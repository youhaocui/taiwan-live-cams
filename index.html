<!DOCTYPE html>
<html lang="zh-TW">
<head>
Â  <meta charset="utf-8" />
Â  <title>å°ç£å³æ™‚ç›´æ’­å››åˆ†å‰²ç›£çœ‹ï¼ˆLive Edge ç©©å®šç‰ˆï¼‰</title>
Â  <meta name="viewport" content="width=device-width,initial-scale=1" />
Â  <style>
Â  Â  /* ---------------------------------------------------------------------- */
Â  Â  /* CSS æ¨£å¼ */
Â  Â  /* ---------------------------------------------------------------------- */
Â  Â  html,body{
Â  Â  Â  height:100%; margin:0; padding:0; background:#000;
Â  Â  Â  font-family: system-ui, sans-serif; color:#fff; overflow:hidden;
Â  Â  }

Â  Â  /* åº•éƒ¨æ§åˆ¶åˆ— */
Â  Â  .controls{
Â  Â  Â  position:fixed; bottom:0; left:0; width:100%; height:78px;
Â  Â  Â  background:rgba(12,12,12,0.95); color:#fff; padding:8px 12px;
Â  Â  Â  box-sizing:border-box; display:flex; flex-direction:row; align-items:center;
Â  Â  Â  gap:10px; z-index:3000; overflow:hidden;
Â  Â  }
Â  Â  .controls button{
Â  Â  Â  background-color:#222; color:#fff; border:1px solid #444;
Â  Â  Â  padding:8px 12px; font-size:13px; cursor:pointer;
Â  Â  Â  border-radius:6px;
Â  Â  Â  height:40px; flex-shrink:0; white-space:nowrap; text-align:center;
Â  Â  }
Â  Â  .controls button.active{ background-color:#0078d7; border-color:#0078d7; }
Â  Â  .divider{ width:1px; height:60%;
Â  Â  Â  background:#333; flex-shrink:0; margin:0;
Â  Â  }

Â  Â  /* ç¸£å¸‚ / æ™¯é»å®¹å™¨ï¼ˆå¯å·¦å³æ»¾å‹•ï¼‰ */
Â  Â  #regionButtons{
Â  Â  Â  display:flex; flex-grow:1; min-width:0; gap:6px;
Â  Â  Â  overflow-x:auto; padding-bottom:6px; height:100%; align-items:center;
Â  Â  }
Â  Â  #regionButtons::-webkit-scrollbar{ height:6px; background-color:rgba(255,255,255,0.06); }
Â  Â  #regionButtons::-webkit-scrollbar-thumb{ background-color:#444;
Â  Â  Â  border-radius:3px;
Â  Â  }
Â  Â  .region-label{ color:#fff; margin:0 8px 0 4px; font-weight:600; flex-shrink:0; user-select:none;
Â  Â  }
Â  Â  /* é€šç”¨åŸå¸‚/æ™¯é»æŒ‰éˆ•æ¨£å¼ */
Â  Â  #regionButtons .city-btn, #regionButtons .stream-btn, #regionButtons .back-btn{
Â  Â  Â  background-color:#111; color:#fff; border:1px solid #555;
Â  Â  Â  padding:6px 10px; margin:0;
Â  Â  Â  border-radius:6px; cursor:pointer;
Â  Â  Â  height:36px; flex-shrink:0; font-size:13px;
Â  Â  }
Â  Â  #regionButtons .city-btn:hover, #regionButtons .stream-btn:hover, #regionButtons .back-btn:hover{
Â  Â  Â  Â  background-color:#1a1a1a; border-color:#666;
Â  Â  }
Â  Â  /* æ™¯é»æŒ‰éˆ•å¾®èª¿æ¨£å¼ */
Â  Â  #regionButtons .stream-btn{
Â  Â  Â  Â  background-color: #222;
Â  Â  Â  Â  border-color: #444;
Â  Â  }
Â  Â  /* è¿”å›æŒ‰éˆ•æ¨£å¼ */
Â  Â  #regionButtons .back-btn{
Â  Â  Â  Â  background-color: #555;
Â  Â  Â  Â  border-color: #777;
Â  Â  }
Â  Â  /* ç•¶å‰é¸ä¸­çš„åŸå¸‚æŒ‰éˆ•ï¼Œç”¨æ–¼åŸå¸‚/æ™¯é»åˆ‡æ›ç‹€æ…‹æ¨™è¨˜ */
Â  Â  #regionButtons .city-btn.active-city{
Â  Â  Â  Â  background-color: #0078d7;
Â  Â  Â  Â  border-color: #0078d7;
Â  Â  }
Â  Â Â 
Â  Â  /* ã€è¶…ä¾µç•¥æ€§ä¿®æ­£ã€‘: éš±è—æ‰€æœ‰ YouTube æ¨è–¦/å¡ç‰‡/è³‡è¨Š/é€£çµ */
Â  Â  .ytp-ce-element,Â  Â  Â  Â  Â  Â  Â  /* End screen elements (ç‰‡å°¾æ¨è–¦) */
Â  Â  .ytp-ce-covering-overlay,Â  Â  Â /* End screen overlay (ç‰‡å°¾é®ç½©) */
Â  Â  .ytp-pause-overlay,Â  Â  Â  Â  Â  Â /* Overlay shown when paused (æš«åœæ™‚çš„æ¨è–¦è¦†è“‹) */
Â  Â  .ytp-cards-module,Â  Â  Â  Â  Â  Â  /* Information cards (è³‡è¨Šå¡ç‰‡ i) */
Â  Â  .ytp-gradient-bottom,Â  Â  Â  Â  Â /* The dark gradient at the bottom */
Â  Â  .ytp-contextmenu,Â  Â  Â  Â  Â  Â  Â /* Right-click menu (å³éµé¸å–®) */
Â  Â  .ytp-button[title*="åˆ†äº«"],Â  Â /* Share button (åˆ†äº«æŒ‰éˆ•) */
Â  Â  .ytp-button[title*="åœ¨ YouTube ä¸Šè§€çœ‹"], /* Watch on YouTube button */
Â  Â  .ytp-chrome-top,Â  Â  Â  Â  Â  Â  Â  /* éš±è—é ‚éƒ¨æ¨™é¡Œå’Œåœ–ç¤º */
Â  Â  .ytp-title-channel,Â  Â  Â  Â  Â  Â /* éš±è—é »é“åç¨± */
Â  Â  .ytp-live-badge {Â  Â  Â  Â  Â  Â  Â /* YouTube ç›´æ’­æ¨™èªŒ */
Â  Â  Â  Â  display: none !important;
Â  Â  Â  Â  visibility: hidden !important;
Â  Â  Â  Â  opacity: 0 !important;
Â  Â  Â  Â  pointer-events: none !important;
Â  Â  Â  Â  z-index: 1 !important;Â 
Â  Â  }
Â  Â  /* ã€CSS ä¿®æ­£çµæŸã€‘ */


Â  Â  /* å½±ç‰‡èˆå°å››æ ¼ */
Â  Â  .stage-wrap{
Â  Â  Â  position:fixed; top:0; left:0; width:100vw;
Â  Â  Â  height:calc(100vh - 78px);
Â  Â  Â  display:grid; grid-template-columns:1fr 1fr; grid-template-rows:1fr 1fr;
Â  Â  Â  gap:0; z-index:1;
Â  Â  }
Â  Â  .cell{ position:relative; width:100%; height:100%;
Â  Â  Â  overflow:hidden; background:#000;
Â  Â  }
Â  Â  .player-container, .player-container iframe{
Â  Â  Â  position:absolute; inset:0; width:100%; height:100%; border:0; display:block;
Â  Â  Â  object-fit:cover; object-position:center;
Â  Â  Â  background:black;
Â  Â  Â  /* é—œéµï¼šæ”¾å¤§ä¸¦å¾®èª¿ä½ç½®ä»¥éš±è— YouTube Logo å’Œæ§åˆ¶åˆ—çš„é‚Šç·£ */
Â  Â  Â  transform: scale(1.65) translateY(-6%);
Â  Â  }
Â  Â  /* é—œéµï¼šå¼·åŒ–é®ç½©ä»¥é˜»æ“‹ YouTube UI/Logo/æ¨è–¦é»æ“Š (Interaction Shield) */
Â  Â  .interaction-shield{
Â  Â  Â  position:absolute; inset:0; z-index:9999; background:transparent;
Â  Â  Â  pointer-events:auto; cursor:default;
Â  Â  }
Â  Â  .label{
Â  Â  Â  position:absolute; left:8px; right:8px; bottom:8px; display:flex;
Â  Â  Â  flex-direction:column; align-items:flex-start; padding:6px 8px;
Â  Â  Â  font-size:14px; color:#fff; background:rgba(0,0,0,0.6); border-radius:6px;
Â  Â  Â  pointer-events:none; z-index:10000;
Â  Â  }
Â  Â  .source-on-screen{ font-size:11px; color:#ccc; margin-top:4px; line-height:1.1;
Â  Â  }

Â  Â  /* é¡¯ç¤ºæ§åˆ¶ */
Â  Â  .hide-labels .label{ display:none;
Â  Â  }
Â  Â  /* åƒ…åœ¨æœ‰ .fullscreen-active æ™‚æ‰éš±è— controls */
Â  Â  .fullscreen-active .controls{ display:none;
Â  Â  }
Â  Â  .fullscreen-active .stage-wrap{ height:100vh; }

Â  Â  @media (max-width:640px){
Â  Â  Â  .controls{ padding:6px 8px;
Â  Â  Â  Â  height:80px;
Â  Â  Â  }
Â  Â  Â  .controls button{ padding:6px 8px; font-size:12px; height:36px;
Â  Â  Â  }
Â  Â  Â  #regionButtons .city-btn, #regionButtons .stream-btn, #regionButtons .back-btn{
Â  Â  Â  Â  padding:6px 8px;
Â  Â  Â  Â  font-size:12px; height:34px;
Â  Â  Â  }
Â  Â  }
Â  Â Â 
Â  Â  /* ---------------------------------------------------------------------- */
Â  Â  /* CSS æ¨£å¼ï¼šéŸ³æ¨‚æ§åˆ¶å€å¡Š (ç¢ºä¿ç·Šæ¹Šæ ¼å¼) */
Â  Â  /* ---------------------------------------------------------------------- */

Â  Â  /* éŸ³æ¨‚æ§åˆ¶å®¹å™¨ï¼šé è¨­éš±è—ï¼Œç”± JS åœ¨æœ‰æ­Œå–®æ™‚åˆ‡æ›ç‚º display: flex */
Â  Â  .music-controls-container {
Â  Â  Â  Â  display: none; flex-shrink: 0;
Â  Â  Â  Â  height: 100%;
Â  Â  Â  Â  align-items: center;
Â  Â  }
Â  Â  .music-controls {
Â  Â  Â  Â  display: flex; gap: 5px; /* æŒ‰éˆ•é–“çš„é–“éš” */
Â  Â  }

Â  Â  /* å°ˆé–€ç‚ºéŸ³æ¨‚æ§åˆ¶æŒ‰éˆ•èª¿æ•´çš„æ¨£å¼ï¼šæ–¹å½¢ã€å±…ä¸­ã€å¤§å­—é«” */
Â  Â  .music-controls button {
Â  Â  Â  Â  /* ç¹¼æ‰¿ .controls button çš„åŸºæœ¬èƒŒæ™¯/é‚Šæ¡†æ¨£å¼ */
Â  Â  Â  Â  background-color: #222; color: #fff;Â 
Â  Â  Â  Â  border: 1px solid #444;
Â  Â  Â  Â  border-radius: 6px;
Â  Â  Â  Â  cursor: pointer;
Â  Â  Â  Â  /* èª¿æ•´ç‚ºç·Šæ¹Šçš„éŸ³æ¨‚æ§åˆ¶æŒ‰éˆ•æ ¼å¼ */
Â  Â  Â  Â  height: 40px;Â 
Â  Â  Â  Â  width: 40px;
Â  Â  Â  Â  /* è¨­ç‚ºæ–¹å½¢ */
Â  Â  Â  Â  padding: 0;
Â  Â  Â  Â  font-size: 16px;
Â  Â  Â  Â  /* ç¢ºä¿ Emoji å¤ å¤§ */
Â  Â  Â  Â  line-height: 1;
Â  Â  Â  Â  flex-shrink: 0;
Â  Â  Â  Â  /* ç¢ºä¿å…§å®¹å±…ä¸­ */
Â  Â  Â  Â  display: flex;
Â  Â  Â  Â  align-items: center;
Â  Â  Â  Â  justify-content: center;
Â  Â  }
Â  Â Â 
Â  Â  /* æ’­æ”¾åˆ—è¡¨ Modal å…§çš„æ¨£å¼ */
Â  Â  #queueListContent ul {
Â  Â  Â  list-style-type: none;Â 
Â  Â  Â  padding-left: 0;Â 
Â  Â  Â  max-height: 250px; /* å¢åŠ é«˜åº¦ */
Â  Â  Â  overflow-y: auto;
Â  Â  }

Â  Â  .song-title {
Â  Â  Â  color: #fff;
Â  Â  Â  display: block;
Â  Â  Â  font-weight: 600;
Â  Â  Â  white-space: nowrap;
Â  Â  Â  overflow: hidden;
Â  Â  Â  text-overflow: ellipsis;
Â  Â  Â  margin-right: 5px;
Â  Â  }

Â  Â  .song-channel {
Â  Â  Â  color: #aaa;
Â  Â  Â  font-size: 11px;
Â  Â  Â  display: block;
Â  Â  Â  white-space: nowrap;
Â  Â  Â  overflow: hidden;
Â  Â  Â  text-overflow: ellipsis;
Â  Â  Â  margin-top: 2px;
Â  Â  }
Â  Â Â 
Â  </style>
</head>
<body>
Â  <div class="controls" id="controls">
Â  Â  <button id="select-cam-0" class="active" onclick="selectCam(0)">å·¦ä¸Š</button>
Â  Â  <button id="select-cam-1" onclick="selectCam(1)">å³ä¸Š</button>
Â  Â  <button id="select-cam-2" onclick="selectCam(2)">å·¦ä¸‹</button>
Â  Â  <button id="select-cam-3" onclick="selectCam(3)">å³ä¸‹</button>

Â  Â  <div class="divider"></div>

Â  Â  <div id="regionButtons" aria-label="ç¸£å¸‚èˆ‡æ™¯é»é¸å–®" role="toolbar"></div>

Â  Â  <div class="divider"></div>
Â  Â  <button id="fullscreenBtn" onclick="toggleFullscreen()">å…¨è¢å¹•</button>

Â  Â  <div class="divider"></div>
Â  Â  <button id="labelsToggleBtn" onclick="toggleLabels()">æ¨™ç±¤éš±è—</button>

Â  Â  <div class="divider"></div>
Â  Â  <button id="muteBtn" onclick="toggleMute()">è§£é™¤éœéŸ³</button>

Â  Â  <div class="divider"></div>
Â  Â  <button id="requestBtn" onclick="requestSong()" title="è¼¸å…¥ç¶²å€/IDé»æ­Œæˆ–æ’­æ”¾æ¸…å–®ï¼Œæˆ– search: é—œéµå­—">ğŸ¶ é»æ­Œ/æ¸…å–®</button>

Â  Â  <div id="musicControlsContainer" class="music-controls-container">
Â 
Â  Â  Â <div class="music-controls">
Â  Â  Â  Â  <button id="prevSongBtn" onclick="skipToPreviousSong()" title="ä¸Šä¸€é¦–">â®ï¸</button>
Â  Â  Â  Â  <button id="playPauseBtn" onclick="playPauseSong()" title="æ’­æ”¾/æš«åœ">â¸ï¸</button>
Â  Â  Â  Â  <button id="nextSongBtn" onclick="skipToNextSong()" title="ä¸‹ä¸€é¦–">â­ï¸</button>
Â  Â  Â  Â  <button id="modeBtn" onclick="openMusicSettingsModal()" title="æ¨¡å¼è¨­å®š">ğŸ”„</button>
Â  Â  Â  Â  <button id="playlistQueueBtn" onclick="showMusicQueueStatusModal()" title="æŸ¥çœ‹æ’­æ”¾åˆ—è¡¨ç‹€æ…‹">ğŸµ</button>
Â  Â  Â  </div>
Â  Â  </div>
Â  </div>

Â  <div class="stage-wrap" id="stageWrap">
Â  Â  <div class="cell" data-index="0">
Â  Â  Â  <div id="player0" class="player-container"></div>
Â  Â  Â  <div class="interaction-shield"></div> <div class="label" id="label0">è¼‰å…¥ä¸­...<span class="source-on-screen"></span></div>
Â  Â  Â  
Â  Â  </div>
Â  Â  <div class="cell" data-index="1">
Â  Â  Â  <div id="player1" class="player-container"></div>
Â  Â  Â  <div class="interaction-shield"></div> <div class="label" id="label1">è¼‰å…¥ä¸­...<span class="source-on-screen"></span></div>
Â  Â  </div>
Â  Â  <div class="cell" data-index="2">
Â  Â  Â  <div id="player2" class="player-container"></div>
Â  Â  Â  <div class="interaction-shield"></div> <div class="label" id="label2">è¼‰å…¥ä¸­...<span class="source-on-screen"></span></div>
Â  Â  </div>
Â  Â  <div class="cell" data-index="3">
Â  Â  Â  <div id="player3" class="player-container"></div>
Â  Â  Â Â 
Â  Â  Â  <div class="interaction-shield"></div> <div class="label" id="label3">è¼‰å…¥ä¸­...<span class="source-on-screen"></span></div>
Â  Â  </div>
Â  </div>

Â  <div id="player_music_container" style="position:fixed;
top:-100px; left:-100px; width:1px; height:1px; overflow:hidden;">
Â  Â  <div id="player_music"></div>
Â  </div>

Â  <div id="musicSettingsModal" style="display:none; position:fixed; inset:0; background:rgba(0,0,0,0.8); z-index:9999;
justify-content:center; align-items:center;">
Â  Â  <div style="background:#222; padding:20px; border-radius:10px; box-shadow:0 0 20px rgba(0,0,0,0.5); width:300px; max-width:90%;
text-align:center;">
Â  Â  Â  <h3 style="margin-top:0; color:#fff;">éŸ³æ¨‚æ’­æ”¾æ¨¡å¼</h3>
Â  Â  Â  <p style="font-size:12px;
color:#aaa;">é»æ“Šä¸‹æ–¹æŒ‰éˆ•é¸æ“‡æ’­æ”¾æ¨¡å¼ï¼š</p>
Â  Â  Â  <div style="display:flex; justify-content:space-around; gap:10px;
margin-top:15px;">
Â  Â  Â  Â  <button id="modeListLoop" class="mode-btn" onclick="setPlaybackMode('listLoop')">ğŸ”„ åˆ—è¡¨å¾ªç’°</button>
Â  Â  Â  Â  <button id="modeShuffle" class="mode-btn" onclick="setPlaybackMode('shuffle')">ğŸ”€ éš¨æ©Ÿæ’­æ”¾</button>
Â  Â  Â  </div>
Â  Â  Â  <button onclick="stopAndCloseModal()" class="stop-btn" style="margin-top:15px;">â¹ï¸ åœæ­¢ä¸¦çµæŸæ’­æ”¾</button>
Â  Â  Â  <button onclick="closeMusicSettingsModal()" class="close-btn" style="margin-top:10px;">é—œé–‰</button>
Â  Â  </div>
Â  </div>

Â  <div id="musicQueueModal" style="display:none;
position:fixed; inset:0; background:rgba(0,0,0,0.8); z-index:9999; justify-content:center; align-items:center;">
Â  Â  <div style="background:#222; padding:20px; border-radius:10px; box-shadow:0 0 20px rgba(0,0,0,0.5); width:350px;
max-width:90%;">
Â  Â  Â  <h3 style="margin-top:0; color:#fff; text-align:center;">ğŸµ æ’­æ”¾åˆ—è¡¨ç‹€æ…‹</h3>
Â  Â  Â  <div id="queueListContent" style="margin-bottom:15px;
padding-right:5px;"></div>
Â  Â  Â  <button onclick="closeMusicQueueModal()" style="margin-top:10px;">é—œé–‰</button>
Â  Â  </div>
Â  </div>

Â  <script src="https://www.youtube.com/iframe_api"></script>
Â  <script>
Â  Â  /* ===== ç›´æ’­ä¾†æºï¼ˆä¿æŒä¸è®Šï¼‰ ===== */
Â  Â  const ALL_STREAMS = {
Â  Â  Â  "å°åŒ—-è±¡å±±çœ‹101": {"id":"z_fY1pj1VBw","label":"å°åŒ—è±¡å±±","source":"Taipei Travel Live Cam å°åŒ—è§€å…‰å³æ™‚å½±åƒ"},
Â  Â  Â  "å°åŒ—-å¤§ç¨»åŸ•": {"id":"Ndo_8RuefH4","label":"å¤§ç¨»åŸ•","source":"Taipei Travel Live Cam å°åŒ—è§€å…‰å³æ™‚å½±åƒ"},
Â  Â  Â  "å°åŒ—-ç¢§å±±å·–": {"id":"uvwfYzwY8tg","label":"ç¢§å±±å·–","source":"Taipei Travel Live Cam å°åŒ—è§€å…‰å³æ™‚å½±åƒ"},
Â  Â  Â  "å°åŒ—-å¾®é¢¨å¹³å°": {"id":"34h_Cy_n0Ok","label":"å¾®é¢¨å¹³å°","source":"Taipei Travel Live Cam å°åŒ—è§€å…‰å³æ™‚å½±åƒ"},
Â  Â  Â  "å°åŒ—-è²“ç©ºæŒ‡å—å®®": {"id":"215ahZ_0rTg","label":"è²“ç©ºæŒ‡å—å®®","source":"Taipei Travel Live Cam å°åŒ—è§€å…‰å³æ™‚å½±åƒ"},
Â  Â  Â  "å°åŒ—-æ“å¤©å²¡è‰åŸ": {"id":"yF2LAyOvq0Q","label":"æ“å¤©å²¡è‰åŸ","source":"é™½æ˜å±±åœ‹å®¶å…¬åœ’"},
Â  Â Â 
Â  Â  Â  "å°åŒ—-é™½æ˜æ›¸å±‹": {"id":"RttyIGHbN_w","label":"é™½æ˜æ›¸å±‹","source":"é™½æ˜å±±åœ‹å®¶å…¬åœ’"},
Â  Â  Â  "å°åŒ—-é çœºä¸ƒæ˜Ÿå±±": {"id":"PvJr2efA6n0","label":"é çœºä¸ƒæ˜Ÿå±±","source":"é™½æ˜å±±åœ‹å®¶å…¬åœ’"},
Â  Â  Â  "å°åŒ—-äºŒåªå­åœè»Šå ´": {"id":"d9KuXrPCWYU","label":"äºŒåªå­åœè»Šå ´","source":"é™½æ˜å±±åœ‹å®¶å…¬åœ’"},
Â  Â  Â  "å°åŒ—-å¤§å±¯è‡ªç„¶å…¬åœ’": {"id":"6ghffcNt3Nw","label":"å¤§å±¯è‡ªç„¶å…¬åœ’","source":"é™½æ˜å±±åœ‹å®¶å…¬åœ’"},
Â  Â  Â  "å°åŒ—-å°æ²¹å‘åœè»Šå ´": {"id":"kKD-ZBLs8-4","label":"å°æ²¹å‘åœè»Šå ´","source":"é™½æ˜å±±åœ‹å®¶å…¬åœ’"},
Â  Â  Â  "å°åŒ—-å†·æ°´å‘åœè»Šå ´": {"id":"GB64WeZZQPQ","label":"å†·æ°´å‘åœè»Šå ´","source":"é™½æ˜å±±åœ‹å®¶å…¬åœ’"},
Â  Â  Â  "æ–°åŒ—-æ¼äººç¢¼é ­": {"id":"xwAWSh35uuw","label":"æ–°åŒ—æ·¡æ°´","source":"æ–°åŒ—æ—…å®¢ New Taipei Tour"},
Â  Â  Â  "æ–°åŒ—-é¼»é ­æœå‹™å€": {"id":"4Bm3IKcGkQY","label":"æ–°åŒ—é¼»é ­","source":"necoast nsa"},
Â  Â  Â  "æ–°åŒ—-ä¸­è§’ç£": {"id":"mmM9NOZLLKY","label":"ä¸­è§’ç£","source":"GoOceanæµ·æ´‹éŠæ†©é¢¨éšªè³‡è¨Š"},
Â  Â  Â  "æ–°åŒ—-ååˆ†ç€‘å¸ƒå…¬åœ’": {"id":"HirBQsQEUeA","label":"ååˆ†ç€‘å¸ƒå…¬åœ’","source":"æ–°åŒ—æ—…å®¢ New Taipei Tour"},
Â  Â  Â  "æ–°åŒ—-ä¹ä»½": {"id":"XSD5ptYisw8","label":"æ–°åŒ—ä¹ä»½","source":"æ–°åŒ—æ—…å®¢ New Taipei Tour"},
Â  Â  Â  "æ–°åŒ—-å…§æ´åœ‹å®¶æ£®æ—éŠæ¨‚å€": {"id":"lX2MYEFomK0","label":"å…§æ´åœ‹å®¶æ£®æ—éŠæ¨‚å€","source":"åœ‹å®¶æ£®æ—éŠæ¨‚å€å³æ™‚å½±åƒ"},
Â  Â  Â  "æ–°åŒ—-ä¸‰å³½è€è¡—åŒ—æ®µ": {"id":"M24SZJU-uoo","label":"ä¸‰å³½è€è¡—åŒ—æ®µ","source":"ä¸‰å³½æ°‘æ¬Šè€è¡—å•†åœˆ"},
Â  Â Â 
Â  Â  Â  "æ–°åŒ—-ä¸‰å³½è€è¡—å—æ®µ": {"id":"R_5jhoux3nY","label":"ä¸‰å³½è€è¡—å—æ®µ","source":"ä¸‰å³½æ°‘æ¬Šè€è¡—å•†åœˆ"},
Â  Â  Â  "æ–°åŒ—-çƒä¾†åŠæ©‹": {"id":"jGoYvmTxLyU","label":"çƒä¾†åŠæ©‹","source":"æ°´åˆ©ç½²æ°´åˆ©é˜²ç½çµ„"},
Â  Â  Â  "æ–°åŒ—-å“¡å±±å­": {"id":"JkGKqXOt9Ls","label":"å“¡å±±å­","source":"æ°´åˆ©ç½²æ°´åˆ©é˜²ç½çµ„"},
Â  Â  Â  "æ–°åŒ—-æ–‡å±±è¾²å ´å¤§è‰çš®": {"id":"_LRkfObNP_U","label":"æ–‡å±±è¾²å ´å¤§è‰çš®","source":"æ–°åŒ—å¸‚è¾²æœƒæ–‡å±±è¾²å ´"},
Â  Â  Â  "åŸºéš†-å¤–æœ¨å±±": {"id":"LInNQYAbAwQ","label":"å¤–æœ¨å±±","source":"GoOceanæµ·æ´‹éŠæ†©é¢¨éšªè³‡è¨Š"},
Â  Â  Â  "æ¡ƒåœ’-åœ‹éš›æ©Ÿå ´": {"id":"91PfFoqvuUk","label":"æ¡ƒåœ’æ©Ÿå ´","source":"éŠæ¡ƒåœ’ Taoyuan Travel"},
Â  Â  Â  "æ¡ƒåœ’-æ¡ƒåœ’æ©Ÿå ´å—è·‘é“": {"id":"y3_x8el5ZJY","label":"TPE å—è·‘é“","source":"Taoyuan Airport"},
Â  Â  Â  "æ¡ƒåœ’-æ¡ƒåœ’æ©Ÿå ´åŒ—è·‘é“": {"id":"wWEnxWA7nnY","label":"TPE åŒ—è·‘é“","source":"Taoyuan Airport"},
Â  Â  Â  "æ¡ƒåœ’-æ°¸å®‰æ¼æ¸¯": {"id":"tD_a03trUvE","label":"æ°¸å®‰æ¼æ¸¯","source":"éŠæ¡ƒåœ’ Taoyuan Travel"},
Â  Â  Â  "æ¡ƒåœ’-æ‹‰æ‹‰å±±éŠå®¢ä¸­å¿ƒ": {"id":"YkIUZjVlhv4","label":"æ‹‰æ‹‰å±±éŠå®¢ä¸­å¿ƒ","source":"éŠæ¡ƒåœ’ Taoyuan Travel"},
Â  Â  Â  "æ¡ƒåœ’-è™é ­å±±ç’°ä¿å…¬åœ’": {"id":"tu_gsIkNt-w","label":"è™é ­å±±ç’°ä¿å…¬åœ’","source":"éŠæ¡ƒåœ’ Taoyuan Travel"},
Â  Â  Â  "æ¡ƒåœ’-å°çƒä¾†å¤©ç©ºæ­¥é“": {"id":"neaiCec1kec","label":"å°çƒä¾†å¤©ç©ºæ­¥é“","source":"éŠæ¡ƒåœ’ Taoyuan Travel"},
Â  Â Â 
Â  Â  "æ¡ƒåœ’-è§’æ¿å±±æ€è¦ªäº­": {"id":"3Za9y4z_Lzc","label":"è§’æ¿å±±æ€è¦ªäº­","source":"éŠæ¡ƒåœ’ Taoyuan Travel"},
Â  Â  Â  "æ¡ƒåœ’-ä¸‰é¾œæˆ²æ°´è§€æ™¯å¹³å°": {"id":"5YDXZ1aiR5Y","label":"ä¸‰é¾œæˆ²æ°´è§€æ™¯å¹³å°","source":"éŠæ¡ƒåœ’ Taoyuan Travel"},
Â  Â  Â  "æ¡ƒåœ’-å¤§æºªæ©‹": {"id":"oFJ6gCaBb_Q","label":"å¤§æºªæ©‹","source":"éŠæ¡ƒåœ’ Taoyuan Travel"},
Â  Â  Â  "æ¡ƒåœ’-è™é ­å±±å¥§çˆ¾æ£®æ—å­¸å ‚": {"id":"yQSmajHyMhU","label":"å¥§çˆ¾æ£®æ—å­¸å ‚","source":"éŠæ¡ƒåœ’ Taoyuan Travel"},
Â  Â  Â  "æ¡ƒåœ’-è§’æ¿å±±æ¢…åœ’": {"id":"-xT1bZhWLuU","label":"è§’æ¿å±±æ¢…åœ’","source":"éŠæ¡ƒåœ’ Taoyuan Travel"},
Â  Â  Â  "æ¡ƒåœ’-è§’æ¿å±±ç”Ÿæ…‹æ± ": {"id":"XEbo8NzMTbQ","label":"è§’æ¿å±±ç”Ÿæ…‹æ± ","source":"éŠæ¡ƒåœ’ Taoyuan Travel"},
Â  Â  Â  "æ¡ƒåœ’-å¤§æºªè€è¡—": {"id":"XUWjAsajKXg","label":"å¤§æºªè€è¡—","source":"éŠæ¡ƒåœ’ Taoyuan Travel"},
Â  Â  Â  "æ¡ƒåœ’-çŸ³é–€æ°´åº«": {"id":"GUCaVR88ZFU","label":"çŸ³é–€æ°´åº«","source":"éŠæ¡ƒåœ’ Taoyuan Travel"},
Â  Â  Â  "æ¡ƒåœ’-æ…ˆæ¹–æ°´å²¸å»£å ´": {"id":"pSQ0e-ZTZ5g","label":"æ…ˆæ¹–æ°´å²¸å»£å ´","source":"éŠæ¡ƒåœ’ Taoyuan Travel"},
Â  Â  Â  "æ¡ƒåœ’-é˜¿å§†åªè–‘æ¯å³¶": {"id":"EUOp2LchPQM","label":"è–‘æ¯å³¶","source":"éŠæ¡ƒåœ’ Taoyuan Travel"},
Â  Â  Â  "æ¡ƒåœ’-ä¸Šå·´é™µ": {"id":"nV-DKquUjFs","label":"ä¸Šå·´é™µ","source":"éŠæ¡ƒåœ’ Taoyuan Travel"},
Â  Â Â 
Â  Â  Â  "æ¡ƒåœ’-æ¡ƒåœ’åœ‹éš›æ©Ÿå ´å‡±æ‚…é…’åº—": {"id":"68GFgzQxrXs","label":"æ©Ÿå ´å‡±æ‚…","source":"éŠæ¡ƒåœ’ Taoyuan Travel"},
Â  Â  Â  "æ¡ƒåœ’-å°çƒä¾†å¯°å®‡å¹³å°": {"id":"PJWye36lEj4","label":"å¯°å®‡å¹³å°","source":"éŠæ¡ƒåœ’ Taoyuan Travel"},
Â  Â  Â  "æ¡ƒåœ’-è¨±åæ¸¯æ¿•åœ°": {"id":"44JArbF682k","label":"è¨±åæ¸¯æ¿•åœ°","source":"éŠæ¡ƒåœ’ Taoyuan Travel"},
Â  Â  Â  "å®œè˜­-å¤–æ¾³æ²™ç˜": {"id":"UgoT-QTbYvo","label":"å®œè˜­å¤–æ¾³","source":"necoast nsa"},
Â  Â  Â  "å®œè˜­-ç¦éš†æµ·æ°´æµ´å ´": {"id":"mMG7v_fET5A","label":"å®œè˜­ç¦éš†","source":"necoast nsa"},Â 
Â  Â  Â  "å®œè˜­-çŸ³åŸæ¼æ¸¯": {"id":"X76Dkt_fPG0","label":"çŸ³åŸæ¼æ¸¯","source":"necoast nsa"},Â 
Â  Â  Â  "å®œè˜­-ç„¡å°¾æ¸¯": {"id":"Bux0vT_5MBw","label":"ç„¡å°¾æ¸¯","source":"GoOceanæµ·æ´‹éŠæ†©é¢¨éšªè³‡è¨Š"},Â 
Â  Â  Â  "å®œè˜­-çŸ³åŸæ¼æ¸¯": {"id":"ozZVLl0h--A","label":"çŸ³åŸæ¼æ¸¯1","source":"GoOceanæµ·æ´‹éŠæ†©é¢¨éšªè³‡è¨Š"},Â 
Â  Â  Â  "å®œè˜­-ç¤æºªå¯’æ²é…’åº—": {"id":"cPh2vzrtG_w","label":"ç¤æºªå¯’æ²é…’åº—","source":"ç¤æºªå¯’æ²é…’åº—MU JIAO XI HOTEL"},Â 
Â  Â  Â  "è‹—æ —-æ±¶æ°´éŠå®¢ä¸­å¿ƒ(é›ªéœ¸)": {"id":"VgmWVBUsfGo","label":"æ±¶æ°´éŠå®¢ä¸­å¿ƒ","source":"é›ªéœ¸åœ‹å®¶å…¬åœ’ Shei-Pa National Park"},
Â  Â  Â  "è‹—æ —-è§€éœ§éŠæ†©å€(é›ªéœ¸)": {"id":"Isp6RQiuxNo","label":"è§€éœ§éŠæ†©å€","source":"é›ªéœ¸åœ‹å®¶å…¬åœ’ Shei-Pa National Park"},
Â  Â Â 
Â  Â  Â  "è‹—æ —-é›ªè¦‹éŠæ†©å€(é›ªéœ¸)": {"id":"2KDE860OW_A","label":"é›ªè¦‹éŠæ†©å€","source":"é›ªéœ¸åœ‹å®¶å…¬åœ’ Shei-Pa National Park"},
Â  Â  Â  "å°ä¸­-é«˜ç¾æ¿•åœ°": {"id":"fjhg3gAnMFg","label":"å°ä¸­é«˜ç¾","source":"å¤§ç©å°ä¸­-è‡ºä¸­è§€å…‰æ—…éŠå±€"},
Â  Â  Â  "å°ä¸­-æœ›é«˜å¯®": {"id":"lhXXhDyjFtI","label":"æœ›é«˜å¯®","source":"å¤§ç©å°ä¸­-è‡ºä¸­è§€å…‰æ—…éŠå±€"},
Â  Â  Â  "å½°åŒ–-ç‹åŠŸæ¼æ¸¯": {"id":"hUG2XK08W5Q","label":"å½°åŒ–ç‹åŠŸ","source":"æ„›ç©å½°åŒ– Changhua Travels"},
Â  Â  Â  "å—æŠ•-åˆæ­¡å±±æ­¦å¶ºäº­": {"id":"2lVMTs_Fj0M","label":"æ­¦å¶ºäº­","source":"å°ç£å³æ™‚å½±åƒç›£è¦–å™¨"},
Â  Â  Â  "å˜‰ç¾©-å¥®èµ·æ¹–": {"id":"B6eki-0-w0g","label":"å˜‰ç¾©å¥®èµ·æ¹–","source":"é˜¿é‡Œå±±åœ‹å®¶é¢¨æ™¯å€ç®¡ç†è™•"},
Â  Â  Â  "å˜‰ç¾©-äºŒå»¶å¹³æ­¥é“": {"id":"j2L_559nCjc","label":"äºŒå»¶å¹³æ­¥é“","source":"é˜¿é‡Œå±±åœ‹å®¶é¢¨æ™¯å€ç®¡ç†è™•"},
Â  Â  Â  "å˜‰ç¾©-å¤ªå¹³é›²æ¢¯": {"id":"dY2cRNr5Buw","label":"å¤ªå¹³é›²æ¢¯","source":"é˜¿é‡Œå±±åœ‹å®¶é¢¨æ™¯å€ç®¡ç†è™•"},
Â  Â  Â  "å˜‰ç¾©-è§¸å£éŠå®¢ä¸­å¿ƒ": {"id":"8KnqJBf_dow","label":"è§¸å£éŠå®¢ä¸­å¿ƒ","source":"é˜¿é‡Œå±±åœ‹å®¶é¢¨æ™¯å€ç®¡ç†è™•"},
Â  Â  Â  "å˜‰ç¾©-æ„›æƒ…å¤§è‰åŸ": {"id":"hMYs60qtkK8","label":"æ„›æƒ…å¤§è‰åŸ","source":"é˜¿é‡Œå±±åœ‹å®¶é¢¨æ™¯å€ç®¡ç†è™•"},
Â  Â  Â  "å˜‰ç¾©-ç”ŸåŠ›è¾²å ´": {"id":"agEzlv9n9Eg","label":"ç”ŸåŠ›è¾²å ´","source":"é˜¿é‡Œå±±åœ‹å®¶é¢¨æ™¯å€ç®¡ç†è™•"},
Â  Â  Â  "å˜‰ç¾©-é‡Œä½³è³‡è¨Šç«™": {"id":"zDt8FBPozZQ","label":"é‡Œä½³è³‡è¨Šç«™","source":"é˜¿é‡Œå±±åœ‹å®¶é¢¨æ™¯å€ç®¡ç†è™•"},
Â  Â  Â  "å°å—-ä¸ƒè‚¡è³é³¥å°": {"id":"5KJe2gCTngA","label":"å°å—ä¸ƒè‚¡","source":"å°æ±Ÿåœ‹å®¶å…¬åœ’ç®¡ç†è™•"},
Â  Â  Â  "å°å—-åŒ—æ±•å°¾æ°´é³¥ä¿è­·å€": {"id":"FES0gWTFUHQ","label":"åŒ—æ±•å°¾æ°´é³¥ä¿è­·å€","source":"å°æ±Ÿåœ‹å®¶é¢¨æ™¯å€ç®¡ç†è™•"},
Â  Â Â 
Â  Â  Â  "å°å—-æ›¾æ–‡æ°´åº«": {"id":"EH4V8IwFIp4","label":"æ›¾æ–‡æ°´åº«","source":"è¥¿æ‹‰é›…åœ‹å®¶é¢¨æ™¯å€ç®¡ç†è™•"},
Â  Â  Â  "å°å—-ç«å±±ç¢§é›²å¯º": {"id":"zkX6X9p-6iA","label":"ç«å±±ç¢§é›²å¯º","source":"è¥¿æ‹‰é›…åœ‹å®¶é¢¨æ™¯å€ç®¡ç†è™•"},
Â  Â  Â  "é«˜é›„-æ——æ´¥æµ·æ°´æµ´å ´": {"id":"ka7FV0sCvxQ","label":"é«˜é›„æ——æ´¥","source":"é«˜é›„æ—…éŠç¶²"},
Â  Â  Â  "é«˜é›„-å£½å±±è§€æ™¯å°": {"id":"C03Itx8iSC0","label":"å£½å±±è§€æ™¯","source":"é«˜é›„æ—…éŠç¶²"},
Â  Â  Â  "å±æ±-å¢¾ä¸å—ç£": {"id":"jUnFuJSj0OU","label":"å¢¾ä¸å—ç£","source":"æˆ‘æ„›å¢¾ä¸æ—…éŠç¥¨åˆ¸ä¸­å¿ƒ"},
Â  Â  Â  "èŠ±è“®-çŸ³æ¢¯åª": {"id":"mXnigLvIL0Q","label":"èŠ±è“®çŸ³æ¢¯åª","source":"æ±éƒ¨æµ·å²¸åœ‹å®¶é¢¨æ™¯å€ç®¡ç†è™•"},
Â  Â  Â  "èŠ±è“®-å¤§çŸ³é¼»å±±": {"id":"JkoXcXI04Qk","label":"å¤§çŸ³é¼»å±±","source":"æ±éƒ¨æµ·å²¸åœ‹å®¶é¢¨æ™¯å€ç®¡ç†è™•"},
Â  Â  Â  "èŠ±è“®-é•·è™¹æ©‹": {"id":"JnD8Rk3o0BM","label":"é•·è™¹æ©‹","source":"æ±éƒ¨æµ·å²¸åœ‹å®¶é¢¨æ™¯å€ç®¡ç†è™•"},
Â  Â  Â  "å°æ±-é¯‰é­šå±±": {"id":"BUJJaW0vkJs","label":"å°æ±é¯‰é­šå±±","source":"Amazing Taitung å°æ±å°±é†¬ç©"},
Â  Â  Â  "å°æ±-é‡‘å´™å¤§æ©‹": {"id":"9QqBz3kNHis","label":"å°æ±é‡‘å´™å¤§æ©‹","source":"Amazing Taitung å°æ±å°±é†¬ç©"},
Â  Â  Â  "å°æ±-é‡‘æ¨½è§€æµª": {"id":"q3KJt-SZc2s","label":"å°æ±é‡‘æ¨½è§€æµª","source":"Amazing Taitung å°æ±å°±é†¬ç©"},
Â  Â  Â  "å°æ±-å¯Œå±±": {"id":"Rsq95SQ26bY","label":"å°æ±å¯Œå±±","source":"Amazing Taitung å°æ±å°±é†¬ç©"},
Â  Â  Â  "å°æ±-æ‰åŸç£": {"id":"VqS_Y8ZCj6M","label":"å°æ±æ‰åŸç£","source":"Amazing Taitung å°æ±å°±é†¬ç©"},
Â  Â Â 
Â  Â  Â  "å°æ±-å¯Œå²¡æ¼æ¸¯": {"id":"D945F_dauls","label":"å°æ±å¯Œå²¡æ¼æ¸¯","source":"Amazing Taitung å°æ±å°±é†¬ç©"},
Â  Â  Â  "å°æ±-è¯æºæ›™å…‰è§€æ™¯å°": {"id":"TY4qQElcUrA","label":"å°æ±è¯æºæ›™å…‰è§€æ™¯å°","source":"Amazing Taitung å°æ±å°±é†¬ç©"},
Â  Â  Â  "å°æ±-å—æ©«åŸ¡å£": {"id":"LSkq-wHMxQY","label":"å°æ±å—æ©«å£","source":"Amazing Taitung å°æ±å°±é†¬ç©"},
Â  Â  Â  "å°æ±-æ± ä¸Šå¤©å ‚è·¯": {"id":"6kUEK3LVrro","label":"å°æ±æ± ä¸Šå¤©å ‚è·¯","source":"Amazing Taitung å°æ±å°±é†¬ç©"},
Â  Â  Â  "å°æ±-å¤šè‰¯è»Šç«™": {"id":"UCG1aXVO8H8","label":"å°æ±å¤šè‰¯","source":"Amazing Taitung å°æ±å°±é†¬ç©"},
Â  Â  Â  "å°æ±-é¹¿é‡é«˜å°": {"id":"rvc1klNIgQc","label":"é¹¿é‡é«˜å°","source":"ervnsa"},
Â  Â  Â  "å°æ±-æˆåŠŸä¸‰ä»™å°": {"id":"dQ7Sd6PGLdA","label":"ä¸‰ä»™å°","source":"æ±éƒ¨æµ·å²¸åœ‹å®¶é¢¨æ™¯å€ç®¡ç†è™•"},
Â  Â  Â  "å°æ±-é‡‘æ¨½éŠæ†©å€": {"id":"ZdqHgQwvZOw","label":"é‡‘æ¨½éŠæ†©å€","source":"æ±éƒ¨æµ·å²¸åœ‹å®¶é¢¨æ™¯å€ç®¡ç†è™•"},
Â  Â  Â  "å°æ±-éƒ½æ­·éŠå®¢ä¸­å¿ƒ": {"id":"JhQuR77AR7U","label":"éƒ½æ­·éŠå®¢ä¸­å¿ƒ","source":"æ±éƒ¨æµ·å²¸åœ‹å®¶é¢¨æ™¯å€ç®¡ç†è™•"},
Â  Â  Â  "å°æ±-åŠ è·¯è˜­éŠæ†©å€": {"id":"AKl3F6cAY2Q","label":"åŠ è·¯è˜­éŠæ†©å€","source":"æ±éƒ¨æµ·å²¸åœ‹å®¶é¢¨æ™¯å€ç®¡ç†è™•"},
Â  Â  Â  "å°æ±-ç¶ å³¶å—å¯®": {"id":"wTHhv7M0vCI","label":"ç¶ å³¶å—å¯®","source":"æ±éƒ¨æµ·å²¸åœ‹å®¶é¢¨æ™¯å€ç®¡ç†è™•"},
Â  Â  Â  "å°æ±-ç¶ å³¶å¸†èˆ¹é¼»": {"id":"pLdBc8PvZko","label":"ç¶ å³¶å¸†èˆ¹é¼»","source":"æ±éƒ¨æµ·å²¸åœ‹å®¶é¢¨æ™¯å€ç®¡ç†è™•"},
Â  Â  Â  "å°æ±-ç¶ å³¶æŸ´å£æµ®æ½›å€": {"id":"a8nJQr5rBGs","label":"ç¶ å³¶æŸ´å£æµ®æ½›å€","source":"æ±éƒ¨æµ·å²¸åœ‹å®¶é¢¨æ™¯å€ç®¡ç†è™•"},
Â  Â Â 
Â  Â  Â  "é‡‘é–€-éº’éºŸå±±æ£®æ—å…¬åœ’": {"id":"M4EJtf_iP8s","label":"é‡‘é–€éº’éºŸå±±å…¬åœ’","source":"æ¨‚éŠé‡‘é–€"},
Â  Â  Â  "é‡‘é–€-134é«˜åœ°": {"id":"-srNHTE-Nf0","label":"é‡‘é–€134é«˜åœ°","source":"æ¨‚éŠé‡‘é–€"},
Â  Â  Â  "é‡‘é–€-å»ºåŠŸå¶¼": {"id":"uh_yNAE01w8","label":"é‡‘é–€å»ºåŠŸå¶¼","source":"æ¨‚éŠé‡‘é–€"}
Â  Â  };
Â  Â  /* ---------------------------------------------------------------------- */
Â  Â  /* JavaScript åŠŸèƒ½ */
Â  Â  /* ---------------------------------------------------------------------- */

Â  Â  // æ‚¨çš„ YouTube Data API Key - å·²åµŒå…¥
Â  Â  const YOUTUBE_API_KEY = "AIzaSyCwW3oAnY8rqIgL-kK9yGCxb7pNsvbvIz4";

Â  Â  const PLAYER_IDS = ['player0', 'player1', 'player2', 'player3'];
Â  Â  const LABEL_IDS = ['label0', 'label1', 'label2', 'label3'];
Â  Â  const DEFAULT_VIDEO_ID = "215ahZ_0rTg";

Â  Â  let selectedCamIndex = 0;
Â  Â  let players = [];
Â  Â  let streamState = Array(4).fill(null);
Â  Â  let isMuted = true;
Â  Â  let currentCity = null;
Â  Â Â 
Â  Â  // éŸ³æ¨‚æ’­æ”¾å™¨ç›¸é—œè®Šæ•¸ (musicQueue ç¾åœ¨å„²å­˜çš„æ˜¯ç‰©ä»¶)
Â  Â  let musicPlayer = null;
Â  Â  let musicQueue = []; // å„²å­˜ {id: videoId, title: string, channel: string}
Â  Â  let currentMusicIndex = -1;
Â  Â  let playbackMode = 'listLoop'; // 'listLoop' æˆ– 'shuffle'
Â  Â  let isPlaying = false;
Â  Â  let isMusicReady = false;
Â  Â  let currentPlaylistId = null;
Â  Â Â 
Â  Â  // å–®ç•«é¢å»¶é²åˆ·æ–°ä¿è­·ç‹€æ…‹
Â  Â  let lastReloadAt = [0, 0, 0, 0];
Â  Â  let isReloading = [false, false, false, false];
Â  Â  const RELOAD_COOLDOWN_MS = 60000; // 60 ç§’å†·å»æ™‚é–“

Â  Â  // åŸå¸‚åˆ†çµ„ï¼ˆä¿æŒä¸è®Šï¼‰
Â  Â  const GROUPED_STREAMS = {};
Â  Â  Object.keys(ALL_STREAMS).forEach(key => {
Â  Â  Â  const city = key.split('-')[0];
Â  Â  Â  if (!GROUPED_STREAMS[city]) GROUPED_STREAMS[city] = [];
Â  Â  Â  GROUPED_STREAMS[city].push({ key: key, ...ALL_STREAMS[key] });
Â  Â  });
Â  Â  const REGION_GROUPS = {
Â  Â  Â  'åŒ—éƒ¨': ['å°åŒ—', 'æ–°åŒ—', 'åŸºéš†', 'æ¡ƒåœ’', 'å®œè˜­', 'æ–°ç«¹'],
Â  Â  Â  'ä¸­éƒ¨': ['è‹—æ —', 'å°ä¸­', 'å½°åŒ–', 'å—æŠ•', 'é›²æ—'],
Â  Â  Â  'å—éƒ¨': ['å˜‰ç¾©', 'å°å—', 'é«˜é›„', 'å±æ±', 'æ¾æ¹–'],
Â  Â  Â  'æ±éƒ¨': ['èŠ±è“®', 'å°æ±'],
Â  Â  Â  'é›¢å³¶': ['é‡‘é–€', 'é¦¬ç¥–']
Â  Â  };
Â  Â  
Â  Â  // =======================================================
Â  Â  // ============= ã€æ’­æ”¾å™¨åˆå§‹åŒ–èˆ‡äº‹ä»¶è™•ç†ã€‘ =============
Â  Â  // =======================================================

Â  Â  function onYouTubeIframeAPIReady() {
Â  Â  Â  PLAYER_IDS.forEach((id, index) => {
Â  Â  Â  Â  const defaultStreams = [
Â  Â  Â  Â  Â  "å°åŒ—-è²“ç©ºæŒ‡å—å®®",
Â  Â  Â  Â  Â  "æ¡ƒåœ’-åœ‹éš›æ©Ÿå ´",
Â  Â  Â  Â  Â  "å°ä¸­-é«˜ç¾æ¿•åœ°",
Â  Â  Â  Â  Â  "é«˜é›„-å£½å±±è§€æ™¯å°"
Â  Â  Â  Â  ];
Â  Â  Â  Â  const defaultKey = defaultStreams[index];
Â  Â  Â  Â  const initialVideoId = (defaultKey && ALL_STREAMS[defaultKey])Â 
? ALL_STREAMS[defaultKey].id : DEFAULT_VIDEO_ID;

Â Â 
Â  Â  Â  Â  players[index] = new YT.Player(id, {
Â  Â  Â  Â  Â  videoId: initialVideoId,
Â  Â  Â  Â  Â  playerVars: {
Â  Â  Â  Â  Â  Â  autoplay: 1, controls: 0, modestbranding: 1, rel: 0, showinfo: 0, fs: 0,
Â  Â  Â  Â  Â  Â  disablekb: 1, loop: 1, mute: 1, playsinline: 1
Â  Â  Â  Â  Â  },
Â  Â  Â  Â  Â  events: {
Â  Â  Â 
Â  Â  Â  Â  Â  Â  onReady: onPlayerReady,
Â  Â  Â  Â  Â  Â  onStateChange: (event) => handleStateChange(event, index)
Â  Â  Â  Â  Â  }
Â  Â  Â  Â  });
Â  Â  Â  Â  if (defaultKey && ALL_STREAMS[defaultKey]) {
Â  Â  Â  Â  Â  streamState[index] = { key: defaultKey, ...ALL_STREAMS[defaultKey] };
Â  Â  Â  Â  Â  updateLabel(index);
Â  Â  Â  Â  }
Â  Â  Â  });
Â  Â  Â  
Â  Â  Â  // ã€éŸ³æ¨‚æ’­æ”¾å™¨åˆå§‹åŒ–ã€‘
Â  Â  Â  musicPlayer = new YT.Player('player_music', {
Â  Â  Â  Â  videoId: '',
Â  Â  Â  Â  playerVars: { autoplay: 0, controls: 0, modestbranding: 1, rel: 0, showinfo: 0, fs: 0, disablekb: 1, loop: 0, mute: 0, playsinline: 1 },
Â  Â  Â  Â  events: { onReady: onMusicPlayerReady, onStateChange: onMusicPlayerStateChange }
Â  Â  Â  });
Â  Â  Â  
Â  Â  Â  renderRegionButtons();Â 
Â  Â  Â  setTimeout(() => {
Â  Â  Â  Â  setInterval(checkStreamDelayLoop, 20000);Â 
Â  Â  Â  Â  console.log("âœ… ç›´æ’­å»¶é²æª¢æ¸¬ (æŒçºŒç›£æ¸¬) å·²å•Ÿå‹•ã€‚");
Â  Â  Â  }, 5000);
Â  Â  Â  document.addEventListener('visibilitychange', handleVisibilityChange);
Â  Â  Â Â 
Â  Â  Â  // ç›£è½å…¨è¢å¹•ç‹€æ…‹è®ŠåŒ–
Â  Â  Â  document.addEventListener('fullscreenchange', handleFullscreenChange);
Â  Â  Â  document.addEventListener('webkitfullscreenchange', handleFullscreenChange);
Â  Â  Â  document.addEventListener('msfullscreenchange', handleFullscreenChange); document.addEventListener('mozfullscreenchange', handleFullscreenChange);Â 
Â  Â  
        // ã€éŸ³æ¨‚æ¨¡å¼æŒ‰éˆ•åˆå§‹åŒ–ã€‘
        updateMusicModeButton();
Â  Â  }

Â  Â  // (ç›´æ’­ç•«é¢) è™•ç†å…¨è¢å¹•ç‹€æ…‹è®ŠåŒ–çš„å‡½å¼ (ä¿æŒä¸è®Š)
Â  Â  function handleFullscreenChange() {
Â  Â  Â  const fullscreenElement = document.fullscreenElement || document.webkitFullscreenElement || document.mozFullScreenElement || document.msFullscreenElement;

Â  Â  Â  if (fullscreenElement) {
Â  Â  Â  Â  document.body.classList.add('fullscreen-active');
Â  Â  Â  } else {
Â  Â  Â  Â  document.body.classList.remove('fullscreen-active');
Â  Â  Â  }
Â  Â  }

Â  Â  // (ç›´æ’­ç•«é¢) é¸æ“‡é¡é ­ (ä¿æŒä¸è®Š)
Â  Â  function selectCam(index) {
Â  Â  Â  selectedCamIndex = index;

Â  Â  Â  document.querySelectorAll('.controls button[id^="select-cam-"]').forEach(btn => {
Â  Â  Â  Â  btn.classList.remove('active');
Â  Â  Â  });
Â  Â  Â  document.getElementById(`select-cam-${index}`).classList.add('active');
Â  Â  }

Â  Â  // (ç›´æ’­ç•«é¢) æ’­æ”¾å™¨äº‹ä»¶è™•ç†ï¼ˆä¿æŒä¸è®Šï¼‰
Â  Â  function onPlayerReady(event) {
Â  Â  Â  const player = event.target;
Â  Â  Â  const index = players.indexOf(player);
Â  Â  Â  try { player.setLoop(true); } catch(e) {}
Â  Â  Â  try { player.mute(); } catch(e) {}
Â  Â  Â  const playPromise = player.playVideo();

Â  Â  Â  if (playPromise && typeof playPromise.catch === 'function') {
Â  Â  Â  Â  playPromise.catch(error => {
Â  Â  Â  Â  Â  // è™•ç†è‡ªå‹•æ’­æ”¾å¤±æ•— (ä¾‹å¦‚ç€è¦½å™¨é˜»æ­¢)
Â  Â  Â  Â  });
Â  Â  Â  }
Â  Â  }

Â  Â  // (ç›´æ’­ç•«é¢) ç‹€æ…‹è®Šæ›´è™•ç†ï¼ˆä¿æŒä¸è®Šï¼‰
Â  Â  function handleStateChange(event, index) {
Â  Â  Â  const st = event.data;
Â  Â  Â  const player = event.target;
Â  Â  Â  if (st === YT.PlayerState.ENDED) {
Â  Â  Â  Â  // ç›´æ’­çµæŸæˆ–é‡åˆ°éŒ¯èª¤ï¼Œé‡æ–°è¼‰å…¥
Â  Â  Â  Â  const state = streamState[index];
Â  Â  Â  Â  if (state) {
Â  Â  Â  Â  Â  player.loadVideoById(state.id);
Â  Â  Â  Â  Â  player.playVideo();
Â  Â  Â  Â  }
Â  Â  Â  } else if (st === YT.PlayerState.PAUSED || st === YT.PlayerState.CUED || st === YT.PlayerState.UNSTARTED) {
Â  Â  Â  Â  if (isReloading[index]) {
Â  Â  Â  Â  Â  return;
Â  Â  Â  Â  }
Â  Â  Â  Â  // å˜—è©¦æ¢å¾©æ’­æ”¾ (é˜²æš«åœ)
Â  Â  Â  Â  setTimeout(() => {
Â  Â  Â  Â  Â  try {
Â  Â  Â  Â  Â  Â  const s = player.getPlayerState ? player.getPlayerState() : null;
Â  Â  Â  Â  Â  Â  if (s !== YT.PlayerState.PLAYING && s !== YT.PlayerState.BUFFERING) {
Â  Â  Â  Â  Â  Â  Â  player.playVideo();
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  } catch(e){}
Â  Â  Â  Â  }, 300);
Â  Â  Â  }
Â  Â  }

Â  Â  // (ç›´æ’­ç•«é¢) å»¶é²æª¢æ¸¬èˆ‡å¼·åˆ¶åŒæ­¥ï¼ˆä¿æŒä¸è®Šï¼‰
Â  Â  function checkStreamDelayLoop() {
Â  Â  Â  const now = Date.now();
Â  Â  Â  players.forEach((player, index) => {
Â  Â  Â  Â  if (!player || !streamState[index]) return;
Â  Â  Â  Â  if (player === musicPlayer) return;
Â  Â  Â  Â  try {
Â  Â  Â  Â  Â  let current = 0, duration = 0;
Â  Â  Â  Â  Â  try { current = player.getCurrentTime ? player.getCurrentTime() : 0; } catch(e){}
Â  Â  Â  Â  Â  try { duration = player.getDuration ? player.getDuration() : 0; } catch(e){}

Â  Â  Â  Â  Â  if (!isFinite(current) || !isFinite(duration) || current <= 0 || duration <= 0) {
Â  Â  Â  Â  Â  Â  if (player.getPlayerState() !== YT.PlayerState.PLAYING) {
Â  Â  Â  Â  Â  Â  Â  player.playVideo();
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  return;
Â  Â  Â  Â  Â  }

Â  Â  Â  Â  Â  const delay = duration - current;
Â  Â  Â  Â  Â  const state = streamState[index];

Â  Â  Â  Â  Â  if (delay > 30 && !isReloading[index] && (now - lastReloadAt[index] > RELOAD_COOLDOWN_MS)) {
Â  Â  Â  Â  Â  Â  isReloading[index]Â 
= true;
Â  Â  Â  Â  Â  Â  lastReloadAt[index] = now;
Â  Â  Â  Â  Â  Â  console.log(`âš ï¸ ç•«é¢ ${index} åµæ¸¬åˆ°è½å¾Œ ${Math.floor(delay)} ç§’ï¼Œå·²åŸ·è¡Œã€Live Edge å¼·åˆ¶åŒæ­¥ã€‘ã€‚`);
Â  Â  Â  Â  Â  Â  const liveDuration = player.getDuration();
Â  Â  Â  Â  Â  Â  try {
Â  Â  Â  Â  Â  Â  Â  if (player && typeof player.seekTo === 'function' && liveDuration > 0) {
Â  Â  Â  Â  Â  Â  Â  Â  player.seekTo(liveDuration, true);
Â  Â  Â  Â  Â  Â  Â  Â  player.playVideo();
Â  Â  Â  Â  Â  Â  Â  } else {
Â  Â  Â  Â  Â  Â  Â  Â  player.loadVideoById(state.id, liveDuration);
Â  Â  Â  Â  Â  Â  Â  Â  player.playVideo();
Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  } catch(e) {
Â  Â  Â  Â  Â  Â  Â  try { player.loadVideoById(state.id, liveDuration); player.playVideo();
Â  Â  Â  Â  Â  Â  Â  } catch(e){}
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  setTimeout(() => { isReloading[index] = false; }, 3000);
Â  Â  Â  Â  Â  }
Â  Â  Â  Â  } catch(e) { console.error(`æª¢æŸ¥å»¶é²å¤±æ•— ${index}:`, e); }
Â  Â  Â  });
Â  Â  }

Â  Â  // ------------------- æ ¸å¿ƒäº’å‹•åŠŸèƒ½ï¼ˆç›´æ’­ç•«é¢ï¼‰ -------------------

Â  Â  function updateLabel(index) {
Â  Â  Â  const state = streamState[index];
Â  Â  Â  const labelElement = document.getElementById(`label${index}`);

Â  Â  Â  if (state) {
Â  Â  Â  Â  labelElement.innerHTML = `${state.label}<span class="source-on-screen">ä¾†æº: ${state.source}</span>`;
Â  Â  Â  } else {
Â  Â  Â  Â  labelElement.innerHTML = `è¼‰å…¥ä¸­...<span class="source-on-screen"></span>`;
Â  Â  Â  }
Â  Â  }

Â  Â  // handleVisibilityChange å‡½å¼ (ä¿æŒä¸è®Š)
Â  Â  function handleVisibilityChange() {
Â  Â  Â  Â  if (!document.hidden) {
Â  Â  Â  Â  Â  Â  players.forEach(player => {
Â  Â  Â  Â  Â  Â  Â  Â  try {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if (player.getPlayerState() !== YT.PlayerState.PLAYING) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  player.playVideo();
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  Â  Â  } catch(e) {}
Â  Â  Â  Â  Â  Â  });

Â  Â  Â  Â  Â  Â  if (typeof musicPlayer !== 'undefined' && typeof isPlaying !== 'undefined' && isPlaying) {
Â  Â  Â  Â  Â  Â  Â  Â  try {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if (musicPlayer.getPlayerState() !== YT.PlayerState.PLAYING) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  musicPlayer.playVideo();
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  Â  Â  } catch(e) {}
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  }
Â  Â  }
Â  Â Â 

Â  Â  /**
Â  Â  Â * è¨­å®šç•¶å‰é¸ä¸­é¡é ­çš„ç›´æ’­ä¸²æµã€‚ï¼ˆä¿æŒä¸è®Šï¼‰
Â  Â  Â */
Â  Â  function setStream(streamKey) {
Â  Â  Â  const stream = ALL_STREAMS[streamKey];
Â  Â  Â  if (!stream) return;

Â  Â  Â  const player = players[selectedCamIndex];
Â  Â  Â  streamState[selectedCamIndex] = { key: streamKey, ...stream };
Â  Â  Â  try {
Â  Â  Â  Â  player.loadVideoById(stream.id);
Â  Â  Â  Â  player.mute();
Â  Â  Â  Â  updateLabel(selectedCamIndex);
Â  Â  Â  } catch(e) {
Â  Â  Â  Â  console.error("è¨­å®šä¸²æµå¤±æ•—:", e);
Â  Â  Â  }
Â  Â  }

Â  Â  function toggleFullscreen() {
Â  Â  Â  const wrap = document.getElementById('stageWrap');
Â  Â  Â  const isFullscreen = document.fullscreenElement || document.webkitFullscreenElement || document.mozFullScreenElement || document.msFullscreenElement;

Â  Â  Â  if (!isFullscreen) {
Â  Â  Â  Â  // é€²å…¥å…¨è¢å¹•
Â  Â  Â  Â  document.body.classList.add('fullscreen-active');
Â  Â  Â  Â  if (wrap.requestFullscreen) {
Â  Â  Â  Â  Â  wrap.requestFullscreen();
Â  Â  Â  Â  } else if (wrap.webkitRequestFullscreen) {
Â  Â  Â  Â  Â  wrap.webkitRequestFullscreen();
Â  Â  Â  Â  } else if (wrap.msRequestFullscreen) {
Â  Â  Â  Â  Â  wrap.msRequestFullscreen();
Â  Â  Â  Â  } else if (wrap.mozRequestFullScreen) {
Â  Â  Â  Â  Â  wrap.mozRequestFullScreen();
Â  Â  Â  Â  }
Â  Â  Â  } else {
Â  Â  Â  Â  // é€€å‡ºå…¨è¢å¹•
Â  Â  Â  Â  document.body.classList.remove('fullscreen-active');
Â  Â  Â  Â  if (document.exitFullscreen) {
Â  Â  Â  Â  Â  document.exitFullscreen();
Â  Â  Â  Â  } else if (document.webkitExitFullscreen) {
Â  Â  Â  Â  Â  document.webkitExitFullscreen();
Â  Â  Â  Â  } else if (document.msExitFullscreen) {
Â  Â  Â  Â  Â  document.msExitFullscreen();
Â  Â  Â  Â  } else if (document.mozCancelFullScreen) {
Â  Â  Â  Â  Â  document.mozCancelFullScreen();
Â  Â  Â  Â  }
Â  Â  Â  }
Â  Â  }

Â  Â  function toggleLabels() {
Â  Â  Â  const body = document.body;
Â  Â  Â  const isHidden = body.classList.toggle('hide-labels');
Â  Â  Â  document.getElementById('labelsToggleBtn').innerText = isHidden ?
'é¡¯ç¤ºæ¨™ç±¤' : 'æ¨™ç±¤éš±è—';
Â  Â  }

Â  Â  function toggleMute() {
Â  Â  Â  isMuted = !isMuted;
Â  Â  Â  players.forEach(player => {
Â  Â  Â  Â  try { isMuted ? player.mute() : player.unMute(); } catch(e){}
Â  Â  Â  });
Â  Â  Â  document.getElementById('muteBtn').innerText = isMuted ? 'è§£é™¤éœéŸ³' : 'éœéŸ³';
Â  Â  }

Â  Â  /**
Â  Â  Â * æ¸²æŸ“é ‚å±¤çš„åœ°å€/åŸå¸‚ç¾¤çµ„æŒ‰éˆ•ã€‚ï¼ˆä¿æŒä¸è®Šï¼‰
Â  Â  Â */
Â  Â  function renderRegionButtons() {
Â  Â  Â  const container = document.getElementById('regionButtons');
Â  Â  Â  container.innerHTML = '';
Â  Â  Â  currentCity = null;

Â  Â  Â  Object.keys(REGION_GROUPS).forEach(region => {
Â  Â  Â  Â  const cities = REGION_GROUPS[region].filter(city => GROUPED_STREAMS[city] && GROUPED_STREAMS[city].length > 0);
Â  Â  Â  Â  if (cities.length === 0) return;

Â  Â  Â  Â  const regionLabel = document.createElement('span');
Â  Â  Â  Â  regionLabel.className = 'region-label';
Â  Â  Â  Â  regionLabel.textContent = region + 'ï¼š';
Â  Â  Â  Â  container.appendChild(regionLabel);

Â  Â  Â  Â  cities.forEach(city => {
Â  Â  Â  Â  Â  const streams = GROUPED_STREAMS[city];
Â  Â  Â  Â  Â  if (streams.length > 0) {
Â  Â  Â  Â  Â  Â  const cityBtn = document.createElement('button');
Â  Â  Â  Â  Â  Â  cityBtn.className = 'city-btn';
Â  Â  Â  Â  Â  Â  cityBtn.textContent = city;
Â  Â  Â  Â  Â  Â  cityBtn.title = `åˆ‡æ›é¡¯ç¤º ${city} çš„ç›´æ’­åˆ—è¡¨`;
Â  Â  Â  Â  Â  Â  if (currentCity === city) {
Â  Â  Â  Â  Â  Â  Â  cityBtn.classList.add('active-city');
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  cityBtn.onclick = () => showCityStreams(city);
Â  Â  Â  Â  Â  Â  container.appendChild(cityBtn);
Â  Â  Â  Â  Â  }
Â  Â  Â  Â  });
Â  Â  Â  });
Â  Â  }

Â  Â  /**
Â  Â  Â * é¡¯ç¤ºç‰¹å®šåŸå¸‚çš„æ™¯é»ç›´æ’­æŒ‰éˆ•åˆ—è¡¨ (å–ä»£åŸå¸‚æŒ‰éˆ•)ã€‚ï¼ˆä¿æŒä¸è®Šï¼‰
Â  Â  Â */
Â  Â  function showCityStreams(city) {
Â  Â  Â  const streams = GROUPED_STREAMS[city];
Â  Â  Â  if (!streams || streams.length === 0) return;

Â  Â  Â  currentCity = city;
Â  Â  Â  const container = document.getElementById('regionButtons');
Â  Â  Â  container.innerHTML = '';

Â  Â  Â  // 1. é¡¯ç¤ºè¿”å›æŒ‰éˆ•
Â  Â  Â  const backBtn = document.createElement('button');
Â  Â  Â  backBtn.className = 'back-btn';
Â  Â  Â  backBtn.textContent = 'ğŸ  è¿”å›åœ°å€åˆ—è¡¨';
Â  Â  Â  backBtn.title = 'è¿”å›åœ°å€/åŸå¸‚é¸æ“‡é é¢';
Â  Â  Â  backBtn.onclick = renderRegionButtons;
Â  Â  Â  container.appendChild(backBtn);

Â  Â  Â  // 2. é¡¯ç¤ºåŸå¸‚åç¨±æ¨™ç±¤
Â  Â  Â  const cityLabel = document.createElement('span');
Â  Â  Â  cityLabel.className = 'region-label';
Â  Â  Â  cityLabel.textContent = `${city}ï¼š`;
Â  Â  Â  container.appendChild(cityLabel);

Â  Â  Â  // 3. é¡¯ç¤ºè©²åŸå¸‚æ‰€æœ‰æ™¯é»æŒ‰éˆ• (ä¸€éµåˆ‡æ›)
Â  Â  Â  streams.forEach(stream => {
Â  Â  Â  Â  const streamBtn = document.createElement('button');
Â  Â  Â  Â  streamBtn.className = 'stream-btn';
Â  Â  Â  Â  // åƒ…é¡¯ç¤ºåœ°åéƒ¨åˆ†ï¼Œä¾‹å¦‚ï¼šå°åŒ—-è±¡å±±çœ‹101 -> è±¡å±±çœ‹101
Â  Â  Â  Â  streamBtn.textContent = stream.key.split('-').slice(1).join('-');
Â  Â  Â  Â  streamBtn.title = `åˆ‡æ›è‡³ï¼š${stream.label} (${stream.source})`;
Â  Â  Â  Â  
Â  Â  Â  Â  // ä½¿ç”¨é–‰åŒ…æ•æ‰ stream.key
Â  Â  Â  Â  streamBtn.onclick = (() => {
Â  Â  Â  Â  Â  const key = stream.key;
Â  Â  Â  Â  Â  return () => setStream(key);
Â  Â  Â  Â  })();
Â  Â  Â  Â  container.appendChild(streamBtn);
Â  Â  Â  });
Â  Â  }

Â  Â  
Â  Â  // =======================================================
Â  Â  // ============= ã€éŸ³æ¨‚æ’­æ”¾å™¨å°ˆå±¬åŠŸèƒ½ã€‘å¯¦ä½œé–‹å§‹ =============
Â  Â  // =======================================================
Â  Â  
Â  Â  // --- éŸ³æ¨‚æ’­æ”¾å™¨äº‹ä»¶è™•ç† ---
Â  Â  
Â  Â  function onMusicPlayerReady(event) {
Â  Â  Â  isMusicReady = true;
Â  Â  Â  console.log("âœ… éŸ³æ¨‚æ’­æ”¾å™¨å·²æº–å‚™å°±ç·’ã€‚");
Â  Â  Â  updateMusicControlsVisibility(); // åˆå§‹åŒ–æ§åˆ¶åˆ—é¡¯ç¤º
Â  Â  Â  // å˜—è©¦åœ¨å°±ç·’æ™‚æ’­æ”¾éšŠåˆ—ä¸­çš„ç¬¬ä¸€é¦–æ­Œ (å¦‚æœæœ‰çš„è©±)
Â  Â  Â  if (musicQueue.length > 0 && currentMusicIndex === 0) {
Â  Â  Â  Â  playPauseSong();
Â  Â  Â  }
Â  Â  }
Â  Â  
Â  Â  function onMusicPlayerStateChange(event) {
Â  Â  Â  const st = event.data;
Â  Â  Â  const playPauseBtn = document.getElementById('playPauseBtn');
Â  Â  Â  
Â  Â  Â  if (st === YT.PlayerState.PLAYING) {
Â  Â  Â  Â  isPlaying = true;
Â  Â  Â  Â  playPauseBtn.innerText = 'â¸ï¸';
Â  Â  Â  } else if (st === YT.PlayerState.PAUSED || st === YT.PlayerState.UNSTARTED || st === YT.PlayerState.CUED) {
Â  Â  Â  Â  isPlaying = false;
Â  Â  Â  Â  playPauseBtn.innerText = 'â–¶ï¸';
Â  Â  Â  } else if (st === YT.PlayerState.ENDED) {
Â  Â  Â  Â  isPlaying = false;
Â  Â  Â  Â  playPauseBtn.innerText = 'â–¶ï¸';
Â  Â  Â  Â  // è‡ªå‹•è·³åˆ°ä¸‹ä¸€é¦–æ­Œ
Â  Â  Â  Â  skipToNextSong(true);
Â  Â  Â  }
Â  Â  }
Â  Â  
Â  Â  // --- æ’­æ”¾/æ§åˆ¶åŠŸèƒ½ ---

Â  Â  /**
Â  Â   * è¼‰å…¥ä¸¦æ’­æ”¾æŒ‡å®šç´¢å¼•çš„æ­Œæ›²
Â  Â   */
Â  Â  function loadAndPlaySong(index) {
Â  Â  Â  if (!isMusicReady || musicQueue.length === 0) return;
Â  Â  Â  
Â  Â  Â  const song = musicQueue[index];
Â  Â  Â  if (!song) {
Â  Â  Â  Â  console.error("å˜—è©¦æ’­æ”¾ç„¡æ•ˆç´¢å¼•çš„æ­Œæ›²:", index);
Â  Â  Â  Â  return;
Â  Â  Â  }
Â  Â  Â  
Â  Â  Â  currentMusicIndex = index;
Â  Â  Â  try {
Â  Â  Â  Â  musicPlayer.loadVideoById(song.id);
Â  Â  Â  Â  musicPlayer.playVideo();
Â  Â  Â  Â  isPlaying = true;
Â  Â  Â  Â  console.log(`ğŸ¶ æ’­æ”¾: ${song.title} - ${song.channel}`);
Â  Â  Â  Â  updateMusicControlsVisibility(); // ç¢ºä¿æ§åˆ¶åˆ—å¯è¦‹
Â  Â  Â  } catch (e) {
Â  Â  Â  Â  console.error("æ’­æ”¾æ­Œæ›²å¤±æ•—:", e);
Â  Â  Â  }
Â  Â  }
Â  Â  
Â  Â  function playPauseSong() {
Â  Â  Â  if (!isMusicReady || musicQueue.length === 0) return;
Â  Â  Â  
Â  Â  Â  try {
Â  Â  Â  Â  if (musicPlayer.getPlayerState() === YT.PlayerState.PLAYING) {
Â  Â  Â  Â  Â  musicPlayer.pauseVideo();
Â  Â  Â  Â  } else {
Â  Â  Â  Â  Â  musicPlayer.playVideo();
Â  Â  Â  Â  }
Â  Â  Â  } catch (e) {
Â  Â  Â  Â  // å¦‚æœæ’­æ”¾å™¨æœªè¼‰å…¥æ­Œæ›²ï¼Œå‰‡è¼‰å…¥ç•¶å‰ç´¢å¼•çš„æ­Œæ›²
Â  Â  Â  Â  if (currentMusicIndex !== -1 && musicQueue[currentMusicIndex]) {
Â  Â  Â  Â  Â  loadAndPlaySong(currentMusicIndex);
Â  Â  Â  Â  }
Â  Â  Â  }
Â  Â  }

Â  Â  function skipToPreviousSong() {
Â  Â  Â  if (musicQueue.length === 0) return;
Â  Â  Â  
Â  Â  Â  let newIndex = currentMusicIndex - 1;
Â  Â  Â  
Â  Â  Â  if (newIndex < 0) {
Â  Â  Â  Â  // å¾ªç’°åˆ°åˆ—è¡¨æœ«å°¾
Â  Â  Â  Â  newIndex = musicQueue.length - 1;
Â  Â  Â  }
Â  Â  Â  
Â  Â  Â  loadAndPlaySong(newIndex);
Â  Â  }

Â  Â  /**
Â  Â   * è·³åˆ°ä¸‹ä¸€é¦–æ­Œæ›²ï¼Œæ”¯æ´å¾ªç’°å’Œéš¨æ©Ÿæ’­æ”¾
Â  Â   * @param {boolean} [auto=false] æ˜¯å¦ç‚ºè‡ªå‹•æ’­æ”¾çµæŸè§¸ç™¼
Â  Â   */
Â  Â  function skipToNextSong(auto = false) {
Â  Â  Â  if (musicQueue.length === 0) {
Â  Â  Â  Â  stopMusic();
Â  Â  Â  Â  return;
Â  Â  Â  }

Â  Â  Â  let newIndex = currentMusicIndex;

Â  Â  Â  if (playbackMode === 'shuffle') {
Â  Â  Â  Â  // éš¨æ©Ÿæ’­æ”¾
Â  Â  Â  Â  while (newIndex === currentMusicIndex) {
Â  Â  Â  Â  Â  newIndex = Math.floor(Math.random() * musicQueue.length);
Â  Â  Â  Â  }
Â  Â  Â  } else {
Â  Â  Â  Â  // åˆ—è¡¨å¾ªç’°
Â  Â  Â  Â  newIndex = currentMusicIndex + 1;
Â  Â  Â  Â  if (newIndex >= musicQueue.length) {
Â  Â  Â  Â  Â  newIndex = 0;
Â  Â  Â  Â  }
Â  Â  Â  }

Â  Â  Â  // å¦‚æœåªå‰©ä¸€é¦–æ­Œï¼Œä¸”æ˜¯è‡ªå‹•çµæŸè§¸ç™¼ï¼Œå‰‡åœæ­¢ï¼ˆé¿å…å–®æ›²ç„¡é™å¾ªç’°ï¼Œé™¤é mode æ˜¯ shuffle ä¸”åªæœ‰ä¸€é¦–ï¼‰
Â  Â  Â  if (musicQueue.length === 1 && auto) {
Â  Â  Â  Â  stopMusic();
Â  Â  Â  Â  return;
Â  Â  Â  }
Â  Â  Â  
Â  Â  Â  loadAndPlaySong(newIndex);
Â  Â  }
Â  Â  
Â  Â  /**
Â  Â   * åœæ­¢æ’­æ”¾ä¸¦é‡è¨­æ’­æ”¾ç‹€æ…‹
Â  Â   */
Â  Â  function stopMusic() {
Â  Â  Â  if (!isMusicReady) return;
Â  Â  Â  try { musicPlayer.stopVideo(); } catch (e) {}
Â  Â  Â  isPlaying = false;
Â  Â  Â  currentMusicIndex = -1;
Â  Â  Â  musicQueue = [];
Â  Â  Â  currentPlaylistId = null;
Â  Â  Â  document.getElementById('musicControlsContainer').style.display = 'none';
Â  Â  Â  console.log("â¹ï¸ éŸ³æ¨‚æ’­æ”¾å·²åœæ­¢ä¸¦æ¸…é™¤åˆ—è¡¨ã€‚");
Â  Â  }
Â  Â  
Â  Â  // --- æ¨¡å¼è¨­å®šèˆ‡ Modal è™•ç† ---
Â  Â  
Â  Â  function updateMusicModeButton() {
Â  Â  Â  const btn = document.getElementById('modeBtn');
Â  Â  Â  if (playbackMode === 'shuffle') {
Â  Â  Â  Â  btn.innerText = 'ğŸ”€';
Â  Â  Â  Â  btn.title = 'æ¨¡å¼: éš¨æ©Ÿæ’­æ”¾';
Â  Â  Â  } else {
Â  Â  Â  Â  btn.innerText = 'ğŸ”„';
Â  Â  Â  Â  btn.title = 'æ¨¡å¼: åˆ—è¡¨å¾ªç’°';
Â  Â  Â  }
Â  Â  }

Â  Â  function setPlaybackMode(mode) {
Â  Â  Â  playbackMode = mode;
Â  Â  Â  updateMusicModeButton();
Â  Â  Â  console.log(`éŸ³æ¨‚æ¨¡å¼è¨­å®šç‚º: ${mode}`);
Â  Â  Â  closeMusicSettingsModal();
Â  Â  }
Â  Â  
Â  Â  function openMusicSettingsModal() {
Â  Â  Â  const modal = document.getElementById('musicSettingsModal');
Â  Â  Â  modal.style.display = 'flex';
Â  Â  }
Â  Â  
Â  Â  function closeMusicSettingsModal() {
Â  Â  Â  document.getElementById('musicSettingsModal').style.display = 'none';
Â  Â  }
Â  Â  
Â  Â  function stopAndCloseModal() {
Â  Â  Â  stopMusic();
Â  Â  Â  closeMusicSettingsModal();
Â  Â  }
Â  Â  
Â  Â  function updateMusicControlsVisibility() {
Â  Â  Â  const container = document.getElementById('musicControlsContainer');
Â  Â  Â  container.style.display = musicQueue.length > 0 ? 'flex' : 'none';
Â  Â  }

Â  Â  // --- æ’­æ”¾åˆ—è¡¨ Modal è™•ç† ---

Â  Â  function showMusicQueueStatusModal() {
Â  Â  Â  const content = document.getElementById('queueListContent');
Â  Â  Â  const modal = document.getElementById('musicQueueModal');
Â  Â  Â  
Â  Â  Â  if (musicQueue.length === 0) {
Â  Â  Â  Â  content.innerHTML = '<p style="color:#aaa; text-align:center;">æ’­æ”¾åˆ—è¡¨æ˜¯ç©ºçš„ã€‚è«‹é»æ­Œï¼</p>';
Â  Â  Â  } else {
Â  Â  Â  Â  let listHTML = '<ul>';
Â  Â  Â  Â  musicQueue.forEach((song, index) => {
Â  Â  Â  Â  Â  const isActive = index === currentMusicIndex;
Â  Â  Â  Â  Â  listHTML += `
Â  Â  Â  Â  Â  Â  <li style="padding: 8px; border-bottom: 1px solid #333; margin-bottom: 5px; cursor: pointer; background: ${isActive ? '#0078d7' : 'transparent'}; border-radius: 4px;"
Â  Â  Â  Â  Â  Â  Â  title="é»æ“Šæ’­æ”¾" onclick="loadAndPlaySong(${index})">
Â  Â  Â  Â  Â  Â  Â  <span class="song-title">${isActive ? 'â–¶ï¸ ' : ''}${index + 1}. ${song.title}</span>
Â  Â  Â  Â  Â  Â  Â  <span class="song-channel">${song.channel}</span>
Â  Â  Â  Â  Â  Â  </li>
Â  Â  Â  Â  Â  `;
Â  Â  Â  Â  });
Â  Â  Â  Â  listHTML += '</ul>';
Â  Â  Â  Â  content.innerHTML = listHTML;
Â  Â  Â  }
Â  Â  Â  
Â  Â  Â  modal.style.display = 'flex';
Â  Â  }

Â  Â  function closeMusicQueueModal() {
Â  Â  Â  document.getElementById('musicQueueModal').style.display = 'none';
Â  Â  }

Â  Â  // --- YouTube API æ•´åˆå‡½å¼ (æ ¸å¿ƒé»æ­Œé‚è¼¯) ---
Â  Â  
Â  Â  /**
Â  Â   * ä½¿ç”¨ YouTube Data API æœå°‹å½±ç‰‡
Â  Â   * @param {string} query æœå°‹é—œéµå­—
Â  Â   * @returns {Promise<object|null>} åŒ…å«å½±ç‰‡ ID å’Œè³‡è¨Šçš„ç‰©ä»¶ï¼Œæˆ– null
Â  Â   */
Â  Â  async function searchYoutube(query) {
Â  Â  Â  if (!query) return null;
Â  Â  Â  // æœå°‹ type=video ä¸”åªå–ä¸€å€‹çµæœ
Â  Â  Â  const url = `https://www.googleapis.com/youtube/v3/search?part=snippet&q=${encodeURIComponent(query)}&type=video&maxResults=1&key=${YOUTUBE_API_KEY}`;

Â  Â  Â  try {
Â  Â  Â  Â  const response = await fetch(url);
Â  Â  Â  Â  if (!response.ok) {
Â  Â  Â  Â  Â  throw new Error(`API response status: ${response.status}`);
Â  Â  Â  Â  }
Â  Â  Â  Â  const data = await response.json();

Â  Â  Â  Â  if (data.items && data.items.length > 0) {
Â  Â  Â  Â  Â  const result = data.items[0];
Â  Â  Â  Â  Â  const videoId = result.id.videoId;
Â  Â  Â  Â  Â  const title = result.snippet.title;
Â  Â  Â  Â  Â  const channelTitle = result.snippet.channelTitle;

Â  Â  Â  Â  Â  console.log(`âœ… YouTube æœå°‹çµæœ: æ‰¾åˆ°å½±ç‰‡ "${title}" (${videoId})`);
Â  Â  Â  Â  Â  return {
Â  Â  Â  Â  Â  Â  id: videoId,
Â  Â  Â  Â  Â  Â  title: title,
Â  Â  Â  Â  Â  Â  channel: channelTitle,
Â  Â  Â  Â  Â  Â  isPlaylist: false
Â  Â  Â  Â  Â  };
Â  Â  Â  Â  } else {
Â  Â  Â  Â  Â  alert("æœå°‹ä¸åˆ°ç›¸é—œå½±ç‰‡ï¼Œè«‹å˜—è©¦æ›´ç²¾ç¢ºçš„é—œéµå­—ã€‚");
Â  Â  Â  Â  Â  return null;
Â  Â  Â  Â  }
Â  Â  Â  } catch (error) {
Â  Â  Â  Â  console.error("YouTube Search API å‘¼å«å¤±æ•—:", error);
Â  Â  Â  Â  alert("æœå°‹åŠŸèƒ½åŸ·è¡Œå¤±æ•—ï¼Œè«‹æª¢æŸ¥ API Key æˆ–ç¶²è·¯é€£ç·šã€‚");
Â  Â  Â  Â  return null;
Â  Â  Â  }
Â  Â  }

Â  Â  /**
Â  Â   * è«‹æ±‚é»æ­Œæˆ–æ’­æ”¾æ¸…å–®
Â  Â   */
Â  Â  async function requestSong() {
Â  Â  Â  let input = prompt("ğŸ¶ è«‹è¼¸å…¥ YouTube ç¶²å€/IDï¼Œæ’­æ”¾æ¸…å–® IDï¼Œæˆ– 'search: é—œéµå­—' ä¾†é»æ­Œï¼š");

Â  Â  Â  if (!input) return;
Â  Â  Â  input = input.trim();

Â  Â  Â  let result = null;

Â  Â  Â  if (input.toLowerCase().startsWith('search:')) {
Â  Â  Â  Â  // è™•ç† search: é—œéµå­—
Â  Â  Â  Â  const query = input.substring(7).trim();
Â  Â  Â  Â  if (query) {
Â  Â  Â  Â  Â  const searchResult = await searchYoutube(query);
Â  Â  Â  Â  Â  if (searchResult) {
Â  Â  Â  Â  Â  Â  // æœå°‹çµæœè¦–ç‚ºå–®ä¸€å½±ç‰‡ï¼Œä½¿ç”¨å…¶ ID é€²è¡Œå¾ŒçºŒè™•ç†
Â  Â  Â  Â  Â  Â  result = { videoId: searchResult.id, isPlaylist: false };
Â  Â  Â  Â  Â  }
Â  Â  Â  Â  } else {
Â  Â  Â  Â  Â  alert("è«‹åœ¨ search: å¾Œé¢è¼¸å…¥æœ‰æ•ˆçš„é—œéµå­—ã€‚");
Â  Â  Â  Â  Â  return;
Â  Â  Â  Â  }
Â  Â  Â  } else {
Â  Â  Â  Â  // è™•ç† ID/URL
Â  Â  Â  Â  const videoMatch = input.match(/(?:youtube\.com\/(?:[^\/]+\/.+\/|(?:v|e(?:mbed)?)\/|.*[?&]v=)|youtu\.be\/)([^"&?\/ ]{11})|list=([^"&?\/ ]+)/i);
Â  Â  Â  Â  
Â  Â  Â  Â  if (videoMatch) {
Â  Â  Â  Â  Â  if (videoMatch[2]) {
Â  Â  Â  Â  Â  Â  // æ’­æ”¾æ¸…å–® ID (list=...)
Â  Â  Â  Â  Â  Â  result = { playlistId: videoMatch[2], isPlaylist: true };
Â  Â  Â  Â  Â  } else {
Â  Â  Â  Â  Â  Â  // å½±ç‰‡ ID (v=... æˆ– youtu.be/...)
Â  Â  Â  Â  Â  Â  result = { videoId: videoMatch[1], isPlaylist: false };
Â  Â  Â  Â  Â  }
Â  Â  Â  Â  } else if (input.length === 11) {
Â  Â  Â  Â  Â  // å¯èƒ½æ˜¯ç´”å½±ç‰‡ ID
Â  Â  Â  Â  Â  result = { videoId: input, isPlaylist: false };
Â  Â  Â  Â  } else if (input.startsWith('PL') || input.startsWith('UU') || input.startsWith('RD') || input.startsWith('OL')) {
Â  Â  Â  Â  Â  // å¯èƒ½æ˜¯ç´”æ’­æ”¾æ¸…å–® ID
Â  Â  Â  Â  Â  result = { playlistId: input, isPlaylist: true };
Â  Â  Â  Â  } else {
Â  Â  Â  Â  Â  alert("è¼¸å…¥æ ¼å¼éŒ¯èª¤æˆ–ç„¡æ³•è­˜åˆ¥ ID/ç¶²å€ã€‚");
Â  Â  Â  Â  Â  return;
Â  Â  Â  Â  }
Â  Â  Â  }
Â  Â  Â  
Â  Â  Â  if (!result) return;
Â  Â  Â  
Â  Â  Â  // æ¸…é™¤èˆŠåˆ—è¡¨ (ç‚ºäº†ç°¡åŒ–ï¼Œæ–°è«‹æ±‚æœƒæ¸…ç©ºèˆŠåˆ—è¡¨)
Â  Â  Â  musicQueue = [];
Â  Â  Â  currentMusicIndex = -1;
Â  Â  Â  currentPlaylistId = null;

Â  Â  Â  if (result.isPlaylist) {
Â  Â  Â  Â  await fetchVideoInfo(null, result.playlistId);
Â  Â  Â  } else {
Â  Â  Â  Â  await fetchVideoInfo(result.videoId, null);
Â  Â  Â  }
Â  Â  }

Â  Â  /**
Â  Â   * ç²å–å½±ç‰‡/æ’­æ”¾æ¸…å–®è³‡è¨Šä¸¦åŠ å…¥éšŠåˆ—
Â  Â   */
Â  Â  async function fetchVideoInfo(videoId, playlistId) {
Â  Â  Â  if (!videoId && !playlistId) return;

Â  Â  Â  if (playlistId) {
Â  Â  Â  Â  console.log(`â³ æ­£åœ¨è¼‰å…¥æ’­æ”¾æ¸…å–® ID: ${playlistId} çš„å½±ç‰‡åˆ—è¡¨...`);
Â  Â  Â  Â  alert("æ’­æ”¾æ¸…å–®åŠŸèƒ½å·²å•Ÿå‹•ï¼Œä½†è¼‰å…¥å¤šå€‹å½±ç‰‡çš„ç´°ç¯€é‚è¼¯è¤‡é›œï¼Œæ­¤è™•ç‚ºç°¡åŒ–ç¯„ä¾‹ï¼Œå»ºè­°æª¢æŸ¥æ§åˆ¶å°è¼¸å‡ºã€‚");
Â  Â  Â  Â  
Â  Â  Â  Â  // é€™è£¡æ‡‰è©²æ˜¯ Playlist API å‘¼å«çš„é‚è¼¯ (è¤‡é›œï¼Œç”¨æ¨¡æ“¬æ•¸æ“šä»£æ›¿)
Â  Â  Â  Â  // åœ¨å¯¦éš›æ‡‰ç”¨ä¸­ï¼Œæ‚¨éœ€è¦ä½¿ç”¨ `playlistItems` endpoint ç²å–æ‰€æœ‰å½±ç‰‡ã€‚
Â  Â  Â  Â  currentPlaylistId = playlistId;
Â  Â  Â  Â  musicQueue.push({ id: 'Ndo_8RuefH4', title: 'æ¸…å–®ç¯„ä¾‹ 1: å¤§ç¨»åŸ•', channel: 'Taipei Cam' });
Â  Â  Â  Â  musicQueue.push({ id: 'z_fY1pj1VBw', title: 'æ¸…å–®ç¯„ä¾‹ 2: è±¡å±±çœ‹101', channel: 'Taipei Cam' });
Â  Â  Â  Â  
Â  Â  Â  } else if (videoId) {
Â  Â  Â  Â  // å–®ä¸€å½±ç‰‡è™•ç† (åŒ…æ‹¬ search: æ‰¾åˆ°çš„å½±ç‰‡)
Â  Â  Â  Â  const url = `https://www.googleapis.com/youtube/v3/videos?part=snippet&id=${videoId}&key=${YOUTUBE_API_KEY}`;
Â  Â  Â  Â  try {
Â  Â  Â  Â  Â  const response = await fetch(url);
Â  Â  Â  Â  Â  const data = await response.json();
Â  Â  Â  Â  Â  
Â  Â  Â  Â  Â  if (data.items && data.items.length > 0) {
Â  Â  Â  Â  Â  Â  const item = data.items[0].snippet;
Â  Â  Â  Â  Â  Â  const newSong = {
Â  Â  Â  Â  Â  Â  Â  id: videoId,
Â  Â  Â  Â  Â  Â  Â  title: item.title,
Â  Â  Â  Â  Â  Â  Â  channel: item.channelTitle
Â  Â  Â  Â  Â  Â  };
Â  Â  Â  Â  Â  Â  
Â  Â  Â  Â  Â  Â  musicQueue.push(newSong);
Â  Â  Â  Â  Â  Â  console.log(`âœ… å·²å°‡å–®æ›² "${newSong.title}" åŠ å…¥æ’­æ”¾åˆ—è¡¨ã€‚`);
Â  Â  Â  Â  Â  Â  
Â  Â  Â  Â  Â  } else {
Â  Â  Â  Â  Â  Â  alert("æ‰¾ä¸åˆ°è©²å½±ç‰‡è³‡è¨Šï¼ŒID å¯èƒ½ç„¡æ•ˆã€‚");
Â  Â  Â  Â  Â  Â  return;
Â  Â  Â  Â  Â  }
Â  Â  Â  Â  } catch (error) {
Â  Â  Â  Â  Â  console.error("Fetch Single Video Info Failed:", error);
Â  Â  Â  Â  Â  alert("è¼‰å…¥å–®æ›²è³‡è¨Šå¤±æ•—ã€‚");
Â  Â  Â  Â  Â  return;
Â  Â  Â  Â  }
Â  Â  Â  }
Â  Â  Â  
Â  Â  Â  // åˆ—è¡¨è¼‰å…¥å®Œæˆå¾Œï¼Œé–‹å§‹æ’­æ”¾ç¬¬ä¸€é¦–
Â  Â  Â  if (musicQueue.length > 0) {
Â  Â  Â  Â  loadAndPlaySong(0);
Â  Â  Â  }
Â  Â  }
Â  Â  
Â  Â  // =======================================================
Â  Â  // ============= ã€éŸ³æ¨‚æ’­æ”¾å™¨å°ˆå±¬åŠŸèƒ½ã€‘å¯¦ä½œçµæŸ =============
Â  Â  // =======================================================
Â  </script>
</body>
</html>
