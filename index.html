<!DOCTYPE html>
<html lang="zh-TW">
<head>
  <meta charset="utf-8" />
  <title>å°ç£å³æ™‚ç›´æ’­å››åˆ†å‰²ç›£çœ‹ï¼ˆLive Edge ç©©å®šç‰ˆï¼‰</title>
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <style>
    /* ---------------------------------------------------------------------- */
    /* CSS æ¨£å¼ - ä¿æŒä¸è®Š */
    /* ---------------------------------------------------------------------- */
    html,body{
      height:100%;
      margin:0; padding:0; background:#000;
      font-family: system-ui, sans-serif; color:#fff; overflow:hidden;
    }

    /* åº•éƒ¨æ§åˆ¶åˆ— */
    .controls{
      position:fixed;
      bottom:0; left:0; width:100%; height:78px;
      background:rgba(12,12,12,0.95); color:#fff; padding:8px 12px;
      box-sizing:border-box; display:flex; flex-direction:row; align-items:center;
      gap:10px; z-index:3000; overflow:hidden;
    }
    .controls button{
      background-color:#222; color:#fff; border:1px solid #444;
      padding:8px 12px; font-size:13px; cursor:pointer;
      border-radius:6px;
      height:40px; flex-shrink:0; white-space:nowrap; text-align:center;
    }
    .controls button.active{ background-color:#0078d7; border-color:#0078d7; }
    .divider{ width:1px; height:60%;
      background:#333; flex-shrink:0; margin:0; }

    /* ç¸£å¸‚ / æ™¯é»å®¹å™¨ï¼ˆå¯å·¦å³æ»¾å‹•ï¼‰ */
    #regionButtons{
      display:flex;
      flex-grow:1; min-width:0; gap:6px;
      overflow-x:auto; padding-bottom:6px; height:100%; align-items:center;
    }
    #regionButtons::-webkit-scrollbar{ height:6px; background-color:rgba(255,255,255,0.06); }
    #regionButtons::-webkit-scrollbar-thumb{ background-color:#444;
      border-radius:3px; }
    .region-label{ color:#fff; margin:0 8px 0 4px; font-weight:600; flex-shrink:0; user-select:none;
      }
    #regionButtons .city-btn{
      background-color:#111; color:#fff; border:1px solid #555;
      padding:6px 10px; margin:0 4px;
      border-radius:6px; cursor:pointer;
      height:36px; flex-shrink:0; font-size:13px;
    }
    #regionButtons .city-btn:hover{ background-color:#1a1a1a; border-color:#666;
      }

    /* å½±ç‰‡èˆå°å››æ ¼ */
    .stage-wrap{
      position:fixed; top:0; left:0; width:100vw;
      height:calc(100vh - 78px);
      display:grid; grid-template-columns:1fr 1fr; grid-template-rows:1fr 1fr;
      gap:0; z-index:1;
    }
    .cell{ position:relative; width:100%; height:100%; overflow:hidden; background:#000;
      }
    .player-container, .player-container iframe{
      position:absolute; inset:0; width:100%; height:100%; border:0; display:block;
      object-fit:cover; object-position:center;
      background:black;
      transform: scale(1.65) translateY(-6%);
    }
    /* å¼·åŒ–é®ç½©ä»¥é˜»æ“‹ YouTube UI/Logo/æ¨è–¦ */
    .interaction-shield{
      position:absolute;
      inset:0; z-index:9999; background:transparent;
      pointer-events:auto; cursor:default;
    }
    .label{
      position:absolute; left:8px; right:8px; bottom:8px; display:flex;
      flex-direction:column; align-items:flex-start; padding:6px 8px;
      font-size:14px; color:#fff; background:rgba(0,0,0,0.6); border-radius:6px;
      pointer-events:none; z-index:10000;
    }
    .source-on-screen{ font-size:11px; color:#ccc; margin-top:4px; line-height:1.1;
      }

    /* é¡¯ç¤ºæ§åˆ¶ */
    .hide-labels .label{ display:none; }
    .fullscreen-active .controls{ display:none;
      }
    .fullscreen-active .stage-wrap{ height:100vh; }

    @media (max-width:640px){
      .controls{ padding:6px 8px;
      height:80px; }
      .controls button{ padding:6px 8px; font-size:12px; height:36px;
      }
      #regionButtons .city-btn{ padding:6px 8px; font-size:12px; height:34px;
      }
    }
    
    /* ---------------------------------------------------------------------- */
    /* CSS æ¨£å¼ï¼šéŸ³æ¨‚æ§åˆ¶å€å¡Š (ä¿æŒä¸è®Š) */
    /* ---------------------------------------------------------------------- */

    /* éŸ³æ¨‚æ§åˆ¶å®¹å™¨ï¼šé è¨­éš±è—ï¼Œç”± JS åœ¨æœ‰æ­Œå–®æ™‚åˆ‡æ›ç‚º display: flex */
    .music-controls-container {
        display: none;
        flex-shrink: 0;
        height: 100%;
        align-items: center;
    }
    .music-controls {
        display: flex;
        gap: 5px; /* æŒ‰éˆ•é–“çš„é–“éš” */
    }

    /* å°ˆé–€ç‚ºéŸ³æ¨‚æ§åˆ¶æŒ‰éˆ•èª¿æ•´çš„æ¨£å¼ï¼šæ–¹å½¢ã€å±…ä¸­ã€å¤§å­—é«” */
    .music-controls button {
        /* ç¹¼æ‰¿ .controls button çš„åŸºæœ¬èƒŒæ™¯/é‚Šæ¡†æ¨£å¼ */
        background-color: #222;
        color: #fff; 
        border: 1px solid #444;
        border-radius: 6px;
        cursor: pointer;
        /* èª¿æ•´ç‚ºç·Šæ¹Šçš„éŸ³æ¨‚æ§åˆ¶æŒ‰éˆ•æ ¼å¼ */
        height: 40px; 
        width: 40px;
        /* è¨­ç‚ºæ–¹å½¢ */
        padding: 0;
        font-size: 16px;
        /* ç¢ºä¿ Emoji å¤ å¤§ */
        line-height: 1;
        flex-shrink: 0;
        /* ç¢ºä¿å…§å®¹å±…ä¸­ */
        display: flex;
        align-items: center;
        justify-content: center;
    }
    
  </style>
</head>
<body>
  <div class="controls" id="controls">
    <button id="select-cam-0" class="active" onclick="selectCam(0)">å·¦ä¸Š</button>
    <button id="select-cam-1" onclick="selectCam(1)">å³ä¸Š</button>
    <button id="select-cam-2" onclick="selectCam(2)">å·¦ä¸‹</button>
    <button id="select-cam-3" onclick="selectCam(3)">å³ä¸‹</button>

    <div class="divider"></div>

    <div id="regionButtons" aria-label="ç¸£å¸‚èˆ‡æ™¯é»é¸å–®" role="toolbar"></div>

    <div class="divider"></div>
    <button id="fullscreenBtn" onclick="toggleFullscreen()">å…¨è¢å¹•</button>

    <div class="divider"></div>
    <button id="labelsToggleBtn" onclick="toggleLabels()">æ¨™ç±¤éš±è—</button>

    <div class="divider"></div>
    <button id="muteBtn" onclick="toggleMute()">è§£é™¤éœéŸ³</button>

    <div class="divider"></div>
    <button id="requestBtn" onclick="requestSong()" title="è¼¸å…¥ç¶²å€/IDé»æ­Œæˆ–æ’­æ”¾æ¸…å–®">ğŸ¶ é»æ­Œ/æ¸…å–®</button>

    <div id="musicControlsContainer" class="music-controls-container">
 
      <div class="music-controls">
        <button id="prevSongBtn" onclick="skipToPreviousSong()" title="ä¸Šä¸€é¦–">â®ï¸</button>
        <button id="playPauseBtn" onclick="playPauseSong()" title="æ’­æ”¾/æš«åœ">â¸ï¸</button>
        <button id="nextSongBtn" onclick="skipToNextSong()" title="ä¸‹ä¸€é¦–">â­ï¸</button>
        <button id="modeBtn" onclick="openMusicSettingsModal()" title="æ¨¡å¼è¨­å®š">ğŸ”„</button>
        <button id="playlistQueueBtn" onclick="showMusicQueueStatusModal()" title="æŸ¥çœ‹æ’­æ”¾åˆ—è¡¨ç‹€æ…‹">ğŸµ</button>
      </div>
    </div>
  </div>

  <div class="stage-wrap" id="stageWrap">
    <div class="cell" data-index="0">
      <div id="player0" class="player-container"></div>
      <div class="interaction-shield"></div>
  
      <div class="label" id="label0">è¼‰å…¥ä¸­...<span class="source-on-screen"></span></div>
    </div>
    <div class="cell" data-index="1">
      <div id="player1" class="player-container"></div>
      <div class="interaction-shield"></div>
      <div class="label" id="label1">è¼‰å…¥ä¸­...<span class="source-on-screen"></span></div>
    </div>
    <div class="cell" data-index="2">
      <div id="player2" class="player-container"></div>
      <div class="interaction-shield"></div>
      <div class="label" id="label2">è¼‰å…¥ä¸­...<span class="source-on-screen"></span></div>
    </div>
    <div class="cell" data-index="3">
      <div id="player3" class="player-container"></div>
      <div 
class="interaction-shield"></div>
      <div class="label" id="label3">è¼‰å…¥ä¸­...<span class="source-on-screen"></span></div>
    </div>
  </div>

  <div id="player_music_container" style="position:fixed;
top:-100px; left:-100px; width:1px; height:1px; overflow:hidden;">
    <div id="player_music"></div>
  </div>

  <div id="musicSettingsModal" style="display:none; position:fixed; inset:0; background:rgba(0,0,0,0.8); z-index:9999;
justify-content:center; align-items:center;">
    <div style="background:#222; padding:20px; border-radius:10px; box-shadow:0 0 20px rgba(0,0,0,0.5); width:300px; max-width:90%;
text-align:center;">
      <h3 style="margin-top:0; color:#fff;">éŸ³æ¨‚æ’­æ”¾æ¨¡å¼</h3>
      <p style="font-size:12px;
color:#aaa;">é»æ“Šä¸‹æ–¹æŒ‰éˆ•é¸æ“‡æ’­æ”¾æ¨¡å¼ï¼š</p>
      <div style="display:flex; justify-content:space-around; gap:10px;
margin-top:15px;">
        <button id="modeListLoop" class="mode-btn" onclick="setPlaybackMode('listLoop')">ğŸ”„ åˆ—è¡¨å¾ªç’°</button>
        <button id="modeShuffle" class="mode-btn" onclick="setPlaybackMode('shuffle')">ğŸ”€ éš¨æ©Ÿæ’­æ”¾</button>
      </div>
      <button onclick="stopAndCloseModal()" class="stop-btn">â¹ï¸ åœæ­¢ä¸¦çµæŸæ’­æ”¾</button>
      <button onclick="closeMusicSettingsModal()" class="close-btn">é—œé–‰</button>
    </div>
  </div>

  <div id="musicQueueModal" style="display:none;
position:fixed; inset:0; background:rgba(0,0,0,0.8); z-index:9999; justify-content:center; align-items:center;">
    <div style="background:#222; padding:20px; border-radius:10px; box-shadow:0 0 20px rgba(0,0,0,0.5); width:350px;
max-width:90%;">
      <h3 style="margin-top:0; color:#fff; text-align:center;">ğŸ¶ æ’­æ”¾åˆ—è¡¨ç‹€æ…‹</h3>
      <div id="queueListContent" style="margin-bottom:15px;
padding-right:5px;"></div>
      <button onclick="closeMusicQueueModal()" style="margin-top:10px;">é—œé–‰</button>
    </div>
  </div>

  <script src="https://www.youtube.com/iframe_api"></script>
  <script>
    /* ===== ç›´æ’­ä¾†æºï¼ˆä¿æŒåŸæ¨£ï¼‰ ===== */
    const ALL_STREAMS = {
      "å°åŒ—-è±¡å±±çœ‹101": {"id":"z_fY1pj1VBw","label":"å°åŒ—è±¡å±±","source":"Taipei Travel Live Cam å°åŒ—è§€å…‰å³æ™‚å½±åƒ"},
      "å°åŒ—-å¤§ç¨»åŸ•": {"id":"Ndo_8RuefH4","label":"å¤§ç¨»åŸ•","source":"Taipei Travel Live Cam å°åŒ—è§€å…‰å³æ™‚å½±åƒ"},
      "å°åŒ—-ç¢§å±±å·–": {"id":"uvwfYzwY8tg","label":"ç¢§å±±å·–","source":"Taipei Travel Live Cam å°åŒ—è§€å…‰å³æ™‚å½±åƒ"},
      "å°åŒ—-å¾®é¢¨å¹³å°": {"id":"34h_Cy_n0Ok","label":"å¾®é¢¨å¹³å°","source":"Taipei Travel Live Cam å°åŒ—è§€å…‰å³æ™‚å½±åƒ"},
      "å°åŒ—-è²“ç©ºæŒ‡å—å®®": {"id":"215ahZ_0rTg","label":"è²“ç©ºæŒ‡å—å®®","source":"Taipei Travel Live Cam å°åŒ—è§€å…‰å³æ™‚å½±åƒ"},
      "å°åŒ—-æ“å¤©å²¡è‰åŸ": {"id":"yF2LAyOvq0Q","label":"æ“å¤©å²¡è‰åŸ","source":"é™½æ˜å±±åœ‹å®¶å…¬åœ’"},
    
      "å°åŒ—-é™½æ˜æ›¸å±‹": {"id":"RttyIGHbN_w","label":"é™½æ˜æ›¸å±‹","source":"é™½æ˜å±±åœ‹å®¶å…¬åœ’"},
      "å°åŒ—-é çœºä¸ƒæ˜Ÿå±±": {"id":"PvJr2efA6n0","label":"é çœºä¸ƒæ˜Ÿå±±","source":"é™½æ˜å±±åœ‹å®¶å…¬åœ’"},
      "å°åŒ—-äºŒåªå­åœè»Šå ´": {"id":"d9KuXrPCWYU","label":"äºŒåªå­åœè»Šå ´","source":"é™½æ˜å±±åœ‹å®¶å…¬åœ’"},
      "å°åŒ—-å¤§å±¯è‡ªç„¶å…¬åœ’": {"id":"6ghffcNt3Nw","label":"å¤§å±¯è‡ªç„¶å…¬åœ’","source":"é™½æ˜å±±åœ‹å®¶å…¬åœ’"},
      "å°åŒ—-å°æ²¹å‘åœè»Šå ´": {"id":"kKD-ZBLs8-4","label":"å°æ²¹å‘åœè»Šå ´","source":"é™½æ˜å±±åœ‹å®¶å…¬åœ’"},
      "å°åŒ—-å†·æ°´å‘åœè»Šå ´": {"id":"GB64WeZZQPQ","label":"å†·æ°´å‘åœè»Šå ´","source":"é™½æ˜å±±åœ‹å®¶å…¬åœ’"},
      "æ–°åŒ—-æ¼äººç¢¼é ­": {"id":"xwAWSh35uuw","label":"æ–°åŒ—æ·¡æ°´","source":"æ–°åŒ—æ—…å®¢ New Taipei Tour"},
      "æ–°åŒ—-é¼»é ­æœå‹™å€": {"id":"4Bm3IKcGkQY","label":"æ–°åŒ—é¼»é ­","source":"necoast nsa"},
      "æ–°åŒ—-ä¸­è§’ç£": {"id":"mmM9NOZLLKY","label":"ä¸­è§’ç£","source":"GoOceanæµ·æ´‹éŠæ†©é¢¨éšªè³‡è¨Š"},
      "æ–°åŒ—-ååˆ†ç€‘å¸ƒå…¬åœ’": {"id":"HirBQsQEUeA","label":"ååˆ†ç€‘å¸ƒå…¬åœ’","source":"æ–°åŒ—æ—…å®¢ New Taipei Tour"},
      "æ–°åŒ—-ä¹ä»½": {"id":"XSD5ptYisw8","label":"æ–°åŒ—ä¹ä»½","source":"æ–°åŒ—æ—…å®¢ New Taipei Tour"},
      "æ–°åŒ—-å…§æ´åœ‹å®¶æ£®æ—éŠæ¨‚å€": {"id":"lX2MYEFomK0","label":"å…§æ´åœ‹å®¶æ£®æ—éŠæ¨‚å€","source":"åœ‹å®¶æ£®æ—éŠæ¨‚å€å³æ™‚å½±åƒ"},
      "æ–°åŒ—-ä¸‰å³½è€è¡—åŒ—æ®µ": {"id":"M24SZJU-uoo","label":"ä¸‰å³½è€è¡—åŒ—æ®µ","source":"ä¸‰å³½æ°‘æ¬Šè€è¡—å•†åœˆ"},
   
      "æ–°åŒ—-ä¸‰å³½è€è¡—å—æ®µ": {"id":"R_5jhoux3nY","label":"ä¸‰å³½è€è¡—å—æ®µ","source":"ä¸‰å³½æ°‘æ¬Šè€è¡—å•†åœˆ"},
      "æ–°åŒ—-çƒä¾†åŠæ©‹": {"id":"jGoYvmTxLyU","label":"çƒä¾†åŠæ©‹","source":"æ°´åˆ©ç½²æ°´åˆ©é˜²ç½çµ„"},
      "æ–°åŒ—-å“¡å±±å­": {"id":"JkGKqXOt9Ls","label":"å“¡å±±å­","source":"æ°´åˆ©ç½²æ°´åˆ©é˜²ç½çµ„"},
      "æ–°åŒ—-æ–‡å±±è¾²å ´å¤§è‰çš®": {"id":"_LRkfObNP_U","label":"æ–‡å±±è¾²å ´å¤§è‰çš®","source":"æ–°åŒ—å¸‚è¾²æœƒæ–‡å±±è¾²å ´"},
      "åŸºéš†-å¤–æœ¨å±±": {"id":"LInNQYAbAwQ","label":"å¤–æœ¨å±±","source":"GoOceanæµ·æ´‹éŠæ†©é¢¨éšªè³‡è¨Š"},
      "æ¡ƒåœ’-åœ‹éš›æ©Ÿå ´": {"id":"91PfFoqvuUk","label":"æ¡ƒåœ’æ©Ÿå ´","source":"éŠæ¡ƒåœ’ Taoyuan Travel"},
      "æ¡ƒåœ’-æ¡ƒåœ’æ©Ÿå ´å—è·‘é“": {"id":"y3_x8el5ZJY","label":"TPE å—è·‘é“","source":"Taoyuan Airport"},
      "æ¡ƒåœ’-æ¡ƒåœ’æ©Ÿå ´åŒ—è·‘é“": {"id":"wWEnxWA7nnY","label":"TPE åŒ—è·‘é“","source":"Taoyuan Airport"},
      "æ¡ƒåœ’-æ°¸å®‰æ¼æ¸¯": {"id":"tD_a03trUvE","label":"æ°¸å®‰æ¼æ¸¯","source":"éŠæ¡ƒåœ’ Taoyuan Travel"},
      "æ¡ƒåœ’-æ‹‰æ‹‰å±±éŠå®¢ä¸­å¿ƒ": {"id":"YkIUZjVlhv4","label":"æ‹‰æ‹‰å±±éŠå®¢ä¸­å¿ƒ","source":"éŠæ¡ƒåœ’ Taoyuan Travel"},
      "æ¡ƒåœ’-è™é ­å±±ç’°ä¿å…¬åœ’": {"id":"tu_gsIkNt-w","label":"è™é ­å±±ç’°ä¿å…¬åœ’","source":"éŠæ¡ƒåœ’ Taoyuan Travel"},
      "æ¡ƒåœ’-å°çƒä¾†å¤©ç©ºæ­¥é“": {"id":"neaiCec1kec","label":"å°çƒä¾†å¤©ç©ºæ­¥é“","source":"éŠæ¡ƒåœ’ Taoyuan Travel"},
     
      "æ¡ƒåœ’-è§’æ¿å±±æ€è¦ªäº­": {"id":"3Za9y4z_Lzc","label":"è§’æ¿å±±æ€è¦ªäº­","source":"éŠæ¡ƒåœ’ Taoyuan Travel"},
      "æ¡ƒåœ’-è§’æ¿å±±ç”Ÿæ…‹æ± ": {"id":"XEbo8NzMTbQ","label":"è§’æ¿å±±ç”Ÿæ…‹æ± ","source":"éŠæ¡ƒåœ’ Taoyuan Travel"},
      "æ¡ƒåœ’-å¤§æºªè€è¡—": {"id":"XUWjAsajKXg","label":"å¤§æºªè€è¡—","source":"éŠæ¡ƒåœ’ Taoyuan Travel"},
      "æ¡ƒåœ’-çŸ³é–€æ°´åº«": {"id":"GUCaVR88ZFU","label":"çŸ³é–€æ°´åº«","source":"éŠæ¡ƒåœ’ Taoyuan Travel"},
      "æ¡ƒåœ’-æ…ˆæ¹–æ°´å²¸å»£å ´": {"id":"pSQ0e-ZTZ5g","label":"æ…ˆæ¹–æ°´å²¸å»£å ´","source":"éŠæ¡ƒåœ’ Taoyuan Travel"},
      "æ¡ƒåœ’-é˜¿å§†åªè–‘æ¯å³¶": {"id":"EUOp2LchPQM","label":"è–‘æ¯å³¶","source":"éŠæ¡ƒåœ’ Taoyuan Travel"},
      "æ¡ƒåœ’-ä¸Šå·´é™µ": {"id":"nV-DKquUjFs","label":"ä¸Šå·´é™µ","source":"éŠæ¡ƒåœ’ Taoyuan Travel"},
      "æ¡ƒåœ’-æ¡ƒåœ’åœ‹éš›æ©Ÿå ´å‡±æ‚…é…’åº—": {"id":"68GFgzQxrXs","label":"æ©Ÿå ´å‡±æ‚…","source":"éŠæ¡ƒåœ’ Taoyuan Travel"},
      "æ¡ƒåœ’-å°çƒä¾†å¯°å®‡å¹³å°": {"id":"PJWye36lEj4","label":"å¯°å®‡å¹³å°","source":"éŠæ¡ƒåœ’ Taoyuan Travel"},
      "æ¡ƒåœ’-è¨±åæ¸¯æ¿•åœ°": {"id":"44JArbF682k","label":"è¨±åæ¸¯æ¿•åœ°","source":"éŠæ¡ƒåœ’ Taoyuan Travel"},
      "å®œè˜­-å¤–æ¾³æ²™ç˜": {"id":"UgoT-QTbYvo","label":"å®œè˜­å¤–æ¾³","source":"necoast nsa"},
      "å®œè˜­-ç¦éš†æµ·æ°´æµ´å ´": {"id":"mMG7v_fET5A","label":"å®œè˜­ç¦éš†","source":"necoast nsa"},
      "å®œè˜­-èˆŠéš§é“å—å£": {"id":"X76Dkt_fPG0","label":"çŸ³åŸæ¼æ¸¯","source":"necoast nsa"},
      "å®œè˜­-ç„¡å°¾æ¸¯": {"id":"Bux0vT_5MBw","label":"ç„¡å°¾æ¸¯","source":"GoOceanæµ·æ´‹éŠæ†©é¢¨éšªè³‡è¨Š"},
      "å®œè˜­-çŸ³åŸæ¼æ¸¯": {"id":"ozZVLl0h--A","label":"çŸ³åŸæ¼æ¸¯1","source":"GoOceanæµ·æ´‹éŠæ†©é¢¨éšªè³‡è¨Š"},
      "å®œè˜­-ç¤æºªå¯’æ²é…’åº—": {"id":"cPh2vzrtG_w","label":"ç¤æºªå¯’æ²é…’åº—","source":"ç¤æºªå¯’æ²é…’åº—MU JIAO XI HOTEL"},
      "è‹—æ —-æ±¶æ°´éŠå®¢ä¸­å¿ƒ(é›ªéœ¸)": {"id":"VgmWVBUsfGo","label":"æ±¶æ°´éŠå®¢ä¸­å¿ƒ","source":"é›ªéœ¸åœ‹å®¶å…¬åœ’ Shei-Pa National Park"},
      "è‹—æ —-è§€éœ§éŠæ†©å€(é›ªéœ¸)": {"id":"Isp6RQiuxNo","label":"è§€éœ§éŠæ†©å€","source":"é›ªéœ¸åœ‹å®¶å…¬åœ’ Shei-Pa National Park"},
      "è‹—æ —-é›ªè¦‹éŠæ†©å€(é›ªéœ¸)": {"id":"2KDE860OW_A","label":"é›ªè¦‹éŠæ†©å€","source":"é›ªéœ¸åœ‹å®¶å…¬åœ’ Shei-Pa National Park"},
      "å°ä¸­-é«˜ç¾æ¿•åœ°": {"id":"fjhg3gAnMFg","label":"å°ä¸­é«˜ç¾","source":"å¤§ç©å°ä¸­-è‡ºä¸­è§€å…‰æ—…éŠå±€"},
      "å°ä¸­-æœ›é«˜å¯®": {"id":"lhXXhDyjFtI","label":"å°ä¸­æœ›é«˜å¯®","source":"å¤§ç©å°ä¸­-è‡ºä¸­è§€å…‰æ—…éŠå±€"},
      "å°ä¸­-å°ä¸­åœ‹éš›æ©Ÿå ´": {"id":"86sC1T8Q4sQ","label":"å°ä¸­æ©Ÿå ´","source":"Taiwan Taoyuan International Airport"},
      "å°ä¸­-è°·é—œæº«æ³‰å…¬åœ’": {"id":"5YV1V_dE3kQ","label":"è°·é—œæº«æ³‰å…¬åœ’","source":"è°·é—œæº«æ³‰æ–‡åŒ–é¤¨"},
      "å½°åŒ–-é¹¿æ¸¯è€è¡—": {"id":"o7D2oP5fQ_I","label":"é¹¿æ¸¯è€è¡—","source":"å½°åŒ–ç¸£é¹¿æ¸¯é®å…¬æ‰€"},
      "å—æŠ•-æ¸…å¢ƒè¾²å ´": {"id":"7eQ5wXq5k6U","label":"æ¸…å¢ƒè¾²å ´","source":"æ¸…å¢ƒè¾²å ´"},
      "å—æŠ•-æ—¥æœˆæ½­": {"id":"z4F_E-49fU0","label":"æ—¥æœˆæ½­","source":"äº¤é€šéƒ¨è§€å…‰ç½²æ—¥æœˆæ½­åœ‹å®¶é¢¨æ™¯å€ç®¡ç†è™•"},
      "é›²æ—-è‰å¶ºçŸ³å£": {"id":"66WjC5I-l_I","label":"è‰å¶ºçŸ³å£","source":"é›²æ—ç¸£æ”¿åºœ"},
      "å˜‰ç¾©-é˜¿é‡Œå±±": {"id":"S3X4yP13H8g","label":"é˜¿é‡Œå±±","source":"è¾²æ¥­éƒ¨æ—æ¥­åŠè‡ªç„¶ä¿è‚²ç½²"},
      "å˜‰ç¾©-é”å¨œä¼Šè°·": {"id":"i-pY8e0rL3k","label":"é”å¨œä¼Šè°·","source":"é˜¿é‡Œå±±åœ‹å®¶é¢¨æ™¯å€ç®¡ç†è™•"},
      "å°å—-å®‰å¹³ç‡ˆå¡”": {"id":"6n5qB5t_92U","label":"å°å—å®‰å¹³","source":"äº¤é€šéƒ¨èˆªæ¸¯å±€"},
      "å°å—-ä¸ƒè‚¡æ½Ÿæ¹–": {"id":"5KJe2gCTngA","label":"å°å—ä¸ƒè‚¡","source":"å°æ±Ÿåœ‹å®¶å…¬åœ’ç®¡ç†è™•"},
      "å°å—-åŒ—æ±•å°¾æ°´é³¥ä¿è­·å€": {"id":"FES0gWTFUHQ","label":"åŒ—æ±•å°¾æ°´é³¥ä¿è­·å€","source":"å°æ±Ÿåœ‹å®¶å…¬åœ’ç®¡ç†è™•"},
      "å°å—-æ›¾æ–‡æ°´åº«": {"id":"EH4V8IwFIp4","label":"æ›¾æ–‡æ°´åº«","source":"è¥¿æ‹‰é›…åœ‹å®¶é¢¨æ™¯å€ç®¡ç†è™•"},
      "å°å—-ç«å±±ç¢§é›²å¯º": {"id":"zkX6X9p-6iA","label":"ç«å±±ç¢§é›²å¯º","source":"è¥¿æ‹‰é›…åœ‹å®¶é¢¨æ™¯å€ç®¡ç†è™•"},
      "é«˜é›„-æ——æ´¥æµ·æ°´æµ´å ´": {"id":"ka7FV0sCvxQ","label":"é«˜é›„æ——æ´¥","source":"é«˜é›„æ—…éŠç¶²"},
      "é«˜é›„-å£½å±±è§€æ™¯å°": {"id":"C03Itx8iSC0","label":"å£½å±±è§€æ™¯","source":"é«˜é›„æ—…éŠç¶²"},
      "å±æ±-å¢¾ä¸å—ç£": {"id":"jUnFuJSj0OU","label":"å¢¾ä¸å—ç£","source":"æˆ‘æ„›å¢¾ä¸æ—…éŠç¥¨åˆ¸ä¸­å¿ƒ"},
      "å±æ±-å°ç‰çƒç™½æ²™å°¾": {"id":"P0_6Yg4V21g","label":"å°ç‰çƒç™½æ²™å°¾","source":"GoOceanæµ·æ´‹éŠæ†©é¢¨éšªè³‡è¨Š"},
      "å±æ±-å°ç‰çƒå¨å°¼æ–¯": {"id":"U4K6t8Wd2rU","label":"å°ç‰çƒå¨å°¼æ–¯","source":"GoOceanæµ·æ´‹éŠæ†©é¢¨éšªè³‡è¨Š"},
      "èŠ±è“®-çŸ³æ¢¯åª": {"id":"mXnigLvIL0Q","label":"èŠ±è“®çŸ³æ¢¯åª","source":"æ±éƒ¨æµ·å²¸åœ‹å®¶é¢¨æ™¯å€ç®¡ç†è™•"},
      "èŠ±è“®-å¤§çŸ³é¼»å±±": {"id":"JkoXcXI04Qk","label":"å¤§çŸ³é¼»å±±","source":"æ±éƒ¨æµ·å²¸åœ‹å®¶é¢¨æ™¯å€ç®¡ç†è™•"},
      "èŠ±è“®-é•·è™¹æ©‹": {"id":"JnD8Rk3o0BM","label":"é•·è™¹æ©‹","source":"æ±éƒ¨æµ·å²¸åœ‹å®¶é¢¨æ™¯å€ç®¡ç†è™•"},
      "å°æ±-é¯‰é­šå±±": {"id":"BUJJaW0vkJs","label":"å°æ±é¯‰é­šå±±","source":"Amazing Taitung å°æ±å°±é†¬ç©"},
      "å°æ±-é‡‘å´™å¤§æ©‹": {"id":"9QqBz3kNHis","label":"å°æ±é‡‘å´™å¤§æ©‹","source":"Amazing Taitung å°æ±å°±é†¬ç©"},
      "å°æ±-é‡‘æ¨½è§€æµª": {"id":"q3KJt-SZc2s","label":"å°æ±é‡‘æ¨½è§€æµª","source":"Amazing Taitung å°æ±å°±é†¬ç©"},
      "å°æ±-å¯Œå±±æ¼æ¥­": {"id":"uJ4X8sJ9g8s","label":"å°æ±å¯Œå±±æ¼æ¥­","source":"Amazing Taitung å°æ±å°±é†¬ç©"},
      "å°æ±-ä¸‰ä»™å°": {"id":"zI0P4z2_0tA","label":"å°æ±ä¸‰ä»™å°","source":"æ±éƒ¨æµ·å²¸åœ‹å®¶é¢¨æ™¯å€ç®¡ç†è™•"},
      "é€£æ±Ÿ-æ±å¼•": {"id":"0G7n9vS9g8k","label":"é¦¬ç¥–æ±å¼•","source":"é¦¬ç¥–åœ‹å®¶é¢¨æ™¯å€ç®¡ç†è™•"},
      "é€£æ±Ÿ-å—ç«¿": {"id":"H3hYf6s8t2p","label":"é¦¬ç¥–å—ç«¿","source":"é¦¬ç¥–åœ‹å®¶é¢¨æ™¯å€ç®¡ç†è™•"},
    };

    const GROUPED_STREAMS = {}; // ä¾ç¸£å¸‚åˆ†é¡çš„ç›´æ’­æµ
    const CITY_ALIAS_TO_BASE = {
      "å°åŒ—": "å°åŒ—", "æ–°åŒ—": "æ–°åŒ—", "åŸºéš†": "åŸºéš†", "æ¡ƒåœ’": "æ¡ƒåœ’", "æ–°ç«¹": "æ–°ç«¹",
      "è‹—æ —": "è‹—æ —", "å°ä¸­": "å°ä¸­", "å½°åŒ–": "å½°åŒ–", "å—æŠ•": "å—æŠ•", "é›²æ—": "é›²æ—",
      "å˜‰ç¾©": "å˜‰ç¾©", "å°å—": "å°å—", "é«˜é›„": "é«˜é›„", "å±æ±": "å±æ±", "å®œè˜­": "å®œè˜­",
      "èŠ±è“®": "èŠ±è“®", "å°æ±": "å°æ±", "é€£æ±Ÿ": "é€£æ±Ÿ",
    };
    const REGION_GROUPS = {
        "åŒ—åŒ—åŸºæ¡ƒ": ["å°åŒ—", "æ–°åŒ—", "åŸºéš†", "æ¡ƒåœ’"],
        "ä¸­å°ç£": ["è‹—æ —", "å°ä¸­", "å½°åŒ–", "å—æŠ•", "é›²æ—"],
        "å—å°ç£": ["å˜‰ç¾©", "å°å—", "é«˜é›„", "å±æ±"],
        "æ±å°ç£": ["å®œè˜­", "èŠ±è“®", "å°æ±"],
        "é›¢å³¶": ["é€£æ±Ÿ"]
    };

    // å¡«å…… GROUPED_STREAMS
    for (const key in ALL_STREAMS) {
      const cityMatch = key.match(/^(.+?)-/);
      if (cityMatch) {
        const cityName = cityMatch[1];
        const baseCityName = CITY_ALIAS_TO_BASE[cityName] || cityName;
        if (!GROUPED_STREAMS[baseCityName]) {
          GROUPED_STREAMS[baseCityName] = [];
        }
        GROUPED_STREAMS[baseCityName].push({ key: key, ...ALL_STREAMS[key] });
      }
    }

    /* æ‡‰ç”¨ç¨‹å¼ç‹€æ…‹ */
    const NUM_PLAYERS = 4;
    const DEFAULT_VIDEO_ID = 'z_fY1pj1VBw'; // é è¨­çš„ç•«é¢ï¼Œå°åŒ—è±¡å±±
    const players = []; // YouTube Player ç‰©ä»¶é™£åˆ—
    const streamState = []; // å„²å­˜æ¯å€‹ç•«é¢çš„ç›´æ’­è³‡è¨Š { key, id, label, source }
    let selectedCamIndex = 0; // ç•¶å‰é¸ä¸­çš„ç•«é¢ (0-3)
    let isMuted = true; // æ‡‰ç”¨ç¨‹å¼å±¤ç´šçš„éœéŸ³ç‹€æ…‹
    let lastReloadAt = [0, 0, 0, 0]; // æ¯å€‹ç•«é¢ä¸Šæ¬¡é‡æ–°è¼‰å…¥çš„æ™‚é–“æˆ³
    let isReloading = [false, false, false, false]; // æ¨™è¨˜æ¯å€‹ç•«é¢æ˜¯å¦æ­£åœ¨é‡æ–°è¼‰å…¥
    const MAX_IFRAME_RELOADS = 3;
    const RELOAD_COOLDOWN_MS = 60000;
    
    /* Music-related variables and constants (å¾ .txt æ•´åˆ) */
    let musicPlayer; // YouTube Player ç‰©ä»¶
    let musicQueue = []; // æ’­æ”¾ä½‡åˆ— (å–®æ›²æ¨¡å¼)
    let currentMusicIndex = -1; // ç•¶å‰æ’­æ”¾çš„æ­Œæ›²ç´¢å¼•
    let currentPlaylistId = null; // ç•¶å‰æ’­æ”¾çš„æ’­æ”¾æ¸…å–® ID (æ¸…å–®æ¨¡å¼)
    let playbackMode = 'listLoop'; // 'listLoop' (åˆ—è¡¨å¾ªç’°) or 'shuffle' (éš¨æ©Ÿæ’­æ”¾)
    let isPlaying = false; // è¿½è¹¤å¯¦éš›æ’­æ”¾ç‹€æ…‹
    const MUSIC_QUEUE_LIMIT = 50; // æ’­æ”¾åˆ—è¡¨å–®æ›²ä¸Šé™
    const YOUTUBE_URL_REGEX = /(?:youtu\.be\/|youtube\.com\/(?:embed\/|v\/|watch\?v=|watch\?.+&v=))([^&?]+)/;
    
    const defaultStreams = [
      "å°åŒ—-è²“ç©ºæŒ‡å—å®®", "æ¡ƒåœ’-åœ‹éš›æ©Ÿå ´", "å°ä¸­-é«˜ç¾æ¿•åœ°", "é«˜é›„-å£½å±±è§€æ™¯å°"
    ];


    /* YouTube Iframe API è™•ç† */

    function onYouTubeIframeAPIReady() {
      // åˆå§‹åŒ–å››å€‹ç›´æ’­æ’­æ”¾å™¨
      document.querySelectorAll('.player-container').forEach((container, index) => {
        const id = container.id;
        const defaultKey = defaultStreams[index];
        const initialVideoId = (defaultKey && ALL_STREAMS[defaultKey]) ? ALL_STREAMS[defaultKey].id : DEFAULT_VIDEO_ID;
        
        players[index] = new YT.Player(id, {
          videoId: initialVideoId,
          playerVars: { autoplay: 1, controls: 0, modestbranding: 1, rel: 0, showinfo: 0, fs: 0, disablekb: 1, loop: 1, mute: 1, playsinline: 1 },
          events: { onReady: onPlayerReady, onStateChange: (event) => handleStateChange(event, index) }
        });

        if (defaultKey && ALL_STREAMS[defaultKey]) {
          streamState[index] = { key: defaultKey, ...ALL_STREAMS[defaultKey] };
          updateLabel(index);
        }
      });
      
      // åˆå§‹åŒ–éŸ³æ¨‚æ’­æ”¾å™¨ (å¾ .txt æ•´åˆ)
      musicPlayer = new YT.Player('player_music', {
        videoId: '',
        playerVars: { autoplay: 0, controls: 0, modestbranding: 1, rel: 0, showinfo: 0, fs: 0, disablekb: 1, loop: 0, mute: 0, playsinline: 1 },
        events: { onReady: onMusicPlayerReady, onStateChange: onMusicPlayerStateChange }
      });

      renderRegionButtons(); 
      // å»¶é²æª¢æ¸¬è¿´åœˆï¼šå»¶å¾Œ 5 ç§’é–‹å§‹åŸ·è¡Œï¼Œä½œç‚ºæŒçºŒç›£æ¸¬æ©Ÿåˆ¶ã€‚
      setTimeout(() => {
        setInterval(checkStreamDelayLoop, 20000);
        console.log("é–‹å§‹åŸ·è¡Œ Live Edge å»¶é²æª¢æ¸¬è¿´åœˆ...");
      }, 5000); 
    }

    function onPlayerReady(event) {
      try { event.target.setLoop(true); } catch(e){}
      try { event.target.mute(); } catch(e){}
      try { event.target.playVideo(); } catch(e){}
    }

    // å–®æ’­æ”¾å™¨ç‹€æ…‹è™•ç†ï¼Œåªè™•ç†è‡ªå·±çš„ index
    function handleStateChange(event, index) {
      const st = event.data;
      
      // è™•ç†çµæŸï¼šYouTube ç›´æ’­å¯èƒ½åœ¨çµæŸæ™‚é¡¯ç¤ºæ¨è–¦ç•«é¢ï¼Œå°è‡´ç•«é¢å‡çµã€‚
      if (st === YT.PlayerState.ENDED) {
        const currentState = streamState[index];
        if (currentState) {
          try {
            // å„ªå…ˆ seekTo(0)+playï¼Œé¿å…çµæŸæ¨è–¦é 
            if (players[index] && typeof players[index].seekTo === 'function') {
              players[index].seekTo(0, true);
              players[index].playVideo();
            } else {
              // å‚™ç”¨æ–¹æ¡ˆï¼šé‡æ–°è¼‰å…¥å½±ç‰‡
              players[index].loadVideoById(currentState.id, 0);
              players[index].playVideo();
            }
          } catch(e) { 
            try { players[index].loadVideoById(currentState.id, 0); players[index].playVideo(); } catch(e){}
          }
        }
      } 
      
      // è™•ç†æš«åœ/æœªé–‹å§‹/å·²ç·©è¡ç‹€æ…‹ï¼šå¯è¦–æ€§åˆ‡å›ç­‰æƒ…æ³ï¼Œé¿å…åœåœ¨é è¦½/æ¨è–¦
      if (st === YT.PlayerState.PAUSED || st === YT.PlayerState.CUED || st === YT.PlayerState.UNSTARTED) {
        setTimeout(() => {
          try {
            const p = players[index];
            if (!p) return;
            const s = p.getPlayerState ? p.getPlayerState() : null;
            // åªæœ‰ç•¶å‰ç‹€æ…‹æ˜ç¢ºä¸æ˜¯ã€Œæ­£åœ¨æ’­æ”¾ã€æˆ–ã€Œæ­£åœ¨ç·©è¡ã€æ™‚ï¼Œæ‰å˜—è©¦ playVideo()
            if (s !== YT.PlayerState.PLAYING && s !== YT.PlayerState.BUFFERING) {
              p.playVideo();
            }
          } catch(e){}
        }, 300);
      }
    }

    // ç¢ºä¿ç›´æ’­æ°¸é è·³åˆ° Live Edge
    function checkStreamDelayLoop() {
      const now = Date.now();
      players.forEach((player, index) => {
        if (!player || !streamState[index]) return;
        // å¿½ç•¥éŸ³æ¨‚æ’­æ”¾å™¨
        if (player === musicPlayer) return; 
        try {
          let current = 0, duration = 0;
          try { current = player.getCurrentTime ? player.getCurrentTime() : 0; } catch(e){}
          try { duration = player.getDuration ? player.getDuration() : 0; } catch(e){}
          
          // ä¿®æ­£ç¯©é¸é‚è¼¯ï¼šåªæ’é™¤ç„¡æ•ˆæˆ–éæ•¸å­—æ™‚é–“ã€‚
          if (!isFinite(current) || !isFinite(duration) || current <= 0 || duration <= 0) {
            // å¦‚æœ duration ä¸åˆç†ï¼Œæˆ‘å€‘ä»ç„¶å˜—è©¦ playVideo() ä¾†ç¢ºä¿å®ƒä¿æŒæ´»å‹•ç‹€æ…‹
            if (player.getPlayerState() !== YT.PlayerState.PLAYING) {
              player.playVideo();
            }
            return;
          }

          const delay = duration - current;
          const state = streamState[index];
          
          // å»¶é²è¶…é 30 ç§’ï¼Œä¸”ä¸åœ¨é‡æ–°è¼‰å…¥ä¸­ï¼Œä¸”è¶…éå†·å»æ™‚é–“ (60 ç§’)
          if (delay > 30 && !isReloading[index] && 
             (now - lastReloadAt[index] > RELOAD_COOLDOWN_MS)) {
             
            isReloading[index] = true;
            lastReloadAt[index] = now;
            
            console.log(`ç•«é¢ ${index} å»¶é² ${Math.floor(delay)} ç§’ï¼Œåƒ…é‡æ–°è¼‰å…¥ï¼š${state.label}`);
            
            try {
              // å„ªå…ˆ seekTo(0)+playï¼Œé¿å…çµæŸæ¨è–¦é 
              if (player && typeof player.seekTo === 'function') {
                player.seekTo(0, true);
                player.playVideo();
              } else {
                // å‚™ç”¨æ–¹æ¡ˆï¼šé‡æ–°è¼‰å…¥å½±ç‰‡
                player.loadVideoById(state.id, 0);
                player.playVideo();
              }
            } catch(e) {
              try { player.loadVideoById(state.id, 0); player.playVideo(); } catch(e){}
            }
            
            // è¨­ç½®ä¸€å€‹çŸ­å»¶é²ä¾†æ¸…é™¤é‡æ–°è¼‰å…¥æ¨™è¨˜
            setTimeout(() => {
                isReloading[index] = false;
            }, 3000); 
          }
        } catch(e){
          console.error(`Check delay error on player ${index}:`, e);
        }
      });
    }

// --------------------------------------------------------------------------------
// |                              éŸ³æ¨‚æ’­æ”¾åŠŸèƒ½ (Music Player Functions)             |
// --------------------------------------------------------------------------------

    function onMusicPlayerReady(event) {
      console.log('Music Player Ready.');
    }

    function onMusicPlayerStateChange(event) {
      if (event.data === YT.PlayerState.ENDED) {
        // å¦‚æœæ˜¯æ’­æ”¾æ¸…å–®æ¨¡å¼ï¼Œè®“ YT å…§å»ºè™•ç† (æœƒè‡ªå‹•è·³åˆ°ä¸‹ä¸€é¦–/å¾ªç’°)
        if (currentPlaylistId) {
          // Playlist mode handles ENDED internally for next video
        } else {
          // å–®æ›²æ¨¡å¼ï¼šæ ¹æ“šæ¨¡å¼æ±ºå®šä¸‹ä¸€é¦–
          if (musicQueue.length === 0) return;
          
          if (playbackMode === 'shuffle') {
            currentMusicIndex = Math.floor(Math.random() * musicQueue.length);
          } else {
            // åˆ—è¡¨å¾ªç’°
            currentMusicIndex = (currentMusicIndex + 1) % musicQueue.length;
          }
          loadAndPlayCurrentSong();
        }
      } else if (event.data === YT.PlayerState.PLAYING) {
        isPlaying = true;
        document.getElementById('playPauseBtn').innerText = 'â¸ï¸';
        document.getElementById('musicControlsContainer').style.display = 'flex';
      } else if (event.data === YT.PlayerState.PAUSED || event.data === YT.PlayerState.UNSTARTED || event.data === YT.PlayerState.BUFFERING) {
        if (event.data !== YT.PlayerState.BUFFERING) {
          isPlaying = false;
          document.getElementById('playPauseBtn').innerText = 'â–¶ï¸';
        }
      }
    }

    // Utility to get Video ID or Playlist ID
    function extractVideoId(urlOrId) {
      // æª¢æŸ¥æ˜¯å¦ç‚ºæ’­æ”¾æ¸…å–®ç¶²å€
      if (urlOrId.includes('list=')) {
        const urlParams = new URLSearchParams(urlOrId.split('?')[1]);
        const playlistId = urlParams.get('list');
        return playlistId; 
      }
      // æª¢æŸ¥æ˜¯å¦ç‚ºå½±ç‰‡ ID æˆ–ç¶²å€
      const match = urlOrId.match(YOUTUBE_URL_REGEX);
      return match ? match[1] : (urlOrId.length === 11 ? urlOrId : null);
    }
    
    function requestSong() {
      const input = prompt("ğŸ¶ è¼¸å…¥ YouTube å½±ç‰‡/æ¸…å–®ç¶²å€æˆ– IDï¼š\nï¼ˆä¾‹å¦‚ï¼šå½±ç‰‡ID: dQw4w9WgXcQï¼Œæˆ–æ’­æ”¾æ¸…å–®ç¶²å€ï¼‰");
      if (!input) return;

      const extractedId = extractVideoId(input);

      if (!extractedId) {
        alert("ç„¡æ•ˆçš„ YouTube ç¶²å€æˆ– IDã€‚");
        return;
      }

      // Check if it's a playlist request
      if (input.includes('list=')) {
        // This is a playlist ID (extractedId)
        if (currentPlaylistId === extractedId) {
          alert("è©²æ’­æ”¾æ¸…å–®å·²åœ¨æ’­æ”¾ä¸­ã€‚");
          return;
        }
        currentPlaylistId = extractedId;
        musicQueue = []; // æ¸…ç©ºå–®æ›²åˆ—è¡¨
        currentMusicIndex = -1;
        
        musicPlayer.loadPlaylist({
          list: currentPlaylistId,
          listType: 'playlist',
          index: 0,
          startSeconds: 0
        });

        // Apply playback mode settings to the playlist
        if (playbackMode === 'listLoop') {
          musicPlayer.setLoop(true);
          musicPlayer.setShuffle(false);
        } else if (playbackMode === 'shuffle') {
          musicPlayer.setLoop(true);
          musicPlayer.setShuffle(true);
        }
        
        musicPlayer.playVideo();
        document.getElementById('musicControlsContainer').style.display = 'flex';
        alert(`å·²è¼‰å…¥æ’­æ”¾æ¸…å–®ï¼š${currentPlaylistId}`);

      } else {
        // Single song mode
        currentPlaylistId = null; // æ¸…é™¤æ¸…å–® ID

        const newSongId = extractedId;
        
        // Queue limit check
        if (musicQueue.length >= MUSIC_QUEUE_LIMIT) {
          alert(`æ’­æ”¾åˆ—è¡¨å·²æ»¿ï¼Œé™åˆ¶ç‚º ${MUSIC_QUEUE_LIMIT} é¦–ã€‚`);
          return;
        }

        // Check if already in queue
        if (musicQueue.some(song => song.id === newSongId)) {
            alert(`æ­Œæ›² ${newSongId} å·²åœ¨åˆ—è¡¨ä¸­ã€‚`);
            return;
        }

        musicQueue.push({ id: newSongId });
        alert(`å·²å°‡æ­Œæ›² ${newSongId} åŠ å…¥ä½‡åˆ—ã€‚`);

        if (musicQueue.length === 1 && currentMusicIndex === -1) {
          // If it's the first song and nothing is playing, start playback
          currentMusicIndex = 0;
          loadAndPlayCurrentSong();
        } else if (currentMusicIndex === -1 && musicQueue.length > 0) {
            // If the queue was empty, now there is a song, start playing the first one
            currentMusicIndex = 0;
            loadAndPlayCurrentSong();
        }
      }
    }
    
    function loadAndPlayCurrentSong() {
      if (currentPlaylistId) return; // Playlist mode does not use this function
      
      if (musicQueue.length > 0 && currentMusicIndex !== -1) {
        const song = musicQueue[currentMusicIndex];
        musicPlayer.loadVideoById(song.id, 0);
        isPlaying = true;
        document.getElementById('playPauseBtn').innerText = 'â¸ï¸';
      } else {
        isPlaying = false;
        document.getElementById('playPauseBtn').innerText = 'â–¶ï¸';
        currentMusicIndex = -1;
        if (musicQueue.length === 0) {
          document.getElementById('musicControlsContainer').style.display = 'none';
        }
      }
    }

    function playPauseSong() {
      const state = musicPlayer.getPlayerState();
      if (state === YT.PlayerState.PLAYING) {
        musicPlayer.pauseVideo();
        isPlaying = false;
        document.getElementById('playPauseBtn').innerText = 'â–¶ï¸';
      } else if (state === YT.PlayerState.PAUSED || state === YT.PlayerState.ENDED) {
        musicPlayer.playVideo();
        isPlaying = true;
        document.getElementById('playPauseBtn').innerText = 'â¸ï¸';
      } else if (state === YT.PlayerState.UNSTARTED || state === YT.PlayerState.CUED) {
        if (currentPlaylistId || (musicQueue.length > 0 && currentMusicIndex !== -1)) {
          musicPlayer.playVideo();
          isPlaying = true;
          document.getElementById('playPauseBtn').innerText = 'â¸ï¸';
        }
      }
    }

    function skipToPreviousSong() {
      if (!musicPlayer) return;

      if (currentPlaylistId) {
        musicPlayer.previousVideo();
        return;
      }

      if (musicQueue.length === 0) return;
      
      let newIndex = currentMusicIndex - 1;
      if (newIndex < 0) newIndex = musicQueue.length - 1; // Loop back to the end
      currentMusicIndex = newIndex;
      loadAndPlayCurrentSong();
    }

    function skipToNextSong() {
      if (!musicPlayer) return;

      if (currentPlaylistId) {
        musicPlayer.nextVideo();
        return;
      }
      
      if (musicQueue.length === 0) return;
      
      let newIndex;
      if (playbackMode === 'shuffle') {
        newIndex = Math.floor(Math.random() * musicQueue.length);
      } else {
        newIndex = (currentMusicIndex + 1) % musicQueue.length;
      }
      
      currentMusicIndex = newIndex;
      loadAndPlayCurrentSong();
    }

    function openMusicSettingsModal() {
      const modal = document.getElementById('musicSettingsModal');
      modal.style.display = 'flex';
      
      // Update active mode button state
      document.querySelectorAll('.mode-btn').forEach(btn => {
        btn.classList.remove('active');
      });
      document.getElementById('mode' + (playbackMode === 'shuffle' ? 'Shuffle' : 'ListLoop')).classList.add('active');
    }

    function closeMusicSettingsModal() {
      document.getElementById('musicSettingsModal').style.display = 'none';
    }
    
    function setPlaybackMode(mode) {
      playbackMode = mode;
      
      // If in playlist mode, apply native YT settings
      if (currentPlaylistId && musicPlayer && musicPlayer.setLoop) {
        if (mode === 'listLoop') {
          musicPlayer.setLoop(true);
          musicPlayer.setShuffle(false);
        } else if (mode === 'shuffle') {
          musicPlayer.setLoop(true);
          musicPlayer.setShuffle(true);
        }
      }
      
      openMusicSettingsModal();
      // Temporarily display mode status
      setTimeout(closeMusicSettingsModal, 1500); 
    }

    function clearMusicState() {
      musicQueue = [];
      currentMusicIndex = -1;
      currentPlaylistId = null;
      document.getElementById('playPauseBtn').innerText = 'â–¶ï¸';
    }

    function stopAndCloseModal() {
      if (musicPlayer) {
        musicPlayer.stopVideo();
        musicPlayer.cueVideoById("");
      }
      clearMusicState();
      isPlaying = false;
      document.getElementById('musicControlsContainer').style.display = 'none';
      closeMusicSettingsModal();
      alert("éŸ³æ¨‚æ’­æ”¾å·²åœæ­¢ä¸¦æ¸…é™¤ä½‡åˆ—ã€‚");
    }

    function showMusicQueueStatusModal() {
      const modal = document.getElementById('musicQueueModal');
      const content = document.getElementById('queueListContent');
      let html = '';

      if (currentPlaylistId) {
        html = `<p style="color:#fff; font-size:14px; margin-top:0;">æ­£åœ¨æ’­æ”¾æ¸…å–® IDï¼š<br><span style="color:#0078d7;">${currentPlaylistId}</span></p>`;
        html += `<p style="color:#aaa; font-size:12px;">æ¸…å–®æ¨¡å¼ç„¡æ³•æŸ¥çœ‹æ­Œæ›²åˆ—è¡¨ã€‚</p>`;
      } else if (musicQueue.length === 0) {
        html = '<p style="text-align:center; color:#ccc;">æ’­æ”¾åˆ—è¡¨æ˜¯ç©ºçš„ã€‚</p>';
      } else {
        html += `<p style="color:#fff; font-size:14px; margin-top:0;">ç¸½è¨ˆï¼š${musicQueue.length} é¦– | æ¨¡å¼ï¼š${playbackMode === 'listLoop' ? 'å¾ªç’°' : 'éš¨æ©Ÿ'}</p><ul style="list-style:none; padding:0; max-height:200px; overflow-y:auto; text-align:left;">`;
        
        // Iterate through musicQueue and display ID and index
        musicQueue.forEach((song, index) => {
          const isCurrent = index === currentMusicIndex;
          const songId = song.id; 
          html += `<li style="padding:4px 0; font-size:13px; color:${isCurrent ? '#f90' : '#ccc'}; border-bottom:1px solid #333; margin-top:3px;">
            ${isCurrent ? 'â–¶ï¸' : (index + 1)}. ${songId}
          </li>`;
        });
        html += '</ul>';
      }
      
      content.innerHTML = html;
      modal.style.display = 'flex';
    }

    function closeMusicQueueModal() {
      document.getElementById('musicQueueModal').style.display = 'none';
    }
    

    /* ---------------------------------------------------------------------- */
    /* å…¶ä»–ç›´æ’­æ§åˆ¶åŠŸèƒ½ (ä¿æŒä¸è®Š) */
    /* ---------------------------------------------------------------------- */
    function selectCam(index) {
      // ... (Rest of existing JS functions)
      selectedCamIndex = index;
      document.querySelectorAll('#controls button[id^="select-cam-"]').forEach(btn => {
        btn.classList.remove('active');
      });
      document.getElementById(`select-cam-${index}`).classList.add('active');
      
      // é‡ç½®æ™¯é»é¸æ“‡æŒ‰éˆ•
      const regionButtons = document.getElementById('regionButtons');
      const locationButtonsContainer = document.getElementById('locationButtons');
      if (locationButtonsContainer) {
          regionButtons.removeChild(locationButtonsContainer);
          renderRegionButtons();
      }
    }

    function updateLabel(index) {
      const state = streamState[index];
      const labelElement = document.getElementById(`label${index}`);
      if (state) {
        labelElement.innerHTML = `${state.label}<span class="source-on-screen">${state.source}</span>`;
      } else {
        labelElement.innerHTML = 'è¼‰å…¥ä¸­...<span class="source-on-screen"></span>';
      }
    }

    function loadStream(streamKey) {
      const stream = ALL_STREAMS[streamKey];
      if (!stream) return;

      const player = players[selectedCamIndex];
      streamState[selectedCamIndex] = { key: streamKey, ...stream };
      
      try {
        // ä½¿ç”¨ loadVideoById ç¢ºä¿é‡æ–°è¼‰å…¥
        player.loadVideoById(stream.id);
        player.mute();
        updateLabel(selectedCamIndex);
        if (!isMuted) player.unMute();
        
        // æ›´æ–°éœéŸ³æŒ‰éˆ•ç‹€æ…‹
        if (player && player.isMuted) {
          document.getElementById('muteBtn').innerText = player.isMuted() ? 'è§£é™¤éœéŸ³' : 'éœéŸ³';
        }
      } catch(e){}
    }

    function toggleFullscreen() {
      const wrap = document.getElementById('stageWrap');
      const controls = document.getElementById('controls');
      const isFullscreen = document.body.classList.toggle('fullscreen-active');
      
      // è§¸ç™¼ç€è¦½å™¨åŸç”Ÿçš„å…¨è¢å¹•API
      if (isFullscreen) {
        if (wrap.requestFullscreen) {
          wrap.requestFullscreen();
        } else if (wrap.webkitRequestFullscreen) { /* Safari */
          wrap.webkitRequestFullscreen();
        } else if (wrap.msRequestFullscreen) { /* IE11 */
          wrap.msRequestFullscreen();
        }
      } else {
        if (document.exitFullscreen) {
          document.exitFullscreen();
        } else if (document.webkitExitFullscreen) { /* Safari */
          document.webkitExitFullscreen();
        } else if (document.msExitFullscreen) { /* IE11 */
          document.msExitFullscreen();
        }
      }
    }

    function toggleLabels() {
      const body = document.body;
      const isHidden = body.classList.toggle('hide-labels');
      document.getElementById('labelsToggleBtn').innerText = isHidden ?
        'é¡¯ç¤ºæ¨™ç±¤' : 'æ¨™ç±¤éš±è—';
    }

    function toggleMute() {
      isMuted = !isMuted;
      
      players.forEach(player => {
        try {
          isMuted ? player.mute() : player.unMute();
        } catch(e){}
      });
      document.getElementById('muteBtn').innerText = isMuted ? 'è§£é™¤éœéŸ³' : 'éœéŸ³';
    }


    function renderRegionButtons() {
      const c = document.getElementById('regionButtons');
      c.innerHTML = '';
      let hasContent = false;
      
      for (const region in REGION_GROUPS) {
        let regionHasCities = false;
        
        REGION_GROUPS[region].forEach(city => {
          const baseCity = CITY_ALIAS_TO_BASE[city] || city;
          if (GROUPED_STREAMS[baseCity] && GROUPED_STREAMS[baseCity].length > 0) regionHasCities = true;
        });
        
        if (regionHasCities) {
          hasContent = true;
          const regionLabel = document.createElement('span');
          regionLabel.className = 'region-label';
          regionLabel.textContent = region + 'ï¼š';
          c.appendChild(regionLabel);
          
          REGION_GROUPS[region].forEach(displayCity => {
            const baseCity = CITY_ALIAS_TO_BASE[displayCity] || displayCity;
            if (GROUPED_STREAMS[baseCity] && GROUPED_STREAMS[baseCity].length > 0) {
              const btn = document.createElement('button');
              btn.className = 'city-btn';
              btn.innerText = displayCity;
              btn.setAttribute('onclick', `renderLocationButtons('${displayCity}')`);
              c.appendChild(btn);
            }
          });
        }
      }
      
      if (!hasContent) {
        const empty = document.createElement('span');
        empty.innerText = 'ï¼ˆæ²’æœ‰æ™¯é»è³‡è¨Šï¼‰';
        empty.style.color = '#bbb';
        c.appendChild(empty);
      }
      c.scrollLeft = 0;
    }

    function renderLocationButtons(displayCity) {
      const baseCity = CITY_ALIAS_TO_BASE[displayCity] || displayCity;
      const streams = GROUPED_STREAMS[baseCity];
      if (!streams || streams.length === 0) return;

      const c = document.getElementById('regionButtons');
      c.innerHTML = ''; // æ¸…é™¤ç¸£å¸‚æŒ‰éˆ•

      const backBtn = document.createElement('button');
      backBtn.className = 'city-btn';
      backBtn.innerText = 'â¬…ï¸ è¿”å›ç¸£å¸‚';
      backBtn.setAttribute('onclick', `renderRegionButtons()`);
      c.appendChild(backBtn);

      const locationContainer = document.createElement('div');
      locationContainer.id = 'locationButtons';
      locationContainer.style.display = 'flex';
      locationContainer.style.gap = '6px';
      
      streams.forEach(stream => {
        const btn = document.createElement('button');
        btn.className = 'city-btn';
        btn.innerText = stream.label;
        btn.setAttribute('onclick', `loadStream('${stream.key}')`);
        locationContainer.appendChild(btn);
      });
      c.appendChild(locationContainer);
      c.scrollLeft = 0;
    }

  </script>
</body>
</html>
