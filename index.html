<!DOCTYPE html>
<html lang="zh-TW">
<head>
  <meta charset="utf-8" />
  <title>å°ç£å³æ™‚ç›´æ’­å››åˆ†å‰²ç›£çœ‹</title>
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <style>
    /* ---------------------------------------------------------------------- */
    /* CSS æ¨£å¼ - ä¿æŒä¸è®Š */
    /* ---------------------------------------------------------------------- */
    html,body{
      height:100%;
      margin:0; padding:0; background:#000;
      font-family: system-ui, sans-serif; color:#fff; overflow:hidden;
    }

    /* åº•éƒ¨æ§åˆ¶åˆ— */
    .controls{
      position:fixed;
      bottom:0; left:0; width:100%; height:78px;
      background:rgba(12,12,12,0.95); color:#fff; padding:8px 12px;
      box-sizing:border-box; display:flex; flex-direction:row; align-items:center;
      gap:10px; z-index:3000; overflow:hidden;
    }
    .controls button{
      background-color:#222; color:#fff; border:1px solid #444;
      padding:8px 12px; font-size:13px; cursor:pointer;
      border-radius:6px;
      height:40px; flex-shrink:0; white-space:nowrap; text-align:center;
    }
    .controls button.active{ background-color:#0078d7; border-color:#0078d7; }
    .divider{ width:1px; height:60%;
      background:#333; flex-shrink:0; margin:0;
    }

    /* ç¸£å¸‚ / æ™¯é»å®¹å™¨ï¼ˆå¯å·¦å³æ»¾å‹•ï¼‰ */
    #regionButtons{
      display:flex;
      flex-grow:1; min-width:0; gap:6px;
      overflow-x:auto; padding-bottom:6px; height:100%; align-items:center;
    }
    #regionButtons::-webkit-scrollbar{ height:6px; background-color:rgba(255,255,255,0.06); }
    #regionButtons::-webkit-scrollbar-thumb{ background-color:#444;
      border-radius:3px;
    }
    .region-label{ color:#fff; margin:0 8px 0 4px; font-weight:600; flex-shrink:0; user-select:none;
    }
    /* é€šç”¨åŸå¸‚/æ™¯é»æŒ‰éˆ•æ¨£å¼ */
    #regionButtons .city-btn, #regionButtons .stream-btn, #regionButtons .back-btn{
      background-color:#111;
      color:#fff; border:1px solid #555;
      padding:6px 10px; margin:0;
      border-radius:6px; cursor:pointer;
      height:36px; flex-shrink:0; font-size:13px;
    }
    #regionButtons .city-btn:hover, #regionButtons .stream-btn:hover, #regionButtons .back-btn:hover{
        background-color:#1a1a1a; border-color:#666;
    }
    /* æ™¯é»æŒ‰éˆ•å¾®èª¿æ¨£å¼ */
    #regionButtons .stream-btn{
        background-color: #222;
      border-color: #444;
    }
    /* è¿”å›æŒ‰éˆ•æ¨£å¼ */
    #regionButtons .back-btn{
        background-color: #555;
      border-color: #777;
    }
    /* ç•¶å‰é¸ä¸­çš„åŸå¸‚æŒ‰éˆ•ï¼Œç”¨æ–¼åŸå¸‚/æ™¯é»åˆ‡æ›ç‹€æ…‹æ¨™è¨˜ */
    #regionButtons .city-btn.active-city{
        background-color: #0078d7;
      border-color: #0078d7;
    }


    /* å½±ç‰‡èˆå°å››æ ¼ */
    .stage-wrap{
      position:fixed; top:0;
      left:0; width:100vw;
      height:calc(100vh - 78px);
      display:grid; grid-template-columns:1fr 1fr; grid-template-rows:1fr 1fr;
      gap:0; z-index:1;
    }
    .cell{ position:relative; width:100%; height:100%;
      overflow:hidden; background:#000;
    }
    /* æ’­æ”¾å™¨å®¹å™¨åŠ iframe - é‡æ–°å¥—ç”¨ç¸®æ”¾ä»¥ä½¿ 16:9 ç•«é¢å¡«æ»¿è±¡é™ä¸¦éš±è—æ¨™é¡Œ */
    .player-container, .player-container iframe{
      position:absolute;
      inset:0; width:100%; height:100%; border:0; display:block;
      object-fit:cover; object-position:center;
      background:black;
      transform: scale(1.65) translateY(-6%);
      /* <-- é‡æ–°å¥—ç”¨é€šç”¨ç¸®æ”¾ */
    }

    /* ã€å·²ç§»é™¤ã€‘åŸæœ¬ç”¨æ–¼å¯ºå»Ÿçš„ .zoomed-stream é¡åˆ¥ï¼Œç¾å·²æ”¹ç‚ºé€šç”¨ç¸®æ”¾ */
    
    /* å¼·åŒ–é®ç½©ä»¥é˜»æ“‹ YouTube UI/Logo/æ¨è–¦ */
    .interaction-shield{
      position:absolute;
      inset:0; z-index:9999; background:transparent;
      pointer-events:auto; cursor:default;
    }
    .label{
      position:absolute; left:8px; right:8px; bottom:8px; display:flex;
      flex-direction:column; align-items:flex-start; padding:6px 8px;
      font-size:14px; color:#fff; background:rgba(0,0,0,0.6); border-radius:6px;
      pointer-events:none; z-index:10000;
    }
    .source-on-screen{ font-size:11px; color:#ccc; margin-top:4px; line-height:1.1;
    }

    /* é¡¯ç¤ºæ§åˆ¶ */
    .hide-labels .label{ display:none;
    }
    /* ã€é—œéµä¿®æ­£ã€‘: åƒ…åœ¨æœ‰ .fullscreen-active æ™‚æ‰éš±è— controls */
    .fullscreen-active .controls{ display:none;
    }
    .fullscreen-active .stage-wrap{ height:100vh; }

    @media (max-width:640px){
      .controls{ padding:6px 8px;
      height:80px;
      }
      .controls button{ padding:6px 8px; font-size:12px; height:36px;
      }
      #regionButtons .city-btn, #regionButtons .stream-btn, #regionButtons .back-btn{
        padding:6px 8px;
      font-size:12px; height:34px;
      }
    }
    
    /* ---------------------------------------------------------------------- */
    /* CSS æ¨£å¼ï¼šéŸ³æ¨‚æ§åˆ¶å€å¡Š (ç¢ºä¿ç·Šæ¹Šæ ¼å¼) */
    /* ---------------------------------------------------------------------- */

    /* éŸ³æ¨‚æ§åˆ¶å®¹å™¨ï¼šé è¨­éš±è—ï¼Œç”± JS åœ¨æœ‰æ­Œå–®æ™‚åˆ‡æ›ç‚º display: flex */
    .music-controls-container {
        display: none;
      flex-shrink: 0;
        height: 100%;
        align-items: center;
    }
    .music-controls {
        display: flex;
      gap: 5px; /* æŒ‰éˆ•é–“çš„é–“éš” */
    }

    /* å°ˆé–€ç‚ºéŸ³æ¨‚æ§åˆ¶æŒ‰éˆ•èª¿æ•´çš„æ¨£å¼ï¼šæ–¹å½¢ã€å±…ä¸­ã€å¤§å­—é«” */
    .music-controls button {
        /* ç¹¼æ‰¿ .controls button çš„åŸºæœ¬èƒŒæ™¯/é‚Šæ¡†æ¨£å¼ */
        background-color: #222;
      color: #fff; 
        border: 1px solid #444;
        border-radius: 6px;
        cursor: pointer;
      /* èª¿æ•´ç‚ºç·Šæ¹Šçš„éŸ³æ¨‚æ§åˆ¶æŒ‰éˆ•æ ¼å¼ */
        height: 40px; 
        width: 40px;
      /* è¨­ç‚ºæ–¹å½¢ */
        padding: 0;
        font-size: 16px;
      /* ç¢ºä¿ Emoji å¤ å¤§ */
        line-height: 1;
        flex-shrink: 0;
      /* ç¢ºä¿å…§å®¹å±…ä¸­ */
        display: flex;
        align-items: center;
        justify-content: center;
    }
    
  </style>
</head>
<body>
  <div class="controls" id="controls">
    <button id="select-cam-0" class="active" onclick="selectCam(0)">å·¦ä¸Š</button>
    <button id="select-cam-1" onclick="selectCam(1)">å³ä¸Š</button>
    <button id="select-cam-2" onclick="selectCam(2)">å·¦ä¸‹</button>
    <button id="select-cam-3" onclick="selectCam(3)">å³ä¸‹</button>

    <div class="divider"></div>

    <div id="regionButtons" aria-label="ç¸£å¸‚èˆ‡æ™¯é»é¸å–®" role="toolbar"></div>

    <div class="divider"></div>
    <button id="fullscreenBtn" onclick="toggleFullscreen()">å…¨è¢å¹•</button>

    <div class="divider"></div>
    <button id="labelsToggleBtn" onclick="toggleLabels()">æ¨™ç±¤éš±è—</button>

    <div class="divider"></div>
    <button id="muteBtn" onclick="toggleMute()">è§£é™¤éœéŸ³</button>

    <div class="divider"></div>
    <button id="requestBtn" onclick="requestSong()" title="è¼¸å…¥ç¶²å€/IDé»æ­Œæˆ–æ’­æ”¾æ¸…å–®">ğŸ¶ é»æ­Œ/æ¸…å–®</button>

    <div id="musicControlsContainer" class="music-controls-container">
 
      <div class="music-controls">
        <button id="prevSongBtn" onclick="skipToPreviousSong()" title="ä¸Šä¸€é¦–">â®ï¸</button>
        <button id="playPauseBtn" onclick="playPauseSong()" title="æ’­æ”¾/æš«åœ">â¸ï¸</button>
        <button id="nextSongBtn" onclick="skipToNextSong()" title="ä¸‹ä¸€é¦–">â­ï¸</button>
        <button id="modeBtn" onclick="openMusicSettingsModal()" title="æ¨¡å¼è¨­å®š">ğŸ”„</button>
        <button id="playlistQueueBtn" onclick="showMusicQueueStatusModal()" title="æŸ¥çœ‹æ’­æ”¾åˆ—è¡¨ç‹€æ…‹">ğŸµ</button>
      </div>
    </div>
  </div>

  <div class="stage-wrap" id="stageWrap">
    <div class="cell" data-index="0">
      <div id="player0" class="player-container"></div>
      <div class="interaction-shield"></div>
   
      <div class="label" id="label0">è¼‰å…¥ä¸­...<span class="source-on-screen"></span></div>
    </div>
    <div class="cell" data-index="1">
      <div id="player1" class="player-container"></div>
      <div class="interaction-shield"></div>
      <div class="label" id="label1">è¼‰å…¥ä¸­...<span class="source-on-screen"></span></div>
    </div>
    <div class="cell" data-index="2">
      <div id="player2" class="player-container"></div>
      <div class="interaction-shield"></div>
      <div class="label" id="label2">è¼‰å…¥ä¸­...<span class="source-on-screen"></span></div>
    </div>
    <div class="cell" data-index="3">
      <div id="player3" class="player-container"></div>
      <div class="interaction-shield"></div>
 
      <div class="label" id="label3">è¼‰å…¥ä¸­...<span class="source-on-screen"></span></div>
    </div>
  </div>

  <div id="player_music_container" style="position:fixed;
    top:-100px;
    left:-100px; width:1px; height:1px; overflow:hidden;">
    <div id="player_music"></div>
  </div>

  <div id="musicSettingsModal" style="display:none; position:fixed; inset:0; background:rgba(0,0,0,0.8); z-index:9999;
    justify-content:center;
    align-items:center;">
    <div style="background:#222; padding:20px; border-radius:10px; box-shadow:0 0 20px rgba(0,0,0,0.5); width:300px; max-width:90%;
    text-align:center;">
      <h3 style="margin-top:0; color:#fff;">éŸ³æ¨‚æ’­æ”¾æ¨¡å¼</h3>
      <p style="font-size:12px;
      color:#aaa;">é»æ“Šä¸‹æ–¹æŒ‰éˆ•é¸æ“‡æ’­æ”¾æ¨¡å¼ï¼š</p>
      <div style="display:flex; justify-content:space-around; gap:10px;
      margin-top:15px;">
        <button id="modeListLoop" class="mode-btn" onclick="setPlaybackMode('listLoop')">ğŸ”„ åˆ—è¡¨å¾ªç’°</button>
        <button id="modeShuffle" class="mode-btn" onclick="setPlaybackMode('shuffle')">ğŸ”€ éš¨æ©Ÿæ’­æ”¾</button>
      </div>
      <button onclick="stopAndCloseModal()" class="stop-btn">â¹ï¸ åœæ­¢ä¸¦çµæŸæ’­æ”¾</button>
      <button onclick="closeMusicSettingsModal()" class="close-btn">é—œé–‰</button>
    </div>
  </div>

  <div id="musicQueueModal" style="display:none;
    position:fixed; inset:0; background:rgba(0,0,0,0.8); z-index:9999; justify-content:center; align-items:center;">
    <div style="background:#222; padding:20px; border-radius:10px; box-shadow:0 0 20px rgba(0,0,0,0.5); width:350px;
    max-width:90%;">
      <h3 style="margin-top:0; color:#fff; text-align:center;">ğŸ¶ æ’­æ”¾åˆ—è¡¨ç‹€æ…‹</h3>
      <div id="queueListContent" style="margin-bottom:15px;
      padding-right:5px;"></div>
      <button onclick="closeMusicQueueModal()" style="margin-top:10px;">é—œé–‰</button>
    </div>
  </div>

  <script src="https://www.youtube.com/iframe_api"></script>
  <script>
    /* ===== ç›´æ’­ä¾†æºï¼ˆå·²æ–°å¢è“®è¯å¯ºã€æ©Ÿå ´è³‡è¨Šã€è“®æ± æ½­ã€å¨œè·¯å½é…’åº—ï¼‰ ===== */
    const ALL_STREAMS = {
      "å°åŒ—-è±¡å±±çœ‹101": {"id":"z_fY1pj1VBw","label":"å°åŒ—è±¡å±±","source":"Taipei Travel Live Cam å°åŒ—è§€å…‰å³æ™‚å½±åƒ"},
      "å°åŒ—-å¤§ç¨»åŸ•": {"id":"Ndo_8RuefH4","label":"å¤§ç¨»åŸ•","source":"Taipei Travel Live Cam å°åŒ—è§€å…‰å³æ™‚å½±åƒ"},
      "å°åŒ—-ç¢§å±±å·–": {"id":"uvwfYzwY8tg","label":"ç¢§å±±å·–","source":"Taipei Travel Live Cam å°åŒ—è§€å…‰å³æ™‚å½±åƒ"},
      "å°åŒ—-å¾®é¢¨å¹³å°": {"id":"34h_Cy_n0Ok","label":"å¾®é¢¨å¹³å°","source":"Taipei Travel Live Cam å°åŒ—è§€å…‰å³æ™‚å½±åƒ"},
      "å°åŒ—-è²“ç©ºæŒ‡å—å®®": {"id":"215ahZ_0rTg","label":"è²“ç©ºæŒ‡å—å®®","source":"Taipei Travel Live Cam å°åŒ—è§€å…‰å³æ™‚å½±åƒ"},
      "å°åŒ—-æ“å¤©å²¡è‰åŸ": {"id":"yF2LAyOvq0Q","label":"æ“å¤©å²¡è‰åŸ","source":"é™½æ˜å±±åœ‹å®¶å…¬åœ’"},
    
      "å°åŒ—-é™½æ˜æ›¸å±‹": {"id":"RttyIGHbN_w","label":"é™½æ˜æ›¸å±‹","source":"é™½æ˜å±±åœ‹å®¶å…¬åœ’"},
      "å°åŒ—-é çœºä¸ƒæ˜Ÿå±±": {"id":"PvJr2efA6n0","label":"é çœºä¸ƒæ˜Ÿå±±","source":"é™½æ˜å±±åœ‹å®¶å…¬åœ’"},
      "å°åŒ—-äºŒåªå­åœè»Šå ´": {"id":"d9KuXrPCWYU","label":"äºŒåªå­åœè»Šå ´","source":"é™½æ˜å±±åœ‹å®¶å…¬åœ’"},
      "å°åŒ—-å¤§å±¯è‡ªç„¶å…¬åœ’": {"id":"6ghffcNt3Nw","label":"å¤§å±¯è‡ªç„¶å…¬åœ’","source":"é™½æ˜å±±åœ‹å®¶å…¬åœ’"},
      "å°åŒ—-å°æ²¹å‘åœè»Šå ´": {"id":"kKD-ZBLs8-4","label":"å°æ²¹å‘åœè»Šå ´","source":"é™½æ˜å±±åœ‹å®¶å…¬åœ’"},
      "å°åŒ—-å†·æ°´å‘åœè»Šå ´": {"id":"GB64WeZZQPQ","label":"å†·æ°´å‘åœè»Šå ´","source":"é™½æ˜å±±åœ‹å®¶å…¬åœ’"},
      "æ–°åŒ—-æ¼äººç¢¼é ­": {"id":"xwAWSh35uuw","label":"æ–°åŒ—æ·¡æ°´","source":"æ–°åŒ—æ—…å®¢ New Taipei Tour"},
      "æ–°åŒ—-é¼»é ­æœå‹™å€": {"id":"4Bm3IKcGkQY","label":"æ–°åŒ—é¼»é ­","source":"necoast nsa"},
      "æ–°åŒ—-ä¸­è§’ç£": {"id":"mmM9NOZLLKY","label":"ä¸­è§’ç£","source":"GoOceanæµ·æ´‹éŠæ†©é¢¨éšªè³‡è¨Š"},
      "æ–°åŒ—-ååˆ†ç€‘å¸ƒå…¬åœ’": {"id":"HirBQsQEUeA","label":"ååˆ†ç€‘å¸ƒå…¬åœ’","source":"æ–°åŒ—æ—…å®¢ New Taipei Tour"},
      "æ–°åŒ—-ä¹ä»½": {"id":"XSD5ptYisw8","label":"æ–°åŒ—ä¹ä»½","source":"æ–°åŒ—æ—…å®¢ New Taipei Tour"},
      "æ–°åŒ—-å…§æ´åœ‹å®¶æ£®æ—éŠæ¨‚å€": {"id":"lX2MYEFomK0","label":"å…§æ´åœ‹å®¶æ£®æ—éŠæ¨‚å€","source":"åœ‹å®¶æ£®æ—éŠæ¨‚å€å³æ™‚å½±åƒ"},
      "æ–°åŒ—-ä¸‰å³½è€è¡—åŒ—æ®µ": {"id":"M24SZJU-uoo","label":"ä¸‰å³½è€è¡—åŒ—æ®µ","source":"ä¸‰å³½æ°‘æ¬Šè€è¡—å•†åœˆ"},
   
      "æ–°åŒ—-ä¸‰å³½è€è¡—å—æ®µ": {"id":"R_5jhoux3nY","label":"ä¸‰å³½è€è¡—å—æ®µ","source":"ä¸‰å³½æ°‘æ¬Šè€è¡—å•†åœˆ"},
      "æ–°åŒ—-çƒä¾†åŠæ©‹": {"id":"jGoYvmTxLyU","label":"çƒä¾†åŠæ©‹","source":"æ°´åˆ©ç½²æ°´åˆ©é˜²ç½çµ„"},
      "æ–°åŒ—-å“¡å±±å­": {"id":"JkGKqXOt9Ls","label":"å“¡å±±å­","source":"æ°´åˆ©ç½²æ°´åˆ©é˜²ç½çµ„"},
      "æ–°åŒ—-æ–‡å±±è¾²å ´å¤§è‰çš®": {"id":"_LRkfObNP_U","label":"æ–‡å±±è¾²å ´å¤§è‰çš®","source":"æ–°åŒ—å¸‚è¾²æœƒæ–‡å±±è¾²å ´"},
      "åŸºéš†-å¤–æœ¨å±±": {"id":"LInNQYAbAwQ","label":"å¤–æœ¨å±±","source":"GoOceanæµ·æ´‹éŠæ†©é¢¨éšªè³‡è¨Š"},
      // Hsinchu Streams - åœ‹ç«‹æ¸…è¯å¤§å­¸è¨ˆé€šä¸­å¿ƒå­¸ç§‘çµ„
      "æ–°ç«¹-æˆåŠŸæ¹–": {"id":"Y6xJKj8k2ys","label":"æˆåŠŸæ¹–","source":"åœ‹ç«‹æ¸…è¯å¤§å­¸è¨ˆé€šä¸­å¿ƒå­¸ç§‘çµ„"},
      "æ–°ç«¹-å¤§è‰åª": {"id":"x_FuMf2ke1o","label":"å¤§è‰åª","source":"åœ‹ç«‹æ¸…è¯å¤§å­¸è¨ˆé€šä¸­å¿ƒå­¸ç§‘çµ„"},
      "æ¡ƒåœ’-åœ‹éš›æ©Ÿå ´": {"id":"91PfFoqvuUk","label":"æ¡ƒåœ’æ©Ÿå ´","source":"éŠæ¡ƒåœ’ Taoyuan Travel"},
      "æ¡ƒåœ’-æ¡ƒåœ’æ©Ÿå ´å—è·‘é“": {"id":"y3_x8el5ZJY","label":"TPE å—è·‘é“","source":"Taoyuan Airport"},
      "æ¡ƒåœ’-æ¡ƒåœ’æ©Ÿå ´åŒ—è·‘é“": {"id":"wWEnxWA7nnY","label":"TPE åŒ—è·‘é“","source":"Taoyuan Airport"},
      "æ¡ƒåœ’-æ°¸å®‰æ¼æ¸¯": {"id":"tD_a03trUvE","label":"æ°¸å®‰æ¼æ¸¯","source":"éŠæ¡ƒåœ’ Taoyuan Travel"},
      "æ¡ƒåœ’-æ‹‰æ‹‰å±±éŠå®¢ä¸­å¿ƒ": {"id":"YkIUZjVlhv4","label":"æ‹‰æ‹‰å±±éŠå®¢ä¸­å¿ƒ","source":"éŠæ¡ƒåœ’ Taoyuan Travel"}, // **[ä¿®æ­£ 1: ç§»é™¤æ›è¡Œç¬¦è™Ÿ]**
      "æ¡ƒåœ’-è™é ­å±±ç’°ä¿å…¬åœ’": {"id":"tu_gsIkNt-w","label":"è™é ­å±±ç’°ä¿å…¬åœ’","source":"éŠæ¡ƒåœ’ Taoyuan Travel"},
      "æ¡ƒåœ’-å°çƒä¾†å¤©ç©ºæ­¥é“": {"id":"neaiCec1kec","label":"å°çƒä¾†å¤©ç©ºæ­¥é“","source":"éŠæ¡ƒåœ’ Taoyuan Travel"},
      "æ¡ƒåœ’-è§’æ¿å±±æ€è¦ªäº­": {"id":"3Za9y4z_Lzc","label":"è§’æ¿å±±æ€è¦ªäº­","source":"éŠæ¡ƒåœ’ Taoyuan Travel"},
      "æ¡ƒåœ’-ä¸‰é¾œæˆ²æ°´è§€æ™¯å¹³å°": {"id":"5YDXZ1aiR5Y","label":"ä¸‰é¾œæˆ²æ°´è§€æ™¯å¹³å°","source":"éŠæ¡ƒåœ’ Taoyuan Travel"},
      "æ¡ƒåœ’-å¤§æºªæ©‹": {"id":"oFJ6gCaBb_Q","label":"å¤§æºªæ©‹","source":"éŠæ¡ƒåœ’ Taoyuan Travel"},
      "æ¡ƒåœ’-è™é ­å±±å¥§çˆ¾æ£®æ—å­¸å ‚": {"id":"yQSmajHyMhU","label":"å¥§çˆ¾æ£®æ—å­¸å ‚","source":"éŠæ¡ƒåœ’ Taoyuan Travel"},
      "æ¡ƒåœ’-è§’æ¿å±±æ¢…åœ’": {"id":"-xT1bZhWLuU","label":"è§’æ¿å±±æ¢…åœ’","source":"éŠæ¡ƒåœ’ Taoyuan Travel"},
      "æ¡ƒåœ’-è§’æ¿å±±ç”Ÿæ…‹æ± ": {"id":"XEbo8NzMTbQ","label":"è§’æ¿å±±ç”Ÿæ…‹æ± ","source":"éŠæ¡ƒåœ’ Taoyuan Travel"},
      "æ¡ƒåœ’-å¤§æºªè€è¡—": {"id":"XUWjAsajKXg","label":"å¤§æºªè€è¡—","source":"éŠæ¡ƒåœ’ Taoyuan Travel"},
      "æ¡ƒåœ’-çŸ³é–€æ°´åº«": {"id":"GUCaVR88ZFU","label":"çŸ³é–€æ°´åº«","source":"éŠæ¡ƒåœ’ Taoyuan Travel"},
      "æ¡ƒåœ’-æ…ˆæ¹–æ°´å²¸å»£å ´": {"id":"pSQ0e-ZTZ5g","label":"æ…ˆæ¹–æ°´å²¸å»£å ´","source":"éŠæ¡ƒåœ’ Travel"}, // **[ä¿®æ­£ 2: ç§»é™¤æ›è¡Œç¬¦è™Ÿ]**
      "æ¡ƒåœ’-é˜¿å§†åªè–‘æ¯å³¶": {"id":"EUOp2LchPQM","label":"è–‘æ¯å³¶","source":"éŠæ¡ƒåœ’ Taoyuan Travel"},
      "æ¡ƒåœ’-ä¸Šå·´é™µ": {"id":"nV-DKquUjFs","label":"ä¸Šå·´é™µ","source":"éŠæ¡ƒåœ’ Taoyuan Travel"},
      "æ¡ƒåœ’-æ¡ƒåœ’åœ‹éš›æ©Ÿå ´å‡±æ‚…é…’åº—": {"id":"68GFgzQxrXs","label":"æ©Ÿå ´å‡±æ‚…","source":"éŠæ¡ƒåœ’ Taoyuan Travel"},
      "æ¡ƒåœ’-å°çƒä¾†å¯°å®‡å¹³å°": {"id":"PJWye36lEj4","label":"å¯°å®‡å¹³å°","source":"éŠæ¡ƒåœ’ Taoyuan Travel"},
      "æ¡ƒåœ’-è¨±åæ¸¯æ¿•åœ°": {"id":"44JArbF682k","label":"è¨±åæ¸¯æ¿•åœ°","source":"éŠæ¡ƒåœ’ Taoyuan Travel"},
      "å®œè˜­-å¤–æ¾³æ²™ç˜": {"id":"UgoT-QTbYvo","label":"å®œè˜­å¤–æ¾³","source":"necoast nsa"},
      "å®œè˜­-ç¦éš†æµ·æ°´æµ´å ´": {"id":"mMG7v_fET5A","label":"å®œè˜­ç¦éš†","source":"necoast nsa"}, 
      "å®œè˜­-çŸ³åŸæ¼æ¸¯": {"id":"X76Dkt_fPG0","label":"çŸ³åŸæ¼æ¸¯","source":"necoast nsa"}, 
      "å®œè˜­-ç„¡å°¾æ¸¯": {"id":"Bux0vT_5MBw","label":"ç„¡å°¾æ¸¯","source":"GoOceanæµ·æ´‹éŠæ†©é¢¨éšªè³‡è¨Š"}, 
      "å®œè˜­-çŸ³åŸæ¼æ¸¯": {"id":"ozZVLl0h--A","label":"çŸ³åŸæ¼æ¸¯1","source":"GoOceanæµ·æ´‹éŠæ†©é¢¨éšªè³‡è¨Š"}, 
      "å®œè˜­-ç¤æºªå¯’æ²é…’åº—": {"id":"cPh2vzrtG_w","label":"ç¤æºªå¯’æ²é…’åº—","source":"ç¤æºªå¯’æ²é…’åº—MU JIAO XI HOTEL"}, 
  
      "è‹—æ —-æ±¶æ°´éŠå®¢ä¸­å¿ƒ(é›ªéœ¸)": {"id":"VgmWVBUsfGo","label":"æ±¶æ°´éŠå®¢ä¸­å¿ƒ","source":"é›ªéœ¸åœ‹å®¶å…¬åœ’ Shei-Pa National Park"},
      "è‹—æ —-è§€éœ§éŠæ†©å€(é›ªéœ¸)": {"id":"Isp6RQiuxNo","label":"è§€éœ§éŠæ†©å€","source":"é›ªéœ¸åœ‹å®¶å…¬åœ’ Shei-Pa National Park"},
      "è‹—æ —-é›ªè¦‹éŠæ†©å€(é›ªéœ¸)": {"id":"2KDE860OW_A","label":"é›ªè¦‹éŠæ†©å€","source":"é›ªéœ¸åœ‹å®¶å…¬åœ’ Shei-Pa National Park"},
      "å°ä¸­-é«˜ç¾æ¿•åœ°": {"id":"fjhg3gAnMFg","label":"å°ä¸­é«˜ç¾","source":"å¤§ç©å°ä¸­-è‡ºä¸­è§€å…‰æ—…éŠå±€"},
      "å°ä¸­-æœ›é«˜å¯®": {"id":"lhXXhDyjFtI","label":"æœ›é«˜å¯®","source":"å¤§ç©å°ä¸­-è‡ºä¸­è§€å…‰æ—…éŠå±€"},
      "å½°åŒ–-ç‹åŠŸæ¼æ¸¯": {"id":"hUG2XK08W5Q","label":"å½°åŒ–ç‹åŠŸ","source":"æ„›ç©å½°åŒ– Changhua Travels"},
      "å—æŠ•-åˆæ­¡å±±æ­¦å¶ºäº­": {"id":"2lVMTs_Fj0M","label":"æ­¦å¶ºäº­","source":"å°ç£å³æ™‚å½±åƒç›£è¦–å™¨"},
      "å˜‰ç¾©-å¥®èµ·æ¹–": {"id":"B6eki-0-w0g","label":"å˜‰ç¾©å¥®èµ·æ¹–","source":"é˜¿é‡Œå±±åœ‹å®¶é¢¨æ™¯å€ç®¡ç†è™•"},
      "å˜‰ç¾©-äºŒå»¶å¹³æ­¥é“": {"id":"j2L_559nCjc","label":"äºŒå»¶å¹³æ­¥é“","source":"é˜¿é‡Œå±±åœ‹å®¶é¢¨æ™¯å€ç®¡ç†è™•"},
      "å˜‰ç¾©-å¤ªå¹³é›²æ¢¯": {"id":"dY2cRNr5Buw","label":"å¤ªå¹³é›²æ¢¯","source":"é˜¿é‡Œå±±åœ‹å®¶é¢¨æ™¯å€ç®¡ç†è™•"},
      "å˜‰ç¾©-è§¸å£éŠå®¢ä¸­å¿ƒ": {"id":"8KnqJBf_dow","label":"è§¸å£éŠå®¢ä¸­å¿ƒ","source":"é˜¿é‡Œå±±åœ‹å®¶é¢¨æ™¯å€ç®¡ç†è™•"},
      "å˜‰ç¾©-æ„›æƒ…å¤§è‰åŸ": {"id":"hMYs60qtkK8","label":"æ„›æƒ…å¤§è‰åŸ","source":"é˜¿é‡Œå±±åœ‹å®¶é¢¨æ™¯å€ç®¡ç†è™•"},
      "å˜‰ç¾©-ç”ŸåŠ›è¾²å ´": 
      {"id":"agEzlv9n9Eg","label":"ç”ŸåŠ›è¾²å ´","source":"é˜¿é‡Œå±±åœ‹å®¶é¢¨æ™¯å€ç®¡ç†è™•"},
      "å˜‰ç¾©-é‡Œä½³è³‡è¨Šç«™": {"id":"zDt8FBPozZQ","label":"é‡Œä½³è³‡è¨Šç«™","source":"é˜¿é‡Œå±±åœ‹å®¶é¢¨æ™¯å€ç®¡ç†è™•"},
      "å°å—-ä¸ƒè‚¡è³é³¥å°": {"id":"5KJe2gCTngA","label":"å°å—ä¸ƒè‚¡","source":"å°æ±Ÿåœ‹å®¶å…¬åœ’ç®¡ç†è™•"},
      "å°å—-åŒ—æ±•å°¾æ°´é³¥ä¿è­·å€": {"id":"FES0gWTFUHQ","label":"åŒ—æ±•å°¾æ°´é³¥ä¿è­·å€","source":"å°æ±Ÿåœ‹å®¶å…¬åœ’ç®¡ç†è™•"},
      "å°å—-æ›¾æ–‡æ°´åº«": {"id":"EH4V8IwFIp4","label":"æ›¾æ–‡æ°´åº«","source":"è¥¿æ‹‰é›…åœ‹å®¶é¢¨æ™¯å€ç®¡ç†è™•"},
      "å°å—-ç«å±±ç¢§é›²å¯º": {"id":"zkX6X9p-6iA","label":"ç«å±±ç¢§é›²å¯º","source":"è¥¿æ‹‰é›…åœ‹å®¶é¢¨æ™¯å€ç®¡ç†è™•"}, 
      // é«˜é›„ç›´æ’­ - æ–°å¢è“®æ± æ½­
      "é«˜é›„-æ¥ æ¢“è–èˆˆæ©‹": {"id":"1vVCtk5OXVk","label":"æ¥ æ¢“è–èˆˆæ©‹","source":"æ°´åˆ©ç½²æ°´åˆ©é˜²ç½çµ„"},
      "é«˜é›„-èšµå¯®åœ‹å°": {"id":"sKrqs-5Auqo","label":"èšµå¯®åœ‹å°","source":"æ°´åˆ©ç½²æ°´åˆ©é˜²ç½çµ„"},
      "é«˜é›„-æ——æ´¥æµ·æ°´æµ´å ´": {"id":"ka7FV0sCvxQ","label":"æ——æ´¥æµ·æ°´æµ´å ´","source":"é«˜é›„æ—…éŠç¶²"},
      "é«˜é›„-å£½å±±è§€æ™¯å°": {"id":"C03Itx8iSC0","label":"å£½å±±è§€æ™¯å°","source":"é«˜é›„æ—…éŠç¶²"},
      "é«˜é›„-è“®æ± æ½­": {"id":"BnPoNatG-HE","label":"è“®æ± æ½­","source":"é«˜é›„æ—…éŠç¶²"}, 
      "é«˜é›„-é«˜é›„ç‡ˆå¡”": {"id":"HqrPgNErSOA","label":"é«˜é›„ç‡ˆå¡”","source":"Ship"}, 
      "é«˜é›„-æ——æ´¥æ²™ç˜": {"id":"lh7OdmxRvTg","label":"æ——æ´¥æ²™ç˜","source":"ship"}, 
   
      // å±æ±ç›´æ’­
      "å±æ±-ç¾Œå…‰æ©‹": {"id":"13C8jdbqQcI","label":"ç¾Œå…‰æ©‹","source":"æ°´åˆ©ç½²æ°´åˆ©é˜²ç½çµ„"}, 
      "å±æ±-å¢¾ä¸å—ç£": {"id":"jUnFuJSj0OU","label":"å¢¾ä¸å—ç£","source":"æˆ‘æ„›å¢¾ä¸æ—…éŠç¥¨åˆ¸ä¸­å¿ƒ"},
      "å±æ±-èˆ¹å¸†çŸ³": {"id":"3Wb_Lgw7Ltc","label":"èˆ¹å¸†çŸ³","source":"å¢¾ä¸åœ‹å®¶å…¬åœ’"}, 
      "å±æ±-èˆ¹å¸†çŸ³æ²™ç˜": {"id":"f8yo_osMxAg","label":"èˆ¹å¸†çŸ³æ²™ç˜ (4K)","source":"å¢¾ä¸åœ‹å®¶å…¬åœ’"},
      "å±æ±-é›€é¯›å…¬å¯“": {"id":"BggLWTcLixM","label":"é›€é¯›å…¬å¯“","source":"å°é›»-å—ç£æµ·åŸŸçŠç‘šè§€æ¸¬è¨ˆç•«"}, 
      "å±æ±-é ‚æµå€": {"id":"oMlSukuxtHw","label":"é ‚æµå€","source":"å°é›»-å—ç£æµ·åŸŸçŠç‘šè§€æ¸¬è¨ˆç•«"}, 
      "å±æ±-è»¸å­”å…¬åœ’": {"id":"2GzIYf-I5kM","label":"è»¸å­”å…¬åœ’","source":"å°é›»-å—ç£æµ·åŸŸçŠç‘šè§€æ¸¬è¨ˆç•«"}, 
      "å±æ±-æ–æ›³å¤§è‰åŸ": {"id":"2dyGcIYbJa8","label":"æ–æ›³å¤§è‰åŸ","source":"å°é›»-å—ç£æµ·åŸŸçŠç‘šè§€æ¸¬è¨ˆç•«"}, 
      // èŠ±è“®ç›´æ’­
      "èŠ±è“®-é¦¬å¤ªéæºªå·¦å²¸": {"id":"Ic6hqus0tjA","label":"é¦¬å¤ªéæºªå·¦å²¸","source":"æ°´åˆ©ç½²æ°´åˆ©é˜²ç½çµ„"},
      "èŠ±è“®-ä¸ƒæ˜Ÿæ½­": {"id":"j3l32VFi5M8","label":"ä¸ƒæ˜Ÿæ½­","source":"æ°´åˆ©ç½²æ°´åˆ©é˜²ç½çµ„"}, 
      "èŠ±è“®-çŸ³æ¢¯åª": {"id":"mXnigLvIL0Q","label":"çŸ³æ¢¯åª","source":"æ±éƒ¨æµ·å²¸åœ‹å®¶é¢¨æ™¯å€ç®¡ç†è™•"},
    
      "èŠ±è“®-å¤§çŸ³é¼»å±±": {"id":"JkoXcXI04Qk","label":"å¤§çŸ³é¼»å±±","source":"æ±éƒ¨æµ·å²¸åœ‹å®¶é¢¨æ™¯å€ç®¡ç†è™•"},
      "èŠ±è“®-é•·è™¹æ©‹": {"id":"JnD8Rk3o0BM","label":"é•·è™¹æ©‹","source":"æ±éƒ¨æµ·å²¸åœ‹å®¶é¢¨æ™¯å€ç®¡ç†è™•"},
      // å°æ±ç›´æ’­ - æ–°å¢å¨œè·¯å½é…’åº—
      "å°æ±-é¯‰é­šå±±": {"id":"BUJJaW0vkJs","label":"å°æ±é¯‰é­šå±±","source":"Amazing Taitung å°æ±å°±é†¬ç©"},
      "å°æ±-é‡‘å´™å¤§æ©‹": {"id":"9QqBz3kNHis","label":"å°æ±é‡‘å´™å¤§æ©‹","source":"Amazing Taitung å°æ±å°±é†¬ç©"},
      "å°æ±-é‡‘æ¨½è§€æµª": {"id":"q3KJt-SZc2s","label":"å°æ±é‡‘æ¨½è§€æµª","source":"Amazing Taitung å°æ±å°±é†¬ç©"},
      "å°æ±-å¯Œå±±": {"id":"Rsq95SQ26bY","label":"å°æ±å¯Œå±±","source":"Amazing Taitung å°æ±å°±é†¬ç©"},
      "å°æ±-æ‰åŸç£": {"id":"VqS_Y8ZCj6M","label":"å°æ±æ‰åŸç£","source":"Amazing Taitung å°æ±å°±é†¬ç©"},
      "å°æ±-å¯Œå²¡æ¼æ¸¯": {"id":"D945F_dauls","label":"å°æ±å¯Œå²¡æ¼æ¸¯","source":"Amazing Taitung å°æ±å°±é†¬ç©"},
      "å°æ±-è¯æºæ›™å…‰è§€æ™¯å°": {"id":"TY4qQElcUrA","label":"å°æ±è¯æºæ›™å…‰è§€æ™¯å°","source":"Amazing Taitung å°æ±å°±é†¬ç©"},
      "å°æ±-å—æ©«åŸ¡å£": {"id":"LSkq-wHMxQY","label":"å°æ±å—æ©«å£","source":"Amazing Taitung å°æ±å°±é†¬ç©"}, // **[ä¿®æ­£ 3: ç§»é™¤æ›è¡Œç¬¦è™Ÿ]**
      "å°æ±-æ± ä¸Šå¤©å ‚è·¯": {"id":"6kUEK3LVrro","label":"å°æ±æ± ä¸Šå¤©å ‚è·¯","source":"Amazing Taitung å°æ±å°±é†¬ç©"},
      "å°æ±-å¤šè‰¯è»Šç«™": {"id":"UCG1aXVO8H8","label":"å°æ±å¤šè‰¯","source":"Amazing Taitung å°æ±å°±é†¬ç©"},
      "å°æ±-é¹¿é‡é«˜å°": {"id":"rvc1klNIgQc","label":"é¹¿é‡é«˜å°","source":"ervnsa"},
      "å°æ±-æˆåŠŸä¸‰ä»™å°": {"id":"dQ7Sd6PGLdA","label":"ä¸‰ä»™å°","source":"æ±éƒ¨æµ·å²¸åœ‹å®¶é¢¨æ™¯å€ç®¡ç†è™•"},
      "å°æ±-é‡‘æ¨½éŠæ†©å€": {"id":"ZdqHgQwvZOw","label":"é‡‘æ¨½éŠæ†©å€","source":"æ±éƒ¨æµ·å²¸åœ‹å®¶é¢¨æ™¯å€ç®¡ç†è™•"},
      "å°æ±-éƒ½æ­·éŠå®¢ä¸­å¿ƒ": {"id":"JhQuR77AR7U","label":"éƒ½æ­·éŠå®¢ä¸­å¿ƒ","source":"æ±éƒ¨æµ·å²¸åœ‹å®¶é¢¨æ™¯å€ç®¡ç†è™•"},
      "å°æ±-åŠ è·¯è˜­éŠæ†©å€": {"id":"AKl3F6cAY2Q","label":"åŠ è·¯è˜­éŠæ†©å€","source":"æ±éƒ¨æµ·å²¸åœ‹å®¶é¢¨æ™¯å€ç®¡ç†è™•"},
      "å°æ±-ç¶ å³¶å—å¯®": {"id":"wTHhv7M0vCI","label":"ç¶ å³¶å—å¯®","source":"æ±éƒ¨æµ·å²¸åœ‹å®¶é¢¨æ™¯å€ç®¡ç†è™•"},
      "å°æ±-ç¶ å³¶å¸†èˆ¹é¼»": {"id":"pLdBc8PvZko","label":"ç¶ å³¶å¸†èˆ¹é¼»","source":"æ±éƒ¨æµ·å²¸åœ‹å®¶é¢¨æ™¯å€ç®¡ç†è™•"},
      "å°æ±-ç¶ å³¶æŸ´å£æµ®æ½›å€": {"id":"a8nJQr5rBGs","label":"ç¶ å³¶æŸ´å£æµ®æ½›å€","source":"æ±éƒ¨æµ·å²¸åœ‹å®¶é¢¨æ™¯å€ç®¡ç†è™•"},
      "å°æ±-å¨œè·¯å½é…’åº—": {"id":"Yo64T79w6Vg","label":"å¨œè·¯å½é…’åº—","source":"å¨œè·¯å½åƒ.å–.ç©.æ¨‚"}, 
      "é‡‘é–€-éº’éºŸå±±æ£®æ—å…¬åœ’": {"id":"M4EJtf_iP8s","label":"é‡‘é–€éº’éºŸå±±å…¬åœ’","source":"æ¨‚éŠé‡‘é–€"},
      "é‡‘é–€-134é«˜åœ°": {"id":"-srNHTE-Nf0","label":"é‡‘é–€134é«˜åœ°","source":"æ¨‚éŠé‡‘é–€"},
      "é‡‘é–€-å»ºåŠŸå¶¼": {"id":"uh_yNAE01w8","label":"é‡‘é–€å»ºåŠŸå¶¼","source":"æ¨‚éŠé‡‘é–€"},
      
      // é¦¬ç¥–ç›´æ’­
      "é¦¬ç¥–-åŒ—ç«¿èˆªç©ºç«™ä¼‘æ¯å®¤": {"id":"EaUVZ49xKQ4","label":"åŒ—ç«¿èˆªç©ºç«™ä¼‘æ¯å®¤","source":"MFKåŒ—ç«¿èˆªç©ºç«™"},
      // å…¶ä»–ç›´æ’­ - æ–°å¢è“®è¯å¯ºèˆ‡æ©Ÿå ´è³‡è¨Š
      "å…¶ä»–-è“®è¯å¯ºæ­£æ®¿1": {"id":"Cfh_CpU2KY0","label":"è“®è¯å¯ºæ­£æ®¿1","source":"lifemapäººç”Ÿåœ°åœ–"}, 
      "å…¶ä»–-è“®è¯å¯ºæ­£æ®¿2": {"id":"tQ5L2IMHjpM","label":"è“®è¯å¯ºæ­£æ®¿2","source":"lifemapäººç”Ÿåœ°åœ–"}, 
      "å…¶ä»–-åœ°éœ‡ç›£æ¸¬ç›´æ’­": {"id":"meHTKm4XBS8","label":"åœ°éœ‡ç›£æ¸¬ç›´æ’­","source":"è¯è¦–æ–°è CH52"},
      "å…¶ä»–-æ¾å±±æ©Ÿå ´èˆªç­è³‡è¨Š": {"id":"ZoUCjUtTVxs","label":"æ¾å±±æ©Ÿå ´èˆªç­è³‡è¨Š","source":"TWSkyWave ç©ºä¸­é›»æ³¢"},
      "å…¶ä»–-é«˜é›„æ©Ÿå ´èˆªç­è³‡è¨Š": {"id":"YdiLKafucSo","label":"é«˜é›„æ©Ÿå ´èˆªç­è³‡è¨Š","source":"TWSkyWave ç©ºä¸­é›»æ³¢"},
      "å…¶ä»–-æ¡ƒåœ’æ©Ÿå ´èˆªç­è³‡è¨Š": {"id":"GbvjIBkhOow","label":"æ¡ƒåœ’æ©Ÿå ´èˆªç­è³‡è¨Š","source":"TWSkyWave ç©ºä¸­é›»æ³¢"},
      "å…¶ä»–-æ¡ƒåœ’æ©Ÿå ´ç•«é¢/è³‡è¨Š": {"id":"0D6QgDOdI6c","label":"æ¡ƒåœ’æ©Ÿå ´ç•«é¢/è³‡è¨Š","source":"éŠæ¡ƒåœ’ Taoyuan Travel"}
    };
    /* ---------------------------------------------------------------------- */
    /* JavaScript åŠŸèƒ½ */
    /* ---------------------------------------------------------------------- */

    const PLAYER_IDS = ['player0', 'player1', 'player2', 'player3'];
    const LABEL_IDS = ['label0', 'label1', 'label2', 'label3'];
    const DEFAULT_VIDEO_ID = "215ahZ_0rTg";
    // ç§»é™¤ TEMPLE_STREAMS åˆ—è¡¨ï¼Œå› ç‚ºç¸®æ”¾å·²æ”¹ç‚ºé€šç”¨å¥—ç”¨
    // const TEMPLE_STREAMS = [ ... ]; 

    let selectedCamIndex = 0;
    let players = [];
    let streamState = Array(4).fill(null);
    let isMuted = true;
    let currentCity = null;
    // éŸ³æ¨‚æ’­æ”¾å™¨ç›¸é—œè®Šæ•¸
    let musicPlayer = null;
    let musicQueue = [];
    let currentMusicIndex = -1;
    let playbackMode = 'listLoop';
    let isPlaying = false;
    let isMusicReady = false;
    let currentPlaylistId = null;
    // å–®ç•«é¢å»¶é²åˆ·æ–°ä¿è­·ç‹€æ…‹
    let lastReloadAt = [0, 0, 0, 0];
    let isReloading = [false, false, false, false];
    const RELOAD_COOLDOWN_MS = 60000; // 60 ç§’å†·å»æ™‚é–“

    // åŸå¸‚åˆ†çµ„ï¼ˆä¿æŒä¸è®Šï¼‰
    const GROUPED_STREAMS = {};
    Object.keys(ALL_STREAMS).forEach(key => {
      const city = key.split('-')[0];
      if (!GROUPED_STREAMS[city]) GROUPED_STREAMS[city] = [];
      GROUPED_STREAMS[city].push({ key: key, ...ALL_STREAMS[key] });
    });
    // å¢åŠ ã€Œå…¶ä»–ã€åˆ°é›¢å³¶åˆ†çµ„ï¼Œæˆ–å‰µå»ºä¸€å€‹æ–°çš„ã€Œå…¶ä»–ã€åˆ†çµ„ã€‚é€™è£¡å°‡ã€Œå…¶ä»–ã€ç¨ç«‹å‡ºä¾†ã€‚
    const REGION_GROUPS = {
      'åŒ—éƒ¨': ['å°åŒ—', 'æ–°åŒ—', 'åŸºéš†', 'æ¡ƒåœ’', 'å®œè˜­', 'æ–°ç«¹'],
      'ä¸­éƒ¨': ['è‹—æ —', 'å°ä¸­', 'å½°åŒ–', 'å—æŠ•', 'é›²æ—'],
      'å—éƒ¨': ['å˜‰ç¾©', 'å°å—', 'é«˜é›„', 'å±æ±', 'æ¾æ¹–'],
      'æ±éƒ¨': ['èŠ±è“®', 'å°æ±'],
      'é›¢å³¶': ['é‡‘é–€', 'é¦¬ç¥–'],
      'å…¶ä»–': ['å…¶ä»–'] // æ–°å¢ 'å…¶ä»–' åˆ†çµ„
    };
    function onYouTubeIframeAPIReady() {
      PLAYER_IDS.forEach((id, index) => {
        const defaultStreams = [
          "å°åŒ—-è²“ç©ºæŒ‡å—å®®",
          "æ¡ƒåœ’-åœ‹éš›æ©Ÿå ´",
          "å°ä¸­-é«˜ç¾æ¿•åœ°",
          "é«˜é›„-å£½å±±è§€æ™¯å°"
        ];
        const defaultKey = defaultStreams[index];
        const initialVideoId = (defaultKey && ALL_STREAMS[defaultKey]) 
     
        ? ALL_STREAMS[defaultKey].id : DEFAULT_VIDEO_ID;
        
        // å–å¾—æ’­æ”¾å™¨å®¹å™¨å…ƒç´ ï¼Œç”¨æ–¼å¾Œé¢æ–°å¢ CSS é¡åˆ¥ (æ­¤è™•ä¸å†éœ€è¦æ¢ä»¶åˆ¤æ–·)
        // const playerContainer = document.getElementById(id); 

        players[index] = new YT.Player(id, {
          videoId: initialVideoId,
          playerVars: {
            autoplay: 1, controls: 0, modestbranding: 1, rel: 0, showinfo: 0, fs: 0,
  
            disablekb: 1, loop: 1, mute: 1, playsinline: 1
          },
          events: {
            onReady: onPlayerReady,
            onStateChange: (event) => handleStateChange(event, index)
          }
        });
        if (defaultKey && ALL_STREAMS[defaultKey]) {
   
          streamState[index] = { key: defaultKey, ...ALL_STREAMS[defaultKey] };
          updateLabel(index);
          // ç§»é™¤æ¢ä»¶åˆ¤æ–·ï¼šç¸®æ”¾å·²ç”± CSS é€šç”¨å¥—ç”¨
          /*
          if (TEMPLE_STREAMS.includes(defaultKey)) {
             playerContainer.classList.add('zoomed-stream');
          }
          */
        }
      });
      musicPlayer = new YT.Player('player_music', {
        videoId: '',
        playerVars: { autoplay: 0, controls: 0, modestbranding: 1, rel: 0, showinfo: 0, fs: 0, disablekb: 1, loop: 0, mute: 0, playsinline: 1 },
        events: { onReady: onMusicPlayerReady, onStateChange: onMusicPlayerStateChange }
      });
      renderRegionButtons(); 
      setTimeout(() => {
        setInterval(checkStreamDelayLoop, 20000); 
        console.log("âœ… ç›´æ’­å»¶é²æª¢æ¸¬ (æŒçºŒç›£æ¸¬) å·²å•Ÿå‹•ã€‚");
      }, 5000);
      document.addEventListener('visibilitychange', handleVisibilityChange);
      
      // ã€æ–°å¢ã€‘ç›£è½å…¨è¢å¹•ç‹€æ…‹è®ŠåŒ–ï¼Œç¢ºä¿æ§åˆ¶åˆ—æ­£ç¢ºé¡¯ç¤º/éš±è—
      document.addEventListener('fullscreenchange', handleFullscreenChange);
      document.addEventListener('webkitfullscreenchange', handleFullscreenChange);
      document.addEventListener('msfullscreenchange', handleFullscreenChange); document.addEventListener('mozfullscreenchange', handleFullscreenChange);
    }

    // ã€æ–°å¢ã€‘è™•ç†å…¨è¢å¹•ç‹€æ…‹è®ŠåŒ–çš„å‡½å¼
    function handleFullscreenChange() {
      const fullscreenElement = document.fullscreenElement ||
      document.webkitFullscreenElement || document.mozFullScreenElement || document.msFullscreenElement;

      if (fullscreenElement) {
        document.body.classList.add('fullscreen-active');
      } else {
        document.body.classList.remove('fullscreen-active');
      }
    }

    // é¸æ“‡é¡é ­ (ä¿æŒä¸è®Š)
    function selectCam(index) {
      selectedCamIndex = index;
      document.querySelectorAll('.controls button[id^="select-cam-"]').forEach(btn => {
        btn.classList.remove('active');
      });
      document.getElementById(`select-cam-${index}`).classList.add('active');
    }

    // ------------------- æ’­æ”¾å™¨äº‹ä»¶è™•ç†ï¼ˆä¿æŒä¸è®Šï¼‰ -------------------

    function onPlayerReady(event) {
      const player = event.target;
      const index = players.indexOf(player);
      try { player.setLoop(true); } catch(e) {}
      try { player.mute();
      } catch(e) {}
      const playPromise = player.playVideo();
      if (playPromise && typeof playPromise.catch === 'function') {
        playPromise.catch(error => {
          // è™•ç†è‡ªå‹•æ’­æ”¾å¤±æ•— (ä¾‹å¦‚ç€è¦½å™¨é˜»æ­¢)
          // console.warn(`ç•«é¢ ${index} è‡ªå‹•æ’­æ”¾å¤±æ•—:`, error);
          // åœ¨é€™è£¡å¯ä»¥å˜—è©¦é¡¯ç¤ºä¸€å€‹æŒ‰éˆ•è®“ç”¨æˆ¶é»æ“Šæ’­æ”¾
        });
      }
    }

    function handleStateChange(event, index) {
      // åœ¨æ­¤å¯åŠ å…¥éŒ¯èª¤è™•ç†é‚è¼¯ï¼Œä¾‹å¦‚åµæ¸¬ YT.PlayerState.ENDED æˆ– YT.PlayerState.BUFFERING 
      // æˆ–æ˜¯éŒ¯èª¤äº‹ä»¶ event.data === -1 (æœªå•Ÿå‹•/éŒ¯èª¤)
      if (event.data === YT.PlayerState.ENDED) {
        // å¦‚æœç›´æ’­çµæŸï¼Œé‡æ–°è¼‰å…¥
        const state = streamState[index];
        if (state) {
          console.log(`ç•«é¢ ${index} åµæ¸¬åˆ°ç›´æ’­çµæŸï¼Œå˜—è©¦é‡æ–°è¼‰å…¥ã€‚`);
          players[index].loadVideoById(state.id);
        }
      }
      // åœ¨å…¶ä»–ç¨‹å¼ç¢¼ä¸­ï¼Œæˆ‘å€‘å°‡ä½¿ç”¨ checkStreamDelayLoop ä¾†è™•ç†å»¶é²å•é¡Œ
    }

    /**
     * æª¢æŸ¥ç›´æ’­ç•«é¢æ˜¯å¦è½å¾Œ (Live Edge ç©©å®šåŠŸèƒ½)ã€‚
     * é€éæª¢æŸ¥ currentTime èˆ‡ duration çš„å·®ç•°ä¾†åˆ¤æ–·æ˜¯å¦éœ€è¦å¼·åˆ¶åŒæ­¥ã€‚
     */
    function checkStreamDelayLoop() {
      const now = Date.now();
      players.forEach((player, index) => {
        if (!player || !streamState[index]) return;
        if (player === musicPlayer) return;
        try {
          let current = 0, duration = 0;
          try { current = player.getCurrentTime ? player.getCurrentTime() : 0; } catch(e){}
          try { duration = player.getDuration ? player.getDuration() : 0;
          
          } catch(e){}
          const isLive = player.getVideoData().live;
          // åªæœ‰ç›´æ’­æ‰é€²è¡Œè½å¾ŒåŒæ­¥ (Live Edge)
          if (!isLive) return;

          if (!isFinite(current) || !isFinite(duration) || current <= 0 || duration <= 0) {
            if (player.getPlayerState() !== YT.PlayerState.PLAYING) {
              player.playVideo();
         
            }
            return;
          }
          const delay = duration - current;
          const state = streamState[index];
          if (delay > 30 && !isReloading[index] && (now - lastReloadAt[index] > RELOAD_COOLDOWN_MS)) {
            isReloading[index] = true;
           
            lastReloadAt[index] = now;
            console.log(`âš ï¸ ç•«é¢ ${index} åµæ¸¬åˆ°è½å¾Œ ${Math.floor(delay)} ç§’ï¼Œå·²åŸ·è¡Œã€Live Edge å¼·åˆ¶åŒæ­¥ã€‘ã€‚`);
            const liveDuration = player.getDuration();
            try {
              if (player && typeof player.seekTo === 'function' && liveDuration > 0) {
                player.seekTo(liveDuration, true);
                player.playVideo();
              } else {
                player.loadVideoById(state.id, liveDuration);
                player.playVideo();
              }
            } catch(e) {
              try {
                player.loadVideoById(state.id, liveDuration);
                player.playVideo();
              } catch(e){}
            }
            setTimeout(() => { isReloading[index] = false; }, 3000);
          }
        } catch(e) {
          console.error(`æª¢æŸ¥å»¶é²å¤±æ•— ${index}:`, e);
        }
      });
    }

    // ------------------- æ ¸å¿ƒäº’å‹•åŠŸèƒ½ -------------------

    function updateLabel(index) {
      const state = streamState[index];
      const labelElement = document.getElementById(`label${index}`);
      if (state) {
        labelElement.innerHTML = `${state.label}<span class="source-on-screen">ä¾†æº: ${state.source}</span>`;
      } else {
        labelElement.innerHTML = `è¼‰å…¥ä¸­...<span class="source-on-screen"></span>`;
      }
    }

    // è™•ç†é é¢å¯è¦‹æ€§è®ŠåŒ–çš„å‡½å¼
    function handleVisibilityChange() {
      if (!document.hidden) {
        // æ¢å¾©å››å€‹ç›´æ’­ç•«é¢
        players.forEach(player => {
          try {
            if (player.getPlayerState() !== YT.PlayerState.PLAYING) {
              player.playVideo();
            }
     
          } catch(e) {}
        });
        // æ¢å¾©èƒŒæ™¯éŸ³æ¨‚æ’­æ”¾å™¨
        if (typeof musicPlayer !== 'undefined' && typeof isPlaying !== 'undefined' && isPlaying) {
          try {
            if (musicPlayer.getPlayerState() !== YT.PlayerState.PLAYING) {
              musicPlayer.playVideo();
            }
          } catch(e) {}
        }
      }
    }

    /**
     * è¨­å®šç•¶å‰é¸ä¸­é¡é ­çš„ç›´æ’­ä¸²æµã€‚
     * @param {string} streamKey - å®Œæ•´çš„ä¸²æµéµ (ä¾‹å¦‚: "å°åŒ—-è±¡å±±çœ‹101")ã€‚
     */
    function setStream(streamKey) {
      const stream = ALL_STREAMS[streamKey];
      if (!stream) return;
      
      // const playerContainer = document.getElementById(`player${selectedCamIndex}`); // å–å¾—æ’­æ”¾å™¨å®¹å™¨
      const player = players[selectedCamIndex];
      streamState[selectedCamIndex] = { key: streamKey, ...stream };
      const videoId = stream.id;
      // ç§»é™¤æ¢ä»¶åˆ¤æ–·ï¼šç¸®æ”¾å·²åœ¨ CSS ä¸­é€šç”¨å¥—ç”¨
      /*
      const isTempleStream = TEMPLE_STREAMS.includes(streamKey);
      if (isTempleStream) {
        playerContainer.classList.add('zoomed-stream');
      } else {
        playerContainer.classList.remove('zoomed-stream');
      }
      */

      player.loadVideoById(videoId);
      player.mute();
      updateLabel(selectedCamIndex);
      // è¨­ç½®æ–°çš„æ™‚é–“æˆ³ï¼Œä»¥é˜²æ­¢å³æ™‚å»¶é²æª¢æ¸¬ç«‹å³é‡æ–°è¼‰å…¥
      lastReloadAt[selectedCamIndex] = Date.now();
    }

    function toggleFullscreen() {
      const stage = document.getElementById('stageWrap');
      if (!document.fullscreenElement && !document.webkitFullscreenElement && !document.msFullscreenElement && !document.mozFullScreenElement) {
        if (stage.requestFullscreen) {
          stage.requestFullscreen();
        } else if (stage.webkitRequestFullscreen) {
          stage.webkitRequestFullscreen();
        } else if (stage.msRequestFullscreen) {
          stage.msRequestFullscreen();
        } else if (stage.mozRequestFullScreen) {
          stage.mozRequestFullScreen();
        }
      } else {
        if (document.exitFullscreen) {
          document.exitFullscreen();
        } else if (document.webkitExitFullscreen) {
          document.webkitExitFullscreen();
        } else if (document.msExitFullscreen) {
          document.msExitFullscreen();
        } else if (document.mozCancelFullScreen) {
          document.mozCancelFullScreen();
        }
      }
    }

    function toggleLabels() {
      const body = document.body;
      const isHidden = body.classList.toggle('hide-labels');
      document.getElementById('labelsToggleBtn').innerText = isHidden ? 'é¡¯ç¤ºæ¨™ç±¤' : 'æ¨™ç±¤éš±è—';
    }

    function toggleMute() {
      isMuted = !isMuted;
      players.forEach(player => {
        try { isMuted ? player.mute() : player.unMute(); } catch(e){}
      });
      document.getElementById('muteBtn').innerText = isMuted ? 'è§£é™¤éœéŸ³' : 'éœéŸ³';
    }

    /**
     * æ¸²æŸ“é ‚å±¤çš„åœ°å€/åŸå¸‚ç¾¤çµ„æŒ‰éˆ•ã€‚
     */
    function renderRegionButtons() {
      const container = document.getElementById('regionButtons');
      container.innerHTML = '';
      currentCity = null;
      Object.keys(REGION_GROUPS).forEach(region => {
        const cities = REGION_GROUPS[region].filter(city => GROUPED_STREAMS[city] && GROUPED_STREAMS[city].length > 0);
        if (cities.length === 0) return;
        const regionLabel = document.createElement('span');
        regionLabel.className = 'region-label';
        regionLabel.textContent = region + 'ï¼š';
        container.appendChild(regionLabel);
        cities.forEach(city => {
          const streams 
          = GROUPED_STREAMS[city];
          if (streams.length > 0) {
            const cityBtn = document.createElement('button');
            cityBtn.className = 'city-btn';
            cityBtn.textContent = city;
            cityBtn.title = `åˆ‡æ›é¡¯ç¤º ${city} çš„ç›´æ’­åˆ—è¡¨`;
            if (currentCity === city) {
          
              cityBtn.classList.add('active-city');
            }
            cityBtn.onclick = () => showCityStreams(city);
            container.appendChild(cityBtn);
          }
        });
      });
    }

    /**
     * é¡¯ç¤ºç‰¹å®šåŸå¸‚çš„æ™¯é»ç›´æ’­æŒ‰éˆ•åˆ—è¡¨ (å–ä»£åŸå¸‚æŒ‰éˆ•)ã€‚
     * @param {string} city - åŸå¸‚åç¨± (ä¾‹å¦‚: "å°åŒ—")ã€‚
     */
    function showCityStreams(city) {
      const streams = GROUPED_STREAMS[city];
      if (!streams || streams.length === 0) return;
      currentCity = city;
      const container = document.getElementById('regionButtons');
      container.innerHTML = '';
      // 1. é¡¯ç¤ºè¿”å›æŒ‰éˆ•
      const backBtn = document.createElement('button');
      backBtn.className = 'back-btn';
      backBtn.textContent = 'ğŸ  è¿”å›åœ°å€åˆ—è¡¨';
      backBtn.title = 'è¿”å›åœ°å€/åŸå¸‚é¸æ“‡é é¢';
      backBtn.onclick = renderRegionButtons;
      container.appendChild(backBtn);
      // 2. é¡¯ç¤ºåŸå¸‚åç¨±æ¨™ç±¤
      const cityLabel = document.createElement('span');
      cityLabel.className = 'region-label';
      cityLabel.textContent = `${city}ï¼š`;
      container.appendChild(cityLabel);
      // 3. é¡¯ç¤ºè©²åŸå¸‚æ‰€æœ‰æ™¯é»æŒ‰éˆ• (ä¸€éµåˆ‡æ›)
      streams.forEach(stream => {
        const streamBtn = document.createElement('button');
        streamBtn.className = 'stream-btn';
        // åƒ…é¡¯ç¤ºåœ°åéƒ¨åˆ†ï¼Œä¾‹å¦‚ï¼šå°åŒ—-è±¡å±±çœ‹101 -> è±¡å±±çœ‹101
        streamBtn.textContent = stream.key.split('-').slice(1).join('-');
        streamBtn.title = `åˆ‡æ›è‡³ï¼š${stream.label} (${stream.source})`;
        // é»æ“Šå¾Œç›´æ¥è¨­å®šä¸²æµï¼Œä¸éœ€è¦ prompt
        streamBtn.onclick = () => setStream(stream.key);
       
        container.appendChild(streamBtn);
      });
    }

    // ------------------- éŸ³æ¨‚æ’­æ”¾åŠŸèƒ½ -------------------

    function onMusicPlayerReady() {
      isMusicReady = true;
      console.log("âœ… éŸ³æ¨‚æ’­æ”¾å™¨å·²å°±ç·’ã€‚");
      // åœ¨æ’­æ”¾å™¨å°±ç·’å¾Œï¼Œè¨­ç½®åª’é«”æœƒè©± (Media Session)
      updateMediaSession();
    }

    /**
     * è™•ç†éŸ³æ¨‚æ’­æ”¾å™¨ç‹€æ…‹è®ŠåŒ–ï¼Œå¯¦ç¾åˆ—è¡¨å¾ªç’°å’Œéš¨æ©Ÿæ’­æ”¾é‚è¼¯ã€‚
     * @param {object} event - YouTube Player API event object.
     */
    function onMusicPlayerStateChange(event) {
      if (!isPlaying) return;
      // åªæœ‰åœ¨æ˜ç¢ºé»æ“Šæ’­æ”¾å¾Œï¼Œæ‰è™•ç†ç‹€æ…‹è®ŠåŒ–

      if (event.data == YT.PlayerState.PLAYING) {
        updatePlayPauseButton(true);
      } else if (event.data == YT.PlayerState.PAUSED) {
        updatePlayPauseButton(false);
      } else if (event.data == YT.PlayerState.ENDED) {
        updatePlayPauseButton(false);
        if (currentPlaylistId) {
          // YouTube æ¸…å–®æ¨¡å¼ä¸‹ï¼Œæ’­æ”¾å™¨æœƒè‡ªå‹•è™•ç†ä¸‹ä¸€é¦–ï¼Œä½†å¦‚æœéœ€è¦åˆ—è¡¨å¾ªç’°ï¼Œéœ€è¦æ‰‹å‹•æ§åˆ¶
          if (playbackMode === 'listLoop') {
            const playlist = musicPlayer.getPlaylist();
            const currentIndex = musicPlayer.getPlaylistIndex();
            // å¦‚æœæ’­åˆ°æ¸…å–®æœ€å¾Œä¸€é¦–ï¼Œå‰‡å¾é ­æ’­æ”¾
            if (playlist && currentIndex >= playlist.length - 1) {
              musicPlayer.playVideoAt(0);
            }
          }
          // åœ¨æ¸…å–®æ¨¡å¼ä¸‹ï¼Œå¦‚æœä¸æ˜¯å¾ªç’°æ¨¡å¼ï¼Œæ’­å®Œå³åœï¼Œä½† YouTube Player æœ¬èº«æœƒåœåœ¨æœ€å¾Œä¸€é¦–çš„ ENDED ç‹€æ…‹ï¼Œé€™è£¡ä¸éœ€è¦é¡å¤–æ“ä½œã€‚
        } else {
          // è‡ªè¨‚åˆ—è¡¨æ¨¡å¼ (ä¿®å¾©é‚è¼¯: ç¢ºä¿èƒ½æ­£ç¢ºå¾ªç’°å’Œéš¨æ©Ÿè·³è½‰)
          let nextIndex = -1;
          if (musicQueue.length === 0) {
            // åˆ—è¡¨ç‚ºç©ºï¼Œåœæ­¢æ’­æ”¾
            currentMusicIndex = -1;
            isPlaying = false;
            document.getElementById('musicControlsContainer').style.display = 'none';
          } else if (playbackMode === 'shuffle') {
            // éš¨æ©Ÿæ¨¡å¼ï¼Œé¸æ“‡ä¸€å€‹æ–°çš„éš¨æ©Ÿæ­Œæ›²ç´¢å¼•
            if (musicQueue.length > 1) {
              do {
                nextIndex = Math.floor(Math.random() * musicQueue.length);
              } while (nextIndex === currentMusicIndex);
            } else {
              nextIndex = 0; // åªæœ‰ä¸€é¦–æ­Œæ™‚ï¼Œæ’­æ”¾å®ƒ
            }
          } else if (playbackMode === 'listLoop') {
            // åˆ—è¡¨å¾ªç’°æ¨¡å¼
            nextIndex = (currentMusicIndex + 1) % musicQueue.length;
          } else {
            // é †åºæ’­æ”¾æ¨¡å¼ (é›–ç„¶ç›®å‰åªæœ‰ listLoop å’Œ shuffleï¼Œä½†ä¿ç•™ä»¥é˜²æ“´å±•)
            nextIndex = currentMusicIndex + 1;
            if (nextIndex >= musicQueue.length) {
              nextIndex = -1; // æ’­å®Œåœæ­¢
            }
          }
          
          currentMusicIndex = nextIndex;

          if (currentMusicIndex !== -1 && currentMusicIndex < musicQueue.length) {
            loadAndPlayCurrentSong();
          } else {
            // åˆ—è¡¨æ’­æ”¾å®Œç•¢ (éå¾ªç’°æ¨¡å¼ä¸‹)
            currentMusicIndex = -1;
            isPlaying = false;
            document.getElementById('musicControlsContainer').style.display = 'none';
            document.getElementById('playPauseBtn').innerText = 'â–¶ï¸';
          }
        }
      }
    }

    function extractVideoId(urlOrId) {
      if (urlOrId.includes('list=')) {
        const urlParams = new URLSearchParams(urlOrId.split('?')[1]);
        const listId = urlParams.get('list');
        if (listId) return listId;
      }
      const match = urlOrId.match(/(?:youtu\.be\/|youtube\.com\/(?:embed\/|v\/|watch\?v=|watch\?.+&v=))([^&?]+)/);
      return match ?
        match[1] : (urlOrId.length === 11 ? urlOrId : null);
    }

    function requestSong() {
      const input = prompt("ğŸ¶ è¼¸å…¥ YouTube å½±ç‰‡/æ¸…å–®ç¶²å€æˆ– IDï¼š\nï¼ˆä¾‹å¦‚ï¼šå½±ç‰‡ID: dQw4w9WgXcQï¼Œæˆ–æ’­æ”¾æ¸…å–®ç¶²å€ï¼‰");
      if (!input) return;
      const id = extractVideoId(input);
      if (!id) {
        alert("ç„¡æ•ˆçš„ YouTube ç¶²å€æˆ– IDã€‚");
        return;
      }
      const isPlaylist = input.includes('list=');
      if (isPlaylist) {
        if (currentPlaylistId === id) {
          alert("è©²æ’­æ”¾æ¸…å–®å·²åœ¨æ’­æ”¾ä¸­ã€‚");
          return;
        }
        currentPlaylistId = id;
        musicQueue = [];
        currentMusicIndex = -1;
        musicPlayer.loadPlaylist({ list: id, listType: 'playlist', index: 0, startSeconds: 0 });
        document.getElementById('musicControlsContainer').style.display = 'flex';
        isPlaying = true;
        updatePlayPauseButton(true);
        alert(`âœ… å·²è¼‰å…¥æ’­æ”¾æ¸…å–® ID: ${id}`);
      } else {
        if (currentPlaylistId) {
          alert("ç•¶å‰æ­£åœ¨æ’­æ”¾æ¸…å–®ï¼Œè«‹å…ˆåœæ­¢æ¸…å–®æ’­æ”¾ (è¨­å®š -> åœæ­¢)ï¼Œå†é»æ’­å–®æ›²ã€‚");
          return;
        }
        musicQueue.push(id);
        alert(`âœ… å·²å°‡å½±ç‰‡ ID: ${id} åŠ å…¥æ’­æ”¾åˆ—è¡¨ã€‚`);
        if (currentMusicIndex === -1 || !isPlaying) {
          currentMusicIndex = currentMusicIndex === -1 ?
          0 : musicQueue.length - 1;
          loadAndPlayCurrentSong();
        }
        document.getElementById('musicControlsContainer').style.display = 'flex';
      }
    }

    // æ–°å¢ updateMediaSession å‡½å¼ (Media Session API è¨»å†Š)
    function updateMediaSession() {
      // æª¢æŸ¥ç€è¦½å™¨æ˜¯å¦æ”¯æ´ Media Session API
      if ('mediaSession' in navigator) {
        // 1. è¨­å®šåª’é«”è³‡è¨Š (é¡¯ç¤ºåœ¨ç³»çµ±é€šçŸ¥/é–å®šç•«é¢)
        navigator.mediaSession.metadata = new MediaMetadata({
          title: 'èƒŒæ™¯éŸ³æ¨‚æ’­æ”¾ä¸­',
          artist: 'å°ç£å³æ™‚ç›´æ’­å››åˆ†å‰²ç›£çœ‹',
          album: 'èƒŒæ™¯æ’­æ”¾åˆ—è¡¨',
    
          // artwork: [{ src: 'æ‚¨çš„åœ–ç‰‡URL', sizes: '96x96', type: 'image/...
        });
        // 2. è¨­å®šæ§åˆ¶äº‹ä»¶è™•ç†å™¨ (å³ä½¿æ²’æœ‰å¯¦éš›æ’­æ”¾ï¼Œä¹Ÿæ‡‰è¨­ç½®ä»¥è®“ç€è¦½å™¨çŸ¥é“æˆ‘å€‘çš„æ„åœ–)
        // æ’­æ”¾/æš«åœ
        navigator.mediaSession.setActionHandler('play', () => {
          musicPlayer.playVideo();
          isPlaying = true;
          updatePlayPauseButton(true);
        });
        navigator.mediaSession.setActionHandler('pause', () => {
          musicPlayer.pauseVideo();
          isPlaying = false;
          updatePlayPauseButton(false);
        });
        // è·³è½‰ä¸‹ä¸€é¦–
        navigator.mediaSession.setActionHandler('nexttrack', () => {
          skipToNextSong();
        });
        // è·³è½‰ä¸Šä¸€é¦–
        navigator.mediaSession.setActionHandler('previoustrack', () => {
          skipToPreviousSong();
        });
        // ç¦ç”¨ä¸æ”¯æ´çš„åŠŸèƒ½
        navigator.mediaSession.setActionHandler('stop', null);
        navigator.mediaSession.setActionHandler('seekto', null);
        navigator.mediaSession.setActionHandler('seekforward', null);
        navigator.mediaSession.setActionHandler('seekbackward', null);
        navigator.mediaSession.setActionHandler('togglemicrophone', null);
        navigator.mediaSession.setActionHandler('togglecamera', null);
        navigator.mediaSession.setActionHandler('hangup', null);
      }
    }

    function loadAndPlayCurrentSong() {
      if (!isMusicReady || musicQueue.length === 0 || currentMusicIndex < 0) return;
      const songId = musicQueue[currentMusicIndex];
      musicPlayer.loadVideoById(songId, 0);
      musicPlayer.unMute();
      musicPlayer.playVideo();
      isPlaying = true;
      document.getElementById('playPauseBtn').innerText = 'â¸ï¸';
    }

    function playPauseSong() {
      if (!musicPlayer || musicQueue.length === 0) return;
      try {
        if (musicPlayer.getPlayerState() === YT.PlayerState.PLAYING) {
          musicPlayer.pauseVideo();
          isPlaying = false;
          document.getElementById('playPauseBtn').innerText = 'â–¶ï¸';
        } else {
          musicPlayer.playVideo();
          isPlaying = true;
          document.getElementById('playPauseBtn').innerText = 'â¸ï¸';
        }
      } catch(e) {
        // å¦‚æœ API å‘¼å«å¤±æ•— (ä¾‹å¦‚æ’­æ”¾å™¨æœªå®Œå…¨è¼‰å…¥)ï¼Œå˜—è©¦å¼·åˆ¶è¼‰å…¥ä¸¦æ’­æ”¾
        if (musicQueue.length > 0 && currentMusicIndex !== -1) {
          loadAndPlayCurrentSong();
        }
      }
    }

    function updatePlayPauseButton(isCurrentlyPlaying) {
      document.getElementById('playPauseBtn').innerText = isCurrentlyPlaying ?
      'â¸ï¸' : 'â–¶ï¸';
    }

    function skipToNextSong() {
      if (currentPlaylistId) {
        musicPlayer.nextVideo();
        return;
      }
      if (musicQueue.length === 0) return;

      if (playbackMode === 'shuffle') {
        let nextIndex;
        do {
          nextIndex = Math.floor(Math.random() * musicQueue.length);
        } while (nextIndex === currentMusicIndex && musicQueue.length > 1);
        currentMusicIndex = nextIndex;
      } else { // 'listLoop' æ¨¡å¼
        currentMusicIndex++;
        if (currentMusicIndex >= musicQueue.length) {
          if (playbackMode === 'listLoop') {
            currentMusicIndex = 0; // å¾ªç’°åˆ°åˆ—è¡¨çš„ç¬¬ä¸€é¦–
          } else {
            currentMusicIndex = -1;
            isPlaying = false;
            document.getElementById('musicControlsContainer').style.display = 'none';
          }
        }
      }

      if (currentMusicIndex !== -1) {
        loadAndPlayCurrentSong();
      }
    }

    function skipToPreviousSong() {
      if (currentPlaylistId) {
        musicPlayer.previousVideo();
        return;
      }
      if (musicQueue.length === 0) return;

      if (playbackMode === 'shuffle') {
        // éš¨æ©Ÿæ¨¡å¼ä¸‹ï¼Œä¸Šä¸€é¦–å’Œä¸‹ä¸€é¦–éƒ½æ˜¯éš¨æ©Ÿï¼Œç‚ºäº†ç°¡å–®ï¼Œå‘¼å« nextSong å¯¦ç¾æ–°çš„éš¨æ©Ÿ
        skipToNextSong(); 
      } else { // 'listLoop' æ¨¡å¼
        currentMusicIndex--;
        if (currentMusicIndex < 0) {
          if (playbackMode === 'listLoop') {
            currentMusicIndex = musicQueue.length - 1; // å¾ªç’°åˆ°åˆ—è¡¨çš„æœ€å¾Œä¸€é¦–
          } else {
            currentMusicIndex = 0;
            // é †åºæ¨¡å¼ä¸‹ï¼Œåœåœ¨ç¬¬ä¸€é¦–
          }
        }
      }

      if (currentMusicIndex !== -1) {
        loadAndPlayCurrentSong();
      }
    }

    function setPlaybackMode(mode) {
      playbackMode = mode;
      document.getElementById('modeListLoop').classList.remove('active');
      document.getElementById('modeShuffle').classList.remove('active');
      document.getElementById(`mode${mode.charAt(0).toUpperCase() + mode.slice(1)}`).classList.add('active');
      alert(`æ’­æ”¾æ¨¡å¼å·²åˆ‡æ›ç‚ºï¼š${mode === 'listLoop' ? 'åˆ—è¡¨å¾ªç’° ğŸ”„' : 'éš¨æ©Ÿæ’­æ”¾ ğŸ”€'}`);
    }

    function openMusicSettingsModal() {
      document.getElementById('musicSettingsModal').style.display = 'flex';
      // è¨­å®šç•¶å‰æ¨¡å¼çš„ active æ¨£å¼
      document.getElementById('modeListLoop').classList.remove('active');
      document.getElementById('modeShuffle').classList.remove('active');
      document.getElementById(`mode${playbackMode.charAt(0).toUpperCase() + playbackMode.slice(1)}`).classList.add('active');
    }

    function closeMusicSettingsModal() {
      document.getElementById('musicSettingsModal').style.display = 'none';
    }

    function stopAndCloseModal() {
      if (musicPlayer) {
        musicPlayer.stopVideo();
        currentPlaylistId = null; // æ¸…é™¤æ’­æ”¾æ¸…å–®ç‹€æ…‹
        musicQueue = [];
        // æ¸…ç©ºè‡ªè¨‚åˆ—è¡¨
        currentMusicIndex = -1;
      }
      document.getElementById('musicControlsContainer').style.display = 'none';
      isPlaying = false;
      document.getElementById('playPauseBtn').innerText = 'â–¶ï¸';
      closeMusicSettingsModal();
    }

    function showMusicQueueStatusModal() {
      const queueContentDiv = document.getElementById('queueListContent');
      
      let content = '';
      if (currentPlaylistId) {
        content = `<p style="color:#fff; font-size:14px; margin-top:0;">æ­£åœ¨æ’­æ”¾æ¸…å–® IDï¼š<br><span style="color:#0078d7; word-break: break-all;">${currentPlaylistId}</span></p>`;
        content += `<p style="color:#aaa; font-size:12px;">æ¸…å–®æ¨¡å¼ç„¡æ³•æŸ¥çœ‹æ­Œæ›²åˆ—è¡¨ã€‚</p>`;
      } else if (musicQueue.length === 0) {
        content = '<p style="text-align:center; color:#ccc;">æ’­æ”¾åˆ—è¡¨æ˜¯ç©ºçš„ã€‚</p>';
      } else {
        content += `<p style="color:#fff; font-size:14px; margin-top:0;">ç¸½è¨ˆï¼š${musicQueue.length} é¦– | æ¨¡å¼ï¼š${playbackMode === 'listLoop' ? 'å¾ªç’°' : 'éš¨æ©Ÿ'}</p><ul style="list-style:none; padding:0; max-height:200px; overflow-y:auto;">`;
        musicQueue.forEach((id, index) => {
          const isCurrent = index === currentMusicIndex;
          content += `<li style="padding:4px 0; font-size:13px; color:${isCurrent ? '#0078d7' : '#fff'}; background:${isCurrent ? 'rgba(0,120,215,0.2)' : 'transparent'}; border-radius:4px; ${isCurrent ? 'font-weight:bold;' : ''}">`;
          content += `${isCurrent ? 'â–¶ï¸' : (index + 1) + '.'} å½±ç‰‡ ID: <span style="word-break: break-all;">${id}</span>`;
          content += '</li>';
        });
        content += '</ul>';
      }
      
      queueContentDiv.innerHTML = content;
      document.getElementById('musicQueueModal').style.display = 'flex';
    }

    function closeMusicQueueModal() {
      document.getElementById('musicQueueModal').style.display = 'none';
    }
  </script>
</body>
</html>
