<!DOCTYPE html>
<html lang="zh-TW">
<head>
  <meta charset="utf-8" />
  <title>å°ç£å³æ™‚ç›´æ’­å››åˆ†å‰²ç›£çœ‹ï¼ˆæœ€çµ‚ç©©å®šç‰ˆ - åœ°å€åˆ†é¡ï¼šåŒ—éƒ¨/ä¸­éƒ¨/å—éƒ¨/æ±éƒ¨/é›¢å³¶ï¼‰</title>
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <style>
    /* ---------------------------------------------------------------------- */
    /* CSS æ¨£å¼ */
    /* ---------------------------------------------------------------------- */
    html,body{
      height:100%; margin:0; padding:0; background:#000;
      font-family: system-ui, sans-serif; color:#fff; overflow:hidden;
    }

    /* åº•éƒ¨æ§åˆ¶åˆ— */
    .controls{
      position:fixed; bottom:0; left:0; width:100%; height:78px;
      background:rgba(12,12,12,0.95); color:#fff; padding:8px 12px;
      box-sizing:border-box; display:flex; flex-direction:row; align-items:center;
      gap:10px; z-index:3000; overflow:hidden;
    }
    .controls button{
      background-color:#222; color:#fff; border:1px solid #444;
      padding:8px 12px; font-size:13px; cursor:pointer; border-radius:6px;
      height:40px; flex-shrink:0; white-space:nowrap; text-align:center;
    }
    .controls button.active{ background-color:#0078d7; border-color:#0078d7; }
    .divider{ width:1px; height:60%; background:#333; flex-shrink:0; margin:0; }

    /* ç¸£å¸‚ / æ™¯é»å®¹å™¨ï¼ˆå¯å·¦å³æ»¾å‹•ï¼‰ */
    #regionButtons{
      display:flex; flex-grow:1; min-width:0; gap:6px;
      overflow-x:auto; padding-bottom:6px; height:100%; align-items:center;
    }
    #regionButtons::-webkit-scrollbar{ height:6px; background-color:rgba(255,255,255,0.06); }
    #regionButtons::-webkit-scrollbar-thumb{ background-color:#444; border-radius:3px; }
    .region-label{ color:#fff; margin:0 8px 0 4px; font-weight:600; flex-shrink:0; user-select:none; }
    #regionButtons .city-btn{
      background-color:#111; color:#fff; border:1px solid #555;
      padding:6px 10px; margin:0 4px; border-radius:6px; cursor:pointer;
      height:36px; flex-shrink:0; font-size:13px;
    }
    #regionButtons .city-btn:hover{ background-color:#1a1a1a; border-color:#666; }

    /* å½±ç‰‡èˆå°å››æ ¼ */
    .stage-wrap{
      position:fixed; top:0; left:0; width:100vw; height:calc(100vh - 78px);
      display:grid; grid-template-columns:1fr 1fr; grid-template-rows:1fr 1fr;
      gap:0; z-index:1;
    }
    .cell{ position:relative; width:100%; height:100%; overflow:hidden; background:#000; }
    .player-container, .player-container iframe{
      position:absolute; inset:0; width:100%; height:100%; border:0; display:block;
      object-fit:cover; object-position:center; background:black;
      transform: scale(1.65) translateY(-6%); /* ç¢ºä¿ç•«é¢æ”¾å¤§ä¸¦èšç„¦ */
    }
    .interaction-shield{ position:absolute; inset:0; z-index:5; background:transparent; cursor:default; }
    .label{
      position:absolute; left:8px; right:8px; bottom:8px; display:flex;
      flex-direction:column; align-items:flex-start; padding:6px 8px;
      font-size:14px; color:#fff; background:rgba(0,0,0,0.6); border-radius:6px;
      pointer-events:none; z-index:10;
    }
    .source-on-screen{ font-size:11px; color:#ccc; margin-top:4px; line-height:1.1; }

    /* é¡¯ç¤ºæ§åˆ¶ */
    .hide-labels .label{ display:none; }
    .fullscreen-active .controls{ display:none; }
    .fullscreen-active .stage-wrap{ height:100vh; }

    @media (max-width:640px){
      .controls{ padding:6px 8px; height:80px; }
      .controls button{ padding:6px 8px; font-size:12px; height:36px; }
      #regionButtons .city-btn{ padding:6px 8px; font-size:12px; height:34px; }
    }
    
    /* ---------------------------------------------------------------------- */
    /* æ–°å¢ï¼šéŸ³æ¨‚æ§åˆ¶å€å¡Šæ¨£å¼ */
    /* ---------------------------------------------------------------------- */
    .music-controls-container {
        display: none; /* é è¨­éš±è—ï¼Œæœ‰æ­Œæ›²æ™‚æ‰é¡¯ç¤º */
        align-items: center;
        gap: 4px; 
        flex-shrink: 0;
    }
    .music-controls {
        display: flex;
        gap: 4px;
        flex-shrink: 0;
    }
    .music-controls button {
        padding: 8px 10px; 
        font-size: 14px;
        height: 40px;
    }
    /* æ¨¡å¼è¨­å®šå½ˆå‡ºçª—æŒ‰éˆ•æ¨£å¼ */
    #musicSettingsModal button, #musicQueueModal button {
        background-color: #333;
        color: #fff;
        border: none;
        padding: 10px 15px;
        border-radius: 6px;
        cursor: pointer;
        font-size: 14px;
        flex-grow: 1;
    }
    #musicSettingsModal button:hover, #musicQueueModal button:hover {
        background-color: #555;
    }
  </style>
</head>
<body>
  <div class="controls" id="controls">
    <button id="select-cam-0" class="active" onclick="selectCam(0)">å·¦ä¸Š</button>
    <button id="select-cam-1" onclick="selectCam(1)">å³ä¸Š</button>
    <button id="select-cam-2" onclick="selectCam(2)">å·¦ä¸‹</button>
    <button id="select-cam-3" onclick="selectCam(3)">å³ä¸‹</button>

    <div class="divider"></div>

    <div id="regionButtons" aria-label="ç¸£å¸‚èˆ‡æ™¯é»é¸å–®" role="toolbar"></div>

    <div class="divider"></div>
    <button id="fullscreenBtn" onclick="toggleFullscreen()">å…¨è¢å¹•</button>

    <div class="divider"></div>
    <button id="labelsToggleBtn" onclick="toggleLabels()">æ¨™ç±¤éš±è—</button>

    <div class="divider"></div>
    <button id="muteBtn" onclick="toggleMute()">è§£é™¤éœéŸ³</button>
    
    <div class="divider"></div>
    <button id="requestBtn" onclick="requestSong()" title="è¼¸å…¥ç¶²å€/IDé»æ­Œæˆ–æ’­æ”¾æ¸…å–®">ğŸ¶ é»æ­Œ/æ¸…å–®</button>
    <button id="playlistQueueBtn" onclick="showMusicQueueStatusModal()" title="æŸ¥çœ‹æ’­æ”¾åˆ—è¡¨ç‹€æ…‹">ğŸµ åˆ—è¡¨ç‹€æ…‹</button>
    
    <div id="musicControlsContainer" class="music-controls-container">
        <div class="music-controls">
            <button id="prevSongBtn" onclick="skipToPreviousSong()" title="ä¸Šä¸€é¦–">â®ï¸</button>
            <button id="playPauseBtn" onclick="playPauseSong()" title="æ’­æ”¾/æš«åœ">â¸ï¸</button>
            <button id="nextSongBtn" onclick="skipToNextSong()" title="ä¸‹ä¸€é¦–">â­ï¸</button>
            <button id="modeBtn" onclick="openMusicSettingsModal()" title="æ¨¡å¼è¨­å®š">ğŸ”„</button>
        </div>
    </div>
    
  </div>

  <div class="stage-wrap" id="stageWrap">
    <div class="cell" data-index="0">
      <div id="player0" class="player-container"></div>
      <div class="interaction-shield"></div>
      <div class="label" id="label0">è¼‰å…¥ä¸­...<span class="source-on-screen"></span></div>
    </div>
    <div class="cell" data-index="1">
      <div id="player1" class="player-container"></div>
      <div class="interaction-shield"></div>
      <div class="label" id="label1">è¼‰å…¥ä¸­...<span class="source-on-screen"></span></div>
    </div>
    <div class="cell" data-index="2">
      <div id="player2" class="player-container"></div>
      <div class="interaction-shield"></div>
      <div class="label" id="label2">è¼‰å…¥ä¸­...<span class="source-on-screen"></span></div>
    </div>
    <div class="cell" data-index="3">
      <div id="player3" class="player-container"></div>
      <div class="interaction-shield"></div>
      <div class="label" id="label3">è¼‰å…¥ä¸­...<span class="source-on-screen"></span></div>
    </div>
  </div>
  
  <div id="player_music_container" style="position:fixed; top:-100px; left:-100px; width:1px; height:1px; overflow:hidden;">
    <div id="player_music"></div>
  </div>

  <div id="musicSettingsModal" style="display:none; position:fixed; inset:0; background:rgba(0,0,0,0.8); z-index:9999; justify-content:center; align-items:center;">
    <div style="background:#222; padding:20px; border-radius:10px; box-shadow:0 0 20px rgba(0,0,0,0.5); width:300px; max-width:90%; text-align:center;">
      <h3 style="margin-top:0; color:#fff;">éŸ³æ¨‚æ’­æ”¾æ¨¡å¼</h3>
      <p style="font-size:12px; color:#aaa;">é»æ“Šä¸‹æ–¹æŒ‰éˆ•é¸æ“‡æ’­æ”¾æ¨¡å¼ï¼š</p>
      <div style="display:flex; justify-content:space-around; gap:10px; margin-top:15px;">
        <button onclick="setPlaybackMode('listLoop')">
            ğŸ”„ åˆ—è¡¨å¾ªç’°
        </button>
        <button onclick="setPlaybackMode('shuffle')">
            ğŸ”€ éš¨æ©Ÿæ’­æ”¾
        </button>
        <button onclick="setPlaybackMode('repeatOne')">
            ğŸ” å–®æ›²å¾ªç’°
        </button>
      </div>
      
      <button onclick="stopAndCloseModal()" style="margin-top:15px; background:#8b0000; width:100%; border:none;">
          â¹ï¸ åœæ­¢ä¸¦çµæŸæ’­æ”¾
      </button>

      <button onclick="closeMusicSettingsModal()" style="margin-top:10px; background:#444; width:100%;">é—œé–‰</button>
    </div>
  </div>

  <div id="musicQueueModal" style="display:none; position:fixed; inset:0; background:rgba(0,0,0,0.8); z-index:9999; justify-content:center; align-items:center;">
    <div style="background:#222; padding:20px; border-radius:10px; box-shadow:0 0 20px rgba(0,0,0,0.5); width:350px; max-width:90%;">
      <h3 style="margin-top:0; color:#fff; text-align:center;">ğŸ¶ æ’­æ”¾åˆ—è¡¨ç‹€æ…‹</h3>
      <div id="queueListContent" style="margin-bottom:15px; padding-right:5px;">
        </div>
      
      <button onclick="closeMusicQueueModal()" style="margin-top:10px; background:#444; width:100%;">é—œé–‰</button>
    </div>
  </div>

  <script src="https://www.youtube.com/iframe_api"></script>
  <script>
    // ===== ç›´æ’­ä¾†æº (ç¸½è¨ˆ 100 å€‹åœ°é») - é€™æ˜¯æ‚¨ç¢ºèªç„¡èª¤çš„æ¸…å–® =====
    const ALL_STREAMS = {
      // å°åŒ—å¸‚
      "å°åŒ—-è±¡å±±çœ‹101": {"id":"z_fY1pj1VBw","label":"å°åŒ—è±¡å±±","source":"Taipei Travel Live Cam å°åŒ—è§€å…‰å³æ™‚å½±åƒ"},
      "å°åŒ—-å¤§ç¨»åŸ•": {"id":"Ndo_8RuefH4","label":"å¤§ç¨»åŸ•","source":"Taipei Travel Live Cam å°åŒ—è§€å…‰å³æ™‚å½±åƒ"},
      "å°åŒ—-ç¢§å±±å·–": {"id":"uvwfYzwY8tg","label":"ç¢§å±±å·–","source":"Taipei Travel Live Cam å°åŒ—è§€å…‰å³æ™‚å½±åƒ"},
      "å°åŒ—-å¾®é¢¨å¹³å°": {"id":"34h_Cy_n0Ok","label":"å¾®é¢¨å¹³å°","source":"Taipei Travel Live Cam å°åŒ—è§€å…‰å³æ™‚å½±åƒ"},
      "å°åŒ—-è²“ç©ºæŒ‡å—å®®": {"id":"215ahZ_0rTg","label":"è²“ç©ºæŒ‡å—å®®","source":"Taipei Travel Live Cam å°åŒ—è§€å…‰å³æ™‚å½±åƒ"},
      "å°åŒ—-æ“å¤©å²¡è‰åŸ": {"id":"yF2LAyOvq0Q","label":"æ“å¤©å²¡è‰åŸ","source":"é™½æ˜å±±åœ‹å®¶å…¬åœ’"},
      "å°åŒ—-é™½æ˜æ›¸å±‹": {"id":"RttyIGHbN_w","label":"é™½æ˜æ›¸å±‹","source":"é™½æ˜å±±åœ‹å®¶å…¬åœ’"},
      "å°åŒ—-é çœºä¸ƒæ˜Ÿå±±": {"id":"PvJr2efA6n0","label":"é çœºä¸ƒæ˜Ÿå±±","source":"é™½æ˜å±±åœ‹å®¶å…¬åœ’"},
      "å°åŒ—-äºŒåªå­åœè»Šå ´": {"id":"d9KuXrPCWYU","label":"äºŒåªå­åœè»Šå ´","source":"é™½æ˜å±±åœ‹å®¶å…¬åœ’"},
      "å°åŒ—-å¤§å±¯è‡ªç„¶å…¬åœ’": {"id":"6ghffcNt3Nw","label":"å¤§å±¯è‡ªç„¶å…¬åœ’","source":"é™½æ˜å±±åœ‹å®¶å…¬åœ’"},
      "å°åŒ—-å°æ²¹å‘åœè»Šå ´": {"id":"kKD-ZBLs8-4","label":"å°æ²¹å‘åœè»Šå ´","source":"é™½æ˜å±±åœ‹å®¶å…¬åœ’"},
      "å°åŒ—-å†·æ°´å‘åœè»Šå ´": {"id":"GB64WeZZQPQ","label":"å†·æ°´å‘åœè»Šå ´","source":"é™½æ˜å±±åœ‹å®¶å…¬åœ’"},
      // æ–°åŒ—å¸‚
      "æ–°åŒ—-æ¼äººç¢¼é ­": {"id":"xwAWSh35uuw","label":"æ–°åŒ—æ·¡æ°´","source":"æ–°åŒ—æ—…å®¢ New Taipei Tour"},
      "æ–°åŒ—-é¼»é ­æœå‹™å€": {"id":"4Bm3IKcGkQY","label":"æ–°åŒ—é¼»é ­","source":"necoast nsa"},
      "æ–°åŒ—-ä¸­è§’ç£": {"id":"mmM9NOZLLKY","label":"ä¸­è§’ç£","source":"GoOceanæµ·æ´‹éŠæ†©é¢¨éšªè³‡è¨Š"},
      "æ–°åŒ—-ååˆ†ç€‘å¸ƒå…¬åœ’": {"id":"HirBQsQEUeA","label":"ååˆ†ç€‘å¸ƒå…¬åœ’","source":"æ–°åŒ—æ—…å®¢ New Taipei Tour"},
      "æ–°åŒ—-ä¹ä»½": {"id":"XSD5ptYisw8","label":"æ–°åŒ—ä¹ä»½","source":"æ–°åŒ—æ—…å®¢ New Taipei Tour"},
      "æ–°åŒ—-å…§æ´åœ‹å®¶æ£®æ—éŠæ¨‚å€": {"id":"lX2MYEFomK0","label":"å…§æ´åœ‹å®¶æ£®æ—éŠæ¨‚å€","source":"åœ‹å®¶æ£®æ—éŠæ¨‚å€å³æ™‚å½±åƒ"},
      "æ–°åŒ—-ä¸‰å³½è€è¡—åŒ—æ®µ": {"id":"M24SZJU-uoo","label":"ä¸‰å³½è€è¡—åŒ—æ®µ","source":"ä¸‰å³½æ°‘æ¬Šè€è¡—å•†åœˆ"},
      "æ–°åŒ—-ä¸‰å³½è€è¡—å—æ®µ": {"id":"R_5jhoux3nY","label":"ä¸‰å³½è€è¡—å—æ®µ","source":"ä¸‰å³½æ°‘æ¬Šè€è¡—å•†åœˆ"},
      "æ–°åŒ—-çƒä¾†åŠæ©‹": {"id":"jGoYvmTxLyU","label":"çƒä¾†åŠæ©‹","source":"æ°´åˆ©ç½²æ°´åˆ©é˜²ç½çµ„"},
      "æ–°åŒ—-å“¡å±±å­": {"id":"JkGKqXOt9Ls","label":"å“¡å±±å­","source":"æ°´åˆ©ç½²æ°´åˆ©é˜²ç½çµ„"},
      "æ–°åŒ—-æ–‡å±±è¾²å ´å¤§è‰çš®": {"id":"_LRkfObNP_U","label":"æ–‡å±±è¾²å ´å¤§è‰çš®","source":"æ–°åŒ—å¸‚è¾²æœƒæ–‡å±±è¾²å ´"},
      // åŸºéš†å¸‚
      "åŸºéš†-å¤–æœ¨å±±": {"id":"LInNQYAbAwQ","label":"å¤–æœ¨å±±","source":"GoOceanæµ·æ´‹éŠæ†©é¢¨éšªè³‡è¨Š"},
      // æ¡ƒåœ’å¸‚
      "æ¡ƒåœ’-åœ‹éš›æ©Ÿå ´": {"id":"91PfFoqvuUk","label":"æ¡ƒåœ’æ©Ÿå ´","source":"éŠæ¡ƒåœ’ Taoyuan Travel"},
      "æ¡ƒåœ’-æ¡ƒåœ’æ©Ÿå ´å—è·‘é“": {"id":"y3_x8el5ZJY","label":"TPE å—è·‘é“","source":"Taoyuan Airport"},
      "æ¡ƒåœ’-æ¡ƒåœ’æ©Ÿå ´åŒ—è·‘é“": {"id":"wWEnxWA7nnY","label":"TPE åŒ—è·‘é“","source":"Taoyuan Airport"},
      "æ¡ƒåœ’-æ°¸å®‰æ¼æ¸¯": {"id":"tD_a03trUvE","label":"æ°¸å®‰æ¼æ¸¯","source":"éŠæ¡ƒåœ’ Taoyuan Travel"},
      "æ¡ƒåœ’-æ‹‰æ‹‰å±±éŠå®¢ä¸­å¿ƒ": {"id":"YkIUZjVlhv4","label":"æ‹‰æ‹‰å±±éŠå®¢ä¸­å¿ƒ","source":"éŠæ¡ƒåœ’ Taoyuan Travel"},
      "æ¡ƒåœ’-è™é ­å±±ç’°ä¿å…¬åœ’": {"id":"tu_gsIkNt-w","label":"è™é ­å±±ç’°ä¿å…¬åœ’","source":"éŠæ¡ƒåœ’ Taoyuan Travel"},
      "æ¡ƒåœ’-å°çƒä¾†å¤©ç©ºæ­¥é“": {"id":"neaiCec1kec","label":"å°çƒä¾†å¤©ç©ºæ­¥é“","source":"éŠæ¡ƒåœ’ Taoyuan Travel"},
      "æ¡ƒåœ’-è§’æ¿å±±æ€è¦ªäº­": {"id":"3Za9y4z_Lzc","label":"è§’æ¿å±±æ€è¦ªäº­","source":"éŠæ¡ƒåœ’ Taoyuan Travel"},
      "æ¡ƒåœ’-ä¸‰é¾œæˆ²æ°´è§€æ™¯å¹³å°": {"id":"5YDXZ1aiR5Y","label":"ä¸‰é¾œæˆ²æ°´è§€æ™¯å¹³å°","source":"éŠæ¡ƒåœ’ Taoyuan Travel"},
      "æ¡ƒåœ’-å¤§æºªæ©‹": {"id":"oFJ6gCaBb_Q","label":"å¤§æºªæ©‹","source":"éŠæ¡ƒåœ’ Taoyuan Travel"},
      "æ¡ƒåœ’-è™é ­å±±å¥§çˆ¾æ£®æ—å­¸å ‚": {"id":"yQSmajHyMhU","label":"å¥§çˆ¾æ£®æ—å­¸å ‚","source":"éŠæ¡ƒåœ’ Taoyuan Travel"},
      "æ¡ƒåœ’-è§’æ¿å±±æ¢…åœ’": {"id":"-xT1bZhWLuU","label":"è§’æ¿å±±æ¢…åœ’","source":"éŠæ¡ƒåœ’ Taoyuan Travel"},
      "æ¡ƒåœ’-è§’æ¿å±±ç”Ÿæ…‹æ± ": {"id":"XEbo8NzMTbQ","label":"è§’æ¿å±±ç”Ÿæ…‹æ± ","source":"éŠæ¡ƒåœ’ Taoyuan Travel"},
      "æ¡ƒåœ’-å¤§æºªè€è¡—": {"id":"XUWjAsajKXg","label":"å¤§æºªè€è¡—","source":"éŠæ¡ƒåœ’ Taoyuan Travel"},
      "æ¡ƒåœ’-çŸ³é–€æ°´åº«": {"id":"GUCaVR88ZFU","label":"çŸ³é–€æ°´åº«","source":"éŠæ¡ƒåœ’ Taoyuan Travel"},
      "æ¡ƒåœ’-æ…ˆæ¹–æ°´å²¸å»£å ´": {"id":"pSQ0e-ZTZ5g","label":"æ…ˆæ¹–æ°´å²¸å»£å ´","source":"éŠæ¡ƒåœ’ Taoyuan Travel"},
      "æ¡ƒåœ’-é˜¿å§†åªè–‘æ¯å³¶": {"id":"EUOp2LchPQM","label":"è–‘æ¯å³¶","source":"éŠæ¡ƒåœ’ Taoyuan Travel"},
      "æ¡ƒåœ’-ä¸Šå·´é™µ": {"id":"nV-DKquUjFs","label":"ä¸Šå·´é™µ","source":"éŠæ¡ƒåœ’ Taoyuan Travel"},
      "æ¡ƒåœ’-æ¡ƒåœ’åœ‹éš›æ©Ÿå ´å‡±æ‚…é…’åº—": {"id":"68GFgzQxrXs","label":"æ©Ÿå ´å‡±æ‚…","source":"éŠæ¡ƒåœ’ Taoyuan Travel"},
      "æ¡ƒåœ’-å°çƒä¾†å¯°å®‡å¹³å°": {"id":"PJWye36lEj4","label":"å¯°å®‡å¹³å°","source":"éŠæ¡ƒåœ’ Taoyuan Travel"},
      "æ¡ƒåœ’-è¨±åæ¸¯æ¿•åœ°": {"id":"44JArbF682k","label":"è¨±åæ¸¯æ¿•åœ°","source":"éŠæ¡ƒåœ’ Taoyuan Travel"},
      // å®œè˜­ç¸£
      "å®œè˜­-å¤–æ¾³æ²™ç˜": {"id":"UgoT-QTbYvo","label":"å®œè˜­å¤–æ¾³","source":"necoast nsa"},
      "å®œè˜­-ç¦éš†æµ·æ°´æµ´å ´": {"id":"mMG7v_fET5A","label":"å®œè˜­ç¦éš†","source":"necoast nsa"}, 
      "å®œè˜­-èˆŠéš§é“å—å£": {"id":"X76Dkt_fPG0","label":"çŸ³åŸæ¼æ¸¯","source":"necoast nsa"}, 
      "å®œè˜­-ç„¡å°¾æ¸¯": {"id":"Bux0vT_5MBw","label":"ç„¡å°¾æ¸¯","source":"GoOceanæµ·æ´‹éŠæ†©é¢¨éšªè³‡è¨Š"}, 
      "å®œè˜­-çŸ³åŸæ¼æ¸¯": {"id":"ozZVLl0h--A","label":"çŸ³åŸæ¼æ¸¯1","source":"GoOceanæµ·æ´‹éŠæ†©é¢¨éšªè³‡è¨Š"}, 
      "å®œè˜­-ç¤æºªå¯’æ²é…’åº—": {"id":"cPh2vzrtG_w","label":"ç¤æºªå¯’æ²é…’åº—","source":"ç¤æºªå¯’æ²é…’åº—MU JIAO XI HOTEL"}, 
      // æ–°ç«¹å¸‚/ç¸£
      // è‹—æ —ç¸£
      "è‹—æ —-æ±¶æ°´éŠå®¢ä¸­å¿ƒ(é›ªéœ¸)": {"id":"VgmWVBUsfGo","label":"æ±¶æ°´éŠå®¢ä¸­å¿ƒ","source":"é›ªéœ¸åœ‹å®¶å…¬åœ’ Shei-Pa National Park"},
      "è‹—æ —-è§€éœ§éŠæ†©å€(é›ªéœ¸)": {"id":"Isp6RQiuxNo","label":"è§€éœ§éŠæ†©å€","source":"é›ªéœ¸åœ‹å®¶å…¬åœ’ Shei-Pa National Park"},
      "è‹—æ —-é›ªè¦‹éŠæ†©å€(é›ªéœ¸)": {"id":"2KDE860OW_A","label":"é›ªè¦‹éŠæ†©å€","source":"é›ªéœ¸åœ‹å®¶å…¬åœ’ Shei-Pa National Park"},
      // å°ä¸­å¸‚
      "å°ä¸­-é«˜ç¾æ¿•åœ°": {"id":"fjhg3gAnMFg","label":"å°ä¸­é«˜ç¾","source":"å¤§ç©å°ä¸­-è‡ºä¸­è§€å…‰æ—…éŠå±€"},
      "å°ä¸­-æœ›é«˜å¯®": {"id":"lhXXhDyjFtI","label":"æœ›é«˜å¯®","source":"å¤§ç©å°ä¸­-è‡ºä¸­è§€å…‰æ—…éŠå±€"},
      // å½°åŒ–ç¸£
      "å½°åŒ–-ç‹åŠŸæ¼æ¸¯": {"id":"hUG2XK08W5Q","label":"å½°åŒ–ç‹åŠŸ","source":"æ„›ç©å½°åŒ– Changhua Travels"},
      // å—æŠ•ç¸£
      "å—æŠ•-åˆæ­¡å±±æ­¦å¶ºäº­": {"id":"2lVMTs_Fj0M","label":"æ­¦å¶ºäº­","source":"å°ç£å³æ™‚å½±åƒç›£è¦–å™¨"},
      // é›²æ—ç¸£
      // å˜‰ç¾©å¸‚/ç¸£
      "å˜‰ç¾©-å¥®èµ·æ¹–": {"id":"B6eki-0-w0g","label":"å˜‰ç¾©å¥®èµ·æ¹–","source":"é˜¿é‡Œå±±åœ‹å®¶é¢¨æ™¯å€ç®¡ç†è™•"},
      "å˜‰ç¾©-äºŒå»¶å¹³æ­¥é“": {"id":"j2L_559nCjc","label":"äºŒå»¶å¹³æ­¥é“","source":"é˜¿é‡Œå±±åœ‹å®¶é¢¨æ™¯å€ç®¡ç†è™•"},
      "å˜‰ç¾©-å¤ªå¹³é›²æ¢¯": {"id":"dY2cRNr5Buw","label":"å¤ªå¹³é›²æ¢¯","source":"é˜¿é‡Œå±±åœ‹å®¶é¢¨æ™¯å€ç®¡ç†è™•"},
      "å˜‰ç¾©-è§¸å£éŠå®¢ä¸­å¿ƒ": {"id":"8KnqJBf_dow","label":"è§¸å£éŠå®¢ä¸­å¿ƒ","source":"é˜¿é‡Œå±±åœ‹å®¶é¢¨æ™¯å€ç®¡ç†è™•"},
      "å˜‰ç¾©-æ„›æƒ…å¤§è‰åŸ": {"id":"hMYs60qtkK8","label":"æ„›æƒ…å¤§è‰åŸ","source":"é˜¿é‡Œå±±åœ‹å®¶é¢¨æ™¯å€ç®¡ç†è™•"},
      "å˜‰ç¾©-ç”ŸåŠ›è¾²å ´": {"id":"agEzlv9n9Eg","label":"ç”ŸåŠ›è¾²å ´","source":"é˜¿é‡Œå±±åœ‹å®¶é¢¨æ™¯å€ç®¡ç†è™•"},
      "å˜‰ç¾©-é‡Œä½³è³‡è¨Šç«™": {"id":"zDt8FBPozZQ","label":"é‡Œä½³è³‡è¨Šç«™","source":"é˜¿é‡Œå±±åœ‹å®¶é¢¨æ™¯å€ç®¡ç†è™•"},
      // å°å—å¸‚
      "å°å—-ä¸ƒè‚¡è³é³¥å°": {"id":"5KJe2gCTngA","label":"å°å—ä¸ƒè‚¡","source":"å°æ±Ÿåœ‹å®¶å…¬åœ’ç®¡ç†è™•"},
      "å°å—-åŒ—æ±•å°¾æ°´é³¥ä¿è­·å€": {"id":"FES0gWTFUHQ","label":"åŒ—æ±•å°¾æ°´é³¥ä¿è­·å€","source":"å°æ±Ÿåœ‹å®¶å…¬åœ’ç®¡ç†è™•"},
      "å°å—-æ›¾æ–‡æ°´åº«": {"id":"EH4V8IwFIp4","label":"æ›¾æ–‡æ°´åº«","source":"è¥¿æ‹‰é›…åœ‹å®¶é¢¨æ™¯å€ç®¡ç†è™•"},
      "å°å—-ç«å±±ç¢§é›²å¯º": {"id":"zkX6X9p-6iA","label":"ç«å±±ç¢§é›²å¯º","source":"è¥¿æ‹‰é›…åœ‹å®¶é¢¨æ™¯å€ç®¡ç†è™•"},
      // é«˜é›„å¸‚
      "é«˜é›„-æ——æ´¥æµ·æ°´æµ´å ´": {"id":"ka7FV0sCvxQ","label":"é«˜é›„æ——æ´¥","source":"é«˜é›„æ—…éŠç¶²"},
      "é«˜é›„-å£½å±±è§€æ™¯å°": {"id":"C03Itx8iSC0","label":"å£½å±±è§€æ™¯","source":"é«˜é›„æ—…éŠç¶²"},
      // å±æ±ç¸£
      "å±æ±-å¢¾ä¸å—ç£": {"id":"jUnFuJSj0OU","label":"å¢¾ä¸å—ç£","source":"æˆ‘æ„›å¢¾ä¸æ—…éŠç¥¨åˆ¸ä¸­å¿ƒ"},
      "å±æ±-å°ç‰çƒç™½æ²™å°¾": {"id":"P0_6Yg4V21g","label":"å°ç‰çƒç™½æ²™å°¾","source":"GoOceanæµ·æ´‹éŠæ†©é¢¨éšªè³‡è¨Š"},
      "å±æ±-å°ç‰çƒå¨å°¼æ–¯": {"id":"U4K6t8Wd2rU","label":"å°ç‰çƒå¨å°¼æ–¯","source":"GoOceanæµ·æ´‹éŠæ†©é¢¨éšªè³‡è¨Š"},
      // èŠ±è“®ç¸£
      "èŠ±è“®-çŸ³æ¢¯åª": {"id":"mXnigLvIL0Q","label":"èŠ±è“®çŸ³æ¢¯åª","source":"æ±éƒ¨æµ·å²¸åœ‹å®¶é¢¨æ™¯å€ç®¡ç†è™•"},
      "èŠ±è“®-å¤§çŸ³é¼»å±±": {"id":"JkoXcXI04Qk","label":"å¤§çŸ³é¼»å±±","source":"æ±éƒ¨æµ·å²¸åœ‹å®¶é¢¨æ™¯å€ç®¡ç†è™•"},
      "èŠ±è“®-é•·è™¹æ©‹": {"id":"JnD8Rk3o0BM","label":"é•·è™¹æ©‹","source":"æ±éƒ¨æµ·å²¸åœ‹å®¶é¢¨æ™¯å€ç®¡ç†è™•"},
      // å°æ±ç¸£
      "å°æ±-é¯‰é­šå±±": {"id":"BUJJaW0vkJs","label":"å°æ±é¯‰é­šå±±","source":"Amazing Taitung å°æ±å°±é†¬ç©"},
      "å°æ±-é‡‘å´™å¤§æ©‹": {"id":"9QqBz3kNHis","label":"å°æ±é‡‘å´™å¤§æ©‹","source":"Amazing Taitung å°æ±å°±é†¬ç©"},
      "å°æ±-é‡‘æ¨½è§€æµª": {"id":"q3KJt-SZc2s","label":"å°æ±é‡‘æ¨½è§€æµª","source":"Amazing Taitung å°æ±å°±é†¬ç©"},
      "å°æ±-å¯Œå±±": {"id":"Rsq95SQ26bY","label":"å°æ±å¯Œå±±","source":"Amazing Taitung å°æ±å°±é†¬ç©"},
      "å°æ±-æ‰åŸç£": {"id":"VqS_Y8ZCj6M","label":"å°æ±æ‰åŸç£","source":"Amazing Taitung å°æ±å°±é†¬ç©"},
      "å°æ±-å¯Œå²¡æ¼æ¸¯": {"id":"D945F_dauls","label":"å°æ±å¯Œå²¡æ¼æ¸¯","source":"Amazing Taitung å°æ±å°±é†¬ç©"},
      "å°æ±-è¯æºæ›™å…‰è§€æ™¯å°": {"id":"TY4qQElcUrA","label":"å°æ±è¯æºæ›™å…‰è§€æ™¯å°","source":"Amazing Taitung å°æ±å°±é†¬ç©"},
      "å°æ±-å—æ©«åŸ¡å£": {"id":"LSkq-wHMxQY","label":"å°æ±å—æ©«å£","source":"Amazing Taitung å°æ±å°±é†¬ç©"},
      "å°æ±-æ± ä¸Šå¤©å ‚è·¯": {"id":"6kUEK3LVrro","label":"å°æ±æ± ä¸Šå¤©å ‚è·¯","source":"Amazing Taitung å°æ±å°±é†¬ç©"},
      "å°æ±-å¤šè‰¯è»Šç«™": {"id":"UCG1aXVO8H8","label":"å°æ±å¤šè‰¯","source":"Amazing Taitung å°æ±å°±é†¬ç©"},
      "å°æ±-é¹¿é‡é«˜å°": {"id":"rvc1klNIgQc","label":"é¹¿é‡é«˜å°","source":"ervnsa"},
      "å°æ±-æˆåŠŸä¸‰ä»™å°": {"id":"dQ7Sd6PGLdA","label":"ä¸‰ä»™å°","source":"æ±éƒ¨æµ·å²¸åœ‹å®¶é¢¨æ™¯å€ç®¡ç†è™•"},
      "å°æ±-é‡‘æ¨½éŠæ†©å€": {"id":"ZdqHgQwvZOw","label":"é‡‘æ¨½éŠæ†©å€","source":"æ±éƒ¨æµ·å²¸åœ‹å®¶é¢¨æ™¯å€ç®¡ç†è™•"},
      "å°æ±-éƒ½æ­·éŠå®¢ä¸­å¿ƒ": {"id":"JhQuR77AR7U","label":"éƒ½æ­·éŠå®¢ä¸­å¿ƒ","source":"æ±éƒ¨æµ·å²¸åœ‹å®¶é¢¨æ™¯å€ç®¡ç†è™•"},
      "å°æ±-åŠ è·¯è˜­éŠæ†©å€": {"id":"AKl3F6cAY2Q","label":"åŠ è·¯è˜­éŠæ†©å€","source":"æ±éƒ¨æµ·å²¸åœ‹å®¶é¢¨æ™¯å€ç®¡ç†è™•"},
      // é›¢å³¶
      "å°æ±-ç¶ å³¶å—å¯®": {"id":"wTHhv7M0vCI","label":"ç¶ å³¶å—å¯®","source":"æ±éƒ¨æµ·å²¸åœ‹å®¶é¢¨æ™¯å€ç®¡ç†è™•"},
      "å°æ±-ç¶ å³¶å¸†èˆ¹é¼»": {"id":"pLdBc8PvZko","label":"ç¶ å³¶å¸†èˆ¹é¼»","source":"æ±éƒ¨æµ·å²¸åœ‹å®¶é¢¨æ™¯å€ç®¡ç†è™•"},
      "å°æ±-ç¶ å³¶æŸ´å£æµ®æ½›å€": {"id":"a8nJQr5rBGs","label":"ç¶ å³¶æŸ´å£æµ®æ½›å€","source":"æ±éƒ¨æµ·å²¸åœ‹å®¶é¢¨æ™¯å€ç®¡ç†è™•"},
      "é‡‘é–€-éº’éºŸå±±æ£®æ—å…¬åœ’": {"id":"M4EJtf_iP8s","label":"é‡‘é–€éº’éºŸå±±å…¬åœ’","source":"æ¨‚éŠé‡‘é–€"},
      "é‡‘é–€-134é«˜åœ°": {"id":"-srNHTE-Nf0","label":"é‡‘é–€134é«˜åœ°","source":"æ¨‚éŠé‡‘é–€"},
      "é‡‘é–€-å»ºåŠŸå¶¼": {"id":"uh_yNAE01w8","label":"é‡‘é–€å»ºåŠŸå¶¼","source":"æ¨‚éŠé‡‘é–€"},
      "æ¾æ¹–-é–æ¸¯": {"id":"65Qk3X6fVbE","label":"æ¾æ¹–é–æ¸¯","source":"GoOceanæµ·æ´‹éŠæ†©é¢¨éšªè³‡è¨Š"}, 
      // ç¸½è¨ˆ 103 å€‹æ™¯é»
    };

    // ----------------------------------------------------------------------
    // JavaScript åŠŸèƒ½ 
    // ----------------------------------------------------------------------

    const PLAYER_IDS = ['player0', 'player1', 'player2', 'player3'];
    const LABEL_IDS = ['label0', 'label1', 'label2', 'label3'];
    const DEFAULT_VIDEO_ID = "215ahZ_0rTg"; // é è¨­ç¬¬ä¸€å€‹ç•«é¢è¼‰å…¥è²“ç©ºæŒ‡å—å®®

    let selectedCamIndex = 0; 
    let players = [];
    let streamState = Array(4).fill(null); 
    let isMuted = true; 
    
    // éŸ³æ¨‚æ’­æ”¾å™¨ç›¸é—œ... 
    let musicPlayer = null;
    let musicQueue = [];
    let currentMusicIndex = -1;
    let playbackMode = 'listLoop'; 
    let isPlaying = false;
    let isMusicReady = false;

    // å°‡ streams ä¾åŸå¸‚åˆ†çµ„ (ç”¨æ–¼ä»‹é¢é¡¯ç¤º)
    const GROUPED_STREAMS = {};
    Object.keys(ALL_STREAMS).forEach(key => {
        const city = key.split('-')[0];
        if (!GROUPED_STREAMS[city]) {
            GROUPED_STREAMS[city] = [];
        }
        GROUPED_STREAMS[city].push({ key: key, ...ALL_STREAMS[key] });
    });

    // å®šç¾©åœ°å€åˆ†çµ„åç¨±å’ŒåŸå¸‚ (æ¾æ¹–åœ¨å—éƒ¨)
    const REGION_GROUPS = {
      'åŒ—éƒ¨': ['å°åŒ—', 'æ–°åŒ—', 'åŸºéš†', 'æ¡ƒåœ’', 'å®œè˜­', 'æ–°ç«¹'],
      'ä¸­éƒ¨': ['è‹—æ —', 'å°ä¸­', 'å½°åŒ–', 'å—æŠ•', 'é›²æ—'],
      'å—éƒ¨': ['å˜‰ç¾©', 'å°å—', 'é«˜é›„', 'å±æ±', 'æ¾æ¹–'], 
      'æ±éƒ¨': ['èŠ±è“®', 'å°æ±'],
      'é›¢å³¶': ['é‡‘é–€', 'é¦¬ç¥–'] 
    };
    
    // åŸå¸‚åˆ¥åæ˜ å°„
    const CITY_ALIAS_TO_BASE = {
      'æ–°ç«¹å¸‚': 'æ–°ç«¹', 'æ–°ç«¹ç¸£': 'æ–°ç«¹',
      'å˜‰ç¾©å¸‚': 'å˜‰ç¾©', 'å˜‰ç¾©ç¸£': 'å˜‰ç¾©'
    };

    // 1. YouTube IFrame API è¼‰å…¥å®Œæˆæ™‚èª¿ç”¨
    function onYouTubeIframeAPIReady() {
        // åˆå§‹åŒ–å››å€‹å½±åƒæ’­æ”¾å™¨
        PLAYER_IDS.forEach((id, index) => {
            const defaultStreams = [
                "å°åŒ—-è²“ç©ºæŒ‡å—å®®", 
                "æ¡ƒåœ’-åœ‹éš›æ©Ÿå ´", 
                "å°ä¸­-é«˜ç¾æ¿•åœ°", 
                "é«˜é›„-å£½å±±è§€æ™¯å°"
            ];
            const defaultKey = defaultStreams[index];
            const initialVideoId = (defaultKey && ALL_STREAMS[defaultKey]) ? ALL_STREAMS[defaultKey].id : DEFAULT_VIDEO_ID;

            players[index] = new YT.Player(id, {
                videoId: initialVideoId, 
                playerVars: {
                    'autoplay': 1, 
                    'controls': 0,
                    'modestbranding': 1,
                    'rel': 0, // æ“‹æ‰å½±ç‰‡çµæŸæ¨è–¦ (æ ¹æ“šç”¨æˆ¶å›é¥‹)
                    'showinfo': 0,
                    'fs': 0,
                    'disablekb': 1,
                    'loop': 1, 
                    'mute': 1 
                },
                events: {
                    'onReady': onPlayerReady,
                    'onStateChange': onLiveStreamStateChange // æ–°å¢ç‹€æ…‹ç›£è½
                }
            });
            
            // åˆå§‹åŒ–å››å€‹ç•«é¢çš„ç‹€æ…‹
            if (defaultKey && ALL_STREAMS[defaultKey]) {
                streamState[index] = { key: defaultKey, ...ALL_STREAMS[defaultKey] };
                updateLabel(index);
            }
        });

        // åˆå§‹åŒ–éŸ³æ¨‚æ’­æ”¾å™¨ (éœéŸ³ä¸¦éš±è—)
        musicPlayer = new YT.Player('player_music', {
            videoId: '', 
            playerVars: {
                'autoplay': 0,
                'controls': 0,
                'modestbranding': 1,
                'rel': 0,
                'showinfo': 0,
                'fs': 0,
                'disablekb': 1,
                'loop': 0,
                'mute': 0 
            },
            events: {
                'onReady': onMusicPlayerReady,
                'onStateChange': onMusicPlayerStateChange
            }
        });

        // é¦–æ¬¡è¼‰å…¥æ™‚é¡¯ç¤ºåœ°å€æŒ‰éˆ•
        renderRegionButtons();
    }

    function onPlayerReady(event) {
        // ç¢ºä¿å½±ç‰‡è¼‰å…¥å¾Œè‡ªå‹•å¾ªç’°æ’­æ”¾
        event.target.setLoop(true);
    }
    
    // è™•ç†å½±ç‰‡çµæŸæ¨è–¦å•é¡Œ (å³ä½¿ rel=0ï¼Œä¹Ÿç”¨ç¨‹å¼ç¢¼ç¢ºä¿ç›´æ’­ä¸æœƒåœæ­¢åœ¨æ¨è–¦ç•«é¢)
    function onLiveStreamStateChange(event) {
        if (event.data === YT.PlayerState.ENDED) {
            const playerIndex = players.indexOf(event.target);
            const currentState = streamState[playerIndex];
            
            if (currentState) {
                // å½±ç‰‡çµæŸæ™‚ï¼Œé‡æ–°è¼‰å…¥ä¸¦æ’­æ”¾åŒä¸€æ”¯å½±ç‰‡ï¼Œé¿å…æ¨è–¦ç•«é¢
                event.target.loadVideoById(currentState.id, 0);
            }
        }
    }

    // æ›´æ–°ç•«é¢æ¨™ç±¤çš„è¼”åŠ©å‡½æ•¸
    function updateLabel(index) {
        const state = streamState[index];
        const labelElement = document.getElementById(`label${index}`);
        if (state) {
            labelElement.innerHTML = `${state.label}<span class="source-on-screen">ä¾†æº: ${state.source}</span>`;
        } else {
            labelElement.innerHTML = `è¼‰å…¥ä¸­...<span class="source-on-screen"></span>`;
        }
    }
    
    function onMusicPlayerReady(event) {
        isMusicReady = true;
        // å¦‚æœè¼‰å…¥æ™‚å·²ç¶“æœ‰ä½‡åˆ—ï¼Œè‡ªå‹•é–‹å§‹æ’­æ”¾
        if (musicQueue.length > 0 && currentMusicIndex === -1) {
            currentMusicIndex = 0;
            loadAndPlayCurrentSong();
        }
    }
    
    // 2. é¸æ“‡æ”å½±æ©Ÿç•«é¢
    function selectCam(index) {
        selectedCamIndex = index;
        document.querySelectorAll('.controls button').forEach((btn, i) => {
            if (i >= 0 && i <= 3) {
                btn.classList.toggle('active', i === index);
            }
        });
    }

    // 3. è¨­å®šä¸²æµåˆ°é¸å®šçš„ç•«é¢
    function setStream(streamKey) {
        const stream = ALL_STREAMS[streamKey];
        if (!stream) return;

        const player = players[selectedCamIndex];
        
        // å„²å­˜ç‹€æ…‹
        streamState[selectedCamIndex] = { key: streamKey, ...stream };

        // 1. è¼‰å…¥ä¸¦æ’­æ”¾å½±ç‰‡ (é è¨­éœéŸ³)
        player.loadVideoById(stream.id);
        player.mute(); 
        
        // 2. æ›´æ–°æ¨™ç±¤
        updateLabel(selectedCamIndex);
        
        // 3. å¦‚æœå–æ¶ˆéœéŸ³æŒ‰éˆ•æ˜¯ã€Œå–æ¶ˆéœéŸ³ã€ï¼ˆisMuted=falseï¼‰ï¼Œå‰‡è§£é™¤éœéŸ³
        if (!isMuted) {
             player.unMute();
        }
    }

    // 4. åˆ‡æ›å…¨è¢å¹•
    function toggleFullscreen() {
        const wrap = document.getElementById('stageWrap');
        if (!document.fullscreenElement) {
            wrap.requestFullscreen().catch(err => {
                alert(`Error attempting to enable full-screen mode: ${err.message} (${err.name})`);
            });
            document.body.classList.add('fullscreen-active');
        } else {
            document.exitFullscreen();
        }
        document.addEventListener('fullscreenchange', () => {
            if (!document.fullscreenElement) {
                document.body.classList.remove('fullscreen-active');
            }
        }, { once: true });
    }

    // 5. åˆ‡æ›æ¨™ç±¤é¡¯ç¤º
    function toggleLabels() {
        const isHidden = document.body.classList.toggle('hide-labels');
        document.getElementById('labelsToggleBtn').innerText = isHidden ? 'é¡¯ç¤ºæ¨™ç±¤' : 'æ¨™ç±¤éš±è—';
    }

    // 6. å…¨å±€éœéŸ³æ§åˆ¶
    function toggleMute() {
        isMuted = !isMuted;
        document.getElementById('muteBtn').innerText = isMuted ? 'è§£é™¤éœéŸ³' : 'å–æ¶ˆéœéŸ³';
        
        players.forEach(player => {
            if (player && player.unMute && player.mute) {
                isMuted ? player.mute() : player.unMute();
            }
        });
    }

    // 7. æ¸²æŸ“ç¸£å¸‚/åœ°å€æŒ‰éˆ• 
    function renderRegionButtons() {
      const c = document.getElementById('regionButtons'); 
      c.innerHTML = '';
      let hasContent = false;

      for (const region in REGION_GROUPS) {
        let regionHasCities = false;
        
        // æª¢æŸ¥è©²åœ°å€æ˜¯å¦æœ‰ä»»ä½•åŸå¸‚åŒ…å«åœ¨ ALL_STREAMS ä¸­
        REGION_GROUPS[region].forEach(city => {
             const baseCity = CITY_ALIAS_TO_BASE[city] || city;
             if (GROUPED_STREAMS[baseCity] && GROUPED_STREAMS[baseCity].length > 0) {
                 regionHasCities = true;
             }
        });

        if (regionHasCities) {
            hasContent = true;
            
            // é¡¯ç¤ºåœ°å€æ¨™ç±¤
            const regionLabel = document.createElement('span');
            regionLabel.className = 'region-label';
            regionLabel.textContent = region + 'ï¼š';
            c.appendChild(regionLabel);
            
            REGION_GROUPS[region].forEach(displayCity => {
                const baseCity = CITY_ALIAS_TO_BASE[displayCity] || displayCity;
                if (GROUPED_STREAMS[baseCity] && GROUPED_STREAMS[baseCity].length > 0) {
                    const btn = document.createElement('button');
                    btn.className = 'city-btn';
                    btn.innerText = displayCity;
                    btn.setAttribute('onclick', `renderLocationButtons('${displayCity}')`);
                    c.appendChild(btn);
                }
            });
        }
      }
      
      if (!hasContent) {
          const empty = document.createElement('span');
          empty.innerText = 'ï¼ˆæ²’æœ‰æ™¯é»è³‡è¨Šï¼‰';
          empty.style.color = '#bbb'; 
          c.appendChild(empty);
      }
      c.scrollLeft = 0;
    }

    // 8. æ¸²æŸ“æ™¯é»æŒ‰éˆ• (ç‰¹å®šåŸå¸‚)
    function renderLocationButtons(displayCity) {
      const baseCity = CITY_ALIAS_TO_BASE[displayCity] || displayCity;
      const c = document.getElementById('regionButtons'); 
      c.innerHTML = '';
      
      const back = document.createElement('button');
      back.innerText = 'â† è¿”å›'; 
      back.className = 'city-btn'; 
      back.setAttribute('onclick', 'renderRegionButtons()'); 
      c.appendChild(back);

      const list = GROUPED_STREAMS[baseCity] || [];
      if (list.length === 0) {
        const empty = document.createElement('span');
        empty.innerText = 'ï¼ˆç›®å‰æ²’æœ‰æ™¯é»ï¼‰';
        empty.style.color = '#bbb'; 
        empty.style.marginLeft = '10px';
        c.appendChild(empty);
      } else {
        list.forEach(stream => {
          const b = document.createElement('button'); 
          b.className = 'city-btn';
          b.innerText = stream.label; 
          b.setAttribute('onclick', `setStream('${stream.key}')`);
          c.appendChild(b);
        });
      }
      c.scrollLeft = 0;
    }

    // 9. éŸ³æ¨‚æ’­æ”¾æ§åˆ¶
    
    function requestSong() {
        const input = prompt("è«‹è¼¸å…¥YouTubeå½±ç‰‡ç¶²å€æˆ–IDï¼Œæˆ–æ˜¯ä¸€å€‹æ’­æ”¾æ¸…å–®ç¶²å€/IDï¼š");
        if (!input) return;

        const isPlaylist = input.includes('list=') || input.startsWith('PL');
        const videoIdMatch = input.match(/(?:youtu\.be\/|v=|vi=|watch\?v=|\/embed\/)([^#&?]*)/);
        const playlistIdMatch = input.match(/[?&]list=([^#&?]*)/);
        
        let id = '';

        if (isPlaylist) {
             id = playlistIdMatch ? playlistIdMatch[1] : input.startsWith('PL') ? input : null;
             if (id) {
                 clearMusicQueue();
                 musicPlayer.loadPlaylist({
                    list: id,
                    listType: 'playlist',
                    index: 0,
                    suggestedQuality: 'small'
                 });
                 document.getElementById('musicControlsContainer').style.display = 'flex';
                 isPlaying = true;
                 currentMusicIndex = 0; 
                 alert("å·²è¼‰å…¥æ’­æ”¾æ¸…å–®ä¸¦é–‹å§‹æ’­æ”¾ã€‚è«‹é»æ“Š 'ğŸµ åˆ—è¡¨ç‹€æ…‹' æŸ¥çœ‹è©³æƒ…ã€‚");
                 return;
             }
        } else {
            id = videoIdMatch ? videoIdMatch[1] : input.length === 11 ? input : null;
        }

        if (id) {
            // å˜—è©¦å¾ YouTube ç²å–æ¨™é¡Œï¼Œä½†é€™è£¡ç°¡åŒ–è™•ç†ï¼Œå…ˆåŠ å…¥ä½‡åˆ—
            musicQueue.push({ id: id, title: 'è¼‰å…¥ä¸­...', source: 'é»æ’­' });

            if (musicQueue.length === 1 || !isPlaying) {
                currentMusicIndex = musicQueue.length - 1; // æ’­æ”¾å‰›åŠ å…¥çš„æ­Œæ›²
                loadAndPlayCurrentSong();
            }
            
            document.getElementById('musicControlsContainer').style.display = 'flex';
            alert(musicQueue.length > 1 ? "å·²åŠ å…¥æ’­æ”¾ä½‡åˆ—ã€‚" : "å·²è¼‰å…¥æ­Œæ›²ä¸¦é–‹å§‹æ’­æ”¾ã€‚");
        } else {
            alert("ç„¡æ•ˆçš„ YouTube ç¶²å€æˆ– IDã€‚");
        }
    }

    function loadAndPlayCurrentSong() {
        if (currentMusicIndex >= 0 && currentMusicIndex < musicQueue.length) {
            const song = musicQueue[currentMusicIndex];
            // ä½¿ç”¨ loadVideoById ç¢ºä¿é‡æ–°è¼‰å…¥
            musicPlayer.loadVideoById(song.id, 0); 
            isPlaying = true;
            document.getElementById('playPauseBtn').innerText = 'â¸ï¸';
        } else {
            // ä½‡åˆ—çµæŸæˆ–ç´¢å¼•ç„¡æ•ˆ
            isPlaying = false;
            document.getElementById('playPauseBtn').innerText = 'â–¶ï¸';
            currentMusicIndex = -1;
            // å¦‚æœåˆ—è¡¨æ¸…ç©ºï¼Œéš±è—æ§åˆ¶é …
            if (musicQueue.length === 0) {
                 document.getElementById('musicControlsContainer').style.display = 'none';
            }
        }
    }
    
    function playPauseSong() {
        const state = musicPlayer.getPlayerState();
        if (state === YT.PlayerState.PLAYING) {
            musicPlayer.pauseVideo();
            isPlaying = false;
            document.getElementById('playPauseBtn').innerText = 'â–¶ï¸';
        } else if (state === YT.PlayerState.PAUSED || state === YT.PlayerState.ENDED) {
            musicPlayer.playVideo();
            isPlaying = true;
            document.getElementById('playPauseBtn').innerText = 'â¸ï¸';
        } else if (state === YT.PlayerState.UNSTARTED || state === YT.PlayerState.CUED) {
             if (musicQueue.length > 0 && currentMusicIndex !== -1) {
                musicPlayer.playVideo();
                isPlaying = true;
                document.getElementById('playPauseBtn').innerText = 'â¸ï¸';
             }
        }
    }
    
    // ä¿®æ­£ï¼šä¸Šä¸€é¦–
    function skipToPreviousSong() {
        if (!musicPlayer || musicQueue.length === 0) return;
        
        musicPlayer.stopVideo(); 
        
        let newIndex = currentMusicIndex - 1;
        if (newIndex < 0) {
            // å¾ªç’°åˆ°åˆ—è¡¨å°¾éƒ¨
            newIndex = musicQueue.length - 1; 
        }
        currentMusicIndex = newIndex;
        loadAndPlayCurrentSong();
    }

    // ä¿®æ­£ï¼šä¸‹ä¸€é¦–
    function skipToNextSong() {
        if (!musicPlayer || musicQueue.length === 0) return;
        
        musicPlayer.stopVideo(); 
        
        let newIndex = currentMusicIndex;

        if (playbackMode === 'shuffle') {
            // éš¨æ©Ÿæ¨¡å¼ï¼Œç¢ºä¿é¸æ“‡çš„ä¸æ˜¯ç•¶å‰æ­Œæ›²ï¼ˆé™¤éåªæœ‰ä¸€é¦–ï¼‰
            if (musicQueue.length > 1) {
                let tempIndex;
                do {
                    tempIndex = Math.floor(Math.random() * musicQueue.length);
                } while (tempIndex === currentMusicIndex);
                newIndex = tempIndex;
            } else {
                // åªæœ‰ä¸€é¦–ï¼ŒåŸåœ°æ’­æ”¾
                newIndex = 0;
            }
        } else {
            // åˆ—è¡¨å¾ªç’°
            newIndex = (currentMusicIndex + 1) % musicQueue.length;
        }

        currentMusicIndex = newIndex;
        loadAndPlayCurrentSong();
    }
    
    function onMusicPlayerStateChange(event) {
        const state = event.data;

        if (musicPlayer.getPlaylistId() && state === YT.PlayerState.CUED) {
             musicPlayer.playVideo();
             isPlaying = true;
             document.getElementById('playPauseBtn').innerText = 'â¸ï¸';
        }
        
        if (state === YT.PlayerState.PLAYING) {
            isPlaying = true;
            document.getElementById('playPauseBtn').innerText = 'â¸ï¸';
            // åœ¨æ­¤æ›´æ–°æ­Œæ›²æ¨™é¡Œ
            try {
                const videoData = musicPlayer.getVideoData();
                // å¦‚æœæ˜¯å–®æ›²ä½‡åˆ—æ¨¡å¼ï¼Œæ›´æ–°æ¨™é¡Œ
                if (!musicPlayer.getPlaylistId() && currentMusicIndex !== -1) {
                    musicQueue[currentMusicIndex].title = videoData.title; 
                }
            } catch (e) {
                // ç„¡æ³•å–å¾—æ¨™é¡Œ
            }
        } else if (state === YT.PlayerState.PAUSED) {
            isPlaying = false;
            document.getElementById('playPauseBtn').innerText = 'â–¶ï¸';
        } else if (state === YT.PlayerState.ENDED) {
            isPlaying = false;
            document.getElementById('playPauseBtn').innerText = 'â–¶ï¸';

            // è™•ç† YouTube æ’­æ”¾æ¸…å–®çš„è‡ªå‹•è¡Œç‚º (YouTube æœƒè‡ªå·±è·³ä¸‹ä¸€é¦–)
            if (musicPlayer.getPlaylistId()) {
                return;
            }

            // è™•ç†å–®æ›²ä½‡åˆ—æ¨¡å¼ (éæ’­æ”¾æ¸…å–®)
            if (musicQueue.length > 0) {
                if (playbackMode === 'repeatOne') {
                    // å–®æ›²å¾ªç’°ï¼šé‡æ–°è¼‰å…¥ç•¶å‰æ­Œæ›²
                    loadAndPlayCurrentSong();
                } else {
                    // åˆ—è¡¨å¾ªç’°æˆ–éš¨æ©Ÿæ’­æ”¾ï¼šè·³åˆ°ä¸‹ä¸€é¦–
                    skipToNextSong();
                }
            } else {
                // ä½‡åˆ—æ¸…ç©ºï¼Œåœæ­¢æ’­æ”¾
                clearMusicQueue();
            }
        }
    }
    
    // éŸ³æ¨‚æ¨¡å¼è¨­å®šå½ˆå‡ºçª—åŠŸèƒ½
    function openMusicSettingsModal() {
        document.getElementById('musicSettingsModal').style.display = 'flex';
        // Highlight current mode button (optional but good UX)
        document.querySelectorAll('#musicSettingsModal button').forEach(btn => {
            if (btn.innerText.includes(playbackMode === 'listLoop' ? 'åˆ—è¡¨å¾ªç’°' : playbackMode === 'shuffle' ? 'éš¨æ©Ÿæ’­æ”¾' : 'å–®æ›²å¾ªç’°')) {
                btn.style.backgroundColor = '#0078d7';
            } else {
                btn.style.backgroundColor = '#333';
            }
        });
    }

    function closeMusicSettingsModal() {
        document.getElementById('musicSettingsModal').style.display = 'none';
    }

    function setPlaybackMode(mode) {
        playbackMode = mode;
        closeMusicSettingsModal();
        alert(`æ’­æ”¾æ¨¡å¼å·²è¨­å®šç‚º: ${mode === 'listLoop' ? 'åˆ—è¡¨å¾ªç’° ğŸ”„' : mode === 'shuffle' ? 'éš¨æ©Ÿæ’­æ”¾ ğŸ”€' : 'å–®æ›²å¾ªç’° ğŸ”'}`);
        openMusicSettingsModal(); // Re-open to show updated highlight temporarily
        setTimeout(closeMusicSettingsModal, 1500); // Close after showing update
    }

    function stopAndCloseModal() {
        if (musicPlayer) {
             // æ¸…é™¤æ‰€æœ‰æ’­æ”¾ç‹€æ…‹ï¼ŒåŒ…æ‹¬ YouTube æ’­æ”¾æ¸…å–®ç‹€æ…‹
            musicPlayer.stopVideo(); 
            musicPlayer.cueVideoById(""); // ç¢ºä¿æ¸…ç©ºæ’­æ”¾å™¨å…§å®¹
        }
        clearMusicQueue();
        isPlaying = false;
        currentMusicIndex = -1;
        document.getElementById('musicControlsContainer').style.display = 'none';
        closeMusicSettingsModal();
        alert("éŸ³æ¨‚æ’­æ”¾å·²åœæ­¢ä¸¦æ¸…é™¤ä½‡åˆ—ã€‚");
    }
    
    function clearMusicQueue() {
        musicQueue = [];
        currentMusicIndex = -1;
        document.getElementById('playPauseBtn').innerText = 'â–¶ï¸';
    }

    function showMusicQueueStatusModal() {
        const modal = document.getElementById('musicQueueModal');
        const content = document.getElementById('queueListContent');
        let html = '';

        if (musicPlayer.getPlaylistId()) {
            const playlistId = musicPlayer.getPlaylistId();
            html = `<p style="color:#ddd; font-size:13px; margin-top:0;">ç•¶å‰æ’­æ”¾æ¨¡å¼: ${playbackMode === 'listLoop' ? 'åˆ—è¡¨å¾ªç’° ğŸ”„' : playbackMode === 'shuffle' ? 'éš¨æ©Ÿæ’­æ”¾ ğŸ”€' : 'å–®æ›²å¾ªç’° ğŸ”'}</p>
                    <p style="color:#fff; font-weight:bold;">âœ… æ­£åœ¨æ’­æ”¾ YouTube æ’­æ”¾æ¸…å–®</p>
                    <p style="font-size:12px; color:#aaa; overflow-wrap: break-word;">ID: ${playlistId}</p>
                    <p style="font-size:12px; color:#aaa;">(æ’­æ”¾æ¸…å–®æ­Œæ›²æ•¸é‡ç„¡æ³•ç›´æ¥ç²å–ï¼Œè«‹ä½¿ç”¨ Prev/Next æŒ‰éˆ•è·³è½‰)</p>`;
        } else if (musicQueue.length === 0) {
            html = '<p style="text-align:center; color:#888;">æ’­æ”¾åˆ—è¡¨ç›®å‰ç‚ºç©ºã€‚</p>';
        } else {
            html += `<p style="color:#ddd; font-size:13px; margin-top:0;">ç•¶å‰æ’­æ”¾æ¨¡å¼: ${playbackMode === 'listLoop' ? 'åˆ—è¡¨å¾ªç’° ğŸ”„' : playbackMode === 'shuffle' ? 'éš¨æ©Ÿæ’­æ”¾ ğŸ”€' : 'å–®æ›²å¾ªç’° ğŸ”'}</p>`;
            html += `<p style="color:#fff; margin-bottom:10px;">ç¸½è¨ˆ ${musicQueue.length} é¦–æ­Œæ›²:</p>`;
            html += `<div style="max-height: 200px; overflow-y: auto; background:#111; padding:8px; border-radius:5px;">`;
            musicQueue.forEach((song, index) => {
                const isCurrent = index === currentMusicIndex;
                const style = isCurrent ? 'background-color:#0078d7; font-weight:bold;' : 'color:#ccc;';
                html += `<div style="padding:4px 0; font-size:12px; border-bottom:1px solid #333; ${style}">`;
                html += `${isCurrent ? 'â–¶ï¸ ' : (index + 1) + '. '} ${song.title} (${song.id})`;
                html += `</div>`;
            });
            html += `</div>`;
        }

        content.innerHTML = html;
        modal.style.display = 'flex';
    }

    function closeMusicQueueModal() {
        document.getElementById('musicQueueModal').style.display = 'none';
    }
    
    // ======================================================================
    // 10. æ–°å¢åŠŸèƒ½ï¼šèƒŒæ™¯æ’­æ”¾è™•ç† (è™•ç†æœ€å°åŒ–æˆ–åˆ‡æ›åˆ†é å¾Œåœæ­¢çš„å•é¡Œ)
    // ======================================================================

    function handleVisibilityChange() {
        if (document.visibilityState === 'visible') {
            console.log("Tab is visible. Checking players state...");
            
            // æª¢æŸ¥å››å€‹ç›´æ’­ç•«é¢
            players.forEach((player, index) => {
                if (streamState[index]) {
                    try {
                        const state = player.getPlayerState();
                        // å¦‚æœæ’­æ”¾å™¨å› ç‚ºåˆ‡æ›åˆ†é è€Œè¢«æš«åœæˆ–åœæ­¢ï¼Œå¼·åˆ¶å®ƒé‡æ–°æ’­æ”¾
                        if (state === YT.PlayerState.PAUSED || state === YT.PlayerState.UNSTARTED || state === YT.PlayerState.ENDED) {
                            console.log(`Live stream ${index} was stopped. Attempting to resume...`);
                            
                            // å°ç›´æ’­ä¾†èªªï¼Œæœ€å¥½çš„æ¢å¾©æ–¹å¼æ˜¯é‡æ–°è¼‰å…¥ä¸¦æ’­æ”¾ (å¦‚æœæ˜¯ ENDED) æˆ–ç›´æ¥æ’­æ”¾
                            if (state === YT.PlayerState.ENDED) {
                                // é‡æ–°è¼‰å…¥ï¼Œå¾é ­é–‹å§‹æ’­
                                player.loadVideoById(streamState[index].id, 0); 
                            } else {
                                player.playVideo();
                            }
                        }
                    } catch (e) {
                         // é¿å…åœ¨æ’­æ”¾å™¨å°šæœªå®Œå…¨åˆå§‹åŒ–æ™‚å ±éŒ¯
                        console.error("Error checking live player state:", e);
                    }
                }
            });
            
            // æª¢æŸ¥éŸ³æ¨‚æ’­æ”¾å™¨
            if (musicPlayer && isPlaying) {
                 try {
                     const musicState = musicPlayer.getPlayerState();
                     // å¦‚æœéŸ³æ¨‚å› ç‚ºåˆ‡æ›åˆ†é è€Œè¢«æš«åœï¼Œä¸”æˆ‘å€‘æ‡‰ç”¨ç¨‹å¼ç‹€æ…‹é¡¯ç¤ºå®ƒæ‡‰è©²åœ¨æ’­æ”¾ï¼Œå‰‡å¼·åˆ¶æ¢å¾©
                     if (musicState === YT.PlayerState.PAUSED || musicState === YT.PlayerState.UNSTARTED || musicState === YT.PlayerState.ENDED) {
                        console.log("Music player was paused. Attempting to resume...");
                        musicPlayer.playVideo();
                     }
                 } catch (e) {
                      console.error("Error checking music player state:", e);
                 }
            }

        } else if (document.visibilityState === 'hidden') {
            console.log("Tab is hidden. Player playback might be throttled.");
            // ç•¶åˆ†é éš±è—æ™‚ï¼Œæˆ‘å€‘ä¸èƒ½ä¸»å‹•é˜»æ­¢ç€è¦½å™¨æš«åœå½±ç‰‡ï¼Œåªèƒ½åœ¨æ¢å¾©æ™‚å˜—è©¦æ¢å¾©
        }
    }
    
    // ç›£è½ visibility change äº‹ä»¶ï¼Œä»¥æ‡‰å°æœ€å°åŒ–æˆ–åˆ‡æ›åˆ†é çš„éœ€æ±‚
    document.addEventListener("visibilitychange", handleVisibilityChange);

    // é¦–æ¬¡è¼‰å…¥æ™‚åŸ·è¡Œ (ä¿æŒåŸæœ‰é‚è¼¯)
    document.addEventListener('DOMContentLoaded', () => {
        // ... (åŸæœ‰çš„åˆå§‹åŒ–ç¨‹å¼ç¢¼)
    });
    
  </script>
</body>
</html>
