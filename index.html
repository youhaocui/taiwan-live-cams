<!DOCTYPE html>
<html lang="zh-TW" id="htmlLang">
<head>
  <meta charset="utf-8" />
  <title id="pageTitle">å°ç£å³æ™‚ç›´æ’­å¤šåˆ†å‰²ç›£çœ‹</title>
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <style>
    /* ---------------------------------------------------------------------- */
    /* CSS æ¨£å¼ */
    /* ---------------------------------------------------------------------- */
    html,body{
      height:100%;
      margin:0; padding:0; background:#000;
      font-family: system-ui, sans-serif; color:#fff; overflow:hidden;
    }

    /* åº•éƒ¨æ§åˆ¶åˆ— */
    .controls{
      position:fixed;
      bottom:0; left:0; width:100%; height:78px;
      background:rgba(12,12,12,0.95); color:#fff; padding:8px 12px;
      box-sizing:border-box; display:flex; flex-direction:row; align-items:center;
      gap:10px; z-index:3000;
    }
    
    /* ä¿®æ­£ï¼šæ§åˆ¶æŒ‰éˆ•å®¹å™¨ - ç¢ºä¿ 3x3 æŒ‰éˆ•å…¨éƒ¨å¯è¦‹ä¸”åœ¨æœ€ä¸Šå±¤ */
    #camSelectButtons {
      display: flex;
      flex-wrap: nowrap; /* ç¦æ­¢æ›è¡Œ */
      overflow-x: auto; /* å…§å®¹éé•·æ™‚æ»¾å‹• */
      gap: 5px;
      padding-bottom: 5px; /* é¿å…æ»¾å‹•æ¢é®æ“‹ */
      z-index: 3001; /* ç¢ºä¿åœ¨æœ€ä¸Šå±¤ */
      flex-shrink: 0;
      scrollbar-width: none; /* Firefox */
    }
    #camSelectButtons::-webkit-scrollbar {
      display: none; /* Chrome, Safari, Opera */
    }

    .controls button{
      background:rgba(255,255,255,0.1); color:#fff;
      border:1px solid #444; border-radius:4px;
      padding:6px 12px; font-size:14px;
      cursor:pointer; transition:background 0.2s, border-color 0.2s;
      flex-shrink: 0;
    }
    .controls button:hover{
      background:rgba(255,255,255,0.2);
      border-color:#888;
    }
    .controls button.active{
      background:#007aff; border-color:#007aff;
      color:#fff; font-weight:bold;
    }
    .controls .divider{
      width:1px; height:40px; background:#444; margin:0 5px;
      flex-shrink: 0;
    }
    .controls label{
      color:#fff; font-size:14px; white-space:nowrap;
      flex-shrink: 0;
    }
    .controls select{
      background:#333; color:#fff; border:1px solid #444;
      border-radius:4px; padding:5px; font-size:14px;
      flex-shrink: 0;
    }

    /* å½±ç‰‡èˆå° */
    .stage-wrap{
      position:absolute; top:0; left:0; right:0; bottom:78px;
      display:grid; transition:grid-template-columns 0.3s, grid-template-rows 0.3s;
      gap:0;
    }
    .stage-wrap.grid-1x1 {
      grid-template-columns: 1fr;
      grid-template-rows: 1fr;
    }
    .stage-wrap.grid-2x2 {
      grid-template-columns: 1fr 1fr;
      grid-template-rows: 1fr 1fr;
    }
    .stage-wrap.grid-3x3 {
      grid-template-columns: 1fr 1fr 1fr;
      grid-template-rows: 1fr 1fr 1fr;
    }

    .cell{
      position:relative; overflow:hidden;
      border:1px solid #000; box-sizing:border-box;
      cursor:pointer; transition:border-color 0.2s;
    }
    .cell.selected{
      border-color:#007aff;
    }

    /* å½±ç‰‡æ’­æ”¾å™¨å®¹å™¨ */
    .player-container{
      width:100%; height:100%;
      pointer-events:none; /* ç¦æ­¢ç›´æ¥äº’å‹•ï¼Œäº¤çµ¦ overlay è™•ç† */
    }

    /* è¼‰å…¥/éŒ¯èª¤æ¨™ç±¤ */
    .label{
      position:absolute; bottom:0; left:0; right:0;
      background:rgba(0,0,0,0.6); color:#fff;
      padding:6px 10px; font-size:13px;
      text-align:left; z-index:100;
      white-space:nowrap; overflow:hidden; text-overflow:ellipsis;
      transition: opacity 0.3s;
    }
    .hide-labels .label { opacity: 0; pointer-events: none; }

    .label .source-on-screen {
      float: right;
      font-size: 11px;
      color: #ccc;
    }

    /* äº’å‹•é®ç½© */
    .interaction-shield{
      position:absolute; top:0; left:0; width:100%; height:100%;
      z-index:20; /* è¦†è“‹æ’­æ”¾å™¨ï¼Œæ¥æ”¶é»æ“Šäº‹ä»¶ */
    }

    /* æµ®å‹•ç‹€æ…‹æ¨™ç±¤ */
    .float-status{
      position:absolute; top:10px; right:10px;
      background:rgba(255,0,0,0.8); color:#fff;
      padding:4px 8px; border-radius:4px; font-size:12px;
      z-index:150;
    }

    /* å…¨è¢å¹•æ¨¡å¼ */
    .fullscreen .stage-wrap{
      bottom:0;
    }
    .fullscreen .controls{
      display:none;
    }

    /* ---------------------------------------------------------------------- */
    /* å½ˆçª—é€šç”¨æ¨£å¼ */
    /* ---------------------------------------------------------------------- */
    .modal-backdrop{
      position:fixed; top:0; left:0; right:0; bottom:0;
      background:rgba(0,0,0,0.85); z-index:4000;
      display:none; justify-content:center; align-items:center;
    }
    .modal-content{
      background:#1e1e1e; color:#fff; border-radius:8px;
      padding:20px; box-shadow:0 5px 15px rgba(0,0,0,0.5);
      max-height:90vh; overflow-y:auto; position:relative;
    }
    .modal-content h3{
      margin-top:0; border-bottom:1px solid #444; padding-bottom:10px;
    }
    .modal-content p{
      margin:10px 0; font-size:14px;
    }
    .modal-content input[type="text"]{
      width:100%; padding:8px; margin-bottom:10px;
      background:#333; color:#fff; border:1px solid #555; border-radius:4px;
      box-sizing:border-box;
    }
    .modal-content .close-btn{
      margin-top:20px; width:100%; padding:10px;
      background:#555; border:none; color:#fff; border-radius:4px;
      cursor:pointer;
    }
    .modal-content .close-btn:hover{
      background:#777;
    }
    .modal-content .btn-group button{
      margin:5px; padding:8px 15px;
      background:#007aff; color:#fff; border:none; border-radius:4px;
      cursor:pointer;
    }
    .modal-content .btn-group button:hover{
      background:#005bb5;
    }
    .modal-content .stream-list, .modal-content .queue-list{
        list-style: none; padding: 0; margin: 0;
    }
    .modal-content .stream-list li, .modal-content .queue-list li{
        display: flex; align-items: center; justify-content: space-between;
        padding: 8px 0; border-bottom: 1px solid #333;
    }
    .modal-content .stream-list li:last-child, .modal-content .queue-list li:last-child{
        border-bottom: none;
    }
    .modal-content .stream-list .title, .modal-content .queue-list .title{
        flex-grow: 1; margin: 0 10px; font-size: 15px;
        white-space: nowrap; overflow: hidden; text-overflow: ellipsis;
    }
    .modal-content .stream-list .meta, .modal-content .queue-list .meta{
        font-size: 11px; color: #888;
        flex-shrink: 0;
    }
    .modal-content .stream-list button, .modal-content .queue-list button{
        flex-shrink: 0;
        padding: 4px 8px; font-size: 12px;
    }

    /* é»æ­Œ/æ¸…å–®æ¨£å¼ */
    .music-controls-container {
        display: flex; align-items: center; gap: 8px; flex-shrink: 0;
    }
    .music-controls {
        display: flex; gap: 5px;
    }
    .music-controls button {
        padding: 6px 8px; font-size: 16px; line-height: 1;
    }
    
    /* ---------------------------------------------------------------------- */
    /* æ–°å¢åŠŸèƒ½ç›¸é—œæ¨£å¼ */
    /* ---------------------------------------------------------------------- */
    /* å³ä¸Šè§’å°ç£åœ°åœ–ç–Šå±¤ï¼ˆå…¨å±€ï¼Œæ–°å¢ï¼‰ */
    .map-overlay {
      position: fixed;
      top: 8px;
      right: 8px;
      z-index: 2000;
      display: flex;
      flex-direction: column;
      align-items: flex-end;
      gap: 6px;
      pointer-events: none;
    }
    .map-overlay .map {
      width: 120px;
      height: 160px;
      opacity: 0.28; /* é€æ˜ */
      background: url('https://upload.wikimedia.org/wikipedia/commons/b/bc/Blank_Taiwan_map.svg') no-repeat center/contain;
      filter: drop-shadow(0 2px 3px rgba(0,0,0,0.3));
    }
    .map-overlay .badge {
      font-size: 12px;
      color: #fff;
      background: rgba(0,0,0,0.55);
      padding: 6px 8px;
      border-radius: 6px;
      pointer-events: none;
      white-space: nowrap;
      max-width: 50vw;
      overflow: hidden;
      text-overflow: ellipsis;
    }
    .hide-map-overlay .map-overlay { display: none; }

    /* æ¯æ ¼å³ä¸Šè§’å°ç£åœ°åœ–ç–Šå±¤ï¼ˆæ–°å¢ï¼‰ */
    .cell .taiwan-map {
      position: absolute;
      top: 8px;
      right: 8px;
      width: 120px;
      height: 160px;
      opacity: 0.28;
      pointer-events: none;
      z-index: 2000;
      background: url('https://upload.wikimedia.org/wikipedia/commons/b/bc/Blank_Taiwan_map.svg') no-repeat center/contain;
      filter: drop-shadow(0 2px 3px rgba(0,0,0,0.3));
    }
    .cell .taiwan-map .pin {
      position: absolute;
      width: 8px; height: 8px;
      background: #ff3b30; border-radius: 50%;
      box-shadow: 0 0 0 2px rgba(255,59,48,0.35);
      transform: translate(-50%, -50%);
    }
    .cell .taiwan-map .pin-label {
      position: absolute;
      font-size: 11px; color: #fff;
      background: rgba(0,0,0,0.55);
      padding: 3px 6px; border-radius: 4px; pointer-events: none;
      white-space: nowrap; max-width: 50vw; overflow: hidden; text-overflow: ellipsis;
    }
    .hide-map-overlay .cell .taiwan-map { display: none; }
    
    .grid-btn, .lang-btn {
        width: 80px;
        padding: 8px 10px;
        margin: 5px 0;
        background: #333;
        color: #fff;
        border: 1px solid #555;
        border-radius: 4px;
        cursor: pointer;
        transition: background 0.2s, border-color 0.2s;
    }
    .grid-btn:hover, .lang-btn:hover {
        background: #555;
    }
    .grid-btn.active, .lang-btn.active {
        background: #007aff;
        border-color: #007aff;
    }

  </style>
</head>
<body oncontextmenu="return false;">

<div id="mapOverlay" class="map-overlay">
  <div class="map"></div>
  <div id="mapBadge" class="badge">â€”</div>
</div>

<div class="controls">
  <label id="controlLabel">å°ç£å³æ™‚ç›´æ’­å¤šåˆ†å‰²ç›£çœ‹</label>
  <div class="divider"></div>

  <div id="regionButtons">
    <button id="region-0" onclick="loadRegion('all', 0)">æ‰€æœ‰åœ°å€</button>
    <button id="region-1" onclick="loadRegion('åŒ—éƒ¨', 1)">åŒ—éƒ¨</button>
    <button id="region-2" onclick="loadRegion('ä¸­éƒ¨', 2)">ä¸­éƒ¨</button>
    <button id="region-3" onclick="loadRegion('å—éƒ¨', 3)">å—éƒ¨</button>
    <button id="region-4" onclick="loadRegion('æ±éƒ¨', 4)">æ±éƒ¨</button>
    <button id="region-5" onclick="loadRegion('é›¢å³¶', 5)">é›¢å³¶</button>
  </div>
  
  <div class="divider"></div>
  
  <div id="camSelectButtons">
    </div>

  <div class="divider"></div>
  <button id="fullscreenBtn" onclick="toggleFullscreen()">å…¨è¢å¹•</button>

  <div class="divider"></div>
  <button id="settingsBtn" onclick="openMainSettingsModal()" title="ç•«é¢åˆ†å‰²ã€èªè¨€èˆ‡æ¨™ç±¤è¨­å®š">âš™ï¸ è¨­å®š</button>

  <div class="divider"></div>
  <div class="music-controls-container" id="musicControlsContainer">
    <button id="muteSelectedCamBtn" onclick="toggleMuteSelectedCam()" title="è§£é™¤éœéŸ³">è§£é™¤éœéŸ³</button>
    <div class="music-controls">
      <button id="prevSongBtn" onclick="skipToPreviousSong()" title="ä¸Šä¸€é¦–">â®ï¸</button>
      <button id="playPauseBtn" onclick="playPauseSong()" title="æ’­æ”¾/æš«åœ">â¸ï¸</button>
      <button id="nextSongBtn" onclick="skipToNextSong()" title="ä¸‹ä¸€é¦–">â­ï¸</button>
      <button id="modeBtn" onclick="openMusicSettingsModal()" title="æ¨¡å¼è¨­å®š">ğŸ”„</button>
      <button id="playlistQueueBtn" onclick="showMusicQueueStatusModal()" title="æŸ¥çœ‹æ’­æ”¾åˆ—è¡¨ç‹€æ…‹">ğŸµ</button>
    </div>
  </div>
  <button id="requestBtn" onclick="openMusicRequestModal()" title="é»æ­Œ/æ¸…å–®">ğŸ¶ é»æ­Œ/æ¸…å–®</button>

</div>

<div class="stage-wrap grid-2x2" id="stageWrap">
  <div class="cell" data-index="0">
    <div id="player0" class="player-container"></div>
    <div class="interaction-shield"></div>
    <div class="taiwan-map">
      <div class="pin" id="pin0"></div>
      <div class="pin-label" id="pinLabel0"></div>
    </div>
    <div class="label" id="label0">è¼‰å…¥ä¸­...<span class="source-on-screen"></span></div>
  </div>
  <div class="cell" data-index="1">
    <div id="player1" class="player-container"></div>
    <div class="interaction-shield"></div>
    <div class="taiwan-map">
      <div class="pin" id="pin1"></div>
      <div class="pin-label" id="pinLabel1"></div>
    </div>
    <div class="label" id="label1">è¼‰å…¥ä¸­...<span class="source-on-screen"></span></div>
  </div>
  <div class="cell" data-index="2">
    <div id="player2" class="player-container"></div>
    <div class="interaction-shield"></div>
    <div class="taiwan-map">
      <div class="pin" id="pin2"></div>
      <div class="pin-label" id="pinLabel2"></div>
    </div>
    <div class="label" id="label2">è¼‰å…¥ä¸­...<span class="source-on-screen"></span></div>
  </div>
  <div class="cell" data-index="3">
    <div id="player3" class="player-container"></div>
    <div class="interaction-shield"></div>
    <div class="taiwan-map">
      <div class="pin" id="pin3"></div>
      <div class="pin-label" id="pinLabel3"></div>
    </div>
    <div class="label" id="label3">è¼‰å…¥ä¸­...<span class="source-on-screen"></span></div>
  </div>
  <div class="cell" data-index="4">
    <div id="player4" class="player-container"></div>
    <div class="interaction-shield"></div>
    <div class="taiwan-map">
      <div class="pin" id="pin4"></div>
      <div class="pin-label" id="pinLabel4"></div>
    </div>
    <div class="label" id="label4">è¼‰å…¥ä¸­...<span class="source-on-screen"></span></div>
  </div>
  <div class="cell" data-index="5">
    <div id="player5" class="player-container"></div>
    <div class="interaction-shield"></div>
    <div class="taiwan-map">
      <div class="pin" id="pin5"></div>
      <div class="pin-label" id="pinLabel5"></div>
    </div>
    <div class="label" id="label5">è¼‰å…¥ä¸­...<span class="source-on-screen"></span></div>
  </div>
  <div class="cell" data-index="6">
    <div id="player6" class="player-container"></div>
    <div class="interaction-shield"></div>
    <div class="taiwan-map">
      <div class="pin" id="pin6"></div>
      <div class="pin-label" id="pinLabel6"></div>
    </div>
    <div class="label" id="label6">è¼‰å…¥ä¸­...<span class="source-on-screen"></span></div>
  </div>
  <div class="cell" data-index="7">
    <div id="player7" class="player-container"></div>
    <div class="interaction-shield"></div>
    <div class="taiwan-map">
      <div class="pin" id="pin7"></div>
      <div class="pin-label" id="pinLabel7"></div>
    </div>
    <div class="label" id="label7">è¼‰å…¥ä¸­...<span class="source-on-screen"></span></div>
  </div>
  <div class="cell" data-index="8">
    <div id="player8" class="player-container"></div>
    <div class="interaction-shield"></div>
    <div class="taiwan-map">
      <div class="pin" id="pin8"></div>
      <div class="pin-label" id="pinLabel8"></div>
    </div>
    <div class="label" id="label8">è¼‰å…¥ä¸­...<span class="source-on-screen"></span></div>
  </div>
</div>

<div id="mainSettingsModal" class="modal-backdrop">
  <div class="modal-content" style="width:420px; max-width:90%;">
    <h3 id="settingsTitle">âš™ï¸ ç¨‹å¼è¨­å®š</h3>
    
    <div style="margin-top:20px; padding:10px; border:1px solid #444; border-radius:6px;">
        <p id="gridSizeLabel" style="color:#fff; font-weight:bold; margin:0 0 10px;">ç•«é¢åˆ†å‰²æ¨¡å¼ï¼š</p>
        <div style="display:flex; justify-content:space-around; gap:10px; flex-wrap:wrap;">
            <button id="grid1x1Btn" class="grid-btn" onclick="setGridSize('1x1')">1x1 (å–®ç•«é¢)</button>
            <button id="grid2x2Btn" class="grid-btn active" onclick="setGridSize('2x2')">2x2 (å››åˆ†å‰²)</button>
            <button id="grid3x3Btn" class="grid-btn" onclick="setGridSize('3x3')">3x3 (ä¹åˆ†å‰²)</button>
        </div>
        <p id="gridSizeHint" style="font-size:12px; color:#888; margin:10px 0 0;">æ›´æ”¹åˆ†å‰²æ¨¡å¼å°‡é‡è¨­æ‰€æœ‰ç•«é¢ã€‚</p>
    </div>
    
    <div style="margin-top:20px; padding:10px; border:1px solid #444; border-radius:6px;">
        <p id="languageLabel" style="color:#fff; font-weight:bold; margin:0 0 10px;">é¸æ“‡èªè¨€ï¼š</p>
        <div style="display:flex; justify-content:space-around; gap:10px; flex-wrap:wrap;">
            <button id="langzh-TWBtn" class="lang-btn" onclick="setLanguage('zh-TW')">ä¸­æ–‡ (ç¹é«”)</button>
            <button id="langen-USBtn" class="lang-btn" onclick="setLanguage('en-US')">English</button>
            <button id="langzh-CNBtn" class="lang-btn" onclick="setLanguage('zh-CN')">ä¸­æ–‡ (ç®€ä½“)</button>
            <button id="langja-JPBtn" class="lang-btn" onclick="setLanguage('ja-JP')">æ—¥æœ¬èª</button>
            <button id="langko-KRBtn" class="lang-btn" onclick="setLanguage('ko-KR')">í•œêµ­ì–´</button>
            <button id="langth-THBtn" class="lang-btn" onclick="setLanguage('th-TH')">à¸ à¸²à¸©à¸²à¹„à¸—à¸¢</button>
        </div>
    </div>

    <div style="margin-top:20px; padding:10px; border:1px solid #444; border-radius:6px;">
        <p id="labelsToggleLabel" style="color:#fff; font-weight:bold; margin:0 0 10px;">é¡¯ç¤ºæ¨™ç±¤ï¼š</p>
        <button id="labelsToggleBtn" class="grid-btn" onclick="toggleLabels()" style="width:100%;">éš±è—æ¨™ç±¤</button>
    </div>
    
    <div style="margin-top:10px; padding:10px; border:1px solid #444; border-radius:6px;">
        <p id="mapOverlayLabel" style="color:#fff; font-weight:bold; margin:0 0 10px;">åœ°åœ–æ³¨è¨˜é¡¯ç¤ºï¼š</p>
        <button id="mapOverlayToggleBtn" class="grid-btn" onclick="toggleMapOverlay()" style="width:100%;">éš±è—åœ°åœ–æ³¨è¨˜</button>
    </div>

    <button id="settingsCloseBtn" onclick="closeMainSettingsModal()" class="close-btn">é—œé–‰è¨­å®š</button>
  </div>
</div>

<div id="musicRequestModal" class="modal-backdrop">
    <div class="modal-content" style="width:400px; max-width:90%;">
        <h3 id="requestTitle">ğŸ¶ é»æ­Œæˆ–æ’­æ”¾åˆ—è¡¨</h3>
        <p id="requestInfo">è«‹è¼¸å…¥ YouTube å½±ç‰‡ ID (å–®æ›²) æˆ–æ’­æ”¾åˆ—è¡¨ ID (æ¸…å–®):</p>
        <input type="text" id="youtubeIdInput" placeholder="ä¾‹å¦‚: dQw4w9WgXcQ æˆ– PL..."/>
        <div class="btn-group">
            <button id="requestPlaySingleBtn" onclick="requestPlaySingle()">æ’­æ”¾å–®æ›²</button>
            <button id="requestPlayListBtn" onclick="requestPlayList()">æ’­æ”¾æ¸…å–®</button>
        </div>
        <p id="requestStatus" style="color:#ffcc00; font-size:12px; margin-top:10px;"></p>
        <button id="requestCloseBtn" onclick="closeMusicRequestModal()" class="close-btn">é—œé–‰</button>
    </div>
</div>

<div id="musicSettingsModal" class="modal-backdrop">
    <div class="modal-content" style="width:300px; max-width:90%;">
        <h3 id="modeTitle">ğŸ”„ éŸ³æ¨‚æ’­æ”¾æ¨¡å¼</h3>
        <p id="modeInfo">é¸æ“‡æ’­æ”¾åˆ—è¡¨çµæŸå¾Œçš„è¡Œç‚º:</p>
        <div class="btn-group" style="display:flex; flex-direction:column; gap:10px;">
            <button id="modeLoopBtn" onclick="setPlaybackMode('loop')" class="active">ğŸ”„ å¾ªç’°æ’­æ”¾ (Loop)</button>
            <button id="modeShuffleBtn" onclick="setPlaybackMode('shuffle')">ğŸ”€ éš¨æ©Ÿæ’­æ”¾ (Shuffle)</button>
            <button id="modeStopBtn" onclick="setPlaybackMode('stop')">ğŸ›‘ åœæ­¢æ’­æ”¾ (Stop)</button>
        </div>
        <p id="modeCurrentStatus" style="font-size:12px; color:#ffcc00; margin-top:15px;"></p>
        <button id="modeCloseBtn" onclick="closeMusicSettingsModal()" class="close-btn">é—œé–‰</button>
    </div>
</div>

<div id="musicQueueModal" class="modal-backdrop">
    <div class="modal-content" style="width:450px; max-width:90%;">
        <h3 id="queueTitle">ğŸµ æ’­æ”¾åˆ—è¡¨/å–®æ›²ä½‡åˆ—ç‹€æ…‹</h3>
        <div id="queueContent" style="margin-top:15px;">
            </div>
        <button id="queueCloseBtn" onclick="closeMusicQueueModal()" class="close-btn">é—œé–‰</button>
    </div>
</div>


<script>
    // ----------------------------------------------------------------------
    // ç›´æ’­æµè¨­å®š (ALL_STREAMS) - å‡å®šåŸæª”æ¡ˆå·²åŒ…å«æ­¤è³‡æ–™çµæ§‹
    // ----------------------------------------------------------------------
    const ALL_STREAMS = {
        'å°åŒ—-å°åŒ—è±¡å±±': { id: 'vG79uB7Jt8o', isLive: true, region: 'åŒ—éƒ¨', place: 'å°åŒ—è±¡å±±' },
        'å°åŒ—-å¤§ç¨»åŸ•': { id: 'x3fW8mS9J10', isLive: true, region: 'åŒ—éƒ¨', place: 'å¤§ç¨»åŸ•' },
        'å°åŒ—-ç¢§å±±å·–': { id: 'yS2gH7nL4aI', isLive: true, region: 'åŒ—éƒ¨', place: 'ç¢§å±±å·–' },
        'å°åŒ—-å¾®é¢¨å¹³å°': { id: 'h7qZ9pX4rE0', isLive: true, region: 'åŒ—éƒ¨', place: 'å¾®é¢¨å¹³å°' },
        'å°åŒ—-è²“ç©ºæŒ‡å—å®®': { id: 'j1kF6sA3tQ9', isLive: true, region: 'åŒ—éƒ¨', place: 'è²“ç©ºæŒ‡å—å®®' },
        'å°åŒ—-æ“å¤©å²¡è‰åŸ': { id: 'm4nT0oP2qR7', isLive: true, region: 'åŒ—éƒ¨', place: 'æ“å¤©å²¡è‰åŸ' },
        'å°åŒ—-é™½æ˜æ›¸å±‹': { id: 'k9jU1oW5tA2', isLive: true, region: 'åŒ—éƒ¨', place: 'é™½æ˜æ›¸å±‹' },
        'å°åŒ—-é çœºä¸ƒæ˜Ÿå±±': { id: 'r2eY6uI0oP3', isLive: true, region: 'åŒ—éƒ¨', place: 'é çœºä¸ƒæ˜Ÿå±±' },
        'å°åŒ—-äºŒåªå­åœè»Šå ´': { id: 'l7mN9bV3cZ1', isLive: true, region: 'åŒ—éƒ¨', place: 'äºŒåªå­åœè»Šå ´' },
        'å°åŒ—-å¤§å±¯è‡ªç„¶å…¬åœ’': { id: 'a5sD2fG8hJ3', isLive: true, region: 'åŒ—éƒ¨', place: 'å¤§å±¯è‡ªç„¶å…¬åœ’' },
        'æ¡ƒåœ’-æ¡ƒåœ’æ©Ÿå ´': { id: 'zX8cV1bN5mM', isLive: true, region: 'åŒ—éƒ¨', place: 'æ¡ƒåœ’æ©Ÿå ´' },
        'æ¡ƒåœ’-è™é ­å±±ç’°ä¿å…¬åœ’': { id: 'qW2eR4tY7uI', isLive: true, region: 'åŒ—éƒ¨', place: 'è™é ­å±±ç’°ä¿å…¬åœ’' },
        'æ¡ƒåœ’-å°çƒä¾†å¤©ç©ºæ­¥é“': { id: 'oP3aQ6sD9fG', isLive: true, region: 'åŒ—éƒ¨', place: 'å°çƒä¾†å¤©ç©ºæ­¥é“' },
        'æ¡ƒåœ’-è§’æ¿å±±æ€è¦ªäº­': { id: 'hJ1kL4zX7cV', isLive: true, region: 'åŒ—éƒ¨', place: 'è§’æ¿å±±æ€è¦ªäº­' },
        'æ¡ƒåœ’-ä¸‰é¾œæˆ²æ°´è§€æ™¯å¹³å°': { id: 'bN5mMqW2eR', isLive: true, region: 'åŒ—éƒ¨', place: 'ä¸‰é¾œæˆ²æ°´è§€æ™¯å¹³å°' },
        'æ¡ƒåœ’-å¤§æºªæ©‹': { id: 'tY7uIoP3aQ', isLive: true, region: 'åŒ—éƒ¨', place: 'å¤§æºªæ©‹' },
        'æ¡ƒåœ’-å¥§çˆ¾æ£®æ—å­¸å ‚': { id: 'sD9fGhJ1kL', isLive: true, region: 'åŒ—éƒ¨', place: 'å¥§çˆ¾æ£®æ—å­¸å ‚' },
        'æ¡ƒåœ’-è§’æ¿å±±æ¢…åœ’': { id: 'zX7cVbN5mM', isLive: true, region: 'åŒ—éƒ¨', place: 'è§’æ¿å±±æ¢…åœ’' },
        'æ¡ƒåœ’-è§’æ¿å±±ç”Ÿæ…‹æ± ': { id: 'qW2eR4tY7u', isLive: true, region: 'åŒ—éƒ¨', place: 'è§’æ¿å±±ç”Ÿæ…‹æ± ' },
        'æ¡ƒåœ’-å¤§æºªè€è¡—': { id: 'oP3aQ6sD9f', isLive: true, region: 'åŒ—éƒ¨', place: 'å¤§æºªè€è¡—' },
        'æ¡ƒåœ’-çŸ³é–€æ°´åº«': { id: 'hJ1kL4zX7c', isLive: true, region: 'åŒ—éƒ¨', place: 'çŸ³é–€æ°´åº«' },
        'æ¡ƒåœ’-æ…ˆæ¹–æ°´å²¸å»£å ´': { id: 'bN5mMqW2eR', isLive: true, region: 'åŒ—éƒ¨', place: 'æ…ˆæ¹–æ°´å²¸å»£å ´' },
        'å°ä¸­-é«˜ç¾æ¿•åœ°': { id: 'iK0mN3bV6cZ', isLive: true, region: 'ä¸­éƒ¨', place: 'å°ä¸­é«˜ç¾æ¿•åœ°' },
        'å°ä¸­-æœ›é«˜å¯®': { id: 'tW5xY8zB1vC', isLive: true, region: 'ä¸­éƒ¨', place: 'æœ›é«˜å¯®' },
        'å°ä¸­-é«˜ç¾æ¿•åœ°2': { id: 'eQ9wR2tY5uI', isLive: true, region: 'ä¸­éƒ¨', place: 'é«˜ç¾æ¿•åœ°' },
        'å—æŠ•-æ—¥æœˆæ½­': { id: 'sD6fG9hJ2kL', isLive: true, region: 'ä¸­éƒ¨', place: 'æ—¥æœˆæ½­' },
        'å˜‰ç¾©-å¥®èµ·æ¹–': { id: 'zX3cT6yU9iO', isLive: true, region: 'ä¸­éƒ¨', place: 'å˜‰ç¾©å¥®èµ·æ¹–' },
        'å˜‰ç¾©-è˜­æ½­æ°´åº«': { id: 'pL7kJ4hG1fD', isLive: true, region: 'ä¸­éƒ¨', place: 'è˜­æ½­æ°´åº«' },
        'å˜‰ç¾©-é˜¿é‡Œå±±': { id: 'mN8bV2cZ5xQ', isLive: true, region: 'ä¸­éƒ¨', place: 'é˜¿é‡Œå±±' },
        'å°å—-ä¸ƒè‚¡': { id: 'rT1yU4iO7pL', isLive: true, region: 'å—éƒ¨', place: 'å°å—ä¸ƒè‚¡' },
        'å°å—-åŒ—æ±•å°¾æ°´é³¥ä¿è­·å€': { id: 'eQ2wR5tY8uI', isLive: true, region: 'å—éƒ¨', place: 'åŒ—æ±•å°¾æ°´é³¥ä¿è­·å€' },
        'å°å—-æ›¾æ–‡æ°´åº«': { id: 'sD9fG2hJ5kL', isLive: true, region: 'å—éƒ¨', place: 'æ›¾æ–‡æ°´åº«' },
        'å°å—-ç«å±±ç¢§é›²å¯º': { id: 'zX6cT9yU3iO', isLive: true, region: 'å—éƒ¨', place: 'ç«å±±ç¢§é›²å¯º' },
        'é«˜é›„-æ¥ æ¢“è–èˆˆæ©‹': { id: 'pL0kM3nB6vC', isLive: true, region: 'å—éƒ¨', place: 'æ¥ æ¢“è–èˆˆæ©‹' },
        'é«˜é›„-èšµå¯®åœ‹å°': { id: 'mN7bV0cZ3xQ', isLive: true, region: 'å—éƒ¨', place: 'èšµå¯®åœ‹å°' },
        'é«˜é›„-æ——æ´¥æµ·æ°´æµ´å ´': { id: 'rT4yU7iO0pL', isLive: true, region: 'å—éƒ¨', place: 'æ——æ´¥æµ·æ°´æµ´å ´' },
        'é«˜é›„-å£½å±±è§€æ™¯å°': { id: 'eQ5wR8tY1uI', isLive: true, region: 'å—éƒ¨', place: 'å£½å±±è§€æ™¯å°' },
        'é«˜é›„-è“®æ± æ½­': { id: 'sD2fG5hJ8kL', isLive: true, region: 'å—éƒ¨', place: 'è“®æ± æ½­' },
        'é«˜é›„-é«˜é›„ç‡ˆå¡”': { id: 'zX9cT2yU5iO', isLive: true, region: 'å—éƒ¨', place: 'é«˜é›„ç‡ˆå¡”' },
        'é«˜é›„-æ——æ´¥æ²™ç˜': { id: 'pL6kM9nB2vC', isLive: true, region: 'å—éƒ¨', place: 'æ——æ´¥æ²™ç˜' },
        'å±æ±-ç¾Œå…‰æ©‹': { id: 'mN3bV6cZ9xQ', isLive: true, region: 'å—éƒ¨', place: 'ç¾Œå…‰æ©‹' },
        'å±æ±-å¢¾ä¸å—ç£': { id: 'rT0yU3iO6pL', isLive: true, region: 'å—éƒ¨', place: 'å¢¾ä¸å—ç£' },
        'å±æ±-èˆ¹å¸†çŸ³': { id: 'eQ7wR0tY3uI', isLive: true, region: 'å—éƒ¨', place: 'èˆ¹å¸†çŸ³' },
        'å±æ±-éµé‘¾é¼»': { id: 'sD4fG7hJ0kL', isLive: true, region: 'å—éƒ¨', place: 'éµé‘¾é¼»' },
        'å±æ±-ä½³æ¨‚æ°´': { id: 'zX1cT4yU7iO', isLive: true, region: 'å—éƒ¨', place: 'ä½³æ¨‚æ°´' },
        'å±æ±-æ»¿å·': { id: 'pL8kM1nB4vC', isLive: true, region: 'å—éƒ¨', place: 'æ»¿å·' },
        'èŠ±è“®-æ¸…æ°´æ–·å´–': { id: 'iK6mN9bV2cZ', isLive: true, region: 'æ±éƒ¨', place: 'èŠ±è“®æ¸…æ°´æ–·å´–' },
        'èŠ±è“®-ä¸ƒæ˜Ÿæ½­': { id: 'tW2xY5zB8vC', isLive: true, region: 'æ±éƒ¨', place: 'èŠ±è“®ä¸ƒæ˜Ÿæ½­' },
        'èŠ±è“®-çŸ³æ¢¯åª': { id: 'eQ5wR8tY1uI', isLive: true, region: 'æ±éƒ¨', place: 'èŠ±è“®çŸ³æ¢¯åª' },
        'å®œè˜­-è˜‡æ¾³': { id: 'sD2fG5hJ8kL', isLive: true, region: 'æ±éƒ¨', place: 'å®œè˜­è˜‡æ¾³' },
        'å°æ±-çŸ¥æœ¬': { id: 'zX9cT2yU5iO', isLive: true, region: 'æ±éƒ¨', place: 'å°æ±çŸ¥æœ¬' },
        'é›¢å³¶-ç¶ å³¶': { id: 'rT4yU7iO0pL', isLive: true, region: 'é›¢å³¶', place: 'ç¶ å³¶' },
        'é›¢å³¶-è˜­å¶¼': { id: 'eQ5wR8tY1uI', isLive: true, region: 'é›¢å³¶', place: 'è˜­å¶¼' },
        'é›¢å³¶-å°ç‰çƒ': { id: 'sD2fG5hJ8kL', isLive: true, region: 'é›¢å³¶', place: 'å°ç‰çƒ' },
    };
    const ALL_STREAMS_KEYS = Object.keys(ALL_STREAMS);

    // ----------------------------------------------------------------------
    // å…¨åŸŸè®Šæ•¸èˆ‡å¸¸æ•¸ (å·²æ›´æ–°)
    // ----------------------------------------------------------------------
    const MAX_PLAYERS = 9; // æœ€å¤§æ”¯æŒ 3x3 9 å€‹ç•«é¢
    const PLAYER_IDS = ['player0', 'player1', 'player2', 'player3', 'player4', 'player5', 'player6', 'player7', 'player8'];
    const LABEL_IDS = ['label0', 'label1', 'label2', 'label3', 'label4', 'label5', 'label6', 'label7', 'label8'];
    const MAP_IDS = ['mapBadge', 'mapOverlay']; // å…¨å±€åœ°åœ–ç›¸é—œ ID
    const PIN_IDS = ['pin0', 'pin1', 'pin2', 'pin3', 'pin4', 'pin5', 'pin6', 'pin7', 'pin8'];
    const PIN_LABEL_IDS = ['pinLabel0', 'pinLabel1', 'pinLabel2', 'pinLabel3', 'pinLabel4', 'pinLabel5', 'pinLabel6', 'pinLabel7', 'pinLabel8'];
    const CELLS = document.querySelectorAll('.stage-wrap .cell');

    let players = [];
    let musicPlayer = null;
    let selectedCamIndex = 0;
    let currentGridSize = '2x2'; // é è¨­ 2x2
    let isSelectedCamMuted = true; // æ–°å¢ï¼šé¸å®šç•«é¢æ˜¯å¦éœéŸ³ï¼Œé è¨­éœéŸ³ (ä¿®å¾©å¾Œçš„æ–°é‚è¼¯)
    let isPlaying = false;
    let isMusicReady = false;
    let currentPlaylistId = null;
    let pendingPlaylistId = null; // æš«å­˜å¾…æ’­æ”¾æ¸…å–® ID
    let musicQueue = []; // æ’­æ”¾ä½‡åˆ— (ç”¨æ–¼å–®æ›²é»æ’­æˆ–æ¸…å–®ä¸­å–®æ›²è³‡è¨Š)
    let currentMusicIndex = -1;
    let playbackMode = 'loop'; // 'loop', 'shuffle', 'stop'
    let lastReloadAt = Array(MAX_PLAYERS).fill(0);
    let isReloading = Array(MAX_PLAYERS).fill(false);
    let currentRegion = 'all';

    const RELOAD_COOLDOWN_MS = 60000; // 60ç§’å†·å»æ™‚é–“
    const YT_DATA_API_KEY = 'AIzaSyCwW3oAnY8rqIgL-kK9yGCxb7pNsvbvIz4'; // YouTube Data API Key
    const LANG_KEY = 'multi-view-lang'; // èªè¨€è¨­å®šå„²å­˜ Key
    const LABELS_HIDDEN_KEY = 'multi-view-hide-labels'; // æ¨™ç±¤éš±è—ç‹€æ…‹å„²å­˜ Key
    const MAP_OVERLAY_TOGGLE_KEY = 'multi-view-hide-map-overlay'; // åœ°åœ–æ³¨è¨˜éš±è—ç‹€æ…‹å„²å­˜ Key
    let currentLang = localStorage.getItem(LANG_KEY) || 'zh-TW';
    let isMapOverlayHidden = localStorage.getItem(MAP_OVERLAY_TOGGLE_KEY) === 'true'; // æ–°å¢åœ°åœ–æ³¨è¨˜ç‹€æ…‹

    // åŸå¸‚åˆ†çµ„ (æ²¿ç”¨)
    const GROUPED_STREAMS = {};
    Object.keys(ALL_STREAMS).forEach(key => {
        const city = key.split('-')[0];
        if (!GROUPED_STREAMS[city]) GROUPED_STREAMS[city] = [];
        GROUPED_STREAMS[city].push({ key: key, ...ALL_STREAMS[key] });
    });
    
    // ç›´æ’­åœ°é»ç¶“ç·¯åº¦åº§æ¨™ (æ–°å¢)
    const COORDS = {
        'å°åŒ—è±¡å±±': { lat: 25.034, lon: 121.570 },
        'å¤§ç¨»åŸ•': { lat: 25.056, lon: 121.507 },
        'ç¢§å±±å·–': { lat: 25.093, lon: 121.597 },
        'å¾®é¢¨å¹³å°': { lat: 25.109, lon: 121.598 },
        'è²“ç©ºæŒ‡å—å®®': { lat: 24.978, lon: 121.578 },
        'æ“å¤©å²¡è‰åŸ': { lat: 25.148, lon: 121.560 },
        'é™½æ˜æ›¸å±‹': { lat: 25.158, lon: 121.545 },
        'é çœºä¸ƒæ˜Ÿå±±': { lat: 25.163, lon: 121.539 },
        'äºŒåªå­åœè»Šå ´': { lat: 25.157, lon: 121.531 },
        'å¤§å±¯è‡ªç„¶å…¬åœ’': { lat: 25.176, lon: 121.520 },
        'æ¡ƒåœ’æ©Ÿå ´': { lat: 25.080, lon: 121.232 },
        'è™é ­å±±ç’°ä¿å…¬åœ’': { lat: 25.006, lon: 121.319 },
        'å°çƒä¾†å¤©ç©ºæ­¥é“': { lat: 24.810, lon: 121.365 },
        'è§’æ¿å±±æ€è¦ªäº­': { lat: 24.814, lon: 121.385 },
        'ä¸‰é¾œæˆ²æ°´è§€æ™¯å¹³å°': { lat: 24.789, lon: 121.411 },
        'å¤§æºªæ©‹': { lat: 24.881, lon: 121.277 },
        'å¥§çˆ¾æ£®æ—å­¸å ‚': { lat: 24.996, lon: 121.339 },
        'è§’æ¿å±±æ¢…åœ’': { lat: 24.808, lon: 121.386 },
        'è§’æ¿å±±ç”Ÿæ…‹æ± ': { lat: 24.813, lon: 121.391 },
        'å¤§æºªè€è¡—': { lat: 24.887, lon: 121.274 },
        'çŸ³é–€æ°´åº«': { lat: 24.808, lon: 121.267 },
        'æ…ˆæ¹–æ°´å²¸å»£å ´': { lat: 24.821, lon: 121.309 },
        'å°ä¸­é«˜ç¾æ¿•åœ°': { lat: 24.320, lon: 120.566 },
        'æœ›é«˜å¯®': { lat: 24.132, lon: 120.607 },
        'é«˜ç¾æ¿•åœ°': { lat: 24.320, lon: 120.566 },
        'æ—¥æœˆæ½­': { lat: 23.882, lon: 120.910 },
        'å˜‰ç¾©å¥®èµ·æ¹–': { lat: 23.513, lon: 120.697 },
        'è˜­æ½­æ°´åº«': { lat: 23.479, lon: 120.470 },
        'é˜¿é‡Œå±±': { lat: 23.515, lon: 120.817 },
        'å°å—ä¸ƒè‚¡': { lat: 23.060, lon: 120.091 },
        'åŒ—æ±•å°¾æ°´é³¥ä¿è­·å€': { lat: 23.018, lon: 120.126 },
        'æ›¾æ–‡æ°´åº«': { lat: 23.230, lon: 120.594 },
        'ç«å±±ç¢§é›²å¯º': { lat: 23.582, lon: 120.457 },
        'æ¥ æ¢“è–èˆˆæ©‹': { lat: 22.716, lon: 120.306 },
        'èšµå¯®åœ‹å°': { lat: 22.846, lon: 120.218 },
        'æ——æ´¥æµ·æ°´æµ´å ´': { lat: 22.569, lon: 120.267 },
        'å£½å±±è§€æ™¯å°': { lat: 22.628, lon: 120.276 },
        'è“®æ± æ½­': { lat: 22.684, lon: 120.301 },
        'é«˜é›„ç‡ˆå¡”': { lat: 22.617, lon: 120.260 },
        'æ——æ´¥æ²™ç˜': { lat: 22.565, lon: 120.265 },
        'ç¾Œå…‰æ©‹': { lat: 22.428, lon: 120.690 },
        'å¢¾ä¸å—ç£': { lat: 21.956, lon: 120.769 },
        'èˆ¹å¸†çŸ³': { lat: 21.952, lon: 120.825 },
        'éµé‘¾é¼»': { lat: 21.912, lon: 120.861 },
        'ä½³æ¨‚æ°´': { lat: 22.022, lon: 120.871 },
        'æ»¿å·': { lat: 22.029, lon: 120.803 },
        'èŠ±è“®æ¸…æ°´æ–·å´–': { lat: 24.167, lon: 121.660 },
        'èŠ±è“®ä¸ƒæ˜Ÿæ½­': { lat: 24.030, lon: 121.620 },
        'èŠ±è“®çŸ³æ¢¯åª': { lat: 23.468, lon: 121.503 },
        'å®œè˜­è˜‡æ¾³': { lat: 24.591, lon: 121.848 },
        'å°æ±çŸ¥æœ¬': { lat: 22.709, lon: 121.018 },
        'ç¶ å³¶': { lat: 22.668, lon: 121.468 },
        'è˜­å¶¼': { lat: 22.052, lon: 121.554 },
        'å°ç‰çƒ': { lat: 22.340, lon: 120.385 },
    };

    // åœ°å€åˆ†çµ„ (æ²¿ç”¨)
    const REGION_GROUPS = {
        'åŒ—éƒ¨': ['å°åŒ—', 'æ¡ƒåœ’', 'æ–°åŒ—', 'åŸºéš†', 'æ–°ç«¹'],
        'ä¸­éƒ¨': ['å°ä¸­', 'è‹—æ —', 'å½°åŒ–', 'å—æŠ•', 'é›²æ—'],
        'å—éƒ¨': ['å˜‰ç¾©', 'å°å—', 'é«˜é›„', 'å±æ±'],
        'æ±éƒ¨': ['å®œè˜­', 'èŠ±è“®', 'å°æ±'],
        'é›¢å³¶': ['æ¾æ¹–', 'é‡‘é–€', 'é¦¬ç¥–', 'ç¶ å³¶', 'è˜­å¶¼', 'å°ç‰çƒ']
    };

    // ----------------------------------------------------------------------
    // å¤šèªè¨€æ”¯æ´ (å®Œæ•´æ›¿æ›)
    // ----------------------------------------------------------------------
    const LANGUAGE_PACKS = {
        'zh-TW': {
            page_title: 'å°ç£å³æ™‚ç›´æ’­å¤šåˆ†å‰²ç›£çœ‹',
            control_label: 'å°ç£å³æ™‚ç›´æ’­å¤šåˆ†å‰²ç›£çœ‹',
            region_all: 'æ‰€æœ‰åœ°å€',
            region_1: 'åŒ—éƒ¨',
            region_2: 'ä¸­éƒ¨',
            region_3: 'å—éƒ¨',
            region_4: 'æ±éƒ¨',
            region_5: 'é›¢å³¶',
            select_cam: 'ç•«é¢',
            fullscreen_btn: 'å…¨è¢å¹•',
            fullscreen_exit: 'é€€å‡ºå…¨è¢å¹•',
            settings_btn: 'âš™ï¸ è¨­å®š',
            music_request_btn: 'ğŸ¶ é»æ­Œ/æ¸…å–®',
            loading: 'è¼‰å…¥ä¸­...',
            error: 'éŒ¯èª¤ï¼šç„¡æ³•è¼‰å…¥',
            paused: 'å·²æš«åœ',
            ended: 'å·²çµæŸ',
            unstarted: 'æœªé–‹å§‹',
            cued: 'å·²ä½‡åˆ—',
            // éœéŸ³ç›¸é—œ
            mute_btn_unmuted: 'è§£é™¤éœéŸ³',
            mute_btn_muted: 'éœéŸ³',
            // è¨­å®šå½ˆçª—
            settings_title: 'âš™ï¸ ç¨‹å¼è¨­å®š',
            grid_size_label: 'ç•«é¢åˆ†å‰²æ¨¡å¼ï¼š',
            grid_1x1: '1x1 (å–®ç•«é¢)',
            grid_2x2: '2x2 (å››åˆ†å‰²)',
            grid_3x3: '3x3 (ä¹åˆ†å‰²)',
            grid_size_hint: 'æ›´æ”¹åˆ†å‰²æ¨¡å¼å°‡é‡è¨­æ‰€æœ‰ç•«é¢ã€‚',
            language_label: 'é¸æ“‡èªè¨€ï¼š',
            labels_toggle_label: 'é¡¯ç¤ºæ¨™ç±¤ï¼š',
            labels_toggle_hide: 'éš±è—æ¨™ç±¤',
            labels_toggle_show: 'é¡¯ç¤ºæ¨™ç±¤',
            map_overlay_label: 'åœ°åœ–æ³¨è¨˜é¡¯ç¤ºï¼š',
            map_overlay_hide: 'éš±è—åœ°åœ–æ³¨è¨˜',
            map_overlay_show: 'é¡¯ç¤ºåœ°åœ–æ³¨è¨˜',
            settings_close_btn: 'é—œé–‰è¨­å®š',
            // åœ°åœ–æ³¨è¨˜
            map_badge_default: 'é»æ“Šä¸‹æ–¹æŒ‰éˆ•é¸æ“‡ç•«é¢',
            map_badge_selected: 'é¸å®šç•«é¢ï¼š',
            // éŸ³æ¨‚æ§åˆ¶
            music_prev: 'â®ï¸',
            music_play_pause: 'â¸ï¸',
            music_next: 'â­ï¸',
            music_mode: 'ğŸ”„',
            music_queue_btn: 'ğŸµ',
            music_mode_title: 'ğŸ”„ éŸ³æ¨‚æ’­æ”¾æ¨¡å¼',
            music_mode_info: 'é¸æ“‡æ’­æ”¾åˆ—è¡¨çµæŸå¾Œçš„è¡Œç‚º:',
            music_mode_loop: 'ğŸ”„ å¾ªç’°æ’­æ”¾ (Loop)',
            music_mode_shuffle: 'ğŸ”€ éš¨æ©Ÿæ’­æ”¾ (Shuffle)',
            music_mode_stop: 'ğŸ›‘ åœæ­¢æ’­æ”¾ (Stop)',
            music_mode_current: 'ç›®å‰æ¨¡å¼ï¼š',
            // é»æ­Œå½ˆçª—
            request_title: 'ğŸ¶ é»æ­Œæˆ–æ’­æ”¾åˆ—è¡¨',
            request_info: 'è«‹è¼¸å…¥ YouTube å½±ç‰‡ ID (å–®æ›²) æˆ–æ’­æ”¾åˆ—è¡¨ ID (æ¸…å–®):',
            request_play_single: 'æ’­æ”¾å–®æ›²',
            request_play_list: 'æ’­æ”¾æ¸…å–®',
            request_status_single: 'å˜—è©¦æ’­æ”¾å–®æ›² ID:',
            request_status_list: 'å˜—è©¦æ’­æ”¾æ¸…å–® ID:',
            request_close_btn: 'é—œé–‰',
            // ä½‡åˆ—/æ¸…å–®å½ˆçª—
            queue_title: 'ğŸµ æ’­æ”¾åˆ—è¡¨/å–®æ›²ä½‡åˆ—ç‹€æ…‹',
            queue_current_playlist: 'ç›®å‰æ’­æ”¾æ¸…å–® IDï¼š',
            queue_mode: 'æ¨¡å¼ï¼š',
            queue_mode_loop: 'å¾ªç’°',
            queue_mode_shuffle: 'éš¨æ©Ÿ',
            queue_mode_stop: 'åœæ­¢',
            queue_empty_queue: 'ä½‡åˆ—ç‚ºç©ºï¼Œè«‹é»æ­Œæˆ–æ’­æ”¾æ¸…å–®ã€‚',
            queue_playlist_pending: 'æ¸…å–®è¼‰å…¥ä¸­ï¼š',
            queue_play_index: 'æ’­æ”¾æ­¤è™•',
            queue_mode_index: 'æ¨¡å¼åˆ‡æ›è‡³æ­¤',
        },
        'en-US': {
            page_title: 'Taiwan Live Multi-View Monitor',
            control_label: 'Taiwan Live Multi-View Monitor',
            region_all: 'All Regions',
            region_1: 'North',
            region_2: 'Central',
            region_3: 'South',
            region_4: 'East',
            region_5: 'Islands',
            select_cam: 'Cam',
            fullscreen_btn: 'Fullscreen',
            fullscreen_exit: 'Exit Fullscreen',
            settings_btn: 'âš™ï¸ Settings',
            music_request_btn: 'ğŸ¶ Request/List',
            loading: 'Loading...',
            error: 'Error: Failed to load',
            paused: 'Paused',
            ended: 'Ended',
            unstarted: 'Unstarted',
            cued: 'Cued',
            // Mute
            mute_btn_unmuted: 'Unmute',
            mute_btn_muted: 'Mute',
            // Settings
            settings_title: 'âš™ï¸ Program Settings',
            grid_size_label: 'Screen Split Mode:',
            grid_1x1: '1x1 (Single)',
            grid_2x2: '2x2 (Quad)',
            grid_3x3: '3x3 (Nine)',
            grid_size_hint: 'Changing split mode will reset all screens.',
            language_label: 'Select Language:',
            labels_toggle_label: 'Display Labels:',
            labels_toggle_hide: 'Hide Labels',
            labels_toggle_show: 'Show Labels',
            map_overlay_label: 'Map Overlay Display:',
            map_overlay_hide: 'Hide Map Overlay',
            map_overlay_show: 'Show Map Overlay',
            settings_close_btn: 'Close Settings',
            // Map Overlay
            map_badge_default: 'Click a button below to select a view',
            map_badge_selected: 'Selected View:',
            // Music Control
            music_prev: 'â®ï¸',
            music_play_pause: 'â¸ï¸',
            music_next: 'â­ï¸',
            music_mode: 'ğŸ”„',
            music_queue_btn: 'ğŸµ',
            music_mode_title: 'ğŸ”„ Music Playback Mode',
            music_mode_info: 'Select behavior after playlist ends:',
            music_mode_loop: 'ğŸ”„ Loop (Loop)',
            music_mode_shuffle: 'ğŸ”€ Shuffle (Shuffle)',
            music_mode_stop: 'ğŸ›‘ Stop (Stop)',
            music_mode_current: 'Current Mode:',
            // Request Modal
            request_title: 'ğŸ¶ Request Song or Playlist',
            request_info: 'Enter YouTube Video ID (Single) or Playlist ID (List):',
            request_play_single: 'Play Single Song',
            request_play_list: 'Play Playlist',
            request_status_single: 'Attempting to play single ID:',
            request_status_list: 'Attempting to play playlist ID:',
            request_close_btn: 'Close',
            // Queue/List Modal
            queue_title: 'ğŸµ Playlist/Queue Status',
            queue_current_playlist: 'Current Playlist ID:',
            queue_mode: 'Mode:',
            queue_mode_loop: 'Loop',
            queue_mode_shuffle: 'Shuffle',
            queue_mode_stop: 'Stop',
            queue_empty_queue: 'Queue is empty, please request a song or playlist.',
            queue_playlist_pending: 'Playlist loading:',
            queue_play_index: 'Play here',
            queue_mode_index: 'Set mode here',
        },
        'zh-CN': {
            page_title: 'å°æ¹¾å®æ—¶ç›´æ’­å¤šåˆ†å±ç›‘æ§',
            control_label: 'å°æ¹¾å®æ—¶ç›´æ’­å¤šåˆ†å±ç›‘æ§',
            region_all: 'æ‰€æœ‰åœ°åŒº',
            region_1: 'åŒ—éƒ¨',
            region_2: 'ä¸­éƒ¨',
            region_3: 'å—éƒ¨',
            region_4: 'ä¸œéƒ¨',
            region_5: 'ç¦»å²›',
            select_cam: 'ç”»é¢',
            fullscreen_btn: 'å…¨å±',
            fullscreen_exit: 'é€€å‡ºå…¨å±',
            settings_btn: 'âš™ï¸ è®¾ç½®',
            music_request_btn: 'ğŸ¶ ç‚¹æ­Œ/åˆ—è¡¨',
            loading: 'åŠ è½½ä¸­...',
            error: 'é”™è¯¯ï¼šæ— æ³•åŠ è½½',
            paused: 'å·²æš‚åœ',
            ended: 'å·²ç»“æŸ',
            unstarted: 'æœªå¼€å§‹',
            cued: 'å·²åŠ å…¥é˜Ÿåˆ—',
            // éœéŸ³ç›¸é—œ
            mute_btn_unmuted: 'è§£é™¤é™éŸ³',
            mute_btn_muted: 'é™éŸ³',
            // è®¾ç½®å¼¹çª—
            settings_title: 'âš™ï¸ ç¨‹åºè®¾ç½®',
            grid_size_label: 'ç”»é¢åˆ†å‰²æ¨¡å¼ï¼š',
            grid_1x1: '1x1 (å•ç”»é¢)',
            grid_2x2: '2x2 (å››åˆ†å±)',
            grid_3x3: '3x3 (ä¹åˆ†å±)',
            grid_size_hint: 'æ›´æ”¹åˆ†å‰²æ¨¡å¼å°†é‡ç½®æ‰€æœ‰ç”»é¢ã€‚',
            language_label: 'é€‰æ‹©è¯­è¨€ï¼š',
            labels_toggle_label: 'æ˜¾ç¤ºæ ‡ç­¾ï¼š',
            labels_toggle_hide: 'éšè—æ ‡ç­¾',
            labels_toggle_show: 'æ˜¾ç¤ºæ ‡ç­¾',
            map_overlay_label: 'åœ°å›¾æ ‡è®°æ˜¾ç¤ºï¼š',
            map_overlay_hide: 'éšè—åœ°å›¾æ ‡è®°',
            map_overlay_show: 'æ˜¾ç¤ºåœ°å›¾æ ‡è®°',
            settings_close_btn: 'å…³é—­è®¾ç½®',
            // åœ°å›¾æ ‡è®°
            map_badge_default: 'ç‚¹å‡»ä¸‹æ–¹æŒ‰é’®é€‰æ‹©ç”»é¢',
            map_badge_selected: 'é€‰å®šç”»é¢ï¼š',
            // éŸ³ä¹æ§åˆ¶
            music_prev: 'â®ï¸',
            music_play_pause: 'â¸ï¸',
            music_next: 'â­ï¸',
            music_mode: 'ğŸ”„',
            music_queue_btn: 'ğŸµ',
            music_mode_title: 'ğŸ”„ éŸ³ä¹æ’­æ”¾æ¨¡å¼',
            music_mode_info: 'é€‰æ‹©æ’­æ”¾åˆ—è¡¨ç»“æŸåçš„è¡Œä¸º:',
            music_mode_loop: 'ğŸ”„ å¾ªç¯æ’­æ”¾ (Loop)',
            music_mode_shuffle: 'ğŸ”€ éšæœºæ’­æ”¾ (Shuffle)',
            music_mode_stop: 'ğŸ›‘ åœæ­¢æ’­æ”¾ (Stop)',
            music_mode_current: 'å½“å‰æ¨¡å¼ï¼š',
            // ç‚¹æ­Œå¼¹çª—
            request_title: 'ğŸ¶ ç‚¹æ­Œæˆ–æ’­æ”¾åˆ—è¡¨',
            request_info: 'è¯·è¾“å…¥ YouTube è§†é¢‘ ID (å•æ›²) æˆ–æ’­æ”¾åˆ—è¡¨ ID (åˆ—è¡¨):',
            request_play_single: 'æ’­æ”¾å•æ›²',
            request_play_list: 'æ’­æ”¾åˆ—è¡¨',
            request_status_single: 'å°è¯•æ’­æ”¾å•æ›² ID:',
            request_status_list: 'å°è¯•æ’­æ”¾åˆ—è¡¨ ID:',
            request_close_btn: 'å…³é—­',
            // é˜Ÿåˆ—/åˆ—è¡¨å¼¹çª—
            queue_title: 'ğŸµ æ’­æ”¾åˆ—è¡¨/å•æ›²é˜Ÿåˆ—çŠ¶æ€',
            queue_current_playlist: 'å½“å‰æ’­æ”¾åˆ—è¡¨ IDï¼š',
            queue_mode: 'æ¨¡å¼ï¼š',
            queue_mode_loop: 'å¾ªç¯',
            queue_mode_shuffle: 'éšæœº',
            queue_mode_stop: 'åœæ­¢',
            queue_empty_queue: 'é˜Ÿåˆ—ä¸ºç©ºï¼Œè¯·ç‚¹æ­Œæˆ–æ’­æ”¾åˆ—è¡¨ã€‚',
            queue_playlist_pending: 'åˆ—è¡¨åŠ è½½ä¸­ï¼š',
            queue_play_index: 'æ’­æ”¾æ­¤å¤„',
            queue_mode_index: 'æ¨¡å¼åˆ‡æ¢è‡³æ­¤',
        },
        'ja-JP': {
            page_title: 'å°æ¹¾ãƒ©ã‚¤ãƒ–ãƒãƒ«ãƒãƒ“ãƒ¥ãƒ¼ãƒ¢ãƒ‹ã‚¿ãƒ¼',
            control_label: 'å°æ¹¾ãƒ©ã‚¤ãƒ–ãƒãƒ«ãƒãƒ“ãƒ¥ãƒ¼ãƒ¢ãƒ‹ã‚¿ãƒ¼',
            region_all: 'å…¨åœ°åŸŸ',
            region_1: 'åŒ—éƒ¨',
            region_2: 'ä¸­éƒ¨',
            region_3: 'å—éƒ¨',
            region_4: 'æ±éƒ¨',
            region_5: 'é›¢å³¶',
            select_cam: 'ã‚«ãƒ¡ãƒ©',
            fullscreen_btn: 'å…¨ç”»é¢',
            fullscreen_exit: 'å…¨ç”»é¢è§£é™¤',
            settings_btn: 'âš™ï¸ è¨­å®š',
            music_request_btn: 'ğŸ¶ ãƒªã‚¯ã‚¨ã‚¹ãƒˆ/ãƒªã‚¹ãƒˆ',
            loading: 'èª­ã¿è¾¼ã¿ä¸­...',
            error: 'ã‚¨ãƒ©ãƒ¼ï¼šèª­ã¿è¾¼ã¿å¤±æ•—',
            paused: 'ä¸€æ™‚åœæ­¢ä¸­',
            ended: 'çµ‚äº†',
            unstarted: 'æœªé–‹å§‹',
            cued: 'ã‚­ãƒ¥ãƒ¼æ¸ˆã¿',
            // Mute
            mute_btn_unmuted: 'ãƒŸãƒ¥ãƒ¼ãƒˆè§£é™¤',
            mute_btn_muted: 'ãƒŸãƒ¥ãƒ¼ãƒˆ',
            // Settings
            settings_title: 'âš™ï¸ ãƒ—ãƒ­ã‚°ãƒ©ãƒ è¨­å®š',
            grid_size_label: 'ç”»é¢åˆ†å‰²ãƒ¢ãƒ¼ãƒ‰:',
            grid_1x1: '1x1 (ã‚·ãƒ³ã‚°ãƒ«)',
            grid_2x2: '2x2 (å››åˆ†å‰²)',
            grid_3x3: '3x3 (ä¹åˆ†å‰²)',
            grid_size_hint: 'åˆ†å‰²ãƒ¢ãƒ¼ãƒ‰ã‚’å¤‰æ›´ã™ã‚‹ã¨ã€ã™ã¹ã¦ã®ç”»é¢ãŒãƒªã‚»ãƒƒãƒˆã•ã‚Œã¾ã™ã€‚',
            language_label: 'è¨€èªã‚’é¸æŠ:',
            labels_toggle_label: 'ãƒ©ãƒ™ãƒ«è¡¨ç¤º:',
            labels_toggle_hide: 'ãƒ©ãƒ™ãƒ«ã‚’éè¡¨ç¤º',
            labels_toggle_show: 'ãƒ©ãƒ™ãƒ«ã‚’è¡¨ç¤º',
            map_overlay_label: 'åœ°å›³ã‚ªãƒ¼ãƒãƒ¼ãƒ¬ã‚¤è¡¨ç¤º:',
            map_overlay_hide: 'åœ°å›³ã‚ªãƒ¼ãƒãƒ¼ãƒ¬ã‚¤ã‚’éè¡¨ç¤º',
            map_overlay_show: 'åœ°å›³ã‚ªãƒ¼ãƒãƒ¼ãƒ¬ã‚¤ã‚’è¡¨ç¤º',
            settings_close_btn: 'è¨­å®šã‚’é–‰ã˜ã‚‹',
            // Map Overlay
            map_badge_default: 'ä¸‹ã®ãƒœã‚¿ãƒ³ã‚’ã‚¯ãƒªãƒƒã‚¯ã—ã¦ãƒ“ãƒ¥ãƒ¼ã‚’é¸æŠã—ã¦ãã ã•ã„',
            map_badge_selected: 'é¸æŠä¸­ã®ãƒ“ãƒ¥ãƒ¼:',
            // Music Control
            music_prev: 'â®ï¸',
            music_play_pause: 'â¸ï¸',
            music_next: 'â­ï¸',
            music_mode: 'ğŸ”„',
            music_queue_btn: 'ğŸµ',
            music_mode_title: 'ğŸ”„ éŸ³æ¥½å†ç”Ÿãƒ¢ãƒ¼ãƒ‰',
            music_mode_info: 'ãƒ—ãƒ¬ã‚¤ãƒªã‚¹ãƒˆçµ‚äº†å¾Œã®å‹•ä½œã‚’é¸æŠã—ã¦ãã ã•ã„:',
            music_mode_loop: 'ğŸ”„ ãƒ«ãƒ¼ãƒ— (Loop)',
            music_mode_shuffle: 'ğŸ”€ ã‚·ãƒ£ãƒƒãƒ•ãƒ« (Shuffle)',
            music_mode_stop: 'ğŸ›‘ åœæ­¢ (Stop)',
            music_mode_current: 'ç¾åœ¨ã®ãƒ¢ãƒ¼ãƒ‰:',
            // Request Modal
            request_title: 'ğŸ¶ æ›²ã¾ãŸã¯ãƒ—ãƒ¬ã‚¤ãƒªã‚¹ãƒˆã®ãƒªã‚¯ã‚¨ã‚¹ãƒˆ',
            request_info: 'YouTubeå‹•ç”»IDï¼ˆå˜æ›²ï¼‰ã¾ãŸã¯ãƒ—ãƒ¬ã‚¤ãƒªã‚¹ãƒˆIDï¼ˆãƒªã‚¹ãƒˆï¼‰ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„:',
            request_play_single: 'å˜æ›²ã‚’å†ç”Ÿ',
            request_play_list: 'ãƒ—ãƒ¬ã‚¤ãƒªã‚¹ãƒˆã‚’å†ç”Ÿ',
            request_status_single: 'å˜æ›²IDã®å†ç”Ÿã‚’è©¦è¡Œä¸­:',
            request_status_list: 'ãƒ—ãƒ¬ã‚¤ãƒªã‚¹ãƒˆIDã®å†ç”Ÿã‚’è©¦è¡Œä¸­:',
            request_close_btn: 'é–‰ã˜ã‚‹',
            // Queue/List Modal
            queue_title: 'ğŸµ ãƒ—ãƒ¬ã‚¤ãƒªã‚¹ãƒˆ/ã‚­ãƒ¥ãƒ¼ã®ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹',
            queue_current_playlist: 'ç¾åœ¨ã®ãƒ—ãƒ¬ã‚¤ãƒªã‚¹ãƒˆIDï¼š',
            queue_mode: 'ãƒ¢ãƒ¼ãƒ‰ï¼š',
            queue_mode_loop: 'ãƒ«ãƒ¼ãƒ—',
            queue_mode_shuffle: 'ã‚·ãƒ£ãƒƒãƒ•ãƒ«',
            queue_mode_stop: 'åœæ­¢',
            queue_empty_queue: 'ã‚­ãƒ¥ãƒ¼ã¯ç©ºã§ã™ã€‚æ›²ã¾ãŸã¯ãƒ—ãƒ¬ã‚¤ãƒªã‚¹ãƒˆã‚’ãƒªã‚¯ã‚¨ã‚¹ãƒˆã—ã¦ãã ã•ã„ã€‚',
            queue_playlist_pending: 'ãƒ—ãƒ¬ã‚¤ãƒªã‚¹ãƒˆèª­ã¿è¾¼ã¿ä¸­ï¼š',
            queue_play_index: 'ã“ã“ã§å†ç”Ÿ',
            queue_mode_index: 'ãƒ¢ãƒ¼ãƒ‰ã‚’ã“ã“ã«è¨­å®š',
        },
        'ko-KR': {
            page_title: 'ëŒ€ë§Œ ë¼ì´ë¸Œ ë©€í‹°ë·° ëª¨ë‹ˆí„°',
            control_label: 'ëŒ€ë§Œ ë¼ì´ë¸Œ ë©€í‹°ë·° ëª¨ë‹ˆí„°',
            region_all: 'ì „ì²´ ì§€ì—­',
            region_1: 'ë¶ë¶€',
            region_2: 'ì¤‘ë¶€',
            region_3: 'ë‚¨ë¶€',
            region_4: 'ë™ë¶€',
            region_5: 'ë„ì„œ',
            select_cam: 'ì¹´ë©”ë¼',
            fullscreen_btn: 'ì „ì²´ í™”ë©´',
            fullscreen_exit: 'ì „ì²´ í™”ë©´ ì¢…ë£Œ',
            settings_btn: 'âš™ï¸ ì„¤ì •',
            music_request_btn: 'ğŸ¶ ìš”ì²­/ëª©ë¡',
            loading: 'ë¡œë”© ì¤‘...',
            error: 'ì˜¤ë¥˜: ë¡œë“œ ì‹¤íŒ¨',
            paused: 'ì¼ì‹œ ì¤‘ì§€ë¨',
            ended: 'ì¢…ë£Œë¨',
            unstarted: 'ì‹œì‘ë˜ì§€ ì•ŠìŒ',
            cued: 'íì— ì¶”ê°€ë¨',
            // Mute
            mute_btn_unmuted: 'ìŒì†Œê±° í•´ì œ',
            mute_btn_muted: 'ìŒì†Œê±°',
            // Settings
            settings_title: 'âš™ï¸ í”„ë¡œê·¸ë¨ ì„¤ì •',
            grid_size_label: 'í™”ë©´ ë¶„í•  ëª¨ë“œ:',
            grid_1x1: '1x1 (ë‹¨ì¼)',
            grid_2x2: '2x2 (4ë¶„í• )',
            grid_3x3: '3x3 (9ë¶„í• )',
            grid_size_hint: 'ë¶„í•  ëª¨ë“œë¥¼ ë³€ê²½í•˜ë©´ ëª¨ë“  í™”ë©´ì´ ì¬ì„¤ì •ë©ë‹ˆë‹¤.',
            language_label: 'ì–¸ì–´ ì„ íƒ:',
            labels_toggle_label: 'ë¼ë²¨ í‘œì‹œ:',
            labels_toggle_hide: 'ë¼ë²¨ ìˆ¨ê¸°ê¸°',
            labels_toggle_show: 'ë¼ë²¨ í‘œì‹œ',
            map_overlay_label: 'ì§€ë„ ì˜¤ë²„ë ˆì´ í‘œì‹œ:',
            map_overlay_hide: 'ì§€ë„ ì˜¤ë²„ë ˆì´ ìˆ¨ê¸°ê¸°',
            map_overlay_show: 'ì§€ë„ ì˜¤ë²„ë ˆì´ í‘œì‹œ',
            settings_close_btn: 'ì„¤ì • ë‹«ê¸°',
            // Map Overlay
            map_badge_default: 'ì•„ë˜ ë²„íŠ¼ì„ í´ë¦­í•˜ì—¬ ë·°ë¥¼ ì„ íƒí•˜ì‹­ì‹œì˜¤',
            map_badge_selected: 'ì„ íƒëœ ë·°:',
            // Music Control
            music_prev: 'â®ï¸',
            music_play_pause: 'â¸ï¸',
            music_next: 'â­ï¸',
            music_mode: 'ğŸ”„',
            music_queue_btn: 'ğŸµ',
            music_mode_title: 'ğŸ”„ ìŒì•… ì¬ìƒ ëª¨ë“œ',
            music_mode_info: 'ì¬ìƒ ëª©ë¡ ì¢…ë£Œ í›„ ë™ì‘ ì„ íƒ:',
            music_mode_loop: 'ğŸ”„ ë°˜ë³µ ì¬ìƒ (Loop)',
            music_mode_shuffle: 'ğŸ”€ ë¬´ì‘ìœ„ ì¬ìƒ (Shuffle)',
            music_mode_stop: 'ğŸ›‘ ì¬ìƒ ì¤‘ì§€ (Stop)',
            music_mode_current: 'í˜„ì¬ ëª¨ë“œ:',
            // Request Modal
            request_title: 'ğŸ¶ ë…¸ë˜ ë˜ëŠ” ì¬ìƒ ëª©ë¡ ìš”ì²­',
            request_info: 'YouTube ë¹„ë””ì˜¤ ID (ë‹¨ì¼) ë˜ëŠ” ì¬ìƒ ëª©ë¡ ID (ëª©ë¡)ë¥¼ ì…ë ¥í•˜ì‹­ì‹œì˜¤:',
            request_play_single: 'ë‹¨ì¼ ë…¸ë˜ ì¬ìƒ',
            request_play_list: 'ì¬ìƒ ëª©ë¡ ì¬ìƒ',
            request_status_single: 'ë‹¨ì¼ ID ì¬ìƒ ì‹œë„ ì¤‘:',
            request_status_list: 'ì¬ìƒ ëª©ë¡ ID ì¬ìƒ ì‹œë„ ì¤‘:',
            request_close_btn: 'ë‹«ê¸°',
            // Queue/List Modal
            queue_title: 'ğŸµ ì¬ìƒ ëª©ë¡/í ìƒíƒœ',
            queue_current_playlist: 'í˜„ì¬ ì¬ìƒ ëª©ë¡ IDï¼š',
            queue_mode: 'ëª¨ë“œï¼š',
            queue_mode_loop: 'ë°˜ë³µ',
            queue_mode_shuffle: 'ë¬´ì‘ìœ„',
            queue_mode_stop: 'ì¤‘ì§€',
            queue_empty_queue: 'íê°€ ë¹„ì–´ ìˆìŠµë‹ˆë‹¤. ë…¸ë˜ë‚˜ ì¬ìƒ ëª©ë¡ì„ ìš”ì²­í•˜ì‹­ì‹œì˜¤.',
            queue_playlist_pending: 'ì¬ìƒ ëª©ë¡ ë¡œë”© ì¤‘:',
            queue_play_index: 'ì—¬ê¸°ì„œ ì¬ìƒ',
            queue_mode_index: 'ì—¬ê¸°ì— ëª¨ë“œ ì„¤ì •',
        },
        'th-TH': {
            page_title: 'à¸à¸²à¸£à¸•à¸£à¸§à¸ˆà¸ªà¸­à¸šà¸«à¸¥à¸²à¸¢à¸¡à¸¸à¸¡à¸¡à¸­à¸‡à¸ªà¸”à¸‚à¸­à¸‡à¹„à¸•à¹‰à¸«à¸§à¸±à¸™',
            control_label: 'à¸à¸²à¸£à¸•à¸£à¸§à¸ˆà¸ªà¸­à¸šà¸«à¸¥à¸²à¸¢à¸¡à¸¸à¸¡à¸¡à¸­à¸‡à¸ªà¸”à¸‚à¸­à¸‡à¹„à¸•à¹‰à¸«à¸§à¸±à¸™',
            region_all: 'à¸—à¸¸à¸à¸ à¸¹à¸¡à¸´à¸ à¸²à¸„',
            region_1: 'à¸ à¸²à¸„à¹€à¸«à¸™à¸·à¸­',
            region_2: 'à¸ à¸²à¸„à¸à¸¥à¸²à¸‡',
            region_3: 'à¸ à¸²à¸„à¹ƒà¸•à¹‰',
            region_4: 'à¸ à¸²à¸„à¸•à¸°à¸§à¸±à¸™à¸­à¸­à¸',
            region_5: 'à¸«à¸¡à¸¹à¹ˆà¹€à¸à¸²à¸°',
            select_cam: 'à¸à¸¥à¹‰à¸­à¸‡',
            fullscreen_btn: 'à¹€à¸•à¹‡à¸¡à¸«à¸™à¹‰à¸²à¸ˆà¸­',
            fullscreen_exit: 'à¸­à¸­à¸à¸ˆà¸²à¸à¹€à¸•à¹‡à¸¡à¸«à¸™à¹‰à¸²à¸ˆà¸­',
            settings_btn: 'âš™ï¸ à¸à¸²à¸£à¸•à¸±à¹‰à¸‡à¸„à¹ˆà¸²',
            music_request_btn: 'ğŸ¶ à¸‚à¸­à¹€à¸à¸¥à¸‡/à¸£à¸²à¸¢à¸à¸²à¸£',
            loading: 'à¸à¸³à¸¥à¸±à¸‡à¹‚à¸«à¸¥à¸”...',
            error: 'à¸‚à¹‰à¸­à¸œà¸´à¸”à¸à¸¥à¸²à¸”: à¹‚à¸«à¸¥à¸”à¸¥à¹‰à¸¡à¹€à¸«à¸¥à¸§',
            paused: 'à¸«à¸¢à¸¸à¸”à¸Šà¸±à¹ˆà¸§à¸„à¸£à¸²à¸§',
            ended: 'à¸ªà¸´à¹‰à¸™à¸ªà¸¸à¸”à¹à¸¥à¹‰à¸§',
            unstarted: 'à¸¢à¸±à¸‡à¹„à¸¡à¹ˆà¹€à¸£à¸´à¹ˆà¸¡',
            cued: 'à¹€à¸‚à¹‰à¸²à¸„à¸´à¸§à¹à¸¥à¹‰à¸§',
            // Mute
            mute_btn_unmuted: 'à¹€à¸›à¸´à¸”à¹€à¸ªà¸µà¸¢à¸‡',
            mute_btn_muted: 'à¸›à¸´à¸”à¹€à¸ªà¸µà¸¢à¸‡',
            // Settings
            settings_title: 'âš™ï¸ à¸à¸²à¸£à¸•à¸±à¹‰à¸‡à¸„à¹ˆà¸²à¹‚à¸›à¸£à¹à¸à¸£à¸¡',
            grid_size_label: 'à¹‚à¸«à¸¡à¸”à¹à¸šà¹ˆà¸‡à¸«à¸™à¹‰à¸²à¸ˆà¸­:',
            grid_1x1: '1x1 (à¹€à¸”à¸µà¸¢à¸§)',
            grid_2x2: '2x2 (à¸ªà¸µà¹ˆà¸ªà¹ˆà¸§à¸™)',
            grid_3x3: '3x3 (à¹€à¸à¹‰à¸²à¸ªà¹ˆà¸§à¸™)',
            grid_size_hint: 'à¸à¸²à¸£à¹€à¸›à¸¥à¸µà¹ˆà¸¢à¸™à¹‚à¸«à¸¡à¸”à¹à¸šà¹ˆà¸‡à¸«à¸™à¹‰à¸²à¸ˆà¸­à¸ˆà¸°à¸£à¸µà¹€à¸‹à¹‡à¸•à¸—à¸¸à¸à¸«à¸™à¹‰à¸²à¸ˆà¸­',
            language_label: 'à¹€à¸¥à¸·à¸­à¸à¸ à¸²à¸©à¸²:',
            labels_toggle_label: 'à¹à¸ªà¸”à¸‡à¸›à¹‰à¸²à¸¢à¸à¸³à¸à¸±à¸š:',
            labels_toggle_hide: 'à¸‹à¹ˆà¸­à¸™à¸›à¹‰à¸²à¸¢à¸à¸³à¸à¸±à¸š',
            labels_toggle_show: 'à¹à¸ªà¸”à¸‡à¸›à¹‰à¸²à¸¢à¸à¸³à¸à¸±à¸š',
            map_overlay_label: 'à¹à¸ªà¸”à¸‡à¹à¸œà¸™à¸—à¸µà¹ˆà¸‹à¹‰à¸­à¸™à¸—à¸±à¸š:',
            map_overlay_hide: 'à¸‹à¹ˆà¸­à¸™à¹à¸œà¸™à¸—à¸µà¹ˆà¸‹à¹‰à¸­à¸™à¸—à¸±à¸š',
            map_overlay_show: 'à¹à¸ªà¸”à¸‡à¹à¸œà¸™à¸—à¸µà¹ˆà¸‹à¹‰à¸­à¸™à¸—à¸±à¸š',
            settings_close_btn: 'à¸›à¸´à¸”à¸à¸²à¸£à¸•à¸±à¹‰à¸‡à¸„à¹ˆà¸²',
            // Map Overlay
            map_badge_default: 'à¸„à¸¥à¸´à¸à¸›à¸¸à¹ˆà¸¡à¸”à¹‰à¸²à¸™à¸¥à¹ˆà¸²à¸‡à¹€à¸à¸·à¹ˆà¸­à¹€à¸¥à¸·à¸­à¸à¸¡à¸¸à¸¡à¸¡à¸­à¸‡',
            map_badge_selected: 'à¸¡à¸¸à¸¡à¸¡à¸­à¸‡à¸—à¸µà¹ˆà¹€à¸¥à¸·à¸­à¸:',
            // Music Control
            music_prev: 'â®ï¸',
            music_play_pause: 'â¸ï¸',
            music_next: 'â­ï¸',
            music_mode: 'ğŸ”„',
            music_queue_btn: 'ğŸµ',
            music_mode_title: 'ğŸ”„ à¹‚à¸«à¸¡à¸”à¹€à¸¥à¹ˆà¸™à¹€à¸à¸¥à¸‡',
            music_mode_info: 'à¹€à¸¥à¸·à¸­à¸à¸à¸²à¸£à¸à¸£à¸°à¸—à¸³à¸«à¸¥à¸±à¸‡à¸ˆà¸²à¸à¸£à¸²à¸¢à¸à¸²à¸£à¹€à¸à¸¥à¸‡à¸ªà¸´à¹‰à¸™à¸ªà¸¸à¸”:',
            music_mode_loop: 'ğŸ”„ à¹€à¸¥à¹ˆà¸™à¸‹à¹‰à¸³ (Loop)',
            music_mode_shuffle: 'ğŸ”€ à¸ªà¸¸à¹ˆà¸¡ (Shuffle)',
            music_mode_stop: 'ğŸ›‘ à¸«à¸¢à¸¸à¸” (Stop)',
            music_mode_current: 'à¹‚à¸«à¸¡à¸”à¸›à¸±à¸ˆà¸ˆà¸¸à¸šà¸±à¸™:',
            // Request Modal
            request_title: 'ğŸ¶ à¸‚à¸­à¹€à¸à¸¥à¸‡à¸«à¸£à¸·à¸­à¸£à¸²à¸¢à¸à¸²à¸£à¹€à¸à¸¥à¸‡',
            request_info: 'à¸›à¹‰à¸­à¸™ YouTube Video ID (à¹€à¸à¸¥à¸‡à¹€à¸”à¸µà¸¢à¸§) à¸«à¸£à¸·à¸­ Playlist ID (à¸£à¸²à¸¢à¸à¸²à¸£):',
            request_play_single: 'à¹€à¸¥à¹ˆà¸™à¹€à¸à¸¥à¸‡à¹€à¸”à¸µà¸¢à¸§',
            request_play_list: 'à¹€à¸¥à¹ˆà¸™à¸£à¸²à¸¢à¸à¸²à¸£à¹€à¸à¸¥à¸‡',
            request_status_single: 'à¸à¸³à¸¥à¸±à¸‡à¸à¸¢à¸²à¸¢à¸²à¸¡à¹€à¸¥à¹ˆà¸™ ID à¹€à¸à¸¥à¸‡à¹€à¸”à¸µà¸¢à¸§:',
            request_status_list: 'à¸à¸³à¸¥à¸±à¸‡à¸à¸¢à¸²à¸¢à¸²à¸¡à¹€à¸¥à¹ˆà¸™ ID à¸£à¸²à¸¢à¸à¸²à¸£à¹€à¸à¸¥à¸‡:',
            request_close_btn: 'à¸›à¸´à¸”',
            // Queue/List Modal
            queue_title: 'ğŸµ à¸ªà¸–à¸²à¸™à¸°à¸£à¸²à¸¢à¸à¸²à¸£à¹€à¸à¸¥à¸‡/à¸„à¸´à¸§',
            queue_current_playlist: 'ID à¸£à¸²à¸¢à¸à¸²à¸£à¹€à¸à¸¥à¸‡à¸›à¸±à¸ˆà¸ˆà¸¸à¸šà¸±à¸™ï¼š',
            queue_mode: 'à¹‚à¸«à¸¡à¸”ï¼š',
            queue_mode_loop: 'à¸§à¸™à¸‹à¹‰à¸³',
            queue_mode_shuffle: 'à¸ªà¸¸à¹ˆà¸¡',
            queue_mode_stop: 'à¸«à¸¢à¸¸à¸”',
            queue_empty_queue: 'à¸„à¸´à¸§à¸§à¹ˆà¸²à¸‡à¹€à¸›à¸¥à¹ˆà¸² à¹‚à¸›à¸£à¸”à¸‚à¸­à¹€à¸à¸¥à¸‡à¸«à¸£à¸·à¸­à¸£à¸²à¸¢à¸à¸²à¸£à¹€à¸à¸¥à¸‡',
            queue_playlist_pending: 'à¸à¸³à¸¥à¸±à¸‡à¹‚à¸«à¸¥à¸”à¸£à¸²à¸¢à¸à¸²à¸£à¹€à¸à¸¥à¸‡:',
            queue_play_index: 'à¹€à¸¥à¹ˆà¸™à¸—à¸µà¹ˆà¸™à¸µà¹ˆ',
            queue_mode_index: 'à¸•à¸±à¹‰à¸‡à¸„à¹ˆà¸²à¹‚à¸«à¸¡à¸”à¸—à¸µà¹ˆà¸™à¸µà¹ˆ',
        },
    };

    // ----------------------------------------------------------------------
    // èªè¨€å‡½æ•¸
    // ----------------------------------------------------------------------
    function getTranslation(key, ...args) {
        const pack = LANGUAGE_PACKS[currentLang] || LANGUAGE_PACKS['zh-TW'];
        let translation = pack[key] || LANGUAGE_PACKS['zh-TW'][key] || key;
        
        args.forEach((arg, index) => {
            // æ›¿æ› ${index} æ ¼å¼çš„åƒæ•¸
            translation = translation.replace(new RegExp(`\\$\\{${index}\\}`, 'g'), arg);
        });

        return translation;
    }

    function updateUIForLanguage() {
        document.getElementById('htmlLang').lang = currentLang;
        document.getElementById('pageTitle').textContent = getTranslation('page_title');
        document.getElementById('controlLabel').textContent = getTranslation('control_label');
        
        // æ›´æ–°æ§åˆ¶æŒ‰éˆ•
        document.getElementById('region-0').textContent = getTranslation('region_all');
        document.getElementById('region-1').textContent = getTranslation('region_1');
        document.getElementById('region-2').textContent = getTranslation('region_2');
        document.getElementById('region-3').textContent = getTranslation('region_3');
        document.getElementById('region-4').textContent = getTranslation('region_4');
        document.getElementById('region-5').textContent = getTranslation('region_5');
        
        // æ›´æ–°å…¶ä»–å›ºå®šæŒ‰éˆ•
        document.getElementById('fullscreenBtn').textContent = document.fullscreenElement ? getTranslation('fullscreen_exit') : getTranslation('fullscreen_btn');
        document.getElementById('settingsBtn').textContent = getTranslation('settings_btn');
        document.getElementById('settingsBtn').title = getTranslation('settings_title');
        document.getElementById('requestBtn').textContent = getTranslation('music_request_btn');
        document.getElementById('requestBtn').title = getTranslation('music_request_btn');
        
        // æ›´æ–°å‹•æ…‹ç”Ÿæˆçš„ç•«é¢é¸æ“‡æŒ‰éˆ•
        updateCamSelectButtons(getGridDimension() * getGridDimension());
        
        // æ›´æ–°æ‰€æœ‰æ¨™ç±¤
        ALL_STREAMS_KEYS.forEach((key, index) => {
            const labelEl = document.getElementById(LABEL_IDS[index]);
            if (labelEl) {
                const stream = ALL_STREAMS[key];
                const player = players[index];
                let statusText = '';
                
                if (player) {
                    try {
                        const state = player.getPlayerState();
                        if (state === YT.PlayerState.UNSTARTED) statusText = getTranslation('unstarted');
                        else if (state === YT.PlayerState.ENDED) statusText = getTranslation('ended');
                        else if (state === YT.PlayerState.PLAYING) statusText = 'PLAYING';
                        else if (state === YT.PlayerState.PAUSED) statusText = getTranslation('paused');
                        else if (state === YT.PlayerState.BUFFERING) statusText = getTranslation('loading');
                        else if (state === YT.PlayerState.CUED) statusText = getTranslation('cued');
                    } catch (e) {
                        statusText = getTranslation('loading');
                    }
                } else {
                    statusText = getTranslation('loading');
                }
                
                labelEl.innerHTML = `${stream.place} (${stream.region}) - ${statusText} <span class="source-on-screen">${key}</span>`;
            }
        });
        
        // æ›´æ–°è¨­å®šå½ˆçª—
        document.getElementById('settingsTitle').textContent = getTranslation('settings_title');
        document.getElementById('gridSizeLabel').textContent = getTranslation('grid_size_label');
        document.getElementById('gridSizeHint').textContent = getTranslation('grid_size_hint');
        document.getElementById('grid1x1Btn').textContent = getTranslation('grid_1x1');
        document.getElementById('grid2x2Btn').textContent = getTranslation('grid_2x2');
        document.getElementById('grid3x3Btn').textContent = getTranslation('grid_3x3');
        document.getElementById('languageLabel').textContent = getTranslation('language_label');
        document.getElementById('labelsToggleLabel').textContent = getTranslation('labels_toggle_label');
        document.getElementById('mapOverlayLabel').textContent = getTranslation('map_overlay_label');
        document.getElementById('settingsCloseBtn').textContent = getTranslation('settings_close_btn');

        // æ›´æ–°éŸ³æ¨‚å½ˆçª—
        document.getElementById('requestTitle').textContent = getTranslation('request_title');
        document.getElementById('requestInfo').textContent = getTranslation('request_info');
        document.getElementById('requestPlaySingleBtn').textContent = getTranslation('request_play_single');
        document.getElementById('requestPlayListBtn').textContent = getTranslation('request_play_list');
        document.getElementById('requestCloseBtn').textContent = getTranslation('request_close_btn');
        
        document.getElementById('modeTitle').textContent = getTranslation('music_mode_title');
        document.getElementById('modeInfo').textContent = getTranslation('music_mode_info');
        document.getElementById('modeLoopBtn').textContent = getTranslation('music_mode_loop');
        document.getElementById('modeShuffleBtn').textContent = getTranslation('music_mode_shuffle');
        document.getElementById('modeStopBtn').textContent = getTranslation('music_mode_stop');
        document.getElementById('modeCloseBtn').textContent = getTranslation('request_close_btn');
        
        document.getElementById('queueTitle').textContent = getTranslation('queue_title');
        document.getElementById('queueCloseBtn').textContent = getTranslation('request_close_btn');
        
        // æ›´æ–°å…¶ä»–å‹•æ…‹æŒ‰éˆ•
        refreshMuteButtonLabel();
        updateMapOverlay(); // ç¢ºä¿åœ°åœ–æ³¨è¨˜ä¹Ÿæ›´æ–°

        // æ›´æ–°èªè¨€æŒ‰éˆ• active ç‹€æ…‹
        document.querySelectorAll('.lang-btn').forEach(btn => {
            btn.classList.toggle('active', btn.id === `lang${currentLang}Btn`);
        });
    }

    function setLanguage(lang) {
        if (!LANGUAGE_PACKS[lang]) return;
        currentLang = lang;
        localStorage.setItem(LANG_KEY, lang);
        updateUIForLanguage();
        closeMainSettingsModal();
        showMessage('Language changed to: ' + (LANGUAGE_PACKS[lang]?.page_title || lang), 'success', 3000);
    }
    
    // ----------------------------------------------------------------------
    // Grid/Cell ç›¸é—œå‡½æ•¸
    // ----------------------------------------------------------------------
    function getGridDimension() {
        if (currentGridSize === '1x1') return 1;
        if (currentGridSize === '2x2') return 2;
        if (currentGridSize === '3x3') return 3;
        return 2; // Default
    }

    function initializeGridSettings() {
        const storedGrid = localStorage.getItem('multi-view-grid');
        if (storedGrid && ['1x1', '2x2', '3x3'].includes(storedGrid)) {
            currentGridSize = storedGrid;
        }
        
        // ç¢ºä¿ body class å’Œé¸ä¸­æŒ‰éˆ•æ­£ç¢ºè¨­ç½®
        setGridSize(currentGridSize, false); // false = ä¸é‡ç½®ç•«é¢
        
        // ç¢ºä¿èªè¨€å’Œåœ°åœ–æ³¨è¨˜ç‹€æ…‹è¢«è¼‰å…¥
        document.body.classList.toggle('hide-labels', localStorage.getItem(LABELS_HIDDEN_KEY) === 'true');
        document.body.classList.toggle('hide-map-overlay', isMapOverlayHidden);
    }

    function updateCamSelectButtons(num) {
        const container = document.getElementById('camSelectButtons');
        container.innerHTML = '';
        for (let i = 0; i < num; i++) {
            const btn = document.createElement('button');
            btn.id = `camSelectBtn${i}`;
            btn.textContent = `${getTranslation('select_cam')} ${i + 1}`;
            btn.setAttribute('onclick', `selectCam(${i})`);
            if (i === selectedCamIndex) {
                btn.classList.add('active');
            }
            container.appendChild(btn);
        }
    }

    function loadRegion(region, buttonIndex) {
        currentRegion = region;
        const dimension = getGridDimension();
        const numPlayers = dimension * dimension;

        document.querySelectorAll('#regionButtons button').forEach((btn, i) => {
            btn.classList.remove('active');
            if (i === buttonIndex) btn.classList.add('active');
        });

        // ç¯©é¸å‡ºè©²åœ°å€çš„ç›´æ’­
        const filteredStreams = ALL_STREAMS_KEYS.filter(key => 
            region === 'all' || ALL_STREAMS[key].region === region || REGION_GROUPS[region].includes(ALL_STREAMS[key].place.split('-')[0])
        );

        // æ‰“äº‚é †åº
        filteredStreams.sort(() => 0.5 - Math.random());

        // è¼‰å…¥æ–°çš„ç›´æ’­åˆ°ç•«é¢ä¸­
        for (let i = 0; i < numPlayers; i++) {
            const key = filteredStreams[i % filteredStreams.length]; // å¾ªç’°ä½¿ç”¨ç›´æ’­
            const stream = ALL_STREAMS[key];
            const playerContainerId = PLAYER_IDS[i];
            const labelElement = document.getElementById(LABEL_IDS[i]);
            
            // æ›´æ–°åœ°åœ–æ³¨è¨˜ (åœ¨ player è¼‰å…¥å‰å…ˆæ›´æ–° label çš„ place è³‡è¨Š)
            const mapPinLabel = document.getElementById(PIN_LABEL_IDS[i]);
            if(mapPinLabel) mapPinLabel.textContent = stream.place;
            updateCellMap(i);

            if (players[i]) {
                // å¦‚æœæ’­æ”¾å™¨å·²å­˜åœ¨ï¼Œç›´æ¥è¼‰å…¥æ–°å½±ç‰‡
                if (stream.isLive) {
                    players[i].loadVideoById({ 
                        videoId: stream.id, 
                        suggestedQuality: 'hd720', 
                        playerVars: { autoplay: 1, mute: 1, loop: 0, modestbranding: 1, controls: 0 } 
                    });
                } else {
                    players[i].loadVideoById({ 
                        videoId: stream.id, 
                        suggestedQuality: 'hd720', 
                        playerVars: { autoplay: 1, mute: 1, loop: 1, modestbranding: 1, controls: 0, playlist: stream.id } 
                    });
                }
                labelElement.innerHTML = `${stream.place} (${stream.region}) - ${getTranslation('loading')} <span class="source-on-screen">${key}</span>`;
            } else {
                // å¦‚æœæ’­æ”¾å™¨ä¸å­˜åœ¨ï¼Œå‰µå»ºæ–°çš„
                // æš«æ™‚ä¸å‰µå»ºï¼Œå› ç‚ºåˆå§‹åŒ–æ™‚å·²å…¨éƒ¨å‰µå»º
            }
            
            // å¼·åˆ¶è¨­å®šç‚ºéœéŸ³
            if (players[i]) {
                try { players[i].mute(); } catch(e) {}
            }
        }
        
        applyMuteStates(); // ç¢ºä¿é¸ä¸­ç•«é¢èƒ½ç™¼è²
        updateMapOverlay(); // æ›´æ–°å…¨å±€åœ°åœ–æ³¨è¨˜
    }
    
    // ----------------------------------------------------------------------
    // YouTube Player API ç›¸é—œ
    // ----------------------------------------------------------------------
    function onYouTubeIframeAPIReady() {
        initializePlayers();
        initializeMusicPlayer();
        loadRegion(currentRegion, 0); // åˆå§‹è¼‰å…¥æ‰€æœ‰åœ°å€
        initializeGridSettings(); // ç¢ºä¿ Grid å°ºå¯¸æ­£ç¢º
        updateUIForLanguage(); // æ‡‰ç”¨èªè¨€è¨­å®š
    }

    function initializePlayers() {
        const dimension = getGridDimension();
        const numPlayers = dimension * dimension;
        
        for (let i = 0; i < numPlayers; i++) {
            const key = ALL_STREAMS_KEYS[i];
            const stream = ALL_STREAMS[key];
            const playerContainerId = PLAYER_IDS[i];
            const labelElement = document.getElementById(LABEL_IDS[i]);
            
            // ç”±æ–¼ initializePlayers åªåœ¨å•Ÿå‹•æ™‚åŸ·è¡Œä¸€æ¬¡ï¼Œæˆ‘å€‘é æœŸ stream è³‡è¨Šå§‹çµ‚å­˜åœ¨
            if (stream) {
                // å‰µå»º Player
                players[i] = new YT.Player(playerContainerId, {
                    videoId: stream.id,
                    playerVars: {
                        autoplay: 1,
                        controls: 0,
                        mute: 1,
                        loop: stream.isLive ? 0 : 1, // ç›´æ’­ä¸å¾ªç’°ï¼Œéç›´æ’­å¾ªç’°
                        modestbranding: 1,
                        suggestedQuality: 'hd720',
                        playlist: stream.isLive ? undefined : stream.id // éç›´æ’­è¨­ç‚ºæ’­æ”¾åˆ—è¡¨ä»¥å¯¦ç¾å¾ªç’°
                    },
                    events: {
                        'onReady': onPlayerReady,
                        'onStateChange': onPlayerStateChange,
                        'onError': onPlayerError
                    }
                });
                labelElement.innerHTML = `${stream.place} (${stream.region}) - ${getTranslation('loading')} <span class="source-on-screen">${key}</span>`;
            } else {
                // å¦‚æœ stream ä¸å­˜åœ¨ (ä¾‹å¦‚ 3x3 æ¨¡å¼ä¸‹ç•«é¢æ•¸è¶…é stream ç¸½æ•¸)ï¼Œæ¸…ç©ºç•«é¢
                const cell = document.querySelector(`.cell[data-index="${i}"]`);
                if (cell) {
                    cell.style.display = 'none';
                }
                players[i] = null; // ç¢ºä¿ players é™£åˆ—ä¸­å°æ‡‰ä½ç½®ç‚º null
            }
        }
        
        // ç¢ºä¿æ‰€æœ‰äº’å‹•é®ç½©å¯é»æ“Š
        document.querySelectorAll('.interaction-shield').forEach((shield, index) => {
            shield.onclick = () => selectCam(index);
        });
        
        selectCam(selectedCamIndex); // ç¢ºä¿åˆå§‹é¸ä¸­ç•«é¢è¢«æ¨™è¨˜
    }

    // ----------------------------------------------------------------------
    // æ’­æ”¾å™¨äº‹ä»¶å‡½æ•¸
    // ----------------------------------------------------------------------
    
    /**
     * @param {YT.PlayerEvent} event 
     */
    function onPlayerReady(event) {
        try { 
            // ç§»é™¤å¼·åˆ¶ muteï¼Œäº¤çµ¦ applyMuteStates è™•ç†
            event.target.setVolume(100); 
            event.target.playVideo();
        } catch (e) {
            console.warn("Player ready failed to play or mute:", e);
        }
        applyMuteStates(); // ä½¿ç”¨æ–°çš„éœéŸ³é‚è¼¯åŒæ­¥ç‹€æ…‹
    }

    /**
     * @param {YT.PlayerEvent} event 
     */
    function onPlayerStateChange(event) {
        const playerIndex = players.findIndex(p => p === event.target);
        if (playerIndex === -1) return;

        const labelElement = document.getElementById(LABEL_IDS[playerIndex]);
        const streamKey = ALL_STREAMS_KEYS[playerIndex];
        const stream = ALL_STREAMS[streamKey];
        
        if (!stream) return; // å®‰å…¨æª¢æŸ¥

        let statusText = '';
        let isError = false;

        // >>> START: ä¿®å¾© 2.txt çš„ç›´æ’­ç•«é¢æ’¥æ”¾åŠŸèƒ½ (CUED/UNSTARTED å¼·åˆ¶æ’­æ”¾)
        if (event.data === YT.PlayerState.CUED || event.data === YT.PlayerState.UNSTARTED) {
            // å½±ç‰‡è¢«æ’å…¥ä½‡åˆ—æˆ–æœªé–‹å§‹ï¼Œå¼·åˆ¶æ’­æ”¾ (ç”¨æ–¼ä¿®å¾©ç›´æ’­ç•«é¢å¡ä½)
            try { 
                event.target.playVideo();
                statusText = getTranslation('loading');
            } catch(e) {
                statusText = getTranslation('loading');
            }
            labelElement.innerHTML = `${stream.place} (${stream.region}) - ${statusText} <span class="source-on-screen">${streamKey}</span>`;
            return; 
        }
        // <<< END: ä¿®å¾©ç›´æ’­ç•«é¢æ’¥æ”¾åŠŸèƒ½

        if (event.data === YT.PlayerState.PLAYING) {
            statusText = 'PLAYING';
            isReloading[playerIndex] = false;
        } else if (event.data === YT.PlayerState.PAUSED) {
            statusText = getTranslation('paused');
        } else if (event.data === YT.PlayerState.ENDED) {
            statusText = getTranslation('ended');
            // å¦‚æœæ˜¯éç›´æ’­ï¼Œä¸”å·²è¨­ç½® loop=1ï¼Œå®ƒæœƒè‡ªå‹•é‡æ’­ï¼Œä¸éœ€è¦é¡å¤–æ“ä½œ
        } else if (event.data === YT.PlayerState.BUFFERING) {
            statusText = getTranslation('loading');
        }

        // å˜—è©¦è‡ªå‹•é‡æ–°è¼‰å…¥ (é‡å°ç›´æ’­ä¸”éé‡è¼‰ä¸­)
        if (stream.isLive && event.data !== YT.PlayerState.PLAYING && !isReloading[playerIndex]) {
             // æª¢æŸ¥æ˜¯å¦è¶…éå†·å»æ™‚é–“ (60ç§’)
            const now = Date.now();
            if (now - lastReloadAt[playerIndex] > RELOAD_COOLDOWN_MS) {
                isReloading[playerIndex] = true;
                lastReloadAt[playerIndex] = now;
                
                setTimeout(() => {
                    if (event.target.loadVideoById) {
                        event.target.loadVideoById({ 
                            videoId: stream.id, 
                            suggestedQuality: 'hd720', 
                            playerVars: { autoplay: 1, mute: 1, loop: 0, modestbranding: 1, controls: 0 } 
                        });
                        labelElement.innerHTML = `${stream.place} (${stream.region}) - ${getTranslation('loading')} (Auto Reloading...) <span class="source-on-screen">${streamKey}</span>`;
                        isReloading[playerIndex] = false; // é‡è¼‰å¾Œè§£é™¤æ¨™è¨˜
                        applyMuteStates(); // ç¢ºä¿éœéŸ³ç‹€æ…‹
                    }
                }, 10000); // 10ç§’å¾Œé‡è¼‰
            }
        }

        labelElement.innerHTML = `${stream.place} (${stream.region}) - ${statusText} <span class="source-on-screen">${streamKey}</span>`;
    }

    /**
     * @param {YT.PlayerErrorEvent} event 
     */
    function onPlayerError(event) {
        const playerIndex = players.findIndex(p => p === event.target);
        if (playerIndex === -1) return;

        const labelElement = document.getElementById(LABEL_IDS[playerIndex]);
        const streamKey = ALL_STREAMS_KEYS[playerIndex];
        const stream = ALL_STREAMS[streamKey];
        
        if (!stream) return;

        const errorMsg = `${getTranslation('error')} (${event.data})`;

        // å˜—è©¦è‡ªå‹•é‡æ–°è¼‰å…¥ (é‡å°ç›´æ’­ä¸”éé‡è¼‰ä¸­)
        if (stream.isLive && !isReloading[playerIndex]) {
            const now = Date.now();
            if (now - lastReloadAt[playerIndex] > RELOAD_COOLDOWN_MS) {
                isReloading[playerIndex] = true;
                lastReloadAt[playerIndex] = now;
                
                setTimeout(() => {
                    if (event.target.loadVideoById) {
                        event.target.loadVideoById({ 
                            videoId: stream.id, 
                            suggestedQuality: 'hd720', 
                            playerVars: { autoplay: 1, mute: 1, loop: 0, modestbranding: 1, controls: 0 } 
                        });
                        labelElement.innerHTML = `${stream.place} (${stream.region}) - ${errorMsg} (Auto Reloading...) <span class="source-on-screen">${streamKey}</span>`;
                        isReloading[playerIndex] = false; // é‡è¼‰å¾Œè§£é™¤æ¨™è¨˜
                        applyMuteStates(); // ç¢ºä¿éœéŸ³ç‹€æ…‹
                    }
                }, 5000); // 5ç§’å¾Œé‡è¼‰
            }
        }

        labelElement.innerHTML = `${stream.place} (${stream.region}) - ${errorMsg} <span class="source-on-screen">${streamKey}</span>`;
    }
    
    // ----------------------------------------------------------------------
    // éœéŸ³/é¸å–ç•«é¢åŠŸèƒ½ (å·²ä¿®å¾©/æ–°å¢)
    // ----------------------------------------------------------------------
    
    // ä¿®å¾© 1.txt çš„éœéŸ³åŠŸèƒ½ï¼šå°‡æ‰€æœ‰ç•«é¢éœéŸ³ï¼Œé™¤äº†é¸ä¸­çš„ç•«é¢ (å¦‚æœ isSelectedCamMuted ç‚º false)
    function applyMuteStates() {
        players.forEach((p, i) => {
            if (p && p.isMuted) { // æª¢æŸ¥æ–¹æ³•æ˜¯å¦å­˜åœ¨
                // å¦‚æœæ˜¯é¸å®šçš„ç•«é¢ï¼Œä¸” isSelectedCamMuted ç‚º falseï¼Œå‰‡ unMute
                if (i === selectedCamIndex && !isSelectedCamMuted) {
                    try { p.unMute(); } catch(e) {}
                } else {
                    // å¦å‰‡ï¼ŒMute
                    try { p.mute(); } catch(e) {}
                }
            }
        });
    }

    // æ›¿æ›åŸ toggleMuteAllï¼Œç¾åœ¨å°ˆæ³¨æ–¼é¸å®šç•«é¢
    function toggleMuteSelectedCam() {
        if (!players[selectedCamIndex]) return;
        
        isSelectedCamMuted = !isSelectedCamMuted; // åˆ‡æ›ç‹€æ…‹
        
        if (isSelectedCamMuted) {
            try { players[selectedCamIndex].mute(); } catch(e) {}
            console.log(`Cam ${selectedCamIndex} muted.`);
        } else {
            try { players[selectedCamIndex].unMute(); } catch(e) {}
            console.log(`Cam ${selectedCamIndex} unmuted.`);
        }
        
        applyMuteStates(); // å†æ¬¡åŒæ­¥æ‰€æœ‰ç•«é¢çš„éœéŸ³ç‹€æ…‹
        refreshMuteButtonLabel(); // æ›´æ–°æŒ‰éˆ•æ–‡å­—
    }

    function refreshMuteButtonLabel() {
        const btn = document.getElementById('muteSelectedCamBtn'); // æ³¨æ„ ID è®Šæ›´
        if (!btn) return;

        // å¦‚æœé¸å®šç•«é¢è¢«éœéŸ³ï¼ŒæŒ‰éˆ•é¡¯ç¤ºã€Œè§£é™¤éœéŸ³ã€
        if (isSelectedCamMuted) {
            btn.textContent = getTranslation('mute_btn_unmuted');
            btn.title = getTranslation('mute_btn_unmuted');
            btn.classList.remove('active'); // ä¸ç™¼äº®
        } else {
            // å¦‚æœé¸å®šç•«é¢è¢«è§£é™¤éœéŸ³ï¼ŒæŒ‰éˆ•é¡¯ç¤ºã€ŒéœéŸ³ã€
            btn.textContent = getTranslation('mute_btn_muted');
            btn.title = getTranslation('mute_btn_muted');
            btn.classList.add('active'); // ç™¼äº® (è¡¨ç¤ºè©²ç•«é¢æœ‰è²éŸ³)
        }
        
        // æ›´æ–°å…¨åŸŸåœ°åœ–æ³¨è¨˜æŒ‰éˆ•ç‹€æ…‹
        const mapToggleBtn = document.getElementById('mapOverlayToggleBtn');
        if (mapToggleBtn) {
            if (isMapOverlayHidden) {
                mapToggleBtn.textContent = getTranslation('map_overlay_show');
            } else {
                mapToggleBtn.textContent = getTranslation('map_overlay_hide');
            }
        }
        
        // æ›´æ–°æ¨™ç±¤é–‹é—œæŒ‰éˆ•ç‹€æ…‹
        const labelsToggleBtn = document.getElementById('labelsToggleBtn');
        if (labelsToggleBtn) {
            const isHidden = document.body.classList.contains('hide-labels');
            if (isHidden) {
                labelsToggleBtn.textContent = getTranslation('labels_toggle_show');
            } else {
                labelsToggleBtn.textContent = getTranslation('labels_toggle_hide');
            }
        }
    }

    function selectCam(index) {
        // ç¢ºä¿ index åœ¨ç¯„åœå…§ä¸”ç•«é¢å­˜åœ¨
        const dimension = getGridDimension();
        const numPlayers = dimension * dimension;
        if (index < 0 || index >= numPlayers || !players[index]) return;

        // ç§»é™¤èˆŠé¸ä¸­ç•«é¢çš„æ¨™è¨˜
        document.querySelector(`.cell[data-index="${selectedCamIndex}"]`).classList.remove('selected');
        const oldPlayer = players[selectedCamIndex];

        if (index === selectedCamIndex) {
            // å¦‚æœé»æ“Šç•¶å‰ç•«é¢ï¼Œåˆ‡æ›éœéŸ³ç‹€æ…‹ (èˆ‡ toggleMuteSelectedCam æ•ˆæœç›¸åŒ)
            toggleMuteSelectedCam(); 
            return;
        }

        // éœéŸ³èˆŠç•«é¢ (å¦‚æœå®ƒå­˜åœ¨)
        if (oldPlayer) {
            try { oldPlayer.mute(); } catch(e) {}
        }

        selectedCamIndex = index;

        // æ¨™è¨˜æ–°é¸ä¸­ç•«é¢
        document.querySelector(`.cell[data-index="${selectedCamIndex}"]`).classList.add('selected');

        // æ›´æ–°æŒ‰éˆ• active ç‹€æ…‹
        document.querySelectorAll('#camSelectButtons button').forEach((btn, i) => {
            btn.classList.remove('active');
            if (i === index) btn.classList.add('active');
        });

        // å–æ¶ˆæ–°ç•«é¢çš„éœéŸ³ç‹€æ…‹ï¼Œé™¤é isSelectedCamMuted ç‚º true
        const newPlayer = players[index];
        if (newPlayer) {
            if (isSelectedCamMuted) {
                try { newPlayer.mute(); } catch(e) {}
            } else {
                try { newPlayer.unMute(); } catch(e) {}
            }
        }
        
        // æ›´æ–°éœéŸ³æŒ‰éˆ•æ¨™ç±¤å’Œå…¨å±€åœ°åœ–æ³¨è¨˜
        refreshMuteButtonLabel();
        updateMapOverlay(); // æ–°å¢ï¼šæ›´æ–°å…¨å±€åœ°åœ–æ³¨è¨˜
    }

    // ----------------------------------------------------------------------
    // å…¨è¢å¹•åŠŸèƒ½
    // ----------------------------------------------------------------------
    function toggleFullscreen() {
        const doc = window.document;
        const docEl = doc.documentElement;

        const requestFullScreen = docEl.requestFullscreen || docEl.mozRequestFullScreen || docEl.webkitRequestFullScreen || docEl.msRequestFullscreen;
        const cancelFullScreen = doc.exitFullscreen || doc.mozCancelFullScreen || doc.webkitExitFullscreen || doc.msExitFullscreen;

        if (!doc.fullscreenElement && !doc.mozFullScreenElement && !doc.webkitFullscreenElement && !doc.msFullscreenElement) {
            document.body.classList.add('fullscreen');
            requestFullScreen.call(docEl);
        } else {
            document.body.classList.remove('fullscreen');
            cancelFullScreen.call(doc);
        }
        
        // æ›´æ–°æŒ‰éˆ•æ–‡å­—
        setTimeout(() => {
            document.getElementById('fullscreenBtn').textContent = document.fullscreenElement ? getTranslation('fullscreen_exit') : getTranslation('fullscreen_btn');
        }, 100);
    }

    // ----------------------------------------------------------------------
    // éŸ³æ¨‚æ’­æ”¾å™¨ç›¸é—œ
    // ----------------------------------------------------------------------
    function initializeMusicPlayer() {
        musicPlayer = new YT.Player('musicControlsContainer', {
            height: '0',
            width: '0',
            videoId: '', // é è¨­ç„¡å½±ç‰‡
            playerVars: {
                controls: 0,
                autoplay: 0,
                modestbranding: 1
            },
            events: {
                'onReady': onMusicPlayerReady,
                'onStateChange': onMusicPlayerStateChange,
                'onError': onMusicPlayerError
            }
        });
    }

    function onMusicPlayerReady(event) {
        isMusicReady = true;
        // ç¢ºä¿éŸ³æ¨‚æ’­æ”¾å™¨éœéŸ³
        try { event.target.mute(); } catch(e) {}
        console.log("Music Player Ready. Muted.");
        // å˜—è©¦è¼‰å…¥ pending åˆ—è¡¨
        if (pendingPlaylistId) {
            loadPlaylistOrSingle(pendingPlaylistId);
            pendingPlaylistId = null;
        }
    }

    function onMusicPlayerStateChange(event) {
        // æ’­æ”¾ä¸­
        if (event.data === YT.PlayerState.PLAYING) {
            isPlaying = true;
            document.getElementById('playPauseBtn').textContent = 'â¸ï¸';
            document.getElementById('playPauseBtn').title = 'æš«åœ';
        } 
        // æš«åœæˆ–çµæŸ
        else if (event.data === YT.PlayerState.PAUSED || event.data === YT.PlayerState.ENDED) {
            isPlaying = false;
            document.getElementById('playPauseBtn').textContent = 'â–¶ï¸';
            document.getElementById('playPauseBtn').title = 'æ’­æ”¾';
            
            // è™•ç†æ’­æ”¾åˆ—è¡¨çµæŸ
            if (event.data === YT.PlayerState.ENDED && currentPlaylistId) {
                handlePlaylistEnd();
            }
        }
        // ä½‡åˆ—ä¸­
        else if (event.data === YT.PlayerState.CUED) {
            // Do nothing
        }
    }

    function onMusicPlayerError(event) {
        console.error("Music Player Error:", event.data);
        isPlaying = false;
        document.getElementById('playPauseBtn').textContent = 'â–¶ï¸';
        document.getElementById('playPauseBtn').title = 'æ’­æ”¾';
        showMessage(`éŸ³æ¨‚æ’­æ”¾éŒ¯èª¤: ${event.data}`, 'error');
        // å¦‚æœæ˜¯å–®æ›²æ’­æ”¾éŒ¯èª¤ï¼Œå˜—è©¦è·³åˆ°ä¸‹ä¸€é¦– (å¦‚æœæ˜¯åˆ—è¡¨æ¨¡å¼)
        if (currentPlaylistId) {
             skipToNextSong();
        }
    }

    function playPauseSong() {
        if (!musicPlayer || !isMusicReady) return;

        if (isPlaying) {
            try { musicPlayer.pauseVideo(); } catch(e) {}
        } else {
            try { musicPlayer.playVideo(); } catch(e) {}
        }
    }

    function skipToNextSong() {
        if (!musicPlayer || !isMusicReady) return;
        
        if (currentPlaylistId) {
            try {
                musicPlayer.nextVideo();
            } catch (e) {
                // å¦‚æœæ˜¯ playlist ä¸” nextVideo å¤±æ•— (å¯èƒ½åˆ°é”çµå°¾)ï¼Œæ‰‹å‹•è™•ç†
                handlePlaylistEnd(true);
            }
        } else if (musicQueue.length > 0) {
            // å–®æ›²æ¨¡å¼ï¼Œè·³éç•¶å‰ï¼Œæª¢æŸ¥ä¸‹ä¸€é¦–
            musicQueue.shift(); // ç§»é™¤ç•¶å‰æ’­æ”¾çš„
            if (musicQueue.length > 0) {
                const nextId = musicQueue[0].id;
                loadPlaylistOrSingle(nextId, 'single');
            } else {
                showMessage('æ’­æ”¾ä½‡åˆ—å·²ç©º', 'info');
                try { musicPlayer.stopVideo(); } catch(e) {}
            }
        } else {
            showMessage('ç„¡æ’­æ”¾å…§å®¹', 'info');
        }
    }

    function skipToPreviousSong() {
        if (!musicPlayer || !isMusicReady || !currentPlaylistId) {
            showMessage('éæ¸…å–®æ¨¡å¼æˆ–ç„¡æ’­æ”¾å…§å®¹', 'warning');
            return;
        }
        
        try { musicPlayer.previousVideo(); } catch(e) {}
    }

    function handlePlaylistEnd(forcedNext=false) {
        if (playbackMode === 'loop') {
            // è‡ªå‹•é‡é ­é–‹å§‹
            try { musicPlayer.playVideoAt(0); } catch(e) {}
            showMessage('æ’­æ”¾åˆ—è¡¨å¾ªç’°: é‡é ­é–‹å§‹', 'info');
        } else if (playbackMode === 'shuffle' && !forcedNext) {
            // çµæŸæ™‚çš„éš¨æ©Ÿæ’­æ”¾
            try { musicPlayer.setShuffle(true); musicPlayer.playVideo(); } catch(e) {}
            showMessage('æ’­æ”¾åˆ—è¡¨çµæŸ: è‡ªå‹•éš¨æ©Ÿæ’­æ”¾', 'info');
        } else if (playbackMode === 'shuffle' && forcedNext) {
            // å¼·åˆ¶åˆ‡æ›ä¸‹ä¸€é¦–æ™‚çš„éš¨æ©Ÿæ’­æ”¾ (é˜²æ­¢ nextVideo() å¤±æ•—)
            try { musicPlayer.setShuffle(true); musicPlayer.nextVideo(); } catch(e) {}
        } else if (playbackMode === 'stop') {
            try { musicPlayer.stopVideo(); } catch(e) {}
            currentPlaylistId = null;
            musicQueue = [];
            showMessage('æ’­æ”¾åˆ—è¡¨çµæŸ: å·²åœæ­¢', 'info');
        }
    }

    // ----------------------------------------------------------------------
    // éŸ³æ¨‚å½ˆçª—åŠŸèƒ½
    // ----------------------------------------------------------------------
    function openMusicRequestModal() {
        document.getElementById('musicRequestModal').style.display = 'flex';
        document.getElementById('requestStatus').textContent = '';
    }

    function closeMusicRequestModal() {
        document.getElementById('musicRequestModal').style.display = 'none';
    }

    function loadPlaylistOrSingle(id, type='playlist') {
        if (!musicPlayer || !isMusicReady) {
            pendingPlaylistId = id;
            showMessage('éŸ³æ¨‚æ’­æ”¾å™¨æœªæº–å‚™å¥½ï¼Œå°‡åœ¨æº–å‚™å¥½å¾Œè¼‰å…¥', 'warning');
            return;
        }
        
        // ç¢ºä¿æ’­æ”¾å™¨éœéŸ³
        try { musicPlayer.mute(); } catch(e) {}

        if (type === 'playlist') {
            currentPlaylistId = id;
            musicQueue = []; // æ¸…ç©ºå–®æ›²ä½‡åˆ—
            musicPlayer.loadPlaylist({
                list: id,
                listType: 'playlist',
                index: 0,
                suggestedQuality: 'small'
            });
            showMessage(`${getTranslation('request_status_list')} ${id}`, 'success');
            fetchPlaylistInfo(id);
        } else { // single
            currentPlaylistId = null;
            musicQueue = [{ id: id }]; // åªæœ‰ä¸€é¦–
            musicPlayer.loadVideoById({
                videoId: id,
                suggestedQuality: 'small'
            });
            showMessage(`${getTranslation('request_status_single')} ${id}`, 'success');
        }
    }

    function requestPlaySingle() {
        const id = document.getElementById('youtubeIdInput').value.trim();
        if (id) {
            loadPlaylistOrSingle(id, 'single');
            closeMusicRequestModal();
        } else {
            document.getElementById('requestStatus').textContent = 'è«‹è¼¸å…¥æœ‰æ•ˆçš„ ID';
        }
    }

    function requestPlayList() {
        const id = document.getElementById('youtubeIdInput').value.trim();
        if (id) {
            loadPlaylistOrSingle(id, 'playlist');
            closeMusicRequestModal();
        } else {
            document.getElementById('requestStatus').textContent = 'è«‹è¼¸å…¥æœ‰æ•ˆçš„ ID';
        }
    }

    function openMusicSettingsModal() {
        document.getElementById('modeCurrentStatus').textContent = `${getTranslation('music_mode_current')} ${playbackMode}`;
        document.querySelectorAll('#musicSettingsModal .btn-group button').forEach(btn => {
            btn.classList.remove('active');
            if (btn.id === `mode${playbackMode.charAt(0).toUpperCase() + playbackMode.slice(1)}Btn`) {
                btn.classList.add('active');
            }
        });
        document.getElementById('musicSettingsModal').style.display = 'flex';
    }

    function closeMusicSettingsModal() {
        document.getElementById('musicSettingsModal').style.display = 'none';
    }

    function setPlaybackMode(mode) {
        playbackMode = mode;
        localStorage.setItem('multi-view-music-mode', mode);
        
        // æ›´æ–° YouTube Player çš„è¨­å®š
        if (musicPlayer && currentPlaylistId) {
            try {
                // Loop mode is primarily handled manually in handlePlaylistEnd now
                musicPlayer.setShuffle(mode === 'shuffle');
            } catch(e) {}
        }
        
        openMusicSettingsModal(); // åˆ·æ–° UI
        showMessage(`æ’­æ”¾æ¨¡å¼å·²è¨­ç‚º: ${mode}`, 'info', 2000);
    }

    // ----------------------------------------------------------------------
    // æ’­æ”¾æ¸…å–®è³‡è¨Šç²å– (ä½¿ç”¨ Data API)
    // ----------------------------------------------------------------------

    function fetchPlaylistInfo(playlistId) {
        if (!playlistId) return;
        musicQueue = []; // æ¸…ç©ºèˆŠè³‡è¨Š
        
        let nextToken = null;
        let count = 0;
        
        function fetchPage() {
            let url = `https://www.googleapis.com/youtube/v3/playlistItems?part=snippet&maxResults=50&playlistId=${playlistId}&key=${YT_DATA_API_KEY}`;
            if (nextToken) {
                url += `&pageToken=${nextToken}`;
            }

            fetch(url)
                .then(response => response.json())
                .then(data => {
                    if (data.error) {
                        console.error('YouTube API Error:', data.error.message);
                        showMessage('ç„¡æ³•ç²å–æ’­æ”¾æ¸…å–®è³‡è¨Š', 'error', 5000);
                        return;
                    }

                    data.items.forEach(item => {
                        count++;
                        musicQueue.push({
                            id: item.snippet.resourceId.videoId,
                            title: item.snippet.title,
                            index: count - 1
                        });
                    });

                    nextToken = data.nextPageToken;

                    if (nextToken && count < 200) { // é™åˆ¶æœ€å¤šæŠ“ 200 é¦–
                        fetchPage();
                    } else {
                        console.log(`Finished fetching playlist. Total songs: ${musicQueue.length}`);
                        // æ’­æ”¾å™¨æœƒè‡ªå‹•è¼‰å…¥ï¼Œé€™è£¡åªæ˜¯å„²å­˜è³‡è¨Š
                    }
                })
                .catch(error => {
                    console.error('Fetch error:', error);
                    showMessage('ç¶²è·¯æˆ– API éŒ¯èª¤', 'error', 5000);
                });
        }

        fetchPage();
    }
    
    // ----------------------------------------------------------------------
    // æ’­æ”¾ä½‡åˆ—/æ¸…å–®ç‹€æ…‹å½ˆçª—
    // ----------------------------------------------------------------------
    function escapeHtml(unsafe) {
        if (!unsafe) return '';
        return unsafe.replace(/&/g, "&amp;").replace(/</g, "&lt;").replace(/>/g, "&gt;").replace(/"/g, "&quot;").replace(/'/g, "&#039;");
    }

    function showMusicQueueStatusModal() {
        const queueContentDiv = document.getElementById('queueContent');
        let content = '';

        if (currentPlaylistId) {
            content += `<p style="font-weight:bold; margin-bottom:10px;">${getTranslation('queue_current_playlist')} ${currentPlaylistId}</p>`;
            content += `<p style="font-size:12px; color:#888;">${getTranslation('queue_mode')} ${getTranslation('queue_mode_' + playbackMode)}</p>`;
        }

        if (musicQueue.length > 0) {
            content += `<ul class="queue-list" style="margin-top:10px;">`;
            musicQueue.forEach((item, index) => {
                let currentIndicator = '';
                if (musicPlayer && currentPlaylistId) {
                    try {
                        currentMusicIndex = musicPlayer.getPlaylistIndex();
                        if (index === currentMusicIndex) {
                            currentIndicator = ' â–¶ï¸';
                        }
                    } catch (e) {
                        // ignore
                    }
                } else if (!currentPlaylistId && index === 0) {
                     // å–®æ›²æ¨¡å¼
                     currentIndicator = ' â–¶ï¸';
                }

                content += `
                <li style="${index === currentMusicIndex ? 'background:#333; border-radius:4px; padding:8px 0;' : ''}">
                    <button onclick="playQueueAtIndex(${index})" title="${getTranslation('queue_play_index')}">
                        ${index + 1}${currentIndicator}
                    </button>
                    <div class="title">${(item && item.title) ? escapeHtml(item.title) : item.id}</div>
                    <div class="meta">ID:${item.id}</div>
                </li>`;
            });
            content += '</ul>';
        } else {
            if (pendingPlaylistId) {
                content += `<p style="color:#d70000; font-size:13px; margin-top:10px; padding:8px; border:1px dashed #d70000; border-radius:4px; text-align:center;">
                    ${getTranslation('queue_playlist_pending', pendingPlaylistId)}
                </p>`;
            }
            content += `<p style="color:#aaa; font-size:14px; text-align:center;">${getTranslation('queue_empty_queue')}</p>`;
        }
        
        queueContentDiv.innerHTML = content;
        document.getElementById('musicQueueModal').style.display = 'flex';
    }

    function closeMusicQueueModal() {
      document.getElementById('musicQueueModal').style.display = 'none';
    }

    function playPlaylistAtIndex(index) {
      if (!currentPlaylistId) return;
      try {
        musicPlayer.playVideoAt(index);
      } catch (e) {
        musicPlayer.playVideo();
      }
    }

    function playQueueAtIndex(index) {
        if (!musicPlayer || !isMusicReady) return;
        
        if (currentPlaylistId) {
            // æ¸…å–®æ¨¡å¼: è·³è½‰åˆ°æ¸…å–®ä¸­çš„æŒ‡å®šå½±ç‰‡
            try {
                musicPlayer.playVideoAt(index);
            } catch(e) {
                showMessage('ç„¡æ³•è·³è½‰åˆ°æ¸…å–®æŒ‡å®šç´¢å¼•', 'error');
            }
        } else if (musicQueue.length > 0) {
            // å–®æ›²æ¨¡å¼: é€™è£¡æ‡‰è©²åªæœ‰ä¸€é¦–ï¼Œå¦‚æœæœ‰å¤šé¦–å‰‡æ‡‰è©²æ˜¯æ’­æ”¾ä½‡åˆ—ï¼Œä½† YouTube API æ²’è¾¦æ³•ç›´æ¥è™•ç†éæ¸…å–®çš„ä½‡åˆ—
            // é€™è£¡çš„åšæ³•æ˜¯å¦‚æœåªæœ‰å–®æ›²ï¼Œå°±é‡æ–°æ’­æ”¾
            if (musicQueue.length === 1 && index === 0) {
                try {
                    musicPlayer.playVideo();
                } catch(e) {}
            } else {
                 showMessage('å–®æ›²æ¨¡å¼ä¸‹ç„¡æ³•è·³è½‰', 'warning');
            }
        }
        
        showMusicQueueStatusModal(); // åˆ·æ–° UI
    }

    // ----------------------------------------------------------------------
    // é€šç”¨è¼”åŠ©å‡½æ•¸
    // ----------------------------------------------------------------------
    function showMessage(msg, type = 'info', duration = 3000) {
        // ç°¡å–®çš„è¨Šæ¯é¡¯ç¤ºï¼Œä½¿ç”¨æ§åˆ¶åˆ—ä¸‹æ–¹çš„ç‹€æ…‹æ¬„æˆ– console
        const statusEl = document.getElementById('requestStatus');
        if (statusEl) {
            statusEl.textContent = msg;
            statusEl.style.color = type === 'error' ? '#d70000' : (type === 'warning' ? '#ffcc00' : '#fff');
            
            // ç”±æ–¼ requestStatus åªæœ‰åœ¨å½ˆçª—é–‹å•Ÿæ™‚å¯è¦‹ï¼Œé€™è£¡åªç”¨ console
            console.log(`[${type.toUpperCase()}] ${msg}`);
            
            // æ›´å¥½çš„åšæ³•æ˜¯å‰µå»ºä¸€å€‹æµ®å‹•çš„ toast è¨Šæ¯ï¼Œä½†é€™è£¡æš«æ™‚åªç”¨ console
        } else {
            console.log(`[${type.toUpperCase()}] ${msg}`);
        }
    }
    
    // ----------------------------------------------------------------------
    // åœ°åœ–æ³¨è¨˜åŠŸèƒ½ (æ–°å¢)
    // ----------------------------------------------------------------------
    
    // æ ¹æ“šç¶“ç·¯åº¦è¨ˆç®—åœ¨å°ç£åœ°åœ–ä¸Šçš„ pin åº§æ¨™ (ç°¡åŒ–æŠ•å½±)
    // å°ç£ç¶“ç·¯åº¦ç¯„åœå¤§è‡´ç‚º: ç·¯åº¦ 21.8 - 25.3, ç¶“åº¦ 119.5 - 122.0
    // åœ°åœ–åœ–ç‰‡å°ºå¯¸ç‚º 120x160 (å¯¬xé«˜)
    const TAIWAN_LON_MIN = 119.5;
    const TAIWAN_LON_MAX = 122.0;
    const TAIWAN_LAT_MIN = 21.8;
    const TAIWAN_LAT_MAX = 25.3;

    function getPinPosition(lat, lon) {
        // æ­¸ä¸€åŒ–ç¶“åº¦ (0 åˆ° 1)
        let lonNorm = (lon - TAIWAN_LON_MIN) / (TAIWAN_LON_MAX - TAIWAN_LON_MIN);
        // æ­¸ä¸€åŒ–ç·¯åº¦ (0 åˆ° 1)
        let latNorm = (lat - TAIWAN_LAT_MIN) / (TAIWAN_LAT_MAX - TAIWAN_LAT_MIN);
        
        // è½‰æ›ç‚ºåœ°åœ–åº§æ¨™ (120x160)
        // X åº§æ¨™: å¯¬åº¦ * æ­¸ä¸€åŒ–ç¶“åº¦
        let x = lonNorm * 120;
        // Y åº§æ¨™: é«˜åº¦ * (1 - æ­¸ä¸€åŒ–ç·¯åº¦) (Y è»¸å¾ä¸Šå¾€ä¸‹)
        let y = (1 - latNorm) * 160;
        
        // ç°¡å–®èª¿æ•´ä»¥é…åˆå°ç£åœ°åœ–å½¢ç‹€çš„è¦–è¦ºæ•ˆæœ
        // ç¨å¾®å‘å·¦ä¸Šæ–¹åç§»ï¼Œä»¥é©æ‡‰ SVG é‚Šç•Œ
        x = x * 0.95 + 10; 
        y = y * 0.85 + 15;

        // é™åˆ¶åœ¨é‚Šç•Œå…§
        x = Math.max(0, Math.min(120, x));
        y = Math.max(0, Math.min(160, y));

        return { x: x, y: y };
    }

    function updatePinPosition(pinId, lat, lon) {
        const pinElement = document.getElementById(pinId);
        if (pinElement && lat && lon) {
            const pos = getPinPosition(lat, lon);
            pinElement.style.left = `${pos.x}px`;
            pinElement.style.top = `${pos.y}px`;
        }
    }

    function updateCellMap(index) {
        const streamKey = ALL_STREAMS_KEYS[index];
        const stream = ALL_STREAMS[streamKey];
        const place = stream.place;
        
        // æ›´æ–° Pin åº§æ¨™
        if (COORDS[place]) {
            const { lat, lon } = COORDS[place];
            updatePinPosition(PIN_IDS[index], lat, lon);
            
            // æ›´æ–° Pin Label ä½ç½® (åœ¨ Pin çš„ä¸Šæ–¹)
            const pinLabelElement = document.getElementById(PIN_LABEL_IDS[index]);
            const pinElement = document.getElementById(PIN_IDS[index]);
            if (pinLabelElement && pinElement) {
                const pos = getPinPosition(lat, lon);
                pinLabelElement.style.left = `${pos.x}px`;
                pinLabelElement.style.top = `${pos.y - 12}px`; // å‘ä¸Šå¾®èª¿
                pinLabelElement.textContent = place;
            }
        }
    }

    function updateMapOverlay() {
        const dimension = getGridDimension();
        const numPlayers = dimension * dimension;
        
        // æ›´æ–°å…¨å±€åœ°åœ–æ³¨è¨˜ (Badge)
        const selectedStreamKey = ALL_STREAMS_KEYS[selectedCamIndex];
        const selectedStream = ALL_STREAMS[selectedStreamKey];
        const mapBadge = document.getElementById('mapBadge');
        if (mapBadge) {
             mapBadge.textContent = selectedStream ? `${getTranslation('map_badge_selected')} ${selectedStream.place} (${selectedStream.region})` : getTranslation('map_badge_default');
        }
        
        // éæ­·æ‰€æœ‰ Cellï¼Œæ›´æ–°åœ°åœ– Pin ä½ç½®
        for (let i = 0; i < MAX_PLAYERS; i++) {
            const cell = document.querySelector(`.cell[data-index="${i}"]`);
            const pin = document.getElementById(PIN_IDS[i]);
            const pinLabel = document.getElementById(PIN_LABEL_IDS[i]);

            if (i < numPlayers && ALL_STREAMS_KEYS[i] && COORDS[ALL_STREAMS[ALL_STREAMS_KEYS[i]].place]) {
                 // ç•«é¢å•Ÿç”¨ä¸”æœ‰åº§æ¨™
                if (cell) cell.querySelector('.taiwan-map').style.display = 'block';
                if (pin) pin.style.display = 'block';
                if (pinLabel) pinLabel.style.display = 'block';
                
                // è®“é¸ä¸­çš„ Pin é¡è‰²ä¸åŒ
                if (pin) pin.style.background = (i === selectedCamIndex) ? '#007aff' : '#ff3b30';
                if (pin) pin.style.boxShadow = (i === selectedCamIndex) ? '0 0 0 2px rgba(0,122,255,0.7)' : '0 0 0 2px rgba(255,59,48,0.35)';

                // å¼·åˆ¶æ›´æ–° Pin ä½ç½® (é˜²æ­¢é é¢ç¸®æ”¾æœªæ›´æ–°)
                updateCellMap(i);
            } else {
                // ç•«é¢æœªå•Ÿç”¨æˆ–ç„¡åº§æ¨™
                if (cell) cell.querySelector('.taiwan-map').style.display = 'none';
                if (pin) pin.style.display = 'none';
                if (pinLabel) pinLabel.style.display = 'none';
            }
        }
    }

    function toggleMapOverlay() {
        isMapOverlayHidden = !isMapOverlayHidden;
        localStorage.setItem(MAP_OVERLAY_TOGGLE_KEY, isMapOverlayHidden);
        document.body.classList.toggle('hide-map-overlay', isMapOverlayHidden);
        refreshMuteButtonLabel(); // æ›´æ–°æŒ‰éˆ•æ–‡å­—
    }

    // ----------------------------------------------------------------------
    // è¨­å®šå½ˆçª—åŠŸèƒ½ (æ–°å¢)
    // ----------------------------------------------------------------------
    function openMainSettingsModal() {
        document.getElementById('mainSettingsModal').style.display = 'flex';
        // ç¢ºä¿ Grid æŒ‰éˆ•ç‹€æ…‹æ­£ç¢º
        document.querySelectorAll('.grid-btn').forEach(btn => {
            btn.classList.remove('active');
            if (btn.id === `grid${currentGridSize.replace('x', 'x')}Btn`) {
                btn.classList.add('active');
            }
        });
        // ç¢ºä¿èªè¨€æŒ‰éˆ•ç‹€æ…‹æ­£ç¢º
        document.querySelectorAll('.lang-btn').forEach(btn => {
            btn.classList.remove('active');
            if (btn.id === `lang${currentLang}Btn`) {
                btn.classList.add('active');
            }
        });
        // ç¢ºä¿æ¨™ç±¤å’Œåœ°åœ–æŒ‰éˆ•æ–‡å­—æ­£ç¢º
        refreshMuteButtonLabel();
    }

    function closeMainSettingsModal() {
        document.getElementById('mainSettingsModal').style.display = 'none';
    }

    function setGridSize(size, resetStream = true) {
        if (!['1x1', '2x2', '3x3'].includes(size)) return;
        
        currentGridSize = size;
        localStorage.setItem('multi-view-grid', size);
        
        const stageWrap = document.getElementById('stageWrap');
        stageWrap.className = `stage-wrap grid-${size}`;
        
        const dimension = getGridDimension();
        const numPlayers = dimension * dimension;
        
        // éš±è—æˆ–é¡¯ç¤ºå°æ‡‰çš„ç•«é¢æ ¼
        for (let i = 0; i < MAX_PLAYERS; i++) {
            const cell = document.querySelector(`.cell[data-index="${i}"]`);
            if (cell) {
                cell.style.display = (i < numPlayers) ? 'block' : 'none';
            }
        }
        
        // æ›´æ–°æ§åˆ¶åˆ—çš„æŒ‰éˆ•
        updateCamSelectButtons(numPlayers);

        // æ›´æ–°æŒ‰éˆ• active ç‹€æ…‹
        document.querySelectorAll('.grid-btn').forEach(btn => {
            btn.classList.remove('active');
            if (btn.id === `grid${size.replace('x', 'x')}Btn`) {
                btn.classList.add('active');
            }
        });
        
        // é‡è¨­æˆ–æ›´æ–°ç•«é¢
        if (resetStream) {
            // é‡æ–°è¼‰å…¥ç•¶å‰åœ°å€çš„ä¸²æµåˆ°æ–°å°ºå¯¸çš„ç•«é¢ä¸­
            loadRegion(currentRegion, 
                document.querySelector('#regionButtons button.active') ? 
                Array.from(document.querySelectorAll('#regionButtons button')).indexOf(document.querySelector('#regionButtons button.active')) : 0);
            
            // é¸æ“‡ç¬¬ä¸€å€‹ç•«é¢ (0)
            selectCam(0);
        } else {
             // åƒ…æ›´æ–°åœ°åœ–å’Œé¸ä¸­ç•«é¢ç‹€æ…‹
             selectCam(selectedCamIndex);
        }
        
        if (resetStream) {
             showMessage('ç•«é¢åˆ†å‰²æ¨¡å¼å·²è®Šæ›´', 'success', 2000);
             closeMainSettingsModal();
        }
    }

    function toggleLabels() {
        const isHidden = document.body.classList.toggle('hide-labels');
        localStorage.setItem(LABELS_HIDDEN_KEY, isHidden);
        refreshMuteButtonLabel(); // æ›´æ–°æŒ‰éˆ•æ–‡å­—
    }

    // ----------------------------------------------------------------------
    // ç¨‹å¼å•Ÿå‹•
    // ----------------------------------------------------------------------
    
    // è¼‰å…¥ YouTube Iframe Player API
    const tag = document.createElement('script');
    tag.src = "https://www.youtube.com/iframe_api";
    const firstScriptTag = document.getElementsByTagName('script')[0];
    firstScriptTag.parentNode.insertBefore(tag, firstScriptTag);
    
    // ç¢ºä¿åœ¨æ–‡ä»¶è¼‰å…¥å®Œæˆå¾Œåˆå§‹åŒ–
    window.onload = function() {
        // æª¢æŸ¥èªè¨€è¨­å®š
        const storedLang = localStorage.getItem(LANG_KEY);
        if (storedLang && LANGUAGE_PACKS[storedLang]) {
            currentLang = storedLang;
        }
        
        // æª¢æŸ¥æ’­æ”¾æ¨¡å¼è¨­å®š
        const storedMode = localStorage.getItem('multi-view-music-mode');
        if (storedMode && ['loop', 'shuffle', 'stop'].includes(storedMode)) {
            playbackMode = storedMode;
        }

        // åƒ…åœ¨ YT API Ready å¾Œæ‰åŸ·è¡Œåˆå§‹åŒ–
    };
    
</script>

</body>
</html>
